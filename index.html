<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'https:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "59f7787a"
    });
  daovoice('update');
  </script>















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="保持饥渴,保持愚蠢.">
<meta property="og:type" content="website">
<meta property="og:title" content="Jesse&#39;s home">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jesse&#39;s home">
<meta property="og:description" content="保持饥渴,保持愚蠢.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jesse&#39;s home">
<meta name="twitter:description" content="保持饥渴,保持愚蠢.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Jesse's home</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jesse's home</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/MYSQL表锁和事务控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/MYSQL表锁和事务控制/" itemprop="url">MYSQL表锁和事务控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/MYSQL表锁和事务控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/MYSQL表锁和事务控制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MYSQL表锁和事务控制"><a href="#MYSQL表锁和事务控制" class="headerlink" title="MYSQL表锁和事务控制"></a>MYSQL表锁和事务控制</h2><h3 id="一-锁表"><a href="#一-锁表" class="headerlink" title="一.锁表"></a>一.锁表</h3><p>锁表语句:LOCK table </p>
<p>解锁语句:UNLOCK table </p>
<p>用法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock table 表名 &#123;read [local] | [low_prioriy] WRITE&#125;</span><br></pre></td></tr></table></figure>
<p>例如: lock table emp read; 锁定emp表</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; lock table emp read;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>开启另外一个终端.执行select查询该表.仍然可以正常查询 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>尝试修改表数据.语句被卡主,会等待表锁解除.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update emp set sal=500 where ename=&apos;tony&apos;;</span><br></pre></td></tr></table></figure>
<p>解除表锁:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; unlock tables;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>另外一个终端数据已经成功修改…显示语句执行了1分钟,其实就是等待锁释放的时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update emp set sal=500 where ename=&apos;tony&apos;;</span><br><span class="line">Query OK, 1 row affected (1 min 8.77 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="二-事务控制"><a href="#二-事务控制" class="headerlink" title="二.事务控制"></a>二.事务控制</h3><p>MYSQL默认情况下是自动提交的,如果需要明确的commit和rollback来提交和回滚事务.那么需要通过明确的事务控制命令来开始事务.</p>
<p><strong>事务控制语法如下:</strong></p>
<p>START TRANSACTION 或者 begin 语句开始一项新事务</p>
<p>COMMIT和ROLLBACK用来提交或者回滚事务</p>
<p>CHAIN和RELEASE字句分别用来定义在事务提交或者回滚之后的操作.CHAIN会立即启动一个新事物,release会断开和客户端连接</p>
<p>SET AUTOCOMMIT={0|1} 可以修改当前连接的提交方式,如果set autocommit=0 则之后的所有事务都需要通过明确命令的进行提交或者回滚</p>
<p><strong>一.演示如何使用事务控制:</strong></p>
<p>1.在终端1和终端2上查询tony的sal:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sal from emp where ename=&apos;tony&apos;;</span><br><span class="line"></span><br><span class="line">+------+</span><br><span class="line">| sal  |</span><br><span class="line">+------+</span><br><span class="line">|  500 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>2.在终端1上用start transaction启动一个事务.把tony的sal改成1000.没有提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update emp set sal=1000 where ename=&apos;tony&apos;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings:</span><br></pre></td></tr></table></figure>
<p>3.在终端1和终端2上再次查询tony的sal;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sal from emp where ename=&apos;tony&apos;;</span><br><span class="line">+------+</span><br><span class="line">| sal  |</span><br><span class="line">+------+</span><br><span class="line">| 1000 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select sal from emp where ename=&apos;tony&apos;;</span><br><span class="line">+------+</span><br><span class="line">| sal  |</span><br><span class="line">+------+</span><br><span class="line">|  500 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>可以看到终端1上生效了,但是终端2上并没有生效</p>
<p>4.在终端1上执行提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; commit;</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure>
<p>5.在终端2上再次查询,发现已经成功更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sal from emp where ename=&apos;tony&apos;;</span><br><span class="line">+------+</span><br><span class="line">| sal  |</span><br><span class="line">+------+</span><br><span class="line">| 1000 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>二,演示用commit and chain的效果:</strong></p>
<p>1.在终端1上开启一个事务.插入一条新数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into emp(ename,hiredate,sal,deptno) values(&apos;aron&apos;,&apos;2003-06-07&apos;,&apos;1500&apos;,4);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>2.用commit and chain提交.然后再次插入一个新记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; commit and chain;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; insert into emp values(&apos;jenny&apos;,&apos;2004-01-01&apos;,&apos;800&apos;,4);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br></pre></td></tr></table></figure>
<p>3.在终端2上查看emp表.发现刚才插入的jenny数据没有看到.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where ename=&apos;aron&apos; or ename=&apos;jenny&apos;;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| aron  | 2003-06-07 | 1500 |      4 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>4.在终端1上commit.然后终端2再次查看.这次看到了jenny</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where ename=&apos;aron&apos; or ename=&apos;jenny&apos;;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| aron  | 2003-06-07 | 1500 |      4 |</span><br><span class="line">| jenny | 2004-01-01 |  800 |      4 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>3.演示回滚操作</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update emp set sal=1000 where ename=&apos;tony&apos;;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select sal from emp where ename=&apos;tony&apos;;</span><br><span class="line">+------+</span><br><span class="line">| sal  |</span><br><span class="line">+------+</span><br><span class="line">| 1000 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; rollback;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select sal from emp where ename=&apos;tony&apos;;</span><br><span class="line">+------+</span><br><span class="line">| sal  |</span><br><span class="line">+------+</span><br><span class="line">|  600 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p> note:DDL语句不能回滚.</p>
</blockquote>
<hr>
<p><strong>4.演示一个新事务会隐含一个Unlock table的操作</strong></p>
<p>1.对emp进行加锁</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; lock table emp write;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>2.终端2上查询emp表数据.select读操作被阻塞.等待锁被释放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp;</span><br></pre></td></tr></table></figure>
<p>3.在终端1上开启一个start transaction新事务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>4.终端2上发现锁被释放了.可以查询了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       |  600 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| magge | 2000-02-03 | NULL |   NULL |</span><br><span class="line">| aron  | 2003-06-07 | 1500 |      4 |</span><br><span class="line">| jenny | 2004-01-01 |  800 |      4 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">8 rows in set (39.31 sec)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>演示回滚部分操作</strong></p>
<p>通过定义savepoint,可以指定回滚到哪个部分(有点类似于快照).如果定义相同的savepoint名字,则后面的会覆盖前面的</p>
<p>release savepoint命令 可以删除一个savepoint.</p>
<p>1.启动一个事务,插入一条新记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; insert into emp values(&apos;hebbt&apos;,&apos;2006-08-08&apos;,1300,5);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>2.定义一个savepoint.名称为test,并且插入第二条数据,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; savepoint test;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; insert into emp values(&apos;micheal&apos;,&apos;2006-08-08&apos;,1600,5);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>3.查询是否有这两条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where ename=&apos;hebbt&apos; or ename=&apos;micheal&apos;;</span><br><span class="line">+---------+------------+------+--------+</span><br><span class="line">| ename   | hiredate   | sal  | deptno |</span><br><span class="line">+---------+------------+------+--------+</span><br><span class="line">| hebbt   | 2006-08-08 | 1300 |      5 |</span><br><span class="line">| micheal | 2006-08-08 | 1600 |      5 |</span><br><span class="line">+---------+------------+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>4.在终端2上查询是否有这两条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where ename=&apos;hebbt&apos; or ename=&apos;micheal&apos;;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>5.回滚到刚才定义的savepoint.并且在终端1上再次查询.发现只有1条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; rollback to savepoint test;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; select * from emp where ename=&apos;hebbt&apos; or ename=&apos;micheal&apos;;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| hebbt | 2006-08-08 | 1300 |      5 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>6.commit提交,再次在终端1和终端2上查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; select * from emp where ename=&apos;hebbt&apos; or ename=&apos;micheal&apos;;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| hebbt | 2006-08-08 | 1300 |      5 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在终端2上只看到commit后的第一条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select * from emp where ename=&apos;hebbt&apos; or ename=&apos;micheal&apos;;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| hebbt | 2006-08-08 | 1300 |      5 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p> savepoint之后的记录没有被commit.有点类似于快照..快照点之后的数据没有被恢复</p>
</blockquote>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/mysql-DML操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/mysql-DML操作/" itemprop="url">DML操作命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/mysql-DML操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/mysql-DML操作/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="DML操作命令"><a href="#DML操作命令" class="headerlink" title="DML操作命令"></a>DML操作命令</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>DML(Data Manipulation Language)—–数据库操纵语句.主要用于增删改查数据库.常用的有insert,delete,update,select</p>
<p>本章主要介绍mysql的DML的增删改查语句用法.</p>
<hr>
<h4 id="一-增-insert-into"><a href="#一-增-insert-into" class="headerlink" title="一.增(insert into)"></a>一.增(insert into)</h4><p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名(列名1.列名2.....) VALUES(值1,值2.....)</span><br></pre></td></tr></table></figure>
<p>例1,向emp表插入ename为jesse,hiredate为2000-01-01,sal为2000,deptno为1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into emp(ename,hiredate,sal,deptno)values(&apos;jesse&apos;,&apos;2000-01-01&apos;,&apos;2000&apos;,1);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>note:<br>1.可以省略列名,直接指定values,但是值必须和表中的列名字段对应<br>2.有默认值,允许为空,或者自增的列名,可以不给值</p>
</blockquote>
<p>例2:只插入ename为tony,sal为1000的字段:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into emp(ename,sal)values(&apos;tony&apos;,&apos;1000&apos;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例3.一次插入多个值</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 (列名1,列名2,列名3......)values(值1,值2....),(值1,值2,.....)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table dept(deptno int(2),deptname varchar(20));</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">mysql&gt; desc dept;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| deptno   | int(2)      | YES  |     | NULL    |       |</span><br><span class="line">| deptname | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into dept values(1,&apos;IT&apos;),(2,&apos;Finance&apos;),(3,&apos;admin&apos;),(4,&apos;design&apos;);</span><br><span class="line">Query OK, 4 rows affected (0.01 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dept;</span><br><span class="line">+--------+----------+</span><br><span class="line">| deptno | deptname |</span><br><span class="line">+--------+----------+</span><br><span class="line">|      1 | IT       |</span><br><span class="line">|      2 | Finance  |</span><br><span class="line">|      3 | admin    |</span><br><span class="line">|      4 | design   |</span><br><span class="line">+--------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into emp(ename,hiredate,sal,deptno)values(&apos;jerry&apos;,&apos;2000-02-02&apos;,2000,2),(&apos;david&apos;,&apos;2001-02-02&apos;,1000,3),(&apos;jimmy&apos;,&apos;1999-01-01&apos;,3000,3);</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 2000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 1000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 3000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="二-改-Update-表-set"><a href="#二-改-Update-表-set" class="headerlink" title="二.改(Update 表 set)"></a>二.改(Update 表 set)</h4><p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE 表名 SET 列名1=值,列名2=值.......[WHERE 条件]</span><br></pre></td></tr></table></figure>
<p>例1.将jesse的薪水从2000改成4000</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update emp set sal=&apos;4000&apos; where ename=&apos;jesse&apos;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jesse | 2000-01-01 | 4000 |      1 |</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 2000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 1000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 3000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>同时更新多表</p>
<p>例2.将emp表中的每个人的sal乘以他在dept表中对应的部门ID号,另外将dept表中的employee字段改成emp表中的ename.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update emp a,dept b set a.sal=a.sal*b.deptno,b.employee=a.ename where a.deptno=b.deptno;</span><br><span class="line">Query OK, 6 rows affected (0.01 sec)</span><br><span class="line">Rows matched: 7  Changed: 6  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jesse | 2000-01-01 | 4000 |      1 |</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dept;</span><br><span class="line">+--------+----------+----------+</span><br><span class="line">| deptno | deptname | employee |</span><br><span class="line">+--------+----------+----------+</span><br><span class="line">|      1 | IT       | jesse    |</span><br><span class="line">|      2 | Finance  | jerry    |</span><br><span class="line">|      3 | admin    | david    |</span><br><span class="line">|      4 | design   | NULL     |</span><br><span class="line">+--------+----------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解析:<br>将表emp设置别名为a.dept表设置别名为b.设置别名只是为了后续操作可以省略打上长长的表名,而使用别名替代a.sal 实际上就等于emp.sal </p>
</blockquote>
<hr>
<h4 id="三-删-Delete-from表"><a href="#三-删-Delete-from表" class="headerlink" title="三.删(Delete from表)"></a>三.删(Delete from表)</h4><p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM 表名 [where 条件]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>note:<strong>如果不指定where条件,则删除表内所有记录</strong>…..小心操作</p>
</blockquote>
<p>例1:删除tony表记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from emp where ename=&apos;tony&apos;;</span><br></pre></td></tr></table></figure>
<p>例2.删除多个表中的多个记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE 1,2,3 ...... from 表1,表2,表3..... where 条件</span><br></pre></td></tr></table></figure>
<p>例3.删除emp表中,和dept表中,deptno为1的记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete a,b from emp a,dept b where a.deptno=b.deptno and a.deptno=1;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dept;</span><br><span class="line">+--------+----------+----------+</span><br><span class="line">| deptno | deptname | employee |</span><br><span class="line">+--------+----------+----------+</span><br><span class="line">|      2 | Finance  | jerry    |</span><br><span class="line">|      3 | admin    | david    |</span><br><span class="line">|      4 | design   | NULL     |</span><br><span class="line">+--------+----------+----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="四-查询-select-FROM-表"><a href="#四-查询-select-FROM-表" class="headerlink" title="四.查询(select * FROM 表)"></a>四.查询(select * FROM 表)</h4><p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM 表名 [where 条件]</span><br></pre></td></tr></table></figure>
<p><strong>1.查询不重复的记录.</strong></p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distinct关键字</span><br></pre></td></tr></table></figure>
<p>例1.查询emp表中不重复的deptno部门ID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct deptno from emp;</span><br><span class="line">+--------+</span><br><span class="line">| deptno |</span><br><span class="line">+--------+</span><br><span class="line">|   NULL |</span><br><span class="line">|      2 |</span><br><span class="line">|      3 |</span><br><span class="line">|      1 |</span><br><span class="line">+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>2.where条件查询</strong></p>
<p>这里涉及到条件判断的运算符,大概有下列运算符:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">= 等于,&lt;,&gt; &gt;=,&lt;=,!=.or,and等</span><br></pre></td></tr></table></figure>
<p>例2.多条件的where判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where deptno&gt;2 and sal&gt;2000;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>3.排序和限制(关键字 ORDER BY 和 LIMIT)</strong></p>
<p><strong>排序</strong></p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM 表名 [where 条件 [ORDER BY 列名1 [DESC|ASC],列名2 [DESC|ASC]]]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:<br>ORDER BY 后面跟多个列名.先按列名1进行排序,如果第一个列的值一样,也就是列名1有多个重复的值,那么这几个重复的值就按列名2的值来排序……依次类推<br>DESC表示降序,ASC表示升序.默认是ASC</p>
</blockquote>
<p>例3.将emp表按工资从高到低进行排序:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp order by sal;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例3-2:按deptno排序,对于重复的deptno,按工资从高到低排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp order by deptno,sal desc;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>Limit</strong></p>
<p>如果对于排序后的输出,只显示一部分,而不是全部.就可以使用Limit关键字,表示限制输出的行数</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">limit 初始偏移量(默认为0),限制行数</span><br></pre></td></tr></table></figure>
<p>例3-3:对工资进行排序,并且只显示3行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp order by sal limit 3;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| tony  | NULL       | 1000 |   NULL |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例3-4:从第二行开始显示,显示3行..(偏移量设置为1)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp order by sal limit 1,3;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>4.聚合 (GROUP BY, WITH, HAVING关键字)</strong></p>
<p>聚合用来做汇总操作.语法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT [列名1,列名2] 聚合操作 FROM 表名 [WHERE 条件] [GROUP BY 列名1,列名2.....] [with ROLLUP] [HAVING  条件]</span><br></pre></td></tr></table></figure>
<p>聚合操作也就是一些聚合函数.常用的有 sum求和,count(*)记录数,MAX,MIN<br>GROUP BY 表示要进行聚合的字段,如果按照部门分类,那么就是group by 部门<br>WITH ROLLUP 表示是否对分类聚合后的结果再汇总<br>HAVING 表示对分类后的结果再进行条件过滤  </p>
<p>例4:查看emp表中的总人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(1) from emp;</span><br><span class="line">+----------+</span><br><span class="line">| count(1) |</span><br><span class="line">+----------+</span><br><span class="line">|        5 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例4-1:统计deptno部门ID中各部门的人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,count(1) from emp group by deptno;</span><br><span class="line">+--------+----------+</span><br><span class="line">| deptno | count(1) |</span><br><span class="line">+--------+----------+</span><br><span class="line">|   NULL |        1 |</span><br><span class="line">|      1 |        1 |</span><br><span class="line">|      2 |        1 |</span><br><span class="line">|      3 |        2 |</span><br><span class="line">+--------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例4-2:既统计各部门人数,又统计总人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,count(1) from emp group by deptno with rollup;</span><br><span class="line">+--------+----------+</span><br><span class="line">| deptno | count(1) |</span><br><span class="line">+--------+----------+</span><br><span class="line">|   NULL |        1 |</span><br><span class="line">|      1 |        1 |</span><br><span class="line">|      2 |        1 |</span><br><span class="line">|      3 |        2 |</span><br><span class="line">|   NULL |        5 |</span><br><span class="line">+--------+----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例4-3:统计人数大于1的部门ID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,count(1) from emp group by deptno having  count(1)&gt;1;</span><br><span class="line">+--------+----------+</span><br><span class="line">| deptno | count(1) |</span><br><span class="line">+--------+----------+</span><br><span class="line">|      3 |        2 |</span><br><span class="line">+--------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>例4-4:统计公司所有员工的薪水总额,最高薪水,最低薪水</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sum(sal),max(sal),min(sal) from emp;</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">| sum(sal) | max(sal) | min(sal) |</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">|    19000 |     9000 |     1000 |</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>5.表连接 (关键字 left join,right join)</strong></p>
<p>表连接分为内连接和外链接</p>
<p><strong>内连接</strong>:最常用,仅显示两张表匹配的记录,<br><strong>外连接</strong>—-又分为左连接,右连接  </p>
<p><strong>左连接</strong>:显示所有左表中的记录,以及与之匹配的右表记录.—关键字:left join<br><strong>右连接</strong>:显示所有的右表记录,以及与之匹配的左表记录—-关键字:right</p>
<p>外连接格式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 左表名 left|right join 右表名 on 左表字段=右表字段</span><br></pre></td></tr></table></figure>
<p>内连接用法刚刚演示过了.比如查询emp表中的ename,dept表中的deptname</p>
<p>例5:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename,deptname from emp,dept where emp.deptno=dept.deptno;</span><br><span class="line">+-------+----------+</span><br><span class="line">| ename | deptname |</span><br><span class="line">+-------+----------+</span><br><span class="line">| jerry | Finance  |</span><br><span class="line">| david | admin    |</span><br><span class="line">| jimmy | admin    |</span><br><span class="line">| jesse | IT       |</span><br><span class="line">+-------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>左连接: 还是刚刚的例子,但是这次会显示emp表中,没有和dept表中deptno字段匹配到的其他记录</p>
<p>例5-1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename,deptname from emp left join dept on  emp.deptno=dept.deptno;</span><br><span class="line">+-------+----------+</span><br><span class="line">| ename | deptname |</span><br><span class="line">+-------+----------+</span><br><span class="line">| jerry | Finance  |</span><br><span class="line">| david | admin    |</span><br><span class="line">| jimmy | admin    |</span><br><span class="line">| jesse | IT       |</span><br><span class="line">| tony  | NULL     |</span><br><span class="line">+-------+----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">这里把没有匹配到的左表的tony显示出来了.右连接情况类似,不再赘述</span><br></pre></td></tr></table></figure>
<p><strong>6.子查询 (关键字 in,not in, =,!=,exists,not exists)</strong></p>
<p>子查询表示当进行查询的时候,where 的条件是另外一个查询的结果.</p>
<p>例6.在emp表中查询在dept表中有记录的deptno.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where deptno in(select deptno from dept);</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>如果子查询的记录数是唯一的,那么可以用=替代in.例6-1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from emp where deptno =(select deptno from dept where deptno=1);</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">或者:</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp where deptno =(select deptno from dept limit 1);</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>子查询也可以转化成表连接,刚才的例子用表连接同样可以实现.例如6-2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select emp.* from emp,dept where emp.deptno=dept.deptno;</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| ename | hiredate   | sal  | deptno |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">| jerry | 2000-02-02 | 4000 |      2 |</span><br><span class="line">| david | 2001-02-02 | 3000 |      3 |</span><br><span class="line">| jimmy | 1999-01-01 | 9000 |      3 |</span><br><span class="line">| jesse | 2000-01-01 | 2000 |      1 |</span><br><span class="line">+-------+------------+------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>7.记录联合 (关键字,union,union all)</strong></p>
<p>记录联合用来将多个表的数据按照一定的查询条件查询出来后,将结果合并一起输出.<br>union表示输出的结果进行一个distinct去除重复数据.<br>union all表示显示联合后的所有信息</p>
<p>语法: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM 表1 UNION|UNION ALL SELECT * FROM 表2 .............................一直到表N</span><br></pre></td></tr></table></figure>
<p>例7:将emp和dept的部门编号集合显示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno from emp</span><br><span class="line">    -&gt; union</span><br><span class="line">    -&gt; select deptno from dept;</span><br><span class="line">+--------+</span><br><span class="line">| deptno |</span><br><span class="line">+--------+</span><br><span class="line">|   NULL |</span><br><span class="line">|      2 |</span><br><span class="line">|      3 |</span><br><span class="line">|      1 |</span><br><span class="line">|      4 |</span><br><span class="line">+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/mysql-DDL操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/mysql-DDL操作/" itemprop="url">DDL操作命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/mysql-DDL操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/mysql-DDL操作/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="DDL操作命令"><a href="#DDL操作命令" class="headerlink" title="DDL操作命令"></a>DDL操作命令</h2><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>DDL (Data Definition Language) —-数据定义语言.定义数据库,表,列,索引,字段等数据库对象,常用的语句有:create,drop,alter</p>
<hr>
<h4 id="一-数据库操作"><a href="#一-数据库操作" class="headerlink" title="一.数据库操作"></a>一.数据库操作</h4><p>1.创建一个数据库:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE dbname</span><br><span class="line">mysql&gt; create database mytest;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>2.查看当前数据库中存在哪些数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">show databases</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| mytest             |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">| test1              |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>information_schema:主要存储系统中一些数据库对象信息.比如用户表信息,列信息,权限,字符集,分区等<br>cluster: 存储系统集群信息<br>mysql:存储系统用户权限  </p>
</blockquote>
<p>3.使用数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mytest</span><br><span class="line">mysql&gt; use mytest;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure>
<p>4.查看刚才使用的数据库中的所有表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show tables</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这是刚创建的数据库,所以没有任何表</p>
</blockquote>
<p>5.删除一个数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop database dbname;</span><br><span class="line">mysql&gt; drop database test1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>note:请谨慎操作任何drop,delete等删除相关语句</p>
</blockquote>
<hr>
<h4 id="二-数据表操作"><a href="#二-数据表操作" class="headerlink" title="二.数据表操作"></a>二.数据表操作</h4><p>1.在数据库中创建一张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE 表名(列名1,字段类型,约束条件</span><br><span class="line">                                列名2,字段类型,约束条件</span><br><span class="line">                                列名n,字段类型,约束条件)</span><br></pre></td></tr></table></figure>
<p>列如:创建一个emp表,包含ename(列名1,字段类型是varchar(10)).hiredate(列名2,字段类型是date),sal(列名3,字段类型int(2),以及deptno</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table emp(ename varchar(10),hiredate date,sal int(2),deptno int(2));</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br></pre></td></tr></table></figure>
<p>2.查看表的定义:</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC 表名;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| hiredate | date        | YES  |     | NULL    |       |</span><br><span class="line">| sal      | int(2)      | YES  |     | NULL    |       |</span><br><span class="line">| deptno   | int(2)      | YES  |     | NULL    |       |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>3.查看创建该表事的SQL语句:</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table 表名;</span><br></pre></td></tr></table></figure>
<p>例如.查看emp表是如何创建的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table emp;</span><br><span class="line">+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table | Create Table |</span><br><span class="line">+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| emp | CREATE TABLE `emp` (</span><br><span class="line">`ename` varchar(10) DEFAULT NULL,</span><br><span class="line">`hiredate` date DEFAULT NULL,</span><br><span class="line">`sal` int(2) DEFAULT NULL,</span><br><span class="line">`deptno` int(2) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1 ###除了可以看到表定义外,还看到了数据库引擎和字符集</span><br><span class="line">+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>4.删除表</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE 表名</span><br></pre></td></tr></table></figure>
<p>例如.删除emp表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table emp;</span><br></pre></td></tr></table></figure>
<p>5.修改表—-alter table语句</p>
<p>5.1修改表类型</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 MODIFY 列名 列字段定义 [FIRST | AFTER 列名]</span><br></pre></td></tr></table></figure>
<p>例如:将emp表中的ename列的字段类型从varchar(10) 改成varchar(20)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp modify ename varchar(20);</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename | varchar(20) | YES | | NULL | |</span><br></pre></td></tr></table></figure>
<p>5.2增加表字段</p>
<p>语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ADD 列名 列字段类型 [FIRST | AFTER 列名]</span><br></pre></td></tr></table></figure>
<p>例如:增加age列,字段类型为int(3)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp add age int(3);</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename | varchar(20) | YES | | NULL | |</span><br><span class="line">| hiredate | date | YES | | NULL | |</span><br><span class="line">| sal | int(2) | YES | | NULL | |</span><br><span class="line">| deptno | int(2) | YES | | NULL | |</span><br><span class="line">| age | int(3) | YES | | NULL | |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>5.3 删除表字段</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 DROP 列名</span><br></pre></td></tr></table></figure>
<p>例如:将age删掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp drop age;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename | varchar(20) | YES | | NULL | |</span><br><span class="line">| hiredate | date | YES | | NULL | |</span><br><span class="line">| sal | int(2) | YES | | NULL | |</span><br><span class="line">| deptno | int(2) | YES | | NULL | |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>5.4 字段改名.</p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 CHANGE 旧列名 新列名 列字段类型</span><br></pre></td></tr></table></figure>
<p>例如:将age改为age1,同时将字段类型改为int(3)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp change age age1 int(4);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename | varchar(20) | YES | | NULL | |</span><br><span class="line">| hiredate | date | YES | | NULL | |</span><br><span class="line">| sal | int(2) | YES | | NULL | |</span><br><span class="line">| deptno | int(2) | YES | | NULL | |</span><br><span class="line">| age1 | int(4) | YES | | NULL | |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:change和notify都可以修改表定义.change需要些两次列名.但是change可以修改队列名,modify不可以</p>
</blockquote>
<blockquote>
<p>Note:前面介绍的字段增加和修改语法中都有一个[FIRST|AFTER 列名]的可选项.这个选项用来修改某个列名在表中的位置.ADD默认将列放在表的最后位置,CHANGE/MODIFY不会修改表位置.</p>
</blockquote>
<p>例如:将age1列名改回到age,并且移动到ename列之后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp change age1 age int(4) after ename;</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename | varchar(20) | YES | | NULL | |</span><br><span class="line">| age | int(4) | YES | | NULL | |</span><br><span class="line">| hiredate | date | YES | | NULL | |</span><br><span class="line">| sal | int(2) | YES | | NULL | |</span><br><span class="line">| deptno | int(2) | YES | | NULL | |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>5.5 更改表名</p>
<p>语法:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 RENAME 新表名</span><br></pre></td></tr></table></figure>
<p>例如:将表emp改名为emp1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp rename emp1</span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">mysql&gt; desc emp1;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| ename    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| age      | int(4)      | YES  |     | NULL    |       |</span><br><span class="line">| hiredate | date        | YES  |     | NULL    |       |</span><br><span class="line">| sal      | int(2)      | YES  |     | NULL    |       |</span><br><span class="line">| deptno   | int(2)      | YES  |     | NULL    |       |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/MYSQL优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/MYSQL优化/" itemprop="url">MYSQL优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/MYSQL优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/MYSQL优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MYSQL优化"><a href="#MYSQL优化" class="headerlink" title="MYSQL优化"></a>MYSQL优化</h2><p>以下的实验都是使用mysql的案例库:sakila.这是mysql官方提供的模拟电影出租厅信息管理系统数据库.类似oracle的scott库.可以去网上下载. </p>
<hr>
<h3 id="优化步骤"><a href="#优化步骤" class="headerlink" title="优化步骤"></a>优化步骤</h3><p>step1:通过show status命令了解各种SQL的执行频率 </p>
<p>语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show [session|global] status .如果不指定,默认为session</span><br></pre></td></tr></table></figure>
<p>例如下面的命令显示了当前session中所有统计参数的值: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show session status like &apos;Com_%&apos;;</span><br><span class="line">+---------------------------+-------+</span><br><span class="line">| Variable_name             | Value |</span><br><span class="line">+---------------------------+-------+</span><br><span class="line">| Com_admin_commands        | 0     |</span><br><span class="line">| Com_assign_to_keycache    | 0     |</span><br><span class="line">| Com_alter_db              | 0     |</span><br><span class="line">| Com_alter_db_upgrade      | 0     |</span><br><span class="line">| Com_alter_event           | 0     |</span><br><span class="line">| Com_alter_function        | 0     |</span><br><span class="line">| Com_alter_procedure       | 0     |</span><br><span class="line">| Com_alter_server          | 0     |</span><br><span class="line">| Com_alter_table           | 0     |</span><br><span class="line">| Com_alter_tablespace      | 0     |</span><br><span class="line">| Com_alter_user            | 0     |</span><br><span class="line">| Com_analyze               | 0     |</span><br><span class="line">| Com_begin                 | 0     |</span><br></pre></td></tr></table></figure>
<p>统计信息很长,没截图完整. 以下是对部分命令的解释</p>
<p>Com_xxx 表示每个xxx语句执行的次数.通常比较重要的参数有:</p>
<p>Com_select: 执行select操作的次数,一次查询加1</p>
<p>Com_insert:执行insert操作的次数,对于批量插入的Insert操作,只累计一次</p>
<p>Com_update:</p>
<p>Com_delete:</p>
<blockquote>
<p>通过上面这些不同类型的DML语句,可以看到数据库主要的操作类型是什么 </p>
</blockquote>
<p>此外,show status还有其他参数可以帮助了解数据库 例如: </p>
<ul>
<li>Connections:试图连接MYSQL服务器的次数 :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like &apos;Connections&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Connections   | 9     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>Slow_queries:慢查询次数 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; show status like &apos;slow_que%&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Slow_queries  | 0     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>Uptime:服务器工作时间 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like &apos;Uptime&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Uptime        | 57912 |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>更多相关信息,请参考 show status命令.在数据库服务器操作系统上也可以使用mysqladmin extended-status 命令来获得这些信息 </p>
</blockquote>
<hr>
<h4 id="step2-定位低效的SQL语句"><a href="#step2-定位低效的SQL语句" class="headerlink" title="step2:定位低效的SQL语句"></a>step2:定位低效的SQL语句</h4><p>有2种方式定位低效SQL语句.</p>
<ul>
<li>通过慢查询日志定位那些执行效率较低的SQL语句.在配置文件定义long_query_time.这个参数表示大于几秒的语句被认为是执行效率低. </li>
<li>–log-slow-queries 这个参数的值为一个日志文件的路径,表示将低效SQL语句写入哪个慢日志文件.</li>
</ul>
<p>​     </p>
<p>可以将以上2个配置文件,写入my.conf的配置文件中.例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">log=&quot;/var/lib/mysql/slow.log&quot; </span><br><span class="line">slow_query_log = ON</span><br><span class="line">log_slow_queries=&quot;/var/lib/mysql/mysql_slow.log&quot; </span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>慢查询日志在查询结束后才记,默认的long_query_time时间为10S,</p>
</blockquote>
<p><strong>使用show processlist命令可以查看当前mysql在进行的线程,线程状态,锁表等</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+----+------+-----------+--------+---------+------+-------+------------------+</span><br><span class="line">| Id | User | Host      | db     | Command | Time | State | Info             |</span><br><span class="line">+----+------+-----------+--------+---------+------+-------+------------------+</span><br><span class="line">|  4 | root | localhost | mytest | Sleep   | 1140 |       | NULL             |</span><br><span class="line">|  8 | root | localhost | NULL   | Query   |    0 | init  | show processlist |</span><br><span class="line">+----+------+-----------+--------+---------+------+-------+------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>SHOW PROCESSLIST显示哪些线程正在运行。您也可以使用mysqladmin processlist语句得到此信息。</p>
<p><strong>各列的含义和用途：</strong></p>
<p><strong>ID列</strong></p>
<p>一个标识，你要kill一个语句的时候很有用，用命令杀掉此查询 /*/mysqladmin kill 进程号。</p>
<p><strong>user列</strong></p>
<p>显示单前用户，如果不是root，这个命令就只显示你权限范围内的sql语句。</p>
<p><strong>host列</strong></p>
<p>显示这个语句是从哪个ip的哪个端口上发出的。用于追踪出问题语句的用户。</p>
<p><strong>db列</strong></p>
<p>显示这个进程目前连接的是哪个数据库。</p>
<p><strong>command列</strong></p>
<p>显示当前连接的执行的命令，一般就是休眠（sleep），查询（query），连接（connect）。</p>
<p><strong>time列</strong></p>
<p>此这个状态持续的时间，单位是秒。</p>
<p><strong>state列</strong></p>
<p>显示使用当前连接的sql语句的状态，很重要的列，后续会有所有的状态的描述，请注意，state只是语句执行中的某一个状态，一个 sql语句，以查询为例，可能需要经过copying to tmp table，Sorting result，Sending data等状态才可以完成</p>
<p><strong>info列</strong></p>
<p>显示这个sql语句，因为长度有限，所以长的sql语句就显示不全，但是一个判断问题语句的重要依据。</p>
<h5 id="这个命令中最关键的就是state列，mysql列出的状态主要有以下几种："><a href="#这个命令中最关键的就是state列，mysql列出的状态主要有以下几种：" class="headerlink" title="这个命令中最关键的就是state列，mysql列出的状态主要有以下几种："></a>这个命令中最关键的就是state列，mysql列出的状态主要有以下几种：</h5><ul>
<li>Checking table</li>
</ul>
<p>　正在检查数据表（这是自动的）。</p>
<ul>
<li>Closing tables</li>
</ul>
<p>　正在将表中修改的数据刷新到磁盘中，同时正在关闭已经用完的表。这是一个很快的操作，如果不是这样的话，就应该确认磁盘空间是否已经满了或者磁盘是否正处于重负中。</p>
<ul>
<li>Connect Out</li>
</ul>
<p>　复制从服务器正在连接主服务器。</p>
<ul>
<li>Copying to tmp table on disk</li>
</ul>
<p>　由于临时结果集大于tmp_table_size，正在将临时表从内存存储转为磁盘存储以此节省内存。</p>
<ul>
<li>Creating tmp table</li>
</ul>
<p>　正在创建临时表以存放部分查询结果。</p>
<ul>
<li>deleting from main table</li>
</ul>
<p>　服务器正在执行多表删除中的第一部分，刚删除第一个表。</p>
<ul>
<li>deleting from reference tables</li>
</ul>
<p>　服务器正在执行多表删除中的第二部分，正在删除其他表的记录。</p>
<ul>
<li>Flushing tables</li>
</ul>
<p>　正在执行FLUSH TABLES，等待其他线程关闭数据表。</p>
<ul>
<li>Killed</li>
</ul>
<p>　发送了一个kill请求给某线程，那么这个线程将会检查kill标志位，同时会放弃下一个kill请求。MySQL会在每次的主循环中检查kill标志位，不过有些情况下该线程可能会过一小段才能死掉。如果该线程程被其他线程锁住了，那么kill请求会在锁释放时马上生效。</p>
<ul>
<li>Locked</li>
</ul>
<p>　被其他查询锁住了。</p>
<ul>
<li>Sending data</li>
</ul>
<p>　正在处理SELECT查询的记录，同时正在把结果发送给客户端。</p>
<ul>
<li>Sorting for group</li>
</ul>
<p>　正在为GROUP BY做排序。</p>
<p>　-Sorting for order</p>
<p>　正在为ORDER BY做排序。</p>
<ul>
<li>Opening tables</li>
</ul>
<p>　这个过程应该会很快，除非受到其他因素的干扰。例如，在执ALTER TABLE或LOCK TABLE语句行完以前，数据表无法被其他线程打开。正尝试打开一个表。</p>
<ul>
<li>Removing duplicates</li>
</ul>
<p>　正在执行一个SELECT DISTINCT方式的查询，但是MySQL无法在前一个阶段优化掉那些重复的记录。因此，MySQL需要再次去掉重复的记录，然后再把结果发送给客户端。</p>
<ul>
<li>Reopen table</li>
</ul>
<p>　获得了对一个表的锁，但是必须在表结构修改之后才能获得这个锁。已经释放锁，关闭数据表，正尝试重新打开数据表。</p>
<ul>
<li>Repair by sorting</li>
</ul>
<p>　修复指令正在排序以创建索引。</p>
<ul>
<li>Repair with keycache</li>
</ul>
<p>　修复指令正在利用索引缓存一个一个地创建新索引。它会比Repair by sorting慢些。</p>
<ul>
<li>Searching rows for update</li>
</ul>
<p>　正在讲符合条件的记录找出来以备更新。它必须在UPDATE要修改相关的记录之前就完成了。</p>
<ul>
<li>Sleeping</li>
</ul>
<p>　正在等待客户端发送新请求.</p>
<ul>
<li>System lock</li>
</ul>
<p>　正在等待取得一个外部的系统锁。如果当前没有运行多个mysqld服务器同时请求同一个表，那么可以通过增加–skip-external-locking参数来禁止外部系统锁。</p>
<ul>
<li>Upgrading lock</li>
</ul>
<p>　INSERT DELAYED正在尝试取得一个锁表以插入新记录。</p>
<ul>
<li>Updating</li>
</ul>
<p>　正在搜索匹配的记录，并且修改它们。</p>
<ul>
<li>User Lock</li>
</ul>
<p>　正在等待GET_LOCK()。</p>
<ul>
<li>Waiting for tables</li>
</ul>
<p>　该线程得到通知，数据表结构已经被修改了，需要重新打开数据表以取得新的结构。然后，为了能的重新打开数据表，必须等到所有其他线程关闭这个表。以下几种情况下会产生这个通知：</p>
<ul>
<li>FLUSH TABLES tbl_name,</li>
<li>ALTER TABLE, RENAME TABLE, REPAIR TABLE, ANALYZE TABLE,</li>
<li>OPTIMIZE TABLE。</li>
<li>waiting for handler insert</li>
</ul>
<p>　INSERT DELAYED已经处理完了所有待处理的插入操作，正在等待新的请求。</p>
<blockquote>
<p> 大部分状态对应很快的操作，只要有一个线程保持同一个状态好几秒钟，那么可能是有问题发生了，需要检查一下。还有其他的状态没在上面中列出来，不过它们大部分只是在查看服务器是否有存在错误是才用得着。</p>
</blockquote>
<hr>
<h4 id="step3-找到低效sql语句后-通过EXPLAIN命令分析SQL语句执行状态"><a href="#step3-找到低效sql语句后-通过EXPLAIN命令分析SQL语句执行状态" class="headerlink" title="step3 找到低效sql语句后.通过EXPLAIN命令分析SQL语句执行状态"></a>step3 找到低效sql语句后.通过EXPLAIN命令分析SQL语句执行状态</h4><p>用法:</p>
<p>直接在select语句钱加explain命令即可. </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;explain select sum(amount) from customer a,payment b where 1=1 and a.customer_id=b.customer_id and email=&apos;Jane.BENNETT@sakilacustomer.org&apos;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: a</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 599</span><br><span class="line">        Extra: Using where</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: b</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_fk_customer_id</span><br><span class="line">          key: idx_fk_customer_id</span><br><span class="line">      key_len: 2</span><br><span class="line">          ref: sakila.a.customer_id</span><br><span class="line">         rows: 13</span><br><span class="line">        Extra: NULL</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>语法解析:</p>
<p><strong>1.select_type</strong>: 表示select的类型.常见的有</p>
<ul>
<li>SIMPLE(简单表,不使用表连接或者子查询).</li>
<li>PRIMARY(主查询,即外层的查询)</li>
<li>UNION</li>
<li>SUBQUERY(子查询的第一个select)</li>
</ul>
<p><strong>2.table:</strong>输出结果集的表</p>
<p>3.type:表示mysql在表中找到所需行的方式,或者叫访问类型,性能由最差到最好依次排列如下:</p>
<ul>
<li>ALL—-全表扫描</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film where rating&gt;9\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: film</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1000</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>index—–索引全扫描.MYSQL遍历整个索引查询匹配的行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select title from film\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: film</span><br><span class="line">         type: index</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: idx_title</span><br><span class="line">      key_len: 767</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1000</span><br><span class="line">        Extra: Using index</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>range——索引范围扫描..常见于&lt;,&lt;=,&gt;,&gt;=等运算符操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from payment where customer_id&gt;=300 and customer_id&lt;=350\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: payment</span><br><span class="line">         type: range</span><br><span class="line">possible_keys: idx_fk_customer_id</span><br><span class="line">          key: idx_fk_customer_id</span><br><span class="line">      key_len: 2</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1349</span><br><span class="line">        Extra: Using index condition</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>ref—–使用非唯一索引扫描或者唯一索引的前缀扫描.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from payment where customer_id=350\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: payment</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_fk_customer_id</span><br><span class="line">          key: idx_fk_customer_id</span><br><span class="line">      key_len: 2</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 23</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>idx_fk_customer_id——-非唯一索引,见上面的例子</p>
</li>
<li><p>eq_ref—–类似于ref.区别在于使用的索引是唯一索引.对于每个索引键值,表中只有一条记录匹配.简单来说,就是多表连接中使用primary key或者unique index作为关联条件</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film a,film_text b where a.film_id=b.film_id\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: a</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1000</span><br><span class="line">        Extra: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: b</span><br><span class="line">         type: eq_ref</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: PRIMARY</span><br><span class="line">      key_len: 2</span><br><span class="line">          ref: sakila.a.film_id</span><br><span class="line">         rows: 1</span><br><span class="line">        Extra: Using index condition</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>const/system——单表中最多只有一个匹配行,查询非常迅速.例如根据主键primary key 或者 唯一索引 unique index进行查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from (select * from customer where email=&apos;AARON.SELBY@sakilacustomer.org&apos;)a\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: PRIMARY</span><br><span class="line">        table: &lt;derived2&gt;</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 599</span><br><span class="line">        Extra: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">           id: 2</span><br><span class="line">  select_type: DERIVED</span><br><span class="line">        table: customer</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 599</span><br><span class="line">        Extra: Using where</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>NULL—-不用访问表或者索引,直接就能得到结果</li>
</ul>
<p><strong>4.possible_keys:</strong>表示查询时可能使用的索引</p>
<p><strong>5.key:</strong>表示实际使用的索引</p>
<p><strong>6.key_len</strong>:使用到索引字段的长度</p>
<p><strong>7.rows:</strong>扫描行的数量</p>
<p><strong>8.extra:</strong>执行情况的说明和描述</p>
<p>通过explain extended 加上 show warnings可以看到SQL被执行前做了哪些SQL改写: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain extended  select sum(amount) from customer a,payment b where 1=1 and a.customer_id=b.customer_id and email=&apos;Jane.BENNETT@sakilacustomer.org&apos;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: a</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 599</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: b</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_fk_customer_id</span><br><span class="line">          key: idx_fk_customer_id</span><br><span class="line">      key_len: 2</span><br><span class="line">          ref: sakila.a.customer_id</span><br><span class="line">         rows: 13</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/MYSQL常用函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/MYSQL常用函数/" itemprop="url">MYSQL常用函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/MYSQL常用函数/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/MYSQL常用函数/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MYSQL常用函数"><a href="#MYSQL常用函数" class="headerlink" title="MYSQL常用函数"></a>MYSQL常用函数</h2><h4 id="一-字符串函数"><a href="#一-字符串函数" class="headerlink" title="一.字符串函数"></a>一.字符串函数</h4><p><strong>1.concat(s1,s2…..)——–连接</strong></p>
<p>s1,s2….为一个字符串</p>
<p>例如:连接以下三个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&apos;abc&apos;,&apos;def&apos;,&apos;hij&apos;);</span><br><span class="line">+---------------------------+</span><br><span class="line">| concat(&apos;abc&apos;,&apos;def&apos;,&apos;hij&apos;) |</span><br><span class="line">+---------------------------+</span><br><span class="line">| abcdefhij                 |</span><br><span class="line">+---------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>2.insert(str,x,y,instr) </strong></p>
<p>说明:</p>
<p>将字符串str从第x位置开始,y个字符长的字符串替换为字符串instr </p>
<p>例如.将字符串abcde从第二个位置开始替换成haha</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select insert(&apos;abcde&apos;,2,4,&apos;haha&apos;);</span><br><span class="line">+----------------------------+</span><br><span class="line">| insert(&apos;abcde&apos;,2,4,&apos;haha&apos;) |</span><br><span class="line">+----------------------------+</span><br><span class="line">| ahaha                      |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>3.lower(str),upper(str) </strong></p>
<p>说明:</p>
<p>字符串大小写切换 </p>
<p><strong>4.left(str,x)</strong></p>
<p>说明:</p>
<p>返回字符串str最左边的x个字符</p>
<p>例如:返回abcde最左边的2个字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select left (&apos;abcde&apos;,2);</span><br><span class="line">+------------------+</span><br><span class="line">| left (&apos;abcde&apos;,2) |</span><br><span class="line">+------------------+</span><br><span class="line">| ab               |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>5.right(str,x)</strong></p>
<p>说明:</p>
<p>返回字符串str最右边的x个字符</p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select right (&apos;abcde&apos;,2);</span><br><span class="line">+-------------------+</span><br><span class="line">| right (&apos;abcde&apos;,2) |</span><br><span class="line">+-------------------+</span><br><span class="line">| de                |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>6.LPAD(str,n,pad)和rpad(str,n,pad)</strong></p>
<p>说明:</p>
<p>LPAD:用字符串pad对str最左边进行填充,直到长度为n个字符长度</p>
<p>rpad:用字符串pad对str最右边进行填充,直到长度为n个字符长度</p>
<blockquote>
<p>这里的n表示填充后字符的总长度</p>
</blockquote>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select lpad(&apos;abcd&apos;,8,&apos;haha&apos;);</span><br><span class="line">+-----------------------+</span><br><span class="line">| lpad(&apos;abcd&apos;,8,&apos;haha&apos;) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| hahaabcd              |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select rpad(&apos;abcd&apos;,8,&apos;haha&apos;);</span><br><span class="line">+-----------------------+</span><br><span class="line">| rpad(&apos;abcd&apos;,8,&apos;haha&apos;) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| abcdhaha              |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>7.LTRIM(str) 和RTRIM(str) </strong></p>
<p>说明:</p>
<p>LTRIM:去掉字符串str左侧的空格 </p>
<p>RTRIM:去掉字符串str右侧的空格 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ltrim(&apos;   abcd&apos;);</span><br><span class="line">+------------------+</span><br><span class="line">| ltrim(&apos;   abcd&apos;) |</span><br><span class="line">+------------------+</span><br><span class="line">| abcd             |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>8.REPEAT(str,x) </strong></p>
<p>说明:</p>
<p>返回字符串str重复x次的结果 </p>
<p>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select repeat(&apos;abcd&apos;,3);</span><br><span class="line">+------------------+</span><br><span class="line">| repeat(&apos;abcd&apos;,3) |</span><br><span class="line">+------------------+</span><br><span class="line">| abcdabcdabcd     |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>9.REPLACE(str,a,b) </strong></p>
<p>说明:</p>
<p>用字符串b替换字符串str中出现的字符串a </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select replace(&apos;abcd200&apos;,&apos;200&apos;,&apos;2018&apos;);</span><br><span class="line">+---------------------------------+</span><br><span class="line">| replace(&apos;abcd200&apos;,&apos;200&apos;,&apos;2018&apos;) |</span><br><span class="line">+---------------------------------+</span><br><span class="line">| abcd2018                        |</span><br><span class="line">+---------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>10.TRIM(str) </strong></p>
<p>说明:</p>
<p>去掉字符串行尾和行首的空格 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select trim(&apos;    abcd     &apos;);</span><br><span class="line">+-----------------------+</span><br><span class="line">| trim(&apos;    abcd     &apos;) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| abcd                  |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>11.SUBSTRING(‘str’,x,y) </strong></p>
<p>说明:</p>
<p>返回从字符串str x位置起y个字符长度的字符串 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select substring(&apos;abcde200&apos;,6,3);</span><br><span class="line">+---------------------------+</span><br><span class="line">| substring(&apos;abcde200&apos;,6,3) |</span><br><span class="line">+---------------------------+</span><br><span class="line">| 200                       |</span><br><span class="line">+---------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><p><strong>1.ABS(x) </strong></p>
<p>说明:</p>
<p>返回x的绝对值 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select abs(2);</span><br><span class="line">+--------+</span><br><span class="line">| abs(2) |</span><br><span class="line">+--------+</span><br><span class="line">|      2 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select abs(2.4);</span><br><span class="line">+----------+</span><br><span class="line">| abs(2.4) |</span><br><span class="line">+----------+</span><br><span class="line">|      2.4 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>2.CEIL(x) 和FLOOR(x) </strong></p>
<p>说明:</p>
<ul>
<li>CEIL(x)——–返回大于x的最小整数值</li>
<li>FLOOR(x)—–返回小于x的最大整数值</li>
</ul>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ceil(1.4),floor(1.4);</span><br><span class="line">+-----------+------------+</span><br><span class="line">| ceil(1.4) | floor(1.4) |</span><br><span class="line">+-----------+------------+</span><br><span class="line">|         2 |          1 |</span><br><span class="line">+-----------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>3.MOD(x,y) </strong></p>
<p>说明:</p>
<p>返回x/y的模, </p>
<p><strong>4.RAND() </strong></p>
<p>说明:</p>
<p>返回0-1内的随机数 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rand(),rand();</span><br><span class="line">+---------------------+--------------------+</span><br><span class="line">| rand()              | rand()             |</span><br><span class="line">+---------------------+--------------------+</span><br><span class="line">| 0.14972682963099967 | 0.5293732364935552 |</span><br><span class="line">+---------------------+--------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>note:如果需要获得一个100以内的随机数,可以进行如下操作: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; mysql&gt; select ceil(100*rand()),ceil(100*rand());</span><br><span class="line">&gt; +------------------+------------------+</span><br><span class="line">&gt; | ceil(100*rand()) | ceil(100*rand()) |</span><br><span class="line">&gt; +------------------+------------------+</span><br><span class="line">&gt; |               76 |               85 |</span><br><span class="line">&gt; +------------------+------------------+</span><br><span class="line">&gt; 1 row in set (0.00 sec)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>5.round(x,y) </strong></p>
<p>用法:</p>
<p>返回x的四舍五入有y位小数的值 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select round(3.12345,3), round(3.1456,2);</span><br><span class="line">+--------------------+-------------------+</span><br><span class="line">| round(3.12345,&apos;3&apos;) | round(3.1456,&apos;2&apos;) |</span><br><span class="line">+--------------------+-------------------+</span><br><span class="line">|              3.123 |              3.15 |</span><br><span class="line">+--------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>6.truncate(x,y) </strong></p>
<p>用法:</p>
<p>返回数字x截断为y位小数的结果 </p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select truncate(3.1234,3);</span><br><span class="line">+--------------------+</span><br><span class="line">| truncate(3.1234,3) |</span><br><span class="line">+--------------------+</span><br><span class="line">|              3.123 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>note:truncate值是单纯的截断小数位.而round截断的时候会自动四舍五入. 例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; mysql&gt; select round(3.1456,&apos;2&apos;),truncate(3.1456,2);</span><br><span class="line">&gt; +-------------------+--------------------+</span><br><span class="line">&gt; | round(3.1456,&apos;2&apos;) | truncate(3.1456,2) |</span><br><span class="line">&gt; +-------------------+--------------------+</span><br><span class="line">&gt; |              3.15 |               3.14 |</span><br><span class="line">&gt; +-------------------+--------------------+</span><br><span class="line">&gt; 1 row in set (0.00 sec)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h3 id="三-日期函数"><a href="#三-日期函数" class="headerlink" title="三.日期函数"></a>三.日期函数</h3><ul>
<li>CURDATE()——–返回当前日期</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select curdate();</span><br><span class="line">+------------+</span><br><span class="line">| curdate()  |</span><br><span class="line">+------------+</span><br><span class="line">| 2017-12-31 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>CURTIME()———返回当前时间</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select curtime();</span><br><span class="line">+-----------+</span><br><span class="line">| curtime() |</span><br><span class="line">+-----------+</span><br><span class="line">| 10:38:31  |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>NOW()————–返回当前的日期和时间</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select now();</span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2017-12-31 10:40:57 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>UNIX_timestamp(date)—返回日期date的UNIX时间戳</p>
</li>
<li><p>from_unixtime——返回unix时间戳的日期</p>
</li>
</ul>
<ul>
<li><p>week(date)—–返回date为一年中的第几个星期</p>
</li>
<li><p>year(date)——-返回日期date的年份</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select week(now()),year(now());</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| week(now()) | year(now()) |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">|          53 |        2017 |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>HOUR(time)——返回time的小时值</li>
<li>minute(time)——–返回time的分钟值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select hour(now()),minute(now());</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| hour(now()) | minute(now()) |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">|          10 |            47 |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>monthname(date)—–返回date的月份名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select monthname(now());</span><br><span class="line">+------------------+</span><br><span class="line">| monthname(now()) |</span><br><span class="line">+------------------+</span><br><span class="line">| December         |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>date_format(date,fmt)——–返回按字符串fmt格式化日期date值</li>
<li>date_add(date,INTERVAL expr type)——–返回与所给日期date相差interval时间的日期 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select now() current,date_add(now(),interval 31 day) after31days,date_add(now(),interval -31 day) before31days;</span><br><span class="line">+---------------------+---------------------+---------------------+</span><br><span class="line">| current             | after31days         | before31days        |</span><br><span class="line">+---------------------+---------------------+---------------------+</span><br><span class="line">| 2017-12-31 10:54:18 | 2018-01-31 10:54:18 | 2017-11-30 10:54:18 |</span><br><span class="line">+---------------------+---------------------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>datediff(expr,expr2)———返回起始时间expr和结束时间expr2之间的天数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select datediff(&apos;2028-12-31&apos;,now());</span><br><span class="line">+------------------------------+</span><br><span class="line">| datediff(&apos;2028-12-31&apos;,now()) |</span><br><span class="line">+------------------------------+</span><br><span class="line">|                         4018 |</span><br><span class="line">+------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="四-流程函数"><a href="#四-流程函数" class="headerlink" title="四.流程函数"></a>四.流程函数</h3><ul>
<li>if(value,t,f)———如果value是真,返回t,否则返回f</li>
</ul>
<p>例如:如果工资超过2000的,就用’high’表示,否则用’low’—- </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select if(sal&gt;2000,&apos;high&apos;,&apos;low&apos;) from emp;</span><br><span class="line">+---------------------------+</span><br><span class="line">| if(sal&gt;2000,&apos;high&apos;,&apos;low&apos;) |</span><br><span class="line">+---------------------------+</span><br><span class="line">| low                       |</span><br><span class="line">| high                      |</span><br><span class="line">| high                      |</span><br><span class="line">| high                      |</span><br><span class="line">| low                       |</span><br><span class="line">+---------------------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>ifnull(value1,value2)——–用来替换Null值,如果值为Null则显示为0</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ifnull(sal,0) from emp;</span><br><span class="line">+---------------+</span><br><span class="line">| ifnull(sal,0) |</span><br><span class="line">+---------------+</span><br><span class="line">|          1000 |</span><br><span class="line">|          4000 |</span><br><span class="line">|          3000 |</span><br><span class="line">|          9000 |</span><br><span class="line">|          2000 |</span><br><span class="line">|             0 |</span><br><span class="line">+---------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>case when [value1] then [result1]  when[value2] then [result2]…………..else[default]END</li>
</ul>
<p>例如将刚才工资分成高低档 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select case when sal&gt;=2000 then &apos;high&apos; else &apos;low&apos; end from emp;</span><br><span class="line">+------------------------------------------------+</span><br><span class="line">| case when sal&gt;=2000 then &apos;high&apos; else &apos;low&apos; end |</span><br><span class="line">+------------------------------------------------+</span><br><span class="line">| low                                            |</span><br><span class="line">| high                                           |</span><br><span class="line">| high                                           |</span><br><span class="line">| high                                           |</span><br><span class="line">| high                                           |</span><br><span class="line">| low                                            |</span><br><span class="line">+------------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>或者分3档:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select case when sal&lt;2000 then &apos;low&apos; when sal&gt;=2000 and sal&lt;=4000 then &apos;medium&apos; when sal&gt;=4000 then &apos;high&apos; end from emp;</span><br><span class="line">+---------------------------------------------------------------------------------------------------------+</span><br><span class="line">| case when sal&lt;2000 then &apos;low&apos; when sal&gt;=2000 and sal&lt;=4000 then &apos;medium&apos; when sal&gt;=4000 then &apos;high&apos; end |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------+</span><br><span class="line">| low                                                                                                     |</span><br><span class="line">| medium                                                                                                  |</span><br><span class="line">| medium                                                                                                  |</span><br><span class="line">| high                                                                                                    |</span><br><span class="line">| medium                                                                                                  |</span><br><span class="line">| NULL                                                                                                    |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>有其他一些常用函数.比如:</strong></p>
<ul>
<li>database()——查看当前数据库名</li>
<li>version()———查看数据库版本</li>
<li>user()————返回当前登录用户名</li>
<li>inet_aton(IP)—-返回IP地址的数字表示</li>
<li>inet_ntoa(num)–返回数字代表的IP地址</li>
<li>password(str)—-返回字符串的加密版本</li>
<li>md5()—–返回字符串的md5值</li>
</ul>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/Mysql数据类型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/Mysql数据类型/" itemprop="url">Mysql数据类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/Mysql数据类型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/Mysql数据类型/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Mysql数据类型"><a href="#Mysql数据类型" class="headerlink" title="Mysql数据类型"></a>Mysql数据类型</h2><h4 id="一-数值类型"><a href="#一-数值类型" class="headerlink" title="一.数值类型"></a>一.数值类型</h4><p><strong>1.整数类型:</strong></p>
<ul>
<li>TINYINIT  </li>
<li>SMALLINT  </li>
<li>mediumINT  </li>
<li>INT,integer  </li>
<li>bigINT  </li>
</ul>
<p>整数后可以跟指定一个小括号(),小括号内指定显示宽度.例如Int(5).表示当数值宽度小于5位数的时候,在数字前填0充满宽度</p>
<p>另外还有auto_increment来表示一个某个列下的值自增,一个表中只能有一个自增列.</p>
<p>对于自增列,应该定义为Not null,或者primary key 或者unique键</p>
<p><strong>2.浮点数类型</strong></p>
<ul>
<li>float 单精度</li>
<li>double 双精度</li>
<li>decimal 定点数</li>
</ul>
<p>浮点数和定点数可以在类型后面加个小括号(M,D)表示..M表示小数的总共位数(包括整数+小数位).D表示小数位..例如float(5,3)表示2个整数,3个小数.,例如:12.345</p>
<p>mysql在保存小数时,自动进行四舍五入</p>
<p>也可以不加小括号().代表不指定精度.浮点数如果不写精度,则按实际精度值显示,定点数如果不指定精度,则按照默认值decimal(10,0)来操作.如果数据超越了精度,则报错</p>
<p><strong>3.位数</strong></p>
<ul>
<li>​    BIT</li>
</ul>
<hr>
<h4 id="二-时间类型"><a href="#二-时间类型" class="headerlink" title="二.时间类型"></a>二.时间类型</h4><ul>
<li>DATE—表示年月日(常用)</li>
<li>DATETIME—表示年月日时分秒(常用).DATETIME是DATE和TIME的组合</li>
<li>TIME———表示时分秒(常用)</li>
<li>YEAR—–表示年份</li>
<li>TIMESTAMP—表示当前系统时间.插入一个NULL时,MYSQL会自动替换成当前系统时间,但是仅限于一个TIMESTAMP</li>
</ul>
<hr>
<h4 id="三-字符串"><a href="#三-字符串" class="headerlink" title="三.字符串"></a>三.字符串</h4><ul>
<li>CHAR——–字符串长度为0-255之间整数</li>
<li>VARCHAR—字符串长度为0-65535整数</li>
<li>BINARY——-字符串被保存为2进制</li>
<li>VARBINARY—同上</li>
<li>BLOB———</li>
<li>TEXT</li>
<li>ENUM———枚举</li>
<li>SET</li>
</ul>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/MYSQL5.7安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/MYSQL5.7安装/" itemprop="url">MYSQL5.7安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:59:58+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/mysql-basic/" itemprop="url" rel="index">
                    <span itemprop="name">mysql-basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/22/MYSQL5.7安装/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/22/MYSQL5.7安装/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Centos7-yum源安装mysql-5-7"><a href="#Centos7-yum源安装mysql-5-7" class="headerlink" title="Centos7 yum源安装mysql 5.7"></a>Centos7 yum源安装mysql 5.7</h2><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境:"></a>系统环境:</h3><p>KVM服务器.</p>
<p>虚拟机版本:centos 7.4</p>
<p>IP地址:10.0.0.10</p>
<hr>
<h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><p><strong>一.下载mysql官方5.7版本的Yum源</strong></p>
<p>wget <a href="https://repo.mysql.com//mysql57-community-release-el7-11.noarch.rpm" target="_blank" rel="noopener">https://repo.mysql.com//mysql57-community-release-el7-11.noarch.rpm</a></p>
<p><strong>二.安装yum源</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall mysql57-community-release-el7-11.noarch.rpm</span><br></pre></td></tr></table></figure>
<blockquote>
<p> Note:如果是安装最新版本(5.7),可以直接进行下一步操作.</p>
</blockquote>
<p> 需要安装旧版本.可以修改配置Yum源:</p>
<p><strong>1.执行下列命令查看刚下载的Yum源支持的mysql版本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum repolist all | grep mysql</span><br></pre></td></tr></table></figure>
<p>2.如果是安装旧版本(比如安装5.6版本),可以关闭5.7版本的yum源.启用旧版本的yum源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum-config-manager --disable mysql57-community shell&gt; yum-config-manager --enable mysql56-community</span><br></pre></td></tr></table></figure>
<p>或者可以编辑yum源文件.修改enable字段来配置你想要安装的mysql版本.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">enable=1表示开启源</span><br><span class="line">enable=0表示关闭源</span><br></pre></td></tr></table></figure>
<p><strong>三.安装MYSQL</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum install mysql-community-server</span><br></pre></td></tr></table></figure>
<p><strong>四.编辑mysql的配置文件.指定mysql的数据存储路径.(默认在/var/lib/mysql)</strong></p>
<p>在本场景下.mysql的数据文件路径是/data/mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;s@datadir=/var/lib/mysql@datadir=/data/mysql@g&apos; /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p><strong>五.启动mysql服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld.service</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:mysql服务启动时,  </p>
<p>1.会自动初始化mysql数据库  </p>
<p>2.在mysql的数据文件目录下生成SSL证书文件,key文件  </p>
<p>3.生成初始密码</p>
</blockquote>
<blockquote>
<p> note:修改mysql的数据文件存储路径后,在启动mysql时报错:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-04-12T07:07:20.845077Z 0 [Note] /usr/sbin/mysqld (mysqld 5.7.21) starting as process 4442 ...</span><br><span class="line">2018-04-12T07:07:20.847901Z 0 [Warning] Can&apos;t create test file /data/mysql/labs.lower-test</span><br><span class="line">2018-04-12T07:07:20.847922Z 0 [Warning] Can&apos;t create test file /data/mysql/labs.lower-test</span><br></pre></td></tr></table></figure>
<p>初步判断是数据文件路径没有权限.给数据文件路径添加权限:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /data/mysql</span><br><span class="line">chown -R mysql:mysql /var/run/mysqld</span><br></pre></td></tr></table></figure>
<p>启动仍然报同样错误.关闭selinux.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;s@SELINUX=enforcing@SELINUX=disabled@g&apos; /etc/selinux/config</span><br></pre></td></tr></table></figure>
<p>重启服务器.mysql启动正常</p>
<p><strong>六.查看mysql服务状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld.service</span><br></pre></td></tr></table></figure>
<p><strong>七.获取mysql的初始密码:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grep &apos;temporary password&apos; /var/log/mysqld.log</span><br><span class="line">2018-04-10T14:24:09.501765Z 1 [Note] A temporary password is generated for root@localhost: d3jr!;9uJdyy</span><br><span class="line"></span><br><span class="line">d3jr!;9uJdyy这个就是初始密码</span><br></pre></td></tr></table></figure>
<p><strong>八.使用root用户密码登录mysql.修改用户密码.配置允许远程登录</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -uroot -p</span><br><span class="line"></span><br><span class="line">修改密码:</span><br><span class="line">mysql&gt; ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;MyNewPass4!&apos;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:密码要求至少一个大写字母,一个小写字母,一个数字,一个特殊符号总共8位字符</p>
</blockquote>
<p>允许root用户远程登录:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update mysql.user set host=&apos;%&apos; where user=&apos;root&apos;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>
<p><strong>九.查看进程,端口是否正常启动</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tulnp | grep :3306</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/16/BGP-Black-Hole/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/16/BGP-Black-Hole/" itemprop="url">03-BGP-Black Hole</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-16T08:59:58+08:00">
                2018-06-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/Route/" itemprop="url" rel="index">
                    <span itemprop="name">Route</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/Route/BGP/" itemprop="url" rel="index">
                    <span itemprop="name">BGP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/16/BGP-Black-Hole/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/16/BGP-Black-Hole/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="BGP2-Black-Hole"><a href="#BGP2-Black-Hole" class="headerlink" title="BGP2. Black Hole"></a>BGP2. Black Hole</h2> <img src="http://pabkmteb4.bkt.clouddn.com/static/images/network/bgp2-1.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/06/16/BGP-Black-Hole/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/16/BGP-Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/16/BGP-Lab/" itemprop="url">02-BGP Lab</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-16T08:59:58+08:00">
                2018-06-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/Route/" itemprop="url" rel="index">
                    <span itemprop="name">Route</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/Route/BGP/" itemprop="url" rel="index">
                    <span itemprop="name">BGP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/16/BGP-Lab/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/16/BGP-Lab/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="BGP-LAB"><a href="#BGP-LAB" class="headerlink" title="BGP LAB"></a>BGP LAB</h2><h3 id="1-实验拓扑"><a href="#1-实验拓扑" class="headerlink" title="1.实验拓扑"></a>1.实验拓扑</h3><p>配置三个AS，运行BGP协议。 </p>
 <img src="http://pabkmteb4.bkt.clouddn.com/static/images/network/bgp1.png">
<hr>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/06/16/BGP-Lab/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/16/BGP-LAB About BGP black hole/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jesse">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jesse's home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/16/BGP-LAB About BGP black hole/" itemprop="url">03-BGP Lab BGP black hole</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-16T08:59:58+08:00">
                2018-06-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/Route/" itemprop="url" rel="index">
                    <span itemprop="name">Route</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/Route/BGP/" itemprop="url" rel="index">
                    <span itemprop="name">BGP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/16/BGP-LAB About BGP black hole/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/16/BGP-LAB About BGP black hole/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="LAB-About-BGP-black-hole"><a href="#LAB-About-BGP-black-hole" class="headerlink" title="LAB About BGP black hole"></a>LAB About BGP black hole</h2><h3 id="LAB-Topology"><a href="#LAB-Topology" class="headerlink" title="LAB Topology"></a>LAB Topology</h3> <img src="http://pabkmteb4.bkt.clouddn.com/static/images/network/bgp3-1.png">
<hr>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/06/16/BGP-LAB About BGP black hole/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
   
    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.png"
                alt="Jesse" />
            
              <p class="site-author-name" itemprop="name">Jesse</p>
              <p class="site-description motion-element" itemprop="description">保持饥渴,保持愚蠢.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/huangyonghome/huangyonghome.github.io" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:mailhuangyong@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/jessehuang408" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/jessehuang408" target="_blank" title="FaceBook">
                      
                        <i class="fa fa-fw fa-facebook"></i>FaceBook</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; Tue Jun 12 2018 08:00:00 GMT+0800 (中国标准时间) &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jesse</span>

  
</div>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>

-->



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"comments"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
















  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '3CtYiIp3Dijlw0XHyLxqMUM0-gzGzoHsz',
        appKey: '6dleF8bCPBg8gTr0pBp1IgVe',
        placeholder: '欢迎留言交流',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

  
<script type="text/javascript">
    //微信二维码点击背景关闭
    $('body').delegate('.-mob-share-weixin-qrcode-bg','click', function(){
        $(".-mob-share-weixin-qrcode-close").trigger("click");
    }); 
</script>


</body>
</html>
