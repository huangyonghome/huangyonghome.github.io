---
title: 监控某个进程端口,邮件告警
date: 2018-06-12 22:59:58
tags:  scripts
categories: [Linux-Basic,shell&shell脚本 ]
comments: true
copyright: true
---



## 监控某个进程端口,邮件告警

```shell
#!/bin/bash
#despcrition:Our MQ server encountered some troubles which sometimes 5672 port was unreachable from this server.So run a shell script to detect the connection
#author:huang yong
#date: 2018-03-12

#define variables
port=5672
host=10.47.115.13
email_user="huangyong@doweidu.com"
#email_title="rabbitmq connection lost"
email_send=0

#send email
function send_email () {
   echo "$(nmap -p $port $host)" | mail -s $1 $email_user

}

while true;do
   nmap -p $port $host | grep "${port}/tcp open" > /dev/null
   if [ $? -ne 0 ];then
       if [ $email_send -eq 0 ];then
          send_email "rabbitmq connection lost"
          email_send=1
       fi
  else
      [ $email_send -eq 1 ] && send_email "rabbitmq connection succeed" && email_send=0
   fi

   sleep 5

done
```

